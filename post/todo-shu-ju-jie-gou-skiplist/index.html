<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="keywords" content="zixfy">
<meta name="description" content="Life is to live it">
<meta name="theme-color" content="#fff">
<title>【TODO】【数据结构】Skiplist | zixfy&#39;s blog</title>
<link rel="shortcut icon" href="/favicon.ico?v=1698999153698">
<link rel="stylesheet" href="/media/css/gemini.css">
<link rel="stylesheet" href="/media/fonts/font-awesome.css">
<link
  href="//fonts.loli.net/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Rosario:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"
  rel="stylesheet" type="text/css">

<link href="/media/hljs/styles/atom-one-dark.css"
  rel="stylesheet">

<link rel="stylesheet" href="/styles/main.css">
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script src="/media/js/jquery.js"></script>
<script src="/media/hljs/highlight.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.ui.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"
  integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"
  integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"
  integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
  onload="renderMathInElement(document.body);"></script>






  <meta name="description" content="【TODO】【数据结构】Skiplist" />
  <meta name="keywords" content="数据结构,算法,TODO" /><script src="https://kit.fontawesome.com/436bcc6aee.js" crossorigin="anonymous"></script>
</head>

<body>
  <div class="head-top-line"></div>
  <div class="header-box">
    
<div class="gemini">
  <header class="header  ">
    <div class="blog-header box-shadow-wrapper bg-color " id="header">
      <div class="nav-toggle" id="nav_toggle">
        <div class="toggle-box">
          <div class="line line-top"></div>
          <div class="line line-center"></div>
          <div class="line line-bottom"></div>
        </div>
      </div>
      <div class="site-meta">       
        <div class="site-title">
          
            <a href="/" class="brand">
              <span>zixfy&#39;s blog</span>
            </a>  
          
        </div>
        
      </div>
      <nav class="site-nav" id="site_nav">
        <ul id="nav_ul">
          
            
            
            <li class="nav-item ">
              
              
                <a href="/" target="_self">
                  <i class="fa fa-github-alt"></i> 首页
                </a>
              
            </li>
          
            
            
            <li class="nav-item ">
              
              
                <a href="/archives" target="_self">
                  <i class="fa fa-book"></i> 归档时间线
                </a>
              
            </li>
          
            
            
            <li class="nav-item ">
              
              
                <a href="/tags" target="_self">
                  <i class="fa fa-tag"></i> 文章标签
                </a>
              
            </li>
          
            
            
            <li class="nav-item ">
              
              
                <a href="/post/about" target="_self">
                  <i class="fa fa-user"></i> 站长信息
                </a>
              
            </li>
          
          
            
              <li class="nav-item ">
                <a href="/friends/" target="_blank">
                  
                    <i class="fa fa-address-book"></i> 友情链接❤
                  
                </a>
              </li>
            
          
          
            <li id="fa_search" class="nav-item">
              <a href="javascript:void(0);">
                <i class="fa fa-search"></i> <span class="language" data-lan="search">搜索</span>
              </a>
            </li>
          
        </ul>
      </nav>
    </div>
  </header>
</div>

<script type="text/javascript"> 
 
  let showNav = true;

  let navToggle = document.querySelector('#nav_toggle'),
  siteNav = document.querySelector('#site_nav');
  
  function navClick() {
    let sideBar = document.querySelector('.sidebar');
    let navUl = document.querySelector('#nav_ul');
    navToggle.classList.toggle('nav-toggle-active');
    siteNav.classList.toggle('nav-menu-active');
    if (siteNav.classList.contains('nav-menu-active')) {
      siteNav.style = "height: " + (navUl.children.length * 42) +"px !important";
    } else {
      siteNav.style = "";
    }
  }

  navToggle.addEventListener('click',navClick);  
</script>
  </div>
  <div class="main-continer">
    
    <div
      class="section-layout gemini ">
      <div class="section-layout-wrapper">
        

<div class="sidebar">
  
    <div class="sidebar-box box-shadow-wrapper bg-color right-motion" id="sidebar">
      
        <div class="post-list-sidebar">
          <div class="sidebar-title">
            <span id="tocSideBar" class="sidebar-title-item sidebar-title-active language" data-lan="index">文章目录</span>
            <span id="metaSideBar" class="sidebar-title-item language" data-lan="preview">站点概览</span>
          </div>
        </div>
      
      <div class="sidebar-body gemini" id="sidebar_body">
        
          
            


<div class="sidebar-wrapper box-shadow-wrapper bg-color">
  <div class="sidebar-item">
    <img class="site-author-image right-motion" src="/images/avatar.png"/>
    <p class="site-author-name">zixfy</p>
    
    <div class="site-description right-motion">
      
        <p id="binft">Life is to live it</p>
      
    </div>
    
  </div>
  <div class="sidebar-item side-item-stat right-motion">
    <div class="sidebar-item-box">
      <a href="/archives/">
        
        <span class="site-item-stat-count">43</span>
        <span class="site-item-stat-name language" data-lan="article">文章</span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="/tags/">
        <span class="site-item-stat-count">19</span>
        <span class="site-item-stat-name language" data-lan="tag">标签</span>
      </a>
    </div>
  </div>
  
    
      <div class="sidebar-item">
        <span class="site-item-rss">
            <i class="fa fa-rss"></i>
            <a href="http://zixfy.github.io/atom.xml" target="_blank">RSS</a>
        </span>
      </div>
    
  
  
    <div class="sidebar-item sidebar-item-social">
      <div class="social-item">
        
          
            
            <a href="https:///github.com/zixfy">
              
              <i class="fa-brands fa-github" title="Github"></i>
              
            </a>
          
            
            <a href="https://www.zhihu.com/people/leon-87-10">
              
              <i class="fa-brands fa-zhihu" title="Zhihu"></i>
              
            </a>
          
            
            <a href="https://space.bilibili.com/3876759">
              
              <i class="fa-brands fa-bilibili" title="bilibili"></i>
              
            </a>
          
            
            <a href="https://www.cnblogs.com/zixfy/">
              
              <i class="fa-solid fa-blog" title="cnblogs"></i>
              
            </a>
          
            
            <a href="https://steamcommunity.com/profiles/76561198852826784">
              
              <i class="fa-brands fa-steam" title="steam"></i>
              
            </a>
          
            
            <a href="https://gitee.com/iff0">
              
              <i class="fa-brands fa-git" title="gitee"></i>
              
            </a>
          
            
            <a href="https://leetcode.cn/u/zixfy/">
              
              <i class="fa-solid fa-code" title="Leetcode"></i>
              
            </a>
          
        
        
      </div>
    </div>
  
  
    <div style="width: 100%; position: relative;">
      <canvas id="canvasDiyBlock" style="width:100%;">当前浏览器不支持canvas，请更换浏览器后再试</canvas>
      <script src="/media/js/magic/clock.js"></script>
    </div>
  

  
    <div class="sidebar-item right-motion sidebar-item-friends">
      
        <p class="friends-title"><i class="fa fa-link"></i> 友情链接❤</p>
      
      <div class="friends-box">
        
          
            <a href="https://github.com/FlyHighest">Terry Zhang, </a>
            
         
        
          
            <a href="https://github.com/zhangguiwei610">zhangguiwei, </a>
            
         
        
          
            <a href="https://github.com/yuanmaoxun">yuanmaoxun, </a>
            
         
        
          
            <a href="https://github.com/LittleGuoKe">Yang Shan, </a>
            
         
        
          
            <a href="https://jingtao.fun/">jingtao, </a>
            
         
        
          
            <a href="https://github.com/clbg">Cheng Peng, </a>
            
         
        
          
            <a href="https://liyirui-git.github.io/">liyirui, </a>
            
         
        
          
              <a href="https://github.com/aboriginalZero">aboriginalZero</a>
            
         
        
      </div>
    </div>
  



</div>
          
        
      </div>
    </div>
  
</div>
<script>
  const SIDEBAR_TITLE_ACTIVE = 'sidebar-title-active';
  const SIDEBAR_BODY_ACTIVE = 'sidebar-body-active';
  const SLIDE_UP_IN = 'slide-up-in';

  let sidebar = document.querySelector('#sidebar'),
  tocSideBar = document.querySelector('#tocSideBar'),
  metaSideBar = document.querySelector('#metaSideBar'),
  postToc = document.querySelector('#post_toc'),
  postSiteMeta = document.querySelector('#post_side_meta'),
  sidebarTitle = document.querySelector('.sidebar-title'),
  sidebarBody = document.querySelector('#sidebar_body');

  tocSideBar && tocSideBar.addEventListener('click', (e) => {
    toggleSidebar(e);
  });

  metaSideBar && metaSideBar.addEventListener('click', (e) => {
    toggleSidebar(e);
  });

  function toggleSidebar(e) {
    let currentTitle = document.querySelector("."+SIDEBAR_TITLE_ACTIVE);
    if (currentTitle == e.srcElement) {
      return ;
    }
    let current, showElement, hideElement;
    if (e.srcElement == metaSideBar) {
      showElement = postSiteMeta;
      hideElement = postToc;
    } else if (e.srcElement == tocSideBar){
      showElement = postToc;
      hideElement = postSiteMeta;
    }
    currentTitle.classList.remove(SIDEBAR_TITLE_ACTIVE);
    e.srcElement.classList.add(SIDEBAR_TITLE_ACTIVE);

    jQuery.Velocity(hideElement, 'stop');
    jQuery.Velocity(hideElement, 'transition.slideUpOut', {
      display: 'none',
      duration: 200,
      complete: function () {
        jQuery.Velocity(showElement, 'transition.slideDownIn', {
          duration: 200
        });
      }
    })
    hideElement.classList.remove(SIDEBAR_BODY_ACTIVE);
    showElement.classList.add(SIDEBAR_BODY_ACTIVE);
  }

  postToc && postToc.addEventListener('transitionend', function() {
    this.classList.remove(SLIDE_UP_IN);
  });

  if (sidebarBody) {
    if (sidebarBody.classList.contains('pisces') || sidebarBody.classList.contains('gemini')) {
      let hasFix = false;
      let scrollEl = document.querySelector('.main-continer');
      let limitTop = document.querySelector('#nav_ul').children.length * 42 + 162;
      window.addEventListener('scroll', function(e) {
        if (document.scrollingElement.scrollTop >= limitTop) {
          if (!hasFix) {
            sidebar.classList.add('sidebar-fixed');
            hasFix = true;
          }
        } else {
          if (hasFix) {
            sidebar.classList.remove('sidebar-fixed');
            hasFix = false;
          }
        }
      });
    }
  }
  
</script>
        <div class="section-box box-shadow-wrapper">
          <div class="section bg-color post post-page">
             <section class="post-header">
  <h1 class="post-title">
    <a class="post-title-link" href="http://zixfy.github.io/post/todo-shu-ju-jie-gou-skiplist/"> 【TODO】【数据结构】Skiplist </a>
  </h1>

  <div class="post-meta">
    
    <span class="meta-item pc-show">
      <i class="fa fa-calendar-o"></i>
      <span class="language" data-lan="publish">发布于</span>
      <span class="publish-time" data-t="2023-09-15 14:19:56">2023-09-15</span>
      <span class="post-meta-divider pc-show">|</span>
    </span>
    
    <span class="meta-item">
      <i class="fa fa-folder-o"></i>
      <span class="pc-show language" data-lan="category-in">标签:</span>
       
      <a href="http://zixfy.github.io/tag/OrYJKqacl/"> <span>数据结构</span> </a>、   
      <a href="http://zixfy.github.io/tag/RoDR350ft/"> <span>算法</span> </a>、   
      <a href="http://zixfy.github.io/tag/K2jofOwxj/">
        <span>TODO</span>
      </a>
       
    </span>
    <span class="post-meta-divider">|</span>
    
    <span class="meta-item">
      <i class="fa fa-clock-o"></i>
      <span
        >1<span class="language" data-lan="minute"
          >分钟</span
        ></span
      >
    </span>
    <span class="meta-item">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-file-word-o"></i>
      <span
        >1<span class="pc-show language" data-lan="words"
          >字数</span
        ></span
      >
    </span>
      
    <span
      id="/post/todo-shu-ju-jie-gou-skiplist/"
      data-flag-title="【TODO】【数据结构】Skiplist"
      class="meta-item pc-show leancloud_visitors"
    >
      <span class="post-meta-divider">|</span>
      <i class="fa fa-eye"></i>
      <span
        ><span class="language" data-lan="view">浏览量:</span>:<span
          class="leancloud-visitors-count"
        ></span
      ></span>
    </span>
    
  </div>
</section>

            
            
           <div class="post-body next-md-body" id="post_body">
              <p>.todo</p>

            </div>
            
            
              <div class="post-footer">
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong class="language" data-lan="author">本文作者：</strong>
      zixfy
    </li>
    <li class="post-copyright-link">
      <strong class="language" data-lan="link">本文链接：</strong>
      <a href="http://zixfy.github.io/post/todo-shu-ju-jie-gou-skiplist/" title="【TODO】【数据结构】Skiplist">http://zixfy.github.io/post/todo-shu-ju-jie-gou-skiplist/</a>
    </li>
    <li class="post-copyright-license">
      <strong class="language" data-lan="copyright">版权声明： </strong>
      本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！
    </li>
  </ul>
  <div class="tags">
    
      <a href="http://zixfy.github.io/tag/OrYJKqacl/"># 数据结构</a>
    
      <a href="http://zixfy.github.io/tag/RoDR350ft/"># 算法</a>
    
      <a href="http://zixfy.github.io/tag/K2jofOwxj/"># TODO</a>
    
  </div>
  <div class="nav">
    <div class="nav-prev">
      
        <i class="fa fa-chevron-left"></i>
        <a class="nav-pc-next" title="【TODO】【数据结构】(红黑树变体)AA树" href="http://zixfy.github.io/post/shu-ju-jie-gou-aa-shu/">【TODO】【数据结构】(红黑树变体)AA树</a class="nav-pc-next">
        <a class="nav-mobile-prev" title="【TODO】【数据结构】(红黑树变体)AA树" href="http://zixfy.github.io/post/shu-ju-jie-gou-aa-shu/">上一篇</a>
      
    </div>
    <div class="nav-next">
      
        <a class="nav-pc-next" title="【C++】HTTP报文解析" href="http://zixfy.github.io/post/todo-c-http-bao-wen-jie-xi/">【C++】HTTP报文解析</a>
        <a class="nav-mobile-next" title="【C++】HTTP报文解析" href="http://zixfy.github.io/post/todo-c-http-bao-wen-jie-xi/">下一篇</a>
        <i class="fa fa-chevron-right"></i>
      
    </div>
  </div>
</div>
            
            
              
  <script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script>
<div id="vcomments" style="padding: 10px 0px 0px 0px"></div>

<style>
  .v .veditor {
    min-height: 10rem;
    background-image: url('');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: right;
    background-color: rgba(255, 255, 255, 0);
    resize: none;
  }

  .v .vwrap {
    border: 1px solid #000 !important;
  }

  .v .vbtn {
    padding: .4rem 1.2rem !important;
    border-color: #fff !important;
    background-color: #49b1f5 !important;
    color: #fff !important;
    font-size: .7rem !important;
  }

  .v .vcards .vcard .vh .vmeta .vat {
    padding: 0 .8rem !important;
    border: 1px solid #00c4b6 !important;
    border-radius: 5px !important;
    color: #00c4b6 !important;
  }
</style>
<script>
  new Valine({
    el: '#vcomments',
    appId: 'd2X4Uv8nepG3BAzr3gOkxqwb-gzGzoHsz',
    appKey: 'tUtSjtS83dWwLXyy2uW123ux',
    avatar: 'custom',
    placeholder: '',
    pageSize: '',
    lang: 'zh-cn',
    enableQQ: 'true' === 'false',
    visitor: 'true' === 'true',
    highlight: 'true' === 'true',
    avatarForce: 'true' === 'false',
    serverURLs: '',
		recordIP: 'true' === 'true',
  });
  // Get the current URL
var currentURL = window.location.pathname;

// Check if the current URL is "/"
if (currentURL === "/" || currentURL == "/home" || currentURL.startsWith("/page/")) {
  // Hide the div
  document.getElementById("vcomments").style.display = "none";
}

</script>

            
          </div>
        </div>
      </div>
    </div>
    <div class="footer-box">
  <footer class="footer">
    <center id="runTimeBox">
      已运行:<span id="run_time"></span>
    </center>
    <span id="busuanzi_container_site_pv">浏览数:<span id="busuanzi_value_site_pv"></span> 次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">访客数:<span id="busuanzi_value_site_uv"></span> 人</span>

    <script>
      BirthDay = new Date('');
      if (BirthDay.getTime()) {
        function runTime() {
          str = "";
          today = new Date();
          timeold = today.getTime() - BirthDay.getTime();
          msPerDay = 24 * 60 * 60 * 1000;
          e_daysold = timeold / msPerDay;
          daysold = Math.floor(e_daysold);
          str += daysold + "天";
          return str;
        }
        setInterval(function () {
          $("#run_time").html(runTime());
        }, 1000);
      } else {
        document.querySelector('.footer').removeChild(document.querySelector('#runTimeBox'));
      }
    </script>
    <div class="poweredby">
      <!-- Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> -->
    </div>
  </footer>
  
    
        <div class="gemini back-to-top" id="back_to_top">
          <i class="fa fa-arrow-up"></i>
          
            <span class="scrollpercent"> <span id="back_to_top_text">0</span>% </span>
            
        </div>
        
                  
                    
<link rel="stylesheet" href="/media/live2d/css/live2d.css" />
<div class="box-scale">
  <div id="landlord" style="left: 5px;bottom: px;"
    data-key="">
    <canvas id="live2d" width="500" height="560" class="live2d"></canvas>
    

      <div class="message" style="opacity:0"></div>
      <div class="live_talk_input_body">
        <div class="live_talk_input_name_body">
          <input name="name" type="text" class="live_talk_name white_input" id="AIuserName" autocomplete="off"
            placeholder="你的名字" />
        </div>
        <div class="live_talk_input_text_body">
          <input name="talk" type="text" class="live_talk_talk white_input" id="AIuserText" autocomplete="off"
            placeholder="要和我聊什么呀？" />
          <button type="button" class="live_talk_send_btn" id="talk_send">发送</button>
        </div>
      </div>
      <input name="live_talk" id="live_talk" value="1" type="hidden" />
      <div class="live_ico_box">
        <div class="live_ico_item type_info" id="showInfoBtn"></div>
        <div class="live_ico_item type_talk" id="showTalkBtn"></div>
        
        <div class="live_ico_item type_youdu" id="youduButton"></div>
        <div class="live_ico_item type_quit" id="hideButton"></div>
        <input name="live_statu_val" id="live_statu_val" value="0" type="hidden" />
        <audio src="" style="display:none;" id="live2d_bgm" data-bgm="0" preload="none"></audio>
        <input id="duType" value="douqilai" type="hidden">
        
      </div>
    
  </div>
</div>
<div id="open_live2d">召唤看板娘</div>
<script>
  var message_Path = 'https://cdn.jsdelivr.net/gh/hsxyhao/live2d.github.io@master/';
  let landlord = document.querySelector('#landlord');
  var apiKey = landlord.dataset.key;
</script>
<script type="text/javascript" src="/media/live2d/js/live2d.js"></script>
<script>
	var home_Path = document.location.protocol + '//' + window.document.location.hostname + ":" + window.document.location.port + '/';
	var userAgent = window.navigator.userAgent.toLowerCase();
	var norunAI = ["android", "iphone", "ipod", "ipad", "windows phone", "mqqbrowser", "msie", "trident/7.0"];
	var norunFlag = false;

	for (var i = 0; i < norunAI.length; i++) {
		if (userAgent.indexOf(norunAI[i]) > -1) {
			norunFlag = true;
			break;
		}
	}

	if (!window.WebGLRenderingContext) {
		norunFlag = true;
	}

	if (!norunFlag) {
		var hitFlag = false;
		var AIFadeFlag = false;
		var liveTlakTimer = null;
		var sleepTimer_ = null;
		var AITalkFlag = false;
		var talkNum = 0;
		(function () {
			function renderTip(template, context) {
				var tokenReg = /(\\)?\{([^\{\}\\]+)(\\)?\}/g;
				return template.replace(tokenReg, function (word, slash1, token, slash2) {
					if (slash1 || slash2) {
						return word.replace('\\', '');
					}
					var variables = token.replace(/\s/g, '').split('.');
					var currentObject = context;
					var i, length, variable;
					for (i = 0, length = variables.length; i < length; ++i) {
						variable = variables[i];
						currentObject = currentObject[variable];
						if (currentObject === undefined || currentObject === null) return '';
					}
					return currentObject;
				});
			}

			String.prototype.renderTip = function (context) {
				return renderTip(this, context);
			};

			var re = /x/;
			re.toString = function () {
				showMessage('哈哈，你打开了控制台，是想要看看我的秘密吗？', 5000);
				return '';
			};

			$(document).on('copy', function () {
				showMessage('你都复制了些什么呀，转载要记得加上出处哦~~', 5000);
			});

			function initTips() {
				$.ajax({
					cache: true,
					url: message_Path + 'message.json',
					dataType: "json",
					success: function (result) {
						$.each(result.mouseover, function (index, tips) {
							$(tips.selector).mouseover(function () {
								var text = tips.text;
								if (Array.isArray(tips.text)) text = tips.text[Math.floor(Math.random() * tips.text.length + 1) - 1];
								text = text.renderTip({ text: $(this).text() });
								showMessage(text, 3000);
								talkValTimer();
								clearInterval(liveTlakTimer);
								liveTlakTimer = null;
							});
							$(tips.selector).mouseout(function () {
								showHitokoto();
								if (liveTlakTimer == null) {
									liveTlakTimer = window.setInterval(function () {
										showHitokoto();
									}, 15000);
								};
							});
						});
						$.each(result.click, function (index, tips) {
							$(tips.selector).click(function () {
								if (hitFlag) {
									return false
								}
								hitFlag = true;
								setTimeout(function () {
									hitFlag = false;
								}, 8000);
								var text = tips.text;
								if (Array.isArray(tips.text)) text = tips.text[Math.floor(Math.random() * tips.text.length + 1) - 1];
								text = text.renderTip({ text: $(this).text() });
								showMessage(text, 3000);
							});
							clearInterval(liveTlakTimer);
							liveTlakTimer = null;
							if (liveTlakTimer == null) {
								liveTlakTimer = window.setInterval(function () {
									showHitokoto();
								}, 15000);
							};
						});
					}
				});
			}
			initTips();

			var text;
			if (document.referrer !== '') {
				var referrer = document.createElement('a');
				referrer.href = document.referrer;
				text = '嗨！来自 <span style="color:#0099cc;">' + referrer.hostname + '</span> 的朋友！';
				var domain = referrer.hostname.split('.')[1];
				if (domain == 'baidu') {
					text = '嗨！ 来自 百度搜索 的朋友！<br>欢迎访问<span style="color:#0099cc;">「 ' + document.title.split(' - ')[0] + ' 」</span>';
				} else if (domain == 'so') {
					text = '嗨！ 来自 360搜索 的朋友！<br>欢迎访问<span style="color:#0099cc;">「 ' + document.title.split(' - ')[0] + ' 」</span>';
				} else if (domain == 'google') {
					text = '嗨！ 来自 谷歌搜索 的朋友！<br>欢迎访问<span style="color:#0099cc;">「 ' + document.title.split(' - ')[0] + ' 」</span>';
				}
			} else {
				if (window.location.href == home_Path) { //主页URL判断，需要斜杠结尾
					var now = (new Date()).getHours();
					if (now > 23 || now <= 5) {
						text = '你是夜猫子呀？这么晚还不睡觉，明天起的来嘛？';
					} else if (now > 5 && now <= 7) {
						text = '早上好！一日之计在于晨，美好的一天就要开始了！';
					} else if (now > 7 && now <= 11) {
						text = '上午好！工作顺利嘛，不要久坐，多起来走动走动哦！';
					} else if (now > 11 && now <= 14) {
						text = '中午了，工作了一个上午，现在是午餐时间！';
					} else if (now > 14 && now <= 17) {
						text = '午后很容易犯困呢，今天的运动目标完成了吗？';
					} else if (now > 17 && now <= 19) {
						text = '傍晚了！窗外夕阳的景色很美丽呢，最美不过夕阳红~~';
					} else if (now > 19 && now <= 21) {
						text = '晚上好，今天过得怎么样？';
					} else if (now > 21 && now <= 23) {
						text = '已经这么晚了呀，早点休息吧，晚安~~';
					} else {
						text = '嗨~ 快来逗我玩吧！';
					}
				} else {
					text = '欢迎阅读<span style="color:#0099cc;">「 ' + document.title.split(' - ')[0] + ' 」</span>';
				}
			}
			showMessage(text, 12000);
		})();

		liveTlakTimer = setInterval(function () {
			showHitokoto();
		}, 15000);

		function showHitokoto() {
			if (sessionStorage.getItem("Sleepy") !== "1") {
				if (!AITalkFlag) {
					$.getJSON('https://v1.hitokoto.cn/', function (result) {
						talkValTimer();
						showMessage(result.hitokoto, 0);
					});
				}
			} else {
				hideMessage(0);
				if (sleepTimer_ == null) {
					sleepTimer_ = setInterval(function () {
						checkSleep();
					}, 200);
				}
			}
		}

		function checkSleep() {
			var sleepStatu = sessionStorage.getItem("Sleepy");
			if (sleepStatu !== '1') {
				talkValTimer();
				showMessage('你回来啦~', 0);
				clearInterval(sleepTimer_);
				sleepTimer_ = null;
			}
		}

		function showMessage(text, timeout) {
			if (Array.isArray(text)) text = text[Math.floor(Math.random() * text.length + 1) - 1];
			$('.message').stop();
			$('.message').html(text);
			$('.message').fadeTo(200, 1);
			//if (timeout === null) timeout = 5000;
			//hideMessage(timeout);
		}
		function talkValTimer() {
			$('#live_talk').val('1');
		}

		function hideMessage(timeout) {
			//$('.message').stop().css('opacity',1);
			if (timeout === null) timeout = 5000;
			$('.message').delay(timeout).fadeTo(200, 0);
		}

		function initLive2d() {
			$('#hideButton').on('click', function () {
				if (AIFadeFlag) {
					return false;
				} else {
					AIFadeFlag = true;
					localStorage.setItem("live2dhidden", "0");
					$('#landlord').fadeOut(200);
					$('#open_live2d').delay(200).fadeIn(200);
					setTimeout(function () {
						AIFadeFlag = false;
					}, 300);
				}
			});
			$('#open_live2d').on('click', function () {
				if (AIFadeFlag) {
					return false;
				} else {
					AIFadeFlag = true;
					localStorage.setItem("live2dhidden", "1");
					$('#open_live2d').fadeOut(200);
					$('#landlord').delay(200).fadeIn(200);
					setTimeout(function () {
						AIFadeFlag = false;
					}, 300);
				}
			});
			$('#youduButton').on('click', function () {
				if ($('#youduButton').hasClass('doudong')) {
					var typeIs = $('#youduButton').attr('data-type');
					$('#youduButton').removeClass('doudong');
					$('body').removeClass(typeIs);
					$('#youduButton').attr('data-type', '');
				} else {
					var duType = $('#duType').val();
					var duArr = duType.split(",");
					var dataType = duArr[Math.floor(Math.random() * duArr.length)];

					$('#youduButton').addClass('doudong');
					$('#youduButton').attr('data-type', dataType);
					$('body').addClass(dataType);
				}
			});
			if (apiKey) {
				$('#showInfoBtn').on('click', function () {
					var live_statu = $('#live_statu_val').val();
					if (live_statu == "0") {
						return
					} else {
						$('#live_statu_val').val("0");
						$('.live_talk_input_body').fadeOut(500);
						AITalkFlag = false;
						showHitokoto();
						$('#showTalkBtn').show();
						$('#showInfoBtn').hide();
					}
				});
				$('#showTalkBtn').on('click', function () {
					var live_statu = $('#live_statu_val').val();
					if (live_statu == "1") {
						return
					} else {
						$('#live_statu_val').val("1");
						$('.live_talk_input_body').fadeIn(500);
						AITalkFlag = true;
						$('#showTalkBtn').hide();
						$('#showInfoBtn').show();

					}
				});
				$('#talk_send').on('click', function () {
					var info_ = $('#AIuserText').val();
					var userid_ = $('#AIuserName').val();
					if (info_ == "") {
						showMessage('写点什么吧！', 0);
						return;
					}
					if (userid_ == "") {
						showMessage('聊之前请告诉我你的名字吧！', 0);
						return;
					}
					showMessage('思考中~', 0);
					let protocol = window.location.protocol.indexOf("s") > 0 ? "https" : "http";
					$.ajax({
						type: "get",
						url: `${protocol}://www.tuling123.com/openapi/api?key=${apiKey}&info=${info_}`,
						dataType: "json",
						success: function (res) {
							talkValTimer();
							showMessage(res.text, 0);
							$('#AIuserText').val("");
							sessionStorage.setItem("live2duser", userid_);
						},
						error: function (e) {
							talkValTimer();
							showMessage('似乎有什么错误，请和站长联系！', 0);
						}
					});
				});
			} else {
				$('#showInfoBtn').hide();
				$('#showTalkBtn').hide();
			}
			//获取音乐信息初始化
			var bgmListInfo = $('input[name=live2dBGM]');
			if (bgmListInfo.length == 0) {
				$('#musicButton').hide();
			} else {
				var bgmPlayNow = parseInt($('#live2d_bgm').attr('data-bgm'));
				var bgmPlayTime = 0;
				var live2dBGM_Num = sessionStorage.getItem("live2dBGM_Num");
				var live2dBGM_PlayTime = sessionStorage.getItem("live2dBGM_PlayTime");
				if (live2dBGM_Num) {
					if (live2dBGM_Num <= $('input[name=live2dBGM]').length - 1) {
						bgmPlayNow = parseInt(live2dBGM_Num);
					}
				}
				if (live2dBGM_PlayTime) {
					bgmPlayTime = parseInt(live2dBGM_PlayTime);
				}
				var live2dBGMSrc = bgmListInfo.eq(bgmPlayNow).val();
				$('#live2d_bgm').attr('data-bgm', bgmPlayNow);
				$('#live2d_bgm').attr('src', live2dBGMSrc);
				$('#live2d_bgm')[0].currentTime = bgmPlayTime;
				$('#live2d_bgm')[0].volume = 0.5;
				var live2dBGM_IsPlay = sessionStorage.getItem("live2dBGM_IsPlay");
				var live2dBGM_WindowClose = sessionStorage.getItem("live2dBGM_WindowClose");
				if (live2dBGM_IsPlay == '0' && live2dBGM_WindowClose == '0') {
					$('#live2d_bgm')[0].play();
					$('#musicButton').addClass('play');
				}
				sessionStorage.setItem("live2dBGM_WindowClose", '1');
				$('#musicButton').on('click', function () {
					if ($('#musicButton').hasClass('play')) {
						$('#live2d_bgm')[0].pause();
						$('#musicButton').removeClass('play');
						sessionStorage.setItem("live2dBGM_IsPlay", '1');
					} else {
						$('#live2d_bgm')[0].play();
						$('#musicButton').addClass('play');
						sessionStorage.setItem("live2dBGM_IsPlay", '0');
					}
				});
				window.onbeforeunload = function () {
					sessionStorage.setItem("live2dBGM_WindowClose", '0');
					if ($('#musicButton').hasClass('play')) {
						sessionStorage.setItem("live2dBGM_IsPlay", '0');
					}
				}
				document.getElementById('live2d_bgm').addEventListener("timeupdate", function () {
					var live2dBgmPlayTimeNow = document.getElementById('live2d_bgm').currentTime;
					sessionStorage.setItem("live2dBGM_PlayTime", live2dBgmPlayTimeNow);
				});
				document.getElementById('live2d_bgm').addEventListener("ended", function () {
					var listNow = parseInt($('#live2d_bgm').attr('data-bgm'));
					listNow++;
					if (listNow > $('input[name=live2dBGM]').length - 1) {
						listNow = 0;
					}
					var listNewSrc = $('input[name=live2dBGM]').eq(listNow).val();
					sessionStorage.setItem("live2dBGM_Num", listNow);
					$('#live2d_bgm').attr('src', listNewSrc);
					$('#live2d_bgm')[0].play();
					$('#live2d_bgm').attr('data-bgm', listNow);
				});
				document.getElementById('live2d_bgm').addEventListener("error", function () {
					$('#live2d_bgm')[0].pause();
					$('#musicButton').removeClass('play');
					showMessage('音乐似乎加载不出来了呢！', 0);
				});
			}
			//获取用户名
			var live2dUser = sessionStorage.getItem("live2duser");
			if (live2dUser !== null) {
				$('#AIuserName').val(live2dUser);
			}
			//获取位置
			var landL = sessionStorage.getItem("historywidth");
			var landB = sessionStorage.getItem("historyheight");
			if (landL == null || landB == null) {
				landL = '5px'
				landB = '0px'
			}
			$('#landlord').css('left', landL + 'px');
			$('#landlord').css('bottom', landB + 'px');
			//移动
			function getEvent() {
				return window.event || arguments.callee.caller.arguments[0];
			}
			var smcc = document.getElementById("landlord");
			var moveX = 0;
			var moveY = 0;
			var moveBottom = 0;
			var moveLeft = 0;
			var moveable = false;
			var docMouseMoveEvent = document.onmousemove;
			var docMouseUpEvent = document.onmouseup;
			smcc.onmousedown = function () {
				var ent = getEvent();
				moveable = true;
				moveX = ent.clientX;
				moveY = ent.clientY;
				var obj = smcc;
				moveBottom = parseInt(obj.style.bottom);
				moveLeft = parseInt(obj.style.left);
				if (isFirefox = navigator.userAgent.indexOf("Firefox") > 0) {
					window.getSelection().removeAllRanges();
				}
				document.onmousemove = function () {
					if (moveable) {
						var ent = getEvent();
						var x = moveLeft + ent.clientX - moveX;
						var y = moveBottom + (moveY - ent.clientY);
						obj.style.left = x + "px";
						obj.style.bottom = y + "px";
					}
				};
				document.onmouseup = function () {
					if (moveable) {
						var historywidth = obj.style.left;
						var historyheight = obj.style.bottom;
						historywidth = historywidth.replace('px', '');
						historyheight = historyheight.replace('px', '');
						sessionStorage.setItem("historywidth", historywidth);
						sessionStorage.setItem("historyheight", historyheight);
						document.onmousemove = docMouseMoveEvent;
						document.onmouseup = docMouseUpEvent;
						moveable = false;
						moveX = 0;
						moveY = 0;
						moveBottom = 0;
						moveLeft = 0;
					}
				};
			};
		}
		$(document).ready(function () {
			var AIimgSrc = [];
			let chooseLive2d = 'aoba'
			if (chooseLive2d === 'histoire') {
				AIimgSrc.push(message_Path + "model/histoire/histoire.1024/texture_00.png");
				AIimgSrc.push(message_Path + "model/histoire/histoire.1024/texture_01.png");
				AIimgSrc.push(message_Path + "model/histoire/histoire.1024/texture_02.png");
				AIimgSrc.push(message_Path + "model/histoire/histoire.1024/texture_03.png");
			} else if (chooseLive2d === 'rem') {
				AIimgSrc.push(message_Path + "model/rem/remu2048/texture_00.png");
			} else if (chooseLive2d === 'aoba') {
				AIimgSrc.push(message_Path + "model/aoba/textures/texture_00.png");
			} else if (chooseLive2d === 'hijiki') {
				AIimgSrc.push(message_Path + "model/hijiki/moc/hijiki.2048/texture_00.png");
			} else if (chooseLive2d === 'tororo') {
				AIimgSrc.push(message_Path + "model/tororo/moc/tororo.2048/texture_00.png");
			}
			var images = [];
			var imgLength = AIimgSrc.length;
			var loadingNum = 0;
			for (var i = 0; i < imgLength; i++) {
				images[i] = new Image();
				images[i].src = AIimgSrc[i];
				images[i].onload = function () {
					loadingNum++;
					if (loadingNum === imgLength) {
						var live2dhidden = localStorage.getItem("live2dhidden");
						if (live2dhidden === "0") {
							setTimeout(function () {
								$('#open_live2d').fadeIn(200);
							}, 1300);
						} else {
							setTimeout(function () {
								$('#landlord').fadeIn(200);
							}, 1300);
						}
						let model = '';
						if (chooseLive2d === 'histoire') {
							model = message_Path + "model/histoire/model.json";
						} else if (chooseLive2d === 'rem') {
							model = message_Path + "model/rem/model.json";
						} else if (chooseLive2d === 'aoba') {
							model = message_Path + "model/aoba/model.json";
						} else if (chooseLive2d === 'hijiki') {
							model = message_Path + "model/hijiki/hijiki.model.json";
						} else if (chooseLive2d === 'tororo') {
							model = message_Path + "model/tororo/tororo.model.json";
						}
						setTimeout(function () {
							loadlive2d("live2d", model);
						}, 1000);
						initLive2d();
						images = null;
					}
				}
			}
		});
	}
</script>
                      
                        
</div>
<script>
  let sideBarOpen = "sidebar-open";
  let body = document.body;
  let back2Top = document.querySelector("#back_to_top"),
    back2TopText = document.querySelector("#back_to_top_text"),
    drawerBox = document.querySelector("#drawer_box"),
    rightSideBar = document.querySelector(".sidebar"),
    viewport = document.querySelector("body");

  function scrollAnimation(currentY, targetY) {
    let needScrollTop = targetY - currentY;
    let _currentY = currentY;
    setTimeout(() => {
      const dist = Math.ceil(needScrollTop / 10);
      _currentY += dist;
      window.scrollTo(_currentY, currentY);
      if (needScrollTop > 10 || needScrollTop < -10) {
        scrollAnimation(_currentY, targetY);
      } else {
        window.scrollTo(_currentY, targetY);
      }
    }, 1);
  }

  back2Top.addEventListener("click", function (e) {
    scrollAnimation(document.scrollingElement.scrollTop, 0);
    e.stopPropagation();
    return false;
  });

  window.addEventListener("scroll", function (e) {
    let percent =
      (document.scrollingElement.scrollTop /
        (document.scrollingElement.scrollHeight -
          document.scrollingElement.clientHeight)) *
      100;
    if (percent > 1 && !back2Top.classList.contains("back-top-active")) {
      back2Top.classList.add("back-top-active");
    }
    if (percent == 0) {
      back2Top.classList.remove("back-top-active");
    }
    if (back2TopText) {
      back2TopText.textContent = Math.floor(percent);
    }
  });

  let hasCacu = false;
  window.addEventListener("resize", function (e) {
    calcuHeight();
  });

  function calcuHeight() {
    // 动态调整站点概览高度
    if (
      (!hasCacu && back2Top.classList.contains("pisces")) ||
      back2Top.classList.contains("gemini")
    ) {
      let sideBar = document.querySelector(".sidebar");
      let navUl = document.querySelector("#site_nav");
      sideBar.style =
        "margin-top:" + (navUl.offsetHeight + navUl.offsetTop + 15) + "px;opacity: 1; display: block;";
      hasCacu = true;
    }
  }
  calcuHeight();

  let open = false,
    MOTION_TIME = 300,
    RIGHT_MOVE_DIS = "320px";

  if (drawerBox) {
    let rightMotions = document.querySelectorAll(".right-motion");
    let right = drawerBox.classList.contains("right");

    let transitionDir = right
      ? "transition.slideRightIn"
      : "transition.slideLeftIn";

    let openProp, closeProp;
    if (right) {
      openProp = {
        paddingRight: RIGHT_MOVE_DIS,
      };
      closeProp = {
        paddingRight: "0px",
      };
    } else {
      openProp = {
        paddingLeft: RIGHT_MOVE_DIS,
      };
      closeProp = {
        paddingLeft: "0px",
      };
    }

    drawerBox.onclick = function () {
      open = !open;
      jQuery.Velocity(rightSideBar, "stop");
      jQuery.Velocity(viewport, "stop");
      jQuery.Velocity(rightMotions, "stop");
      if (open) {
        jQuery.Velocity(
          rightSideBar,
          {
            width: RIGHT_MOVE_DIS,
          },
          {
            duration: MOTION_TIME,
            begin: function () {
              jQuery.Velocity(rightMotions, transitionDir, {});
            },
          }
        );
        jQuery.Velocity(viewport, openProp, {
          duration: MOTION_TIME,
        });
      } else {
        jQuery.Velocity(
          rightSideBar,
          {
            width: "0px",
          },
          {
            duration: MOTION_TIME,
            begin: function () {
              jQuery.Velocity(rightMotions, {
                opacity: 0,
              });
            },
          }
        );
        jQuery.Velocity(viewport, closeProp, {
          duration: MOTION_TIME,
        });
      }
      for (let i = 0; i < drawerBox.children.length; i++) {
        drawerBox.children[i].classList.toggle("muse-line");
      }
      drawerBox.classList.toggle(sideBarOpen);
    };
  }

  // 链接跳转
  let newWindow = "true";
  if (newWindow === "true") {
    let links = document.querySelectorAll(".post-body a");
    links.forEach((item) => {
      if (!item.classList.contains("btn")) {
        item.setAttribute("target", "_blank");
      }
    });
  }

  let faSearch = document.querySelector("#fa_search");
  faSearch &&
    faSearch.addEventListener("click", function () {
      document.querySelector("#search_mask").style = "";
    });

  // 代码高亮
  hljs.initHighlightingOnLoad();

  // 离开当前页title变化
  var leaveTitle = "";
  var normal_title = document.title;
  if (leaveTitle) {
    document.addEventListener("visibilitychange", function () {
      if (document.visibilityState == "hidden") {
        normal_title = document.title;
        document.title = leaveTitle;
      } else {
        document.title = normal_title;
      }
    });
  }
</script>

<!-- <link rel="stylesheet" href="/media/css/jquery.fancybox.css" />
<script src="/media/js/jquery.fancybox.js"></script>

<script>
  let images = document.querySelectorAll(".section img");
  images.forEach((image) => {
    var parent = image.parentElement;
    var next = image.nextElementSibling;
    parent.removeChild(image);
    var aelem = document.createElement("a");
    aelem.href = image.src;
    aelem.dataset["fancybox"] = "images";
    aelem.dataset["rel"] = "fancybox-button";
    aelem.classList.add("fancybox");
    aelem.appendChild(image);
    parent.insertBefore(aelem, next);
  });
</script> -->

<script src="/media/js/view-image.min.js"></script>
<script>
  window.ViewImage && ViewImage.init('.section img');
</script>
    <div class="reward-mask" style="display: none;">
  <div class="reward-relative">
    <span class="close" aria-hidden="true">x</span>
    <div class="reward-body">
      <h2>感谢您的支持，我会继续努力的!</h2>
      <div class="reward-img-box">
        <div style="position: relative; width: 140px; height: 140px;">
          
          
          
        </div>
      </div>
      <p class="reward-word">扫码打赏，你说多少就多少</p>
      <p class="reward-tip"> </p>
    </div>
    <div class="bottom">
      
      
    </div>
  </div>
</div>
<style>
  .reward-mask {
    position: fixed;
    z-index: 99999;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: #00000054;
  }

  .reward-relative {
    position: relative;
    width: 480px;
    text-align: center;
    margin: 0 auto;
    border-radius: 5px;
    background-color: #fff;
    top: 50%;
    margin-top: -205px;
  }

  .reward-relative .close {
    position: absolute;
    right: 10px;
    font-weight: normal;
    font-size: 16px;
    color: #929292;
  }

  .reward-body {
    padding: 40px 20px 20px;
  }

  .bottom {
    display: flex;
  }

  .reward-btn {
    text-align: center;
  }

  .reward-btn-text {
    display: inline-block;
    cursor: pointer;
    width: 60px;
    height: 60px;
    line-height: 60px;
    border-radius: 50%;
    background-color: #ff9734;
    color: #FFF;
    margin-top: 20px;
  }

  .pay-text {
    margin-top: 10px;
    padding: 10px;
    flex: 1;
    transition: all .2s linear;
  }

  .pay-text:hover {
    background-color: #a5a5a536;
  }

  .reward-body h2 {
    padding-top: 10px;
    text-align: center;
    color: #a3a3a3;
    font-size: 16px;
    font-weight: normal;
    margin: 0 0 20px;
  }

  .reward-body h2:after,
  .reward-body h2:before {
    font-family: Arial, Helvetica, sans-serif;
    background: 0 0;
    width: 0;
    height: 0;
    font-style: normal;
    color: #eee;
    font-size: 80px;
    position: absolute;
    top: 20px;
  }

  .reward-body h2:before {
    content: '\201c';
    left: 50px;
  }

  .reward-body h2:after {
    content: '\201d';
    right: 80px;
  }

  .reward-img-box {
    display: inline-block;
    padding: 10px;
    border: 6px solid #ea5f00;
    margin: 0 auto;
    border-radius: 3px;
    position: relative;
  }

  .reward-img {
    position: absolute;
    left: 0px;
    top: 0px;
    width: 100%;
    height: 100%;
  }

  @media (max-width: 767px) {
    .reward-relative {
      height: 100%;
      top: 0px;
      margin-top: 0;
      width: auto;
    }

    .reward-relative .bottom {
      flex-direction: column;
    }

    .reward-relative .pay-text {
      width: 80%;
      margin: 5px auto;
      border: 1px solid silver;
      padding: 6px;
      border-radius: 4px;
    }

    .reward-body h2:after {
      right: 40px;
    }

    .reward-body h2:after,
    .reward-body h2:before {
      font-size: 60px;
    }

    .reward-body h2:before {
      left: 20px;
    }
  }
</style>
<script>
  !function () {
    var mask = document.querySelector('.reward-mask');
    let close = document.querySelector('.reward-relative .close');
    let rewardBtn = document.querySelector('.reward-btn');

    let zfb = document.querySelector('#zfb'),
      wx = document.querySelector('#wx'),
      zfbBtn = document.querySelector('#zfbBtn'),
      wxBtn = document.querySelector('#wxBtn');

    if (zfbBtn && wxBtn) {
      zfbBtn.addEventListener('click', () => {
        jQuery.Velocity(zfb, 'transition.slideLeftIn', {
          duration: 400
        });
        jQuery.Velocity(wx, 'transition.slideRightOut', {
          display: 'none',
          duration: 400
        });
      });

      wxBtn.addEventListener('click', () => {
        jQuery.Velocity(wx, 'transition.slideRightIn', {
          duration: 400
        });
        jQuery.Velocity(zfb, 'transition.slideLeftOut', {
          display: 'none',
          duration: 400
        });
      });
    }

    rewardBtn.addEventListener('click', (e) => {
      jQuery.Velocity(mask, 'transition.slideDownIn', {
        duration: 400
      })
    });

    close.addEventListener('click', (e) => {
      e.preventDefault();
      jQuery.Velocity(mask, 'transition.slideUpOut', {
        duration: 400
      })
    })
  }()
</script>

  </div>
</body>

  <div class="search-mask" id="search_mask" style="display: none;">
  <div class="search-box">
    <div class="search-title">
      <i class="fa fa-search"></i>
      <div class="input-box">
        <input id="search" type="text" class="language" data-lan="search" placeholder="搜索">
      </div>
      <i id="close" class="fa fa-times-circle"></i>
    </div>
    <div class="stat-box">
      <span id="stat_count">0</span><span class="language" data-lan="stat">条相关条目，使用了</span><span id="stat_times">0</span><span class="language" data-lan="stat-time">毫秒</span>
      <hr>
    </div>
    <div class="result" id="result">
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/zai-python-zhong-shi-yong-type-hints-he-mypy/"" data-c="
          &lt;p&gt;原文：&lt;a href=&#34;https://zhuanlan.zhihu.com/p/662747187&#34;&gt;https://zhuanlan.zhihu.com/p/662747187&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;[TOC]&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Reference:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://peps.python.org/pep-0484/&#34;&gt;PEP 484&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Python&lt;/code&gt;是动态类型的解释型语言，所以有时类型不匹配的问题要拖到运行期才能被发现（比如对一个&lt;code&gt;int&lt;/code&gt;对象取下标）&lt;/p&gt;
&lt;p&gt;还有就是如果没有类型信息，代码里&lt;code&gt;naming&lt;/code&gt;又很烂的话，就很难猜出来鼠标指着的那个对象是啥类型，之前帮老师弄一个&lt;code&gt;Python&lt;/code&gt;项目就因为这个问题很打脑阔&lt;/p&gt;
&lt;h3 id=&#34;0-basic&#34;&gt;0-Basic&lt;/h3&gt;
&lt;p&gt;为了解决这些问题，我们可以使用&lt;code&gt;Python3.5+&lt;/code&gt;标准库引入的类型提示（&lt;code&gt;Type Hints&lt;/code&gt;）和辅助用的&lt;code&gt;typing&lt;/code&gt;模块&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Py3.5+&lt;/code&gt;可以为变量&lt;code&gt;instance&lt;/code&gt;、函数&lt;code&gt;function&lt;/code&gt;（方法&lt;code&gt;method&lt;/code&gt;）、类&lt;code&gt;class&lt;/code&gt;、模块&lt;code&gt;module&lt;/code&gt;提供类型提示&lt;/p&gt;
&lt;p&gt;但类型提示只是一种注释，或者说元信息，解释器把类型信息存储到了&lt;code&gt;function&lt;/code&gt;或&lt;code&gt;class type&lt;/code&gt;的&lt;code&gt;__annotation__&lt;/code&gt;属性中&lt;/p&gt;
&lt;p&gt;在运行期，解释器也并不会对变量的类型断言&lt;/p&gt;
&lt;p&gt;类型进行也没有静态检查的要求，需要一个&lt;code&gt;IDE&lt;/code&gt;帮助我们根据&lt;code&gt;Hint&lt;/code&gt;进行类型推导，比如&lt;code&gt;PyCharm&lt;/code&gt;的&lt;code&gt;Type Introspection&lt;/code&gt;，还会在推导出矛盾时给出一个&lt;code&gt;warning&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;或者使用&lt;code&gt;mypy&lt;/code&gt;等&lt;code&gt;static typing checker&lt;/code&gt;，会解析代码找出类型错误&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Type Hint&lt;/code&gt;的好处总结是&lt;/p&gt;
&lt;p&gt;类型推导自动获取调用函数的签名、返回值类型，提高可读性与开发效率&lt;/p&gt;
&lt;p&gt;让运行期潜在的类型安全问题提前暴露&lt;/p&gt;
&lt;h4 id=&#34;type-hint&#34;&gt;Type Hint&lt;/h4&gt;
&lt;p&gt;最基本的语法是使用标注赋值（&lt;code&gt;Annotated assignment statements&lt;/code&gt;），表达式语法为&lt;code&gt;&amp;lt;var&amp;gt; : &amp;lt;type hint&amp;gt; [= &amp;lt;expr&amp;gt;] &lt;/code&gt;，其中&lt;code&gt;type hint&lt;/code&gt;大多情况下是一个&lt;code&gt;type&lt;/code&gt;或者类型名的字符串&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;alpha: int = 0
# or
bravo: &amp;quot;str&amp;quot; = 2.3
# PyCharm: Expected type &#39;str&#39;, got &#39;float&#39; instead
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;（&lt;code&gt;PyCharm&lt;/code&gt;中按住&lt;code&gt;Ctrl&lt;/code&gt;指向变量名可以看推导的类型）&lt;/p&gt;
&lt;p&gt;但这个语法补丁在一些场合不适用，比如元组解构&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;charlie: int, delta: float = (114, 5.14)       
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;根据标注赋值表达式语法&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;annotated_assignment_stmt ::=  augtarget &amp;quot;:&amp;quot; expression
                               [&amp;quot;=&amp;quot; (starred_expression | yield_expression)]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;单纯是因为左手侧只能单变量，不支持解构&lt;/p&gt;
&lt;p&gt;此时可以改写成下方丑陋的形式&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;charlie: int
delta: float
charlie: int, delta: float = (114, 5.14)   
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;但要注意，只给出&lt;code&gt;type hint&lt;/code&gt; ，而不赋值变量，则不会把这个变量名加入到&lt;code&gt;globals&lt;/code&gt;或&lt;code&gt;locals&lt;/code&gt;，也就是说直接使用会抛出&lt;code&gt;Undefined NameError&lt;/code&gt;，举栗说&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;alpha: int 
bravo: &amp;quot;str&amp;quot; = &amp;quot;i hate cowards&amp;quot;
def main():
    charlie: int = 114
    delta: float
    print(locals()) # {&#39;charlie&#39;: 114}
    print(globals()[&#39;bravo&#39;]) # i hate cowards

    # print(delta) 
    # -&amp;gt; UnboundLocalError: cannot access local variable &#39;delta&#39; where it is not associated with a value
    # print(globals()[&#39;alpha&#39;]) -&amp;gt; KeyError: &#39;alpha&#39;
    # print(alpha) -&amp;gt; NameError: name &#39;alpha&#39; is not defined

main()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这里在&lt;code&gt;main&lt;/code&gt;函数作用域中，&lt;code&gt;delta&lt;/code&gt;未被加入&lt;code&gt;locals()&lt;/code&gt;中不能使用，在全局作用域下，&lt;code&gt;aplha&lt;/code&gt;没有加入到&lt;code&gt;globals()&lt;/code&gt;中不能使用&lt;/p&gt;
&lt;p&gt;或者我们在元组解构时，直接标注整个元组也行&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;someTup: tuple[int, float] = (114, 5.14)
echo, foxtrot = someTup
# PyCharm: Variable &amp;quot;echo&amp;quot; Inferred type: int
# PyCharm: Variable &amp;quot;foxtrot&amp;quot; Inferred type: float
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;为函数标注时，也是用&lt;code&gt;:&lt;/code&gt; + 类型标注形参，并且在函数体之前使用&lt;code&gt;-&amp;gt;&lt;/code&gt;尾置类型来标注返回值&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;def stoi(s: str, base: int = 10) -&amp;gt; int:
    return int(s, base=base)
thatNumber = stoi(&amp;quot;107&amp;quot;)
# PyCharm: Variable &amp;quot;thatNumber&amp;quot; Inferred type: int
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;type-alias&#34;&gt;Type Alias&lt;/h4&gt;
&lt;p&gt;首先要知道在&lt;code&gt;Python&lt;/code&gt;中一切皆对象，类型如&lt;code&gt;int, str, list&lt;/code&gt;以及自定义类都是一个&lt;code&gt;type&lt;/code&gt;类型的对象（&lt;code&gt;(list.__class__ is type) is True&lt;/code&gt;，&lt;code&gt;type&lt;/code&gt;对象重载了&lt;code&gt;__call__&lt;/code&gt;，也就是&lt;code&gt;()&lt;/code&gt;，所以能通过&lt;code&gt;type&lt;/code&gt;对象调用对应类型的构造函数）&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;print(object.__class__ is type)
# True
print(type.__class__ is type)
# True
print(type(type(type(type(type)))))
# &amp;lt;class &#39;type&#39;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;当然&lt;code&gt;type&lt;/code&gt;也是一个对象，而且&lt;code&gt;object&lt;/code&gt;和&lt;code&gt;type&lt;/code&gt;的类型都是&lt;code&gt;type&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;import numpy as np
dummy = np.zeros((3, 3), dtype=np.int32)
def up_cast(arr: np.ndarray) -&amp;gt; np.ndarray:
    t: type = get_type_from_config(opt=[np.single, np.half, np.double])
    return arr.astype(t)
print(up_cast(dummy))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;所以也把一个对象标注成&lt;code&gt;type&lt;/code&gt;也没问题&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;typing.TypeAliasType&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在&lt;code&gt;Py3.12&lt;/code&gt;中为&lt;code&gt;type hint&lt;/code&gt;引入了类型别名的语法&lt;code&gt;type &amp;lt;alias&amp;gt; = &amp;lt;expr&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;type String = str
s1: String = &#39;Let life be beautiful like summer flowers&#39;
Str = str
s2: Str = &#39;and death like autumn leaves.&#39;
print(String.__class__, String)
# &amp;lt;class &#39;typing.TypeAliasType&#39;&amp;gt; String
print(Str.__class__, Str)
# &amp;lt;class &#39;type&#39;&amp;gt; &amp;lt;class &#39;str&#39;&amp;gt;

# print(String()) -&amp;gt; TypeError: &#39;typing.TypeAliasType&#39; object is not callable
print(Str())
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;从样例可以看出，可以从一个类型创建出新类型，但新类型的类型不是&lt;code&gt;type&lt;/code&gt;，而是&lt;code&gt;typing.TypeAliasType&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;所以无法直接从类型别名创建出新对象，但是使用一个对象引用原类型创建别名时，还可以用别名创建对象&lt;/p&gt;
&lt;p&gt;为了这个语法，&lt;code&gt;type&lt;/code&gt;变成了一个上下文关键字&lt;code&gt;soft keyword&lt;/code&gt;，但我觉得为什么要和内置的&lt;code&gt;type&lt;/code&gt;冲突呢，把这个关键字改成&lt;code&gt;alias&lt;/code&gt;不合适嘛..&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;typing.NewType&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;另外一种从现有类型创建新类型的方法是&lt;code&gt;typing.NewType&lt;/code&gt;，对于&lt;code&gt;Type Hint&lt;/code&gt;而言，&lt;code&gt;NewType&lt;/code&gt;被当作原始类型的子类，也就是不同的类型，这在语义上类似&lt;code&gt;Go&lt;/code&gt;的&lt;code&gt;type&lt;/code&gt;别名，不同类型使用相同的数据结构&lt;/p&gt;
&lt;p&gt;然而运行时使用&lt;code&gt;NewType&lt;/code&gt;从原始类型构造对象时，它只是返回实参，所以运行时对象还是原始类型&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;Verse = typing.NewType(&#39;Verse&#39;, str)


def say(some: Verse) -&amp;gt; None:
    print(some)


say(Verse(&#39;The world has kissed my soul with its pain,&#39;
          &#39; asking for its return in songs.&#39;))
# say(&#39;It is the tears of the earth that keep here smiles in bloom.&#39;)
# PyCharm: Expected type &#39;Verse&#39;, got &#39;str&#39; instead

print(Verse.__class__)
# &amp;lt;class &#39;typing.NewType&#39;&amp;gt;
print(isinstance(Verse, str))
# False
print(Verse(&#39;&#39;).__class__)
# &amp;lt;class &#39;str&#39;&amp;gt;

# print(Verse([1, 2]))
# PyCharm: Expected type &#39;str&#39;, got &#39;list[int]&#39; instead
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;从样例可以看出，在静态类型推导中，&lt;code&gt;Verse&lt;/code&gt;和&lt;code&gt;str&lt;/code&gt;是不同类型。但在运行时，通过&lt;code&gt;Verse()&lt;/code&gt;转化的&lt;code&gt;str&lt;/code&gt;其实还是&lt;code&gt;str&lt;/code&gt;对象啦&lt;/p&gt;
&lt;h3 id=&#34;1-mypy&#34;&gt;1-mypy&lt;/h3&gt;
&lt;p&gt;在继续之前，让我们先装备一个&lt;code&gt;Python&lt;/code&gt;静态类型检查器，&lt;code&gt;mypy&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;运行&lt;code&gt;mypy&lt;/code&gt;会分析代码，并且出现类型推导矛盾或属性/方法错误时，&lt;code&gt;mypy&lt;/code&gt;程序直接报错&lt;/p&gt;
&lt;p&gt;但与&lt;code&gt;PyCharm inspection&lt;/code&gt;一样，不要求所有代码都带有类型标注，所以不妨在代码重灾区加入&lt;code&gt;Type Hint&lt;/code&gt;并使用&lt;code&gt;mypy&lt;/code&gt;罢&lt;/p&gt;
&lt;p&gt;首先打开终端输入&lt;code&gt;pip3 install mypy&lt;/code&gt;安装&lt;code&gt;mypy&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;之后把它集成到&lt;code&gt;PyCharm IDE&lt;/code&gt;中，点击&lt;code&gt;File -&amp;gt; Settings -&amp;gt; Tools -&amp;gt; External Tools&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;新建一个&lt;code&gt;Tool&lt;/code&gt;，&lt;code&gt;Program: mypy&lt;/code&gt;，设定项目目录和源代码目录，这样在&lt;code&gt;IDE&lt;/code&gt;中右键&lt;code&gt;-&amp;gt; External Tools -&amp;gt; mypy&lt;/code&gt;就可以运行&lt;code&gt;mypy&lt;/code&gt;检查了&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/cbd1b438feafae788bdf77fb2a71a2d.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;当然也可以每次&lt;code&gt;Debug&lt;/code&gt;前运行一下&lt;code&gt;mypy&lt;/code&gt;，打开入口脚本的&lt;code&gt;Run Configuration&lt;/code&gt;，添加一个&lt;code&gt;Before launch -&amp;gt; Run External Tools&lt;/code&gt;，启用&lt;code&gt;mypy&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;mypy&lt;/code&gt;现在（&lt;code&gt;1.6.1&lt;/code&gt;）的问题是，&lt;code&gt;Py3.12&lt;/code&gt;更新的&lt;code&gt;Type Hint&lt;/code&gt;特性还没支持&lt;/p&gt;
&lt;h3 id=&#34;2-utilities&#34;&gt;2-Utilities&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;typing&lt;/code&gt;提供了一些通用的标注类型用于&lt;code&gt;Type Hint&lt;/code&gt;和类型推导&lt;/p&gt;
&lt;h4 id=&#34;final&#34;&gt;Final&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;typing.Final (Py3.8+)&lt;/code&gt;标注一个对象为&lt;strong&gt;只读&lt;/strong&gt;，语义上类似&lt;code&gt;C#&lt;/code&gt;的&lt;code&gt;readonly&lt;/code&gt;，&lt;code&gt;C/C++&lt;/code&gt;的&lt;code&gt;const&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from typing import Final
MAX_SIZE: Final = 9000
MAX_SIZE += 1  

class Connection:
    TIMEOUT: Final[int] = 10
class FastConnector(Connection):
    TIMEOUT = 1  # Error reported by type checker

# mypy:
# main.py:78: error: Cannot assign to final name &amp;quot;MAX_SIZE&amp;quot;  [misc]
# main.py:86: error: Cannot assign to final name &amp;quot;TIMEOUT&amp;quot;  [misc]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;以官方文档为例，被标注为&lt;code&gt;Final&lt;/code&gt;的对象不能重新赋值，同时作为类属性的&lt;code&gt;Final&lt;/code&gt;对象不能在子类中被重写(&lt;code&gt;overwrite&lt;/code&gt;)&lt;/p&gt;
&lt;h4 id=&#34;any&#34;&gt;Any&lt;/h4&gt;
&lt;p&gt;在类型推导中，被标注为&lt;code&gt;typing.Any&lt;/code&gt;的对象为动态类型&lt;/p&gt;
&lt;p&gt;可以被任何类型，同样&lt;strong&gt;也可以&lt;/strong&gt;赋值给任何类型&lt;/p&gt;
&lt;p&gt;语义上类似&lt;code&gt;C++/Rust&lt;/code&gt;的&lt;code&gt;std::any&lt;/code&gt;、&lt;code&gt;Go&lt;/code&gt;的&lt;code&gt;interface{}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;注意&lt;code&gt;Any&lt;/code&gt;和&lt;code&gt;object&lt;/code&gt;在类型推到中的区别&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;def get_x(o: Any) -&amp;gt; int:
    return o.x
# mypy： okay

def get_x(o: object) -&amp;gt; int:
    return o.x
# main.py:79: error: &amp;quot;object&amp;quot; has no attribute &amp;quot;x&amp;quot;  [attr-defined]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;Any&lt;/code&gt;是开放的，类型推导认为&lt;code&gt;Any&lt;/code&gt;类型可以有任意属性/方法，而&lt;code&gt;object&lt;/code&gt;是封闭的，使用&lt;code&gt;object&lt;/code&gt;类没有的属性会使&lt;code&gt;mypy&lt;/code&gt;报错&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Any&lt;/code&gt;举例：反射&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from typing import Any

class Some:
    def __init__(self):
        self.tick = 0

def touch(o: Any) -&amp;gt; Any:
    if hasattr(o, &#39;tick&#39;):
       	o.tick = o.tick + 1
    return o


y = Some()
print(touch(y).tick)
# 1
print(touch(&#39;nothing&#39;))
# nothing
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;union&#34;&gt;Union&lt;/h4&gt;
&lt;p&gt;将对象标注为&lt;code&gt;T1 | T2 | ... | TN&lt;/code&gt;（&lt;code&gt;Py3.10&lt;/code&gt;之前没有语法糖要使用&lt;code&gt;typing.Union[T1, T2, ... TN]&lt;/code&gt;）表示一种 和类型（相对于作为&lt;code&gt;class&lt;/code&gt;的积类型，&lt;code&gt;class&lt;/code&gt;内部是多个类型的组合），意味着在运行时对象的类型是&lt;code&gt;T1, T2, ... TN&lt;/code&gt;其中之一，用处是实现非继承的多态&lt;/p&gt;
&lt;p&gt;语义上类似&lt;code&gt;C# SumType&lt;/code&gt;， &lt;code&gt;C++ std::variant&lt;/code&gt;，&lt;code&gt;Rust Enumerated types&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;以我之前写的代码为例&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;import numpy as np
def forward(self, images_data: np.ndarray) -&amp;gt; list[np.ndarray] | np.ndarray:
    # ...
    result: list[np.ndarray] = self._forward(dispatched_jobs)

    for i in range(len(result)):
        result[i] = result[i][:real_batch_size, ...]
    if len(result) == 1:
        return result[0]
    return result
# mypy： okay
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这里&lt;code&gt;forward&lt;/code&gt;返回模型推理结果的类型是运行时确定的（读取的模型结构可能是多流输出或单流输出），因此使用&lt;code&gt;Union&lt;/code&gt;标注返回值&lt;/p&gt;
&lt;h4 id=&#34;optional&#34;&gt;Optional&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;typing.Optional[T]&lt;/code&gt;表示类型&lt;code&gt;T&lt;/code&gt;的可空版本，当然&lt;code&gt;Python&lt;/code&gt;对象可空，所以&lt;code&gt;Optional[T]&lt;/code&gt;就是&lt;code&gt;T | None&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;语义上类似&lt;code&gt;C# Nullable&amp;lt;T&amp;gt;&lt;/code&gt;， &lt;code&gt;C++ std::optional&lt;/code&gt;，&lt;code&gt;Rust std::option&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;一般来说，不使用&lt;code&gt;T&lt;/code&gt;的某个特殊值而是可空类型表示空值，因为可读性好而且可能没有适合的特殊值表示空值&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from typing import Optional

class Node:
    # ... 
    
def dfs(root: Optional[Node]) -&amp;gt; None:
    if root is None:
        return
    dfs(root.left)
    print(root.val, end=&#39;, &#39;)
    dfs(root.right)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;比如在深度优先搜索中把形参标注为可空类型&lt;/p&gt;
&lt;h4 id=&#34;self&#34;&gt;Self&lt;/h4&gt;
&lt;p&gt;在类中标注方法，如果涉及到了当前类类型，比如这样&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;class Some:
    def clone(self) -&amp;gt; Some:
        return self._clone_impl()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;那么解释器会认为在&lt;code&gt;Some&lt;/code&gt;类内部&lt;code&gt;Some&lt;/code&gt;还没有完成定义，所以使用了&lt;code&gt;Some&lt;/code&gt;时解释器不认可代码，这像是一个缺陷似的&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;class Some:
    def clone(self) -&amp;gt; &#39;Some&#39;:
        return self._clone_impl()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;此时可以改为用字符串标注，类型推导/类型检查器也可以接受&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;class Tensor:
    def __add__(self, other: Self) -&amp;gt; Self:
        # ...

    def __sub__(self, other: Self) -&amp;gt; Self:
        # ...

    def __mul__(self, other: Self) -&amp;gt; Self:
        # ...

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在&lt;code&gt;Py3.11&lt;/code&gt;，可以使用&lt;code&gt;typing.Self&lt;/code&gt;标注当前类类型了，一般常用于运算符重载&lt;/p&gt;
&lt;p&gt;要注意，&lt;code&gt;Self&lt;/code&gt;其实是一个泛型的语法糖（&lt;code&gt;typing.TypeVar&lt;/code&gt;）&lt;/p&gt;
&lt;p&gt;所以子类&lt;code&gt;overrite&lt;/code&gt;父类方法时，&lt;code&gt;Self&lt;/code&gt;推导为子类类型，而不是父类类型&lt;/p&gt;
&lt;h3 id=&#34;3-introspection&#34;&gt;3-Introspection&lt;/h3&gt;
&lt;p&gt;对于类型标注，解释器会将变量名和标注存储在&lt;code&gt;function&lt;/code&gt;/&lt;code&gt;class&lt;/code&gt;/&lt;code&gt;module&lt;/code&gt;对象的&lt;code&gt;__annotations__&lt;/code&gt;属性里&lt;/p&gt;
&lt;p&gt;但函数作用域内的局部变量的标注不会被存储在&lt;code&gt;function&lt;/code&gt;对象的&lt;code&gt;__annotations__&lt;/code&gt;里&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from typing import get_type_hints

class Some:
    a: int
    b: tuple[str, int]

    def __init__(self):
        self.c: int = 0
        self.d: float = 1.

    def f(self, x: int, y: str) -&amp;gt; float:
        tmp: list[int] = [1, 1, 4]
        return .0


glob: str = &#39;module var&#39;
print(get_type_hints(Some))
# {&#39;a&#39;: &amp;lt;class &#39;int&#39;&amp;gt;, &#39;b&#39;: tuple[str, int]}
print(get_type_hints(Some().f))
# {&#39;x&#39;: &amp;lt;class &#39;int&#39;&amp;gt;, &#39;y&#39;: &amp;lt;class &#39;str&#39;&amp;gt;, &#39;return&#39;: &amp;lt;class &#39;float&#39;&amp;gt;}
print(globals()[&#39;__annotations__&#39;])
# {&#39;glob&#39;: &amp;lt;class &#39;str&#39;&amp;gt;}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;而且最好使用&lt;code&gt;typing.get_type_hints&lt;/code&gt;在运行时获取&lt;code&gt;Type Hints&lt;/code&gt;，因为它帮我们处理了不同的对象&lt;/p&gt;
&lt;p&gt;现在我们获得了内省类型标注的能力，也许可以用它来做运行时类型断言，但我认为更应该提高&lt;code&gt;Py&lt;/code&gt;代码内标注覆盖率来做静态断言&lt;/p&gt;
&lt;p&gt;所以我认为&lt;code&gt;get_type_hints&lt;/code&gt;更大的用处是为&lt;code&gt;Python&lt;/code&gt;元编程提供基础设施（如本文第&lt;code&gt;6&lt;/code&gt;部分的&lt;code&gt;dataclass&lt;/code&gt;）&lt;/p&gt;
&lt;h3 id=&#34;4-functionmethod&#34;&gt;4-Function/Method&lt;/h3&gt;
&lt;h4 id=&#34;never&#34;&gt;Never&lt;/h4&gt;
&lt;p&gt;在&lt;code&gt;Python&lt;/code&gt;中，函数正常执行流&lt;code&gt;return&lt;/code&gt;或无&lt;code&gt;return&lt;/code&gt;语句，返回的是&lt;code&gt;None&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;但是标注一个永不正常返回的函数，应该使用&lt;code&gt;typing.Never&lt;/code&gt;，而不是&lt;code&gt;None&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from typing import Never

class CmdExit(Exception): pass

def stop_thread() -&amp;gt; Never:
    raise CmdExit()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;（在&lt;code&gt;Py3.11&lt;/code&gt;之前，需要换用&lt;code&gt;typing.NoReturn&lt;/code&gt;）&lt;/p&gt;
&lt;h4 id=&#34;callable&#34;&gt;Callable&lt;/h4&gt;
&lt;p&gt;我们可以用&lt;code&gt;typing.Callable&lt;/code&gt;来标注&lt;code&gt;Python&lt;/code&gt;函数、方法或其他函数对象（重载了&lt;code&gt;__call__&lt;/code&gt;的对象）&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Callable&lt;/code&gt;可以是一个泛型（见下文第&lt;code&gt;5&lt;/code&gt;部分），其中&lt;code&gt;Callable[[Arg1, Arg2, ... ArgN], RetT]&lt;/code&gt;标注一个形参类型为&lt;code&gt;Arg1, Arg2, ... ArgN&lt;/code&gt;，返回值类型为&lt;code&gt;RetT&lt;/code&gt;的函数对象&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;def async_query(on_success: Callable[[int], None],
                on_error: Callable[[int, Exception], None]) -&amp;gt; None:
    ...  # Body
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;一个官方文档的例子&lt;/p&gt;
&lt;p&gt;当然，除了回调，我们在实现函数装饰器时，形参也是&lt;code&gt;Callable&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;def using_huawei_api(func: Callable) -&amp;gt; Callable:
    def wrapper(*args, **kwargs):
        init_huawei_api()
        res = func(*args, **kwargs)
        finalize_huawei_api()
        return res
    return wrapper


@using_huawei_api
def runner(img_paths: list[str], model_cfg: CfgNode) -&amp;gt; Err:
    # ...

what_type = runner
# PyCharm : Variable &amp;quot;what_type&amp;quot; Inferred type:
# (...) -&amp;gt; Any
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;当然我们实现装饰器时往往需要处理的是任意的函数对象，比如我的代码里&lt;code&gt;@using_huawei_api&lt;/code&gt;在任意函数调用前后做了一些事&lt;/p&gt;
&lt;p&gt;但是像这样把原函数标注成非泛型的&lt;code&gt;Callable&lt;/code&gt;时，装饰器返回的闭包会丢失类型标注&lt;/p&gt;
&lt;p&gt;这里被装饰的&lt;code&gt;runner&lt;/code&gt;被&lt;code&gt;PyCharm&lt;/code&gt;推导为&lt;code&gt;(...) -&amp;gt; Any&lt;/code&gt;，也就是&lt;code&gt;Callable[..., Any]&lt;/code&gt;，一个形参变长，返回任意类型的函数&lt;/p&gt;
&lt;p&gt;这肯定不好，会破坏我们的后续的类型推导&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from typing import ParamSpec, TypeVar
Param = ParamSpec(&#39;Param&#39;)
T = TypeVar(&#39;T&#39;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;所以可以使用&lt;code&gt;typing&lt;/code&gt;提供的辅助泛型&lt;code&gt;ParamSpec&lt;/code&gt;表示形参类型，同时把返回值类型也标注为泛型&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;def using_huawei_api(func: Callable[Param, T]) -&amp;gt; Callable[Param, T]:
    def wrapper(*args: Param.args, **kwargs: Param.kwargs) -&amp;gt; T:
        # ...
    return wrapper

@using_huawei_api
def runner(img_paths: list[str], model_cfg: CfgNode) -&amp;gt; Err:
    # ...

what_type = runner
# PyCharm: Variable &amp;quot;what_type&amp;quot; Inferred type:
# (img_paths: list[str], model_cfg: CfgNode) -&amp;gt; Err
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;使用&lt;code&gt;ParamSpec.args&lt;/code&gt;解构出&lt;code&gt;arguments&lt;/code&gt;（&lt;code&gt;*args&lt;/code&gt;），&lt;code&gt;ParamSpec.kwargs&lt;/code&gt;解构出&lt;code&gt;keyword arguments&lt;/code&gt;（&lt;code&gt;**kwargs&lt;/code&gt;），然后将标注转发给闭包就可以，此时&lt;code&gt;PyCharm&lt;/code&gt;也正确推导出了被装饰函数的签名/返回类型&lt;/p&gt;
&lt;h4 id=&#34;decorators&#34;&gt;Decorators&lt;/h4&gt;
&lt;p&gt;关于函数/方法，&lt;code&gt;typing&lt;/code&gt;还提供了几个装饰器&lt;/p&gt;
&lt;p&gt;其中和&lt;code&gt;OOP&lt;/code&gt;相关的是&lt;code&gt;typing.override&lt;/code&gt;/&lt;code&gt;typing.final&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;class Base:
    def log_status(self) -&amp;gt; None:
        ...

class Sub(Base):
    @override
    def log_status(self) -&amp;gt; None:  # Okay: overrides Base.log_status
        ...

    @override
    def done(self) -&amp;gt; None:  # Error reported by type checker
        ...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;以官方文档为例，使用&lt;code&gt;override&lt;/code&gt;装饰方法时，是提示类型检查器我们在使用继承多态，父类中必须存在同名的相同签名的方法&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;class Base:
    @final
    def done(self) -&amp;gt; None:
        ...
class Sub(Base):
    def done(self) -&amp;gt; None:  # Error reported by type checker
        ...

@final
class Leaf:
    ...
class Other(Leaf):  # Error reported by type checker
    ...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;相对地，就像其他语言中的&lt;code&gt;OOP&lt;/code&gt;，&lt;code&gt;typing.final&lt;/code&gt;可以装饰一个类或方法，表示类不能被继承或方法不能被&lt;code&gt;override&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;另外，如果我们的函数需要重载（当然肯定不是&lt;code&gt;C++&lt;/code&gt;中的重载概念，这里指的就是函数多态），可以用&lt;code&gt;typing.overload&lt;/code&gt;装饰不同的重载版本&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;def get_vec(dim1: int, dim2: int | None, dim3: int | None) -&amp;gt; list[int] | list[list[int]] | list[list[list[int]]]:
    if dim3 is not None:
        return [[[0 for i in range(dim3)] for j in range(dim2)] for k in range(dim1)]
    if dim2 is not None:
        return [[0 for j in range(dim2)] for k in range(dim1)]
    return [0 for k in range(dim1)]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;比如这个&lt;code&gt;get_vec&lt;/code&gt;函数根据形参长度返回不同类型的对象，如果只是像这样把返回值标注成&lt;code&gt;Union&lt;/code&gt;，那无论用户如何调用&lt;code&gt;get_vec&lt;/code&gt;，得到的推导类型都是&lt;code&gt;list[int] | list[list[int]] | list[list[list[int]]]&lt;/code&gt;，那就没啥意义了，不同入参方式对应不同返回值，这时我们利用&lt;code&gt;overload&lt;/code&gt;表达这种语义&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;@overload
def get_vec(dim1: int) -&amp;gt; list[int]:
    ...
@overload
def get_vec(dim1: int, dim2: int) -&amp;gt; list[list[int]]:
    ...
@overload
def get_vec(dim1: int, dim2: int, dim3: int) -&amp;gt; list[list[list[int]]]:
    ...
def get_vec(dim1, dim2=None, dim3=None):
    # ... implementation 


v1 = get_vec(1)
v2 = get_vec(1, 4)
v3 = get_vec(5, 1, 4)

# PyCharm:
# Variable &amp;quot;v1&amp;quot; Inferred type: list[int]
# Variable &amp;quot;v2&amp;quot; Inferred type: list[list[int]]
# Variable &amp;quot;v3&amp;quot; Inferred type: list[list[list[int]]]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;使用&lt;code&gt;overload&lt;/code&gt;需要像这样写，使用&lt;code&gt;@overload&lt;/code&gt;装饰每一个重载版本，函数体使用&lt;code&gt;...&lt;/code&gt;忽略，而且&lt;code&gt;overload&lt;/code&gt;重载声明后要紧接实现的函数，这里&lt;code&gt;@overload&lt;/code&gt;重载中已经进行了标注，有了类型推导的信息，所以具体实现函数中不用标注了&lt;/p&gt;
&lt;p&gt;根据入参，&lt;code&gt;PyCharm&lt;/code&gt;也正确推导出了不同的返回值类型&lt;/p&gt;
&lt;h3 id=&#34;5-generic&#34;&gt;5-Generic&lt;/h3&gt;
&lt;p&gt;这里泛型指的是&lt;code&gt;Type Hint&lt;/code&gt;里的泛型，&lt;code&gt;Python&lt;/code&gt;运行时没有泛型可言&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Type Hint&lt;/code&gt;中泛型参数包含在方括号（&lt;code&gt;[]&lt;/code&gt;）中&lt;/p&gt;
&lt;h4 id=&#34;builtin-container&#34;&gt;Builtin Container&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;Type Hint&lt;/code&gt;中&lt;code&gt;Py&lt;/code&gt;内置容器不仅有非泛型版本，也有泛型版本&lt;/p&gt;
&lt;p&gt;&lt;code&gt;list[T]/set[T]&lt;/code&gt;标注存储类型&lt;code&gt;T&lt;/code&gt;的列表/集合&lt;/p&gt;
&lt;p&gt;&lt;code&gt;tuple[T1, T2, T3, ..., TN]&lt;/code&gt;标注存储类型&lt;code&gt;T1, T2, T3, ..., TN&lt;/code&gt;的元组&lt;/p&gt;
&lt;p&gt;&lt;code&gt;dict[K, V]&lt;/code&gt;标注键类型&lt;code&gt;K&lt;/code&gt;，值类型&lt;code&gt;V&lt;/code&gt;的字典&lt;/p&gt;
&lt;p&gt;当然，&lt;code&gt;Py3.9&lt;/code&gt;以下要换用&lt;code&gt;typing.List&lt;/code&gt;,&lt;code&gt;typing.Set&lt;/code&gt;,&lt;code&gt;typing.Tuple&lt;/code&gt;,&lt;code&gt;typing.Dict&lt;/code&gt;,因为当时还没有为这些类型对象重载&lt;code&gt;[]&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&#34;protocol&#34;&gt;Protocol&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;typing.Protocol&lt;/code&gt;定义一种鸭子类型（也就是非继承的接口）,具体是定义一个空壳类，继承自&lt;code&gt;Protocol&lt;/code&gt;，然后定义鸭子类型需要满足的方法&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;class CanSub(Protocol):
    def __sub__(self, other: Self) -&amp;gt; Self:
        pass
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;像这里我们定义一种可减的类型&lt;code&gt;CanSub&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;def zero(x: CanSub) -&amp;gt; CanSub:
    return x - x
zero(1)
zero([1, 0, 7])

# mypy: error: Argument 1 to &amp;quot;zero&amp;quot; has incompatible type &amp;quot;list[int]&amp;quot;; expected &amp;quot;CanSub&amp;quot;  [arg-type]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;然后被标注为&lt;code&gt;CanSub&lt;/code&gt;的对象必须重载&lt;code&gt;-&lt;/code&gt;才可以&lt;/p&gt;
&lt;p&gt;通常一个具体类型可以满足多个鸭子类型，所以现在考虑如何组合不同的&lt;code&gt;Protocol&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;@runtime_checkable
class CanAdd(Protocol):
    def __add__(self, other: Self) -&amp;gt; Self:
        pass
    
@runtime_checkable
class CanAddSub(CanAdd, CanSub, Protocol):
    pass

print(isinstance([], CanAddSub))
# False
print(isinstance([], CanAdd))
# True
print(isinstance(1, CanAddSub))
# True
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;现在再写一个可加类型&lt;code&gt;CanAdd&lt;/code&gt;，组合&lt;code&gt;CanAdd&lt;/code&gt;和&lt;code&gt;CanSub&lt;/code&gt;的方式是再定义一个&lt;code&gt;CanAddSub&lt;/code&gt;同时继承自``CanAdd/CanSub/Protocol&lt;code&gt;（&lt;/code&gt;Protocol`需要&lt;strong&gt;最后&lt;/strong&gt;被继承）&lt;/p&gt;
&lt;p&gt;然后用&lt;code&gt;typing.runtime_checkable&lt;/code&gt;装饰一下鸭子类型，就可以在运行时用&lt;code&gt;isinstance&lt;/code&gt;判断对象是否满足相应&lt;code&gt;Protocol&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&#34;typevar&#34;&gt;TypeVar&lt;/h4&gt;
&lt;p&gt;通过&lt;code&gt;typing.TypeVar&lt;/code&gt;定义一个泛型&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;T = TypeVar(&#39;T&#39;)  # Can be anything
S = TypeVar(&#39;S&#39;, bound=str)  # Can be any subtype of str
A = TypeVar(&#39;A&#39;, str, bytes)  # Must be exactly str or bytes
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;默认的&lt;code&gt;TypeVar&lt;/code&gt;是开放类型，但可以通过&lt;code&gt;bound&lt;/code&gt;或&lt;code&gt;*constrains&lt;/code&gt;参数施加简单的泛型约束&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;T = TypeVar(&#39;T&#39;)
def slow_sort(arr: list[T]) -&amp;gt; list[T]:
    if len(arr) &amp;lt;= 1:
        return arr
    base: T = arr[len(arr) // 2]
    left: list[T] = [x for x in arr if x &amp;lt; base]
    middle: list[T] = [x for x in arr if x == base]
    right: list[T] = [x for x in arr if x &amp;gt; base]
    return slow_sort(left) + middle + slow_sort(right)

what_type = slow_sort([&#39;a&#39;, &#39;c&#39;, &#39;b&#39;])
# PyCharm: Variable &amp;quot;what_type&amp;quot; Inferred type: list[str]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;创建一个泛型函数的例子，在&lt;code&gt;Py3.12&lt;/code&gt;中，不用再定义&lt;code&gt;TypeVar&lt;/code&gt;了，直接用&lt;code&gt;def slow_sort[T](arr: list[T]) -&amp;gt; list[T]&lt;/code&gt;就可以定义泛型函数，但&lt;code&gt;mypy&lt;/code&gt;好像还没支持这个特性&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;U = TypeVar(&#39;U&#39;)
V = TypeVar(&#39;V&#39;)
class pair(Generic[U, V]):
    def __init__(self, u: U, v: V):
        self.first = u
        self.second = v


p = pair(107, &#39;zixfy&#39;)
a, b = p.first, p.second
# PyCharm: Variable &amp;quot;a&amp;quot; Inferred type: int
#          Variable &amp;quot;v&amp;quot; Inferred type: str
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;而让类继承&lt;code&gt;typing.Generic&lt;/code&gt;可以创建泛型类，同样地，在&lt;code&gt;Py3.12&lt;/code&gt;中可以使用&lt;code&gt;class pair[U, V]:&lt;/code&gt;定义泛型类&lt;/p&gt;
&lt;h4 id=&#34;typevartuple&#34;&gt;TypeVarTuple&lt;/h4&gt;
&lt;p&gt;（&lt;code&gt;mypy1.6.1&lt;/code&gt;对&lt;code&gt;TypeVarTuple&lt;/code&gt;的支持还是实验特性，需要在&lt;code&gt;mypy&lt;/code&gt;程序参数中加入&lt;code&gt;--enable-incomplete-feature=TypeVarTuple --enable-incomplete-feature=Unpack&lt;/code&gt;）&lt;/p&gt;
&lt;p&gt;变长泛型，也就是一个打包了若干类型的列表(&lt;code&gt;TypeList&lt;/code&gt;)&lt;/p&gt;
&lt;p&gt;通过&lt;code&gt;typing.Unpack&lt;/code&gt;，我们可以把这些类型从&lt;code&gt;TypeVarTuple&lt;/code&gt;中解构出来&lt;/p&gt;
&lt;p&gt;考虑实现如下的类似&lt;code&gt;C++ std::apply&lt;/code&gt;的功能，输入函数&lt;code&gt;f&lt;/code&gt;和实参&lt;code&gt;*args&lt;/code&gt;，在&lt;code&gt;apply&lt;/code&gt;内部调用原函数&lt;code&gt;f&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;这要求&lt;code&gt;f&lt;/code&gt;形参类型和&lt;code&gt;*args&lt;/code&gt;类型一致，所以样例中将形参和&lt;code&gt;*args&lt;/code&gt;都标注为&lt;code&gt;Unpack[Ts]&lt;/code&gt;（变长的泛型）&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from typing import Callable, TypeVarTuple, Unpack
T = TypeVar(&#39;T&#39;)
Ts = TypeVarTuple(&#39;Ts&#39;) 

def apply(f: Callable[[Unpack[Ts]], T], *args: Unpack[Ts]) -&amp;gt; T:
    return f(*args)

def f(x: int, y: float, prefix: str) -&amp;gt; str:
    return prefix + str(x + y)

# g = apply(f, 1.333, 1.333, &amp;quot;Result: &amp;quot;)
# mypy: Argument 1 to &amp;quot;apply&amp;quot; has incompatible type 
# &amp;quot;Callable[[int, float, str], str]&amp;quot;; 
# expected &amp;quot;Callable[[float, float, str], str]&amp;quot;


g = apply(f, 1, 1.333, &amp;quot;Result: &amp;quot;)
print(g)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这样，在调用&lt;code&gt;apply&lt;/code&gt;，若实参类型不符，&lt;code&gt;mypy&lt;/code&gt;会帮我们找出类型错误&lt;/p&gt;
&lt;p&gt;如果不都标注为&lt;code&gt;Unpack[Ts]&lt;/code&gt;，而是标注为&lt;code&gt;...&lt;/code&gt;，则无法检查实参，因为&lt;code&gt;...&lt;/code&gt;表示任意的变长泛型，而且如果同时把原函数形参和&lt;code&gt;*args&lt;/code&gt;都标注为&lt;code&gt;...&lt;/code&gt;，&lt;code&gt;mypy&lt;/code&gt;不认可&lt;/p&gt;
&lt;p&gt;同时可以看到，我们可以利用&lt;code&gt;TypeVarTuple&lt;/code&gt;标注&lt;code&gt;Py&lt;/code&gt;函数的变长参数（&lt;code&gt;*args&lt;/code&gt;）了&lt;/p&gt;
&lt;h4 id=&#34;typeddict&#34;&gt;TypedDict&lt;/h4&gt;
&lt;p&gt;在&lt;code&gt;Py&lt;/code&gt;中，函数不仅可以有变长参数&lt;code&gt;*args&lt;/code&gt;，还可以有关键字参数&lt;code&gt;**kwargs&lt;/code&gt;,&lt;code&gt;kwargs&lt;/code&gt;在运行时就是一个&lt;code&gt;dict&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;相应地，&lt;code&gt;Py3.11&lt;/code&gt;引入了&lt;code&gt;typing.TypedDict&lt;/code&gt;，限制&lt;code&gt;dict&lt;/code&gt;指定键需要对应特定类型&lt;/p&gt;
&lt;p&gt;结合&lt;code&gt;Unpack&lt;/code&gt;，我们就可以标注&lt;code&gt;kwargs&lt;/code&gt;了喔&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from typing import Unpack, TypedDict, NotRequired

class Opt(TypedDict):
    lower: int
    upper: int
    as_type: NotRequired[type]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;首先定义一个空类&lt;code&gt;Opt&lt;/code&gt;标注关键字参数的名字和类型，如果某个参数不是必须的，则将对应类型&lt;code&gt;T&lt;/code&gt;标注为&lt;code&gt;typing.NotRequired[T]&lt;/code&gt;版本&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;def clip(x: int, **kwargs: Unpack[Opt]):
    r: int = max(min(x, kwargs[&#39;upper&#39;]), kwargs[&#39;lower&#39;])
    print(kwargs.__class__)
    if &#39;as_type&#39; in kwargs:
        return kwargs[&#39;as_type&#39;](r)
    return r


g = clip(-1, lower=107, upper=109, as_type=str)
print(g, type(g))
# 107 &amp;lt;class &#39;str&#39;&amp;gt;

# h = clip(1, lower=1 )
# mypy: Missing named argument &amp;quot;upper&amp;quot; for &amp;quot;clip&amp;quot;  [call-arg]

# l = clip(114, lower=514, upper=1919.810)
# mypy: Argument &amp;quot;upper&amp;quot; to &amp;quot;clip&amp;quot; has incompatible type &amp;quot;float&amp;quot;; expected &amp;quot;int&amp;quot;  [arg-type]

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在函数签名内，使用&lt;code&gt;Unpack[Opt]&lt;/code&gt;解构&lt;code&gt;TypedDict&lt;/code&gt;标注&lt;code&gt;**kwargs&lt;/code&gt;，可以看到&lt;code&gt;mypy&lt;/code&gt;已经可以找出&lt;code&gt;kwargs&lt;/code&gt;中的类型错误了&lt;/p&gt;
&lt;h4 id=&#34;contravariantcovariant&#34;&gt;Contravariant/Covariant&lt;/h4&gt;
&lt;p&gt;协变（&lt;code&gt;covariant&lt;/code&gt;）和逆变（&lt;code&gt;contravariant&lt;/code&gt;）是泛型（&lt;code&gt;TypeVar&lt;/code&gt;）的两个关键字参数&lt;/p&gt;
&lt;p&gt;其实这个有些像&lt;code&gt;C#&lt;/code&gt;里的&lt;code&gt;in&lt;/code&gt;和&lt;code&gt;out&lt;/code&gt;关键字..&lt;/p&gt;
&lt;p&gt;假设某个&lt;code&gt;TypeVar&lt;/code&gt;被推导为具体类型&lt;code&gt;T&lt;/code&gt;，如果&lt;code&gt;TypeVar&lt;/code&gt;是协变的，那么也可以被看作&lt;code&gt;T&lt;/code&gt;的某个子类型（更加严格的类型）&lt;/p&gt;
&lt;p&gt;反之如果&lt;code&gt;TypeVar&lt;/code&gt;是逆变的，那么也可以被看作&lt;code&gt;T&lt;/code&gt;的某个父类型（更加宽松的类型）&lt;/p&gt;
&lt;p&gt;我们往往把某个接口方法返回值定义成协变的，因为接口的实现类里往往信息更多，可以生成更详细的子类型&lt;/p&gt;
&lt;p&gt;同样，也可以把某个接口方法形参定义成逆变的，因为接口的实现类往往信息更多，可以处理更不详细的父类型&lt;/p&gt;
&lt;p&gt;还是举个栗子吧&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;class Item(object): pass
class Bread(Item): pass
class Freedom(Item): pass


Out = TypeVar(&#39;Out&#39;, covariant=True)
In = TypeVar(&#39;In&#39;, contravariant=True)


class Factory(Generic[In, Out]):
    @abc.abstractmethod
    def get(self) -&amp;gt; Out:
        pass

    @abc.abstractmethod
    def consume(self, x: In) -&amp;gt; None:
        pass
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这里我们定义了协变与逆变泛型分别为&lt;code&gt;Out&lt;/code&gt;与&lt;code&gt;In&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;然后写了数据类&lt;code&gt;Item/Bread/Freedom&lt;/code&gt;，其中&lt;code&gt;Item&lt;/code&gt;是父类&lt;/p&gt;
&lt;p&gt;最后定义了一个泛型接口&lt;code&gt;Factory[In, Out]&lt;/code&gt;，其&lt;code&gt;get&lt;/code&gt;返回值&lt;code&gt;Out&lt;/code&gt;是协变的，而&lt;code&gt;consume&lt;/code&gt;形参&lt;code&gt;In&lt;/code&gt;是逆变的&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;class Dream(Factory[Item, Item]):
    @override
    def get(self) -&amp;gt; Freedom:
        return Freedom()

    @override
    def consume(self, x: Item) -&amp;gt; None:
        print(f&amp;quot;Dream eats {type(x).__name__}, &amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在&lt;code&gt;Factory[Item, Item]&lt;/code&gt;的实现类&lt;code&gt;Dream&lt;/code&gt;中，我们将&lt;code&gt;get&lt;/code&gt;的返回值类型&lt;code&gt;overrite&lt;/code&gt;成&lt;code&gt;Freedom&lt;/code&gt;，这是可以的，因为接口里这里是协变，而&lt;code&gt;Freedom&lt;/code&gt;又是&lt;code&gt;Item&lt;/code&gt;的子类；但将&lt;code&gt;Freedom&lt;/code&gt;替换成&lt;code&gt;Item&lt;/code&gt;的父类&lt;code&gt;object&lt;/code&gt;就是不可取的&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;class Work(Factory[Item, Item]):
    @override
    def get(self) -&amp;gt; Bread:
        return Bread()

    @override
    def consume(self, x: object) -&amp;gt; None:
        print(f&amp;quot;Work burns {&amp;quot;anything&amp;quot; if type(x) is object else type(x).__name__}, &amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;而在&lt;code&gt;Factory[Item, Item]&lt;/code&gt;的另一个实现类&lt;code&gt;Work&lt;/code&gt;中，我们将&lt;code&gt;consume&lt;/code&gt;的形参类型&lt;code&gt;overrite&lt;/code&gt;成&lt;code&gt;object&lt;/code&gt;，这是可以的，因为接口里这里是逆变，而&lt;code&gt;object&lt;/code&gt;又是&lt;code&gt;Item&lt;/code&gt;的父类&lt;/p&gt;
&lt;p&gt;但将&lt;code&gt;object&lt;/code&gt;替换成&lt;code&gt;Item&lt;/code&gt;的子类&lt;code&gt;Bread&lt;/code&gt;时，&lt;code&gt;mypy&lt;/code&gt;会报错&lt;code&gt;This violates the Liskov substitution principle&lt;/code&gt;，里氏原则里有说&lt;strong&gt;任何基类可以出现的地方，子类一定可以出现&lt;/strong&gt;，但这里父子关系是反过来的，可能这就是为什么叫做逆变吧..&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;Dream().consume(Bread())
Work().consume(Dream().get())
Work().consume(object())
# Dream eats Bread, 
# Work burns Freedom,
# Work burns anything,
# mypy: okay

# Dream().consume(object())
# mypy: no
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;btw, &lt;code&gt;type&lt;/code&gt;，或者说&lt;code&gt;typing.Type&lt;/code&gt;的泛型版本&lt;code&gt;type[C]&lt;/code&gt;也是协变的&lt;/p&gt;
&lt;h3 id=&#34;6-dataclass&#34;&gt;6-dataclass&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;dataclass&lt;/code&gt;是&lt;code&gt;Py&lt;/code&gt;中的结构体，它也是通过类型标注定义的&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from dataclasses import dataclass

@dataclass
class PersonImageInformation(object):
    image_name: str
    person_id: int
    image_quality: float
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这里用,&lt;code&gt;@dataclass&lt;/code&gt;装饰&lt;code&gt;PersonImageInformation&lt;/code&gt;后&lt;/p&gt;
&lt;p&gt;&lt;code&gt;PersonImageInformation&lt;/code&gt;会被添加和定义的类属性相对应的构造方法、哈希、重载&lt;code&gt;&amp;lt;&lt;/code&gt;, &lt;code&gt;&amp;gt;&lt;/code&gt;, &lt;code&gt;==&lt;/code&gt;, &lt;code&gt;str()&lt;/code&gt;等&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;info = PersonImageInformation(
    image_name=&#39;/some/path&#39;,
    image_quality=0.92,
    person_id=107)

# info2 = PersonImageInformation(
#    image_name=&#39;/some/path&#39;,
#    person_id=107)
# mypy: Missing positional argument &amp;quot;image_quality&amp;quot; in call to &amp;quot;PersonImageInformation&amp;quot;  [call-arg]

# info3 = PersonImageInformation(
#     image_name=0,
#     image_quality=0.92,
#     person_id=107)
# mypy: Argument &amp;quot;image_name&amp;quot; to &amp;quot;PersonImageInformation&amp;quot; has incompatible type &amp;quot;int&amp;quot;; expected &amp;quot;str&amp;quot;  [arg-type]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;可以看到生成的构造函数也是带类型标注的，实际上就是通过内省&lt;code&gt;__annotation__&lt;/code&gt;属性拿到的，但&lt;code&gt;dataclass&lt;/code&gt;用的不是&lt;code&gt;typing&lt;/code&gt;模块，而是&lt;code&gt;inspect&lt;/code&gt;模块&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;cls_annotations = inspect.get_annotations(cls)	
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在添加构造方法&lt;code&gt;__init__&lt;/code&gt;时，类型标注也被写进方法的签名里&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;def _init_param(f):
    # Return the __init__ parameter string for this field.  For
    # example, the equivalent of &#39;x:int=3&#39; (except instead of &#39;int&#39;,
    # reference a variable set to int, and instead of &#39;3&#39;, reference a
    # variable set to 3).
    # ...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;有些库也是像这样利用&lt;code&gt;Type Hints&lt;/code&gt;进行元编程的，比如&lt;code&gt;pydantic&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;以上&lt;/p&gt;
">在Python中使用Type Hints和Mypy</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/cfan-xing-zhi-ke-li-hua-han-shu-zu-he/"" data-c="
          &lt;p&gt;原文：&lt;a href=&#34;https://zhuanlan.zhihu.com/p/662698843&#34;&gt;https://zhuanlan.zhihu.com/p/662698843&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Reference:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://sighingnow.github.io/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/cpp_currying_partial_application.html&#34;&gt;C++ 实现 Currying 和 Partial application&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/47315860&#34;&gt;从零开始的简单函数式C++（八）函数组合 - 知乎 (zhihu.com)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;抛开柯里化和函数组合在非函数式的&lt;code&gt;C++&lt;/code&gt;语言中能有多大用与抽象的额外开销不谈.. 本文只是单纯地解析一下如何利用&lt;code&gt;C++&lt;/code&gt;泛型（模板）实现这两个高阶函数&lt;/p&gt;
&lt;p&gt;一个最小实现其实不是很复杂，只要先了解一点变长模板、&lt;code&gt;forwarding reference&lt;/code&gt;、&lt;code&gt;lambda&lt;/code&gt;就可以..&lt;/p&gt;
&lt;h3 id=&#34;compose&#34;&gt;Compose&lt;/h3&gt;
&lt;p&gt;首先是函数组合（&lt;code&gt;Compose&lt;/code&gt;）&lt;/p&gt;
&lt;p&gt;给定函数&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;f_1, f_2, \dots, f_N&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.8888799999999999em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;，我们希望给定输入&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;a_1, a_2, \dots a_M&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.625em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;M&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;，总有&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo&gt;−&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;Compose(f_1, f_2, \dots, f_N)(a_1  \dots a_M) = f_N(f_{N-1}\dots (f_2(f_1(a_1  \dots a_M))))&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.07153em;&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;M&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.328331em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;span class=&#34;mbin mtight&#34;&gt;−&lt;/span&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.208331em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;M&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;也就是$Compose(f_1, f_2, \dots, f_N)  \equiv f_N(f_{N-1}\dots (f_2(f_1))) $&lt;/p&gt;
&lt;p&gt;由于$Compose(f_2, \dots, f_{N})  \equiv f_{N}(f_{N-1}\dots (f_2)) $&lt;/p&gt;
&lt;p&gt;所以$Compose(f_1, f_2, \dots, f_N) \equiv a_1  \dots a_M \rightarrow Compose(f_2, \dots, f_{N})(f1(a_1  \dots a_M)) $&lt;/p&gt;
&lt;p&gt;那可以看出，我们实现&lt;code&gt;Compose&lt;/code&gt;的一种方式是写一个递归模板函数，但这样引入了递归的开销&lt;/p&gt;
&lt;p&gt;另外考虑如果令&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;∣&lt;/mi&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;a\ |\ f = f(a)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;∣&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;，那么&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;∣&lt;/mi&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;∣&lt;/mi&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;∣&lt;/mi&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;Compose(f_1, f_2, \dots, f_N)(a_1 \dots a_M) =    f_1(a_1\dots a_M) \ |\ f_2 \ |\ \dots\ |\ f_N&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.07153em;&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;M&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;M&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;∣&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;∣&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;∣&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;因为&lt;code&gt;C++14&lt;/code&gt;中引入了折叠表达式，我们也可以通过&lt;code&gt;operator&lt;/code&gt;重载 + 折叠表达式的方式实现这种非递归的链式调用与函数组合&lt;/p&gt;
&lt;h4 id=&#34;0-递归实现&#34;&gt;0. 递归实现&lt;/h4&gt;
&lt;p&gt;先来看简单一点的递归版本实现&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-C++&#34;&gt;template &amp;lt;typename... Func&amp;gt; struct Compose {
private:
    using FuncChain = std::tuple&amp;lt;Func...&amp;gt;;
    FuncChain funcs;
public:
  template &amp;lt;typename... FuncRef&amp;gt;
  explicit Compose(FuncRef &amp;amp;&amp;amp;...);

  template &amp;lt;typename... ArgT&amp;gt; 
  decltype(auto) operator()(ArgT &amp;amp;&amp;amp;...);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;我们把&lt;code&gt;Compose&lt;/code&gt;实现为模板函数对象，模板参数为&lt;code&gt;Func...&lt;/code&gt;，是需要组合的函数的&lt;strong&gt;值&lt;/strong&gt;类型列表&lt;/p&gt;
&lt;p&gt;在&lt;code&gt;Compose&lt;/code&gt;内部，我们维护了一个&lt;code&gt;tuple&amp;lt;Func...&amp;gt;&lt;/code&gt;，存储所有待组合的函数，因为调用组合函数时，它需要看到所有被组合的函数，所以我们才将&lt;code&gt;Compose&lt;/code&gt;实现为能持有状态的函数对象&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Compose&lt;/code&gt;的构造函数是&lt;code&gt;template &amp;lt;typename... FuncRef&amp;gt; Compose(FuncRef &amp;amp;&amp;amp;...)&lt;/code&gt;，使用&lt;code&gt;Forwarding Refence&lt;/code&gt;（万能引用）区分&lt;code&gt;FuncRef&amp;amp;&amp;amp;&lt;/code&gt;是&lt;code&gt;Func&lt;/code&gt;的左值引用还是右值引用，从而支持复制/移动语义&lt;/p&gt;
&lt;p&gt;的这里不直接写成&lt;code&gt;Compose(Func &amp;amp;&amp;amp;...)&lt;/code&gt;的原因是，编译器在生成&lt;code&gt;Compose&lt;/code&gt;构造函数代码时，已经进入了&lt;code&gt;Compose&lt;/code&gt;内，&lt;code&gt;Func...&lt;/code&gt;类型已确定，&lt;code&gt;Func&amp;amp;&amp;amp;&lt;/code&gt;不是万能引用，而是一个确定的类型&lt;/p&gt;
&lt;p&gt;简单地说，万能引用的原理是引用折叠，当&lt;code&gt;FuncRef = T&lt;/code&gt;或&lt;code&gt;FuncRef = T&amp;amp;&amp;amp;&lt;/code&gt;时，&lt;code&gt;FunRef&amp;amp;&amp;amp; = T&amp;amp;&amp;amp;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;当&lt;code&gt;FuncRef = T&amp;amp;&lt;/code&gt;时，&lt;code&gt;FunRef&amp;amp;&amp;amp; = T&amp;amp;&lt;/code&gt;，了解了这些规则，就能理解这里为何还要套一层模板&lt;/p&gt;
&lt;p&gt;最后是&lt;code&gt;operator()&lt;/code&gt;这里返回类型声明为&lt;code&gt;decltype(auto)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;decltype(auto)&lt;/code&gt;对于编译器而言大概就是这个意思&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;decltype(auto) f() {
    return some_expr;
}
// ==
decltype((some_expr)) f() {
    return some_expr;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;也就是保持返回的表达式的引用类型和&lt;code&gt;cv&lt;/code&gt;限定符，避免&lt;code&gt;Compose&lt;/code&gt;修改了原始函数们的返回值类型&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;typename... FuncRef&amp;gt;
explicit Compose(FuncRef &amp;amp;&amp;amp;...f) : funcs{std::forward&amp;lt;FuncRef&amp;gt;(f)...} {};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;递归版本的话，&lt;code&gt;operator()&lt;/code&gt;内部调用一个递归模板&lt;code&gt;_invoke&lt;/code&gt;，令&lt;code&gt;_invoke&amp;lt;Index, ArgT...&amp;gt;&lt;/code&gt;调用第&lt;code&gt;Index&lt;/code&gt;个函数，然后把结果传给第&lt;code&gt;Index + 1&lt;/code&gt;个函数&lt;code&gt;_invoke&amp;lt;Index + 1, ArgT...&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;std::size_t Index, typename... ArgT&amp;gt;
decltype(auto) _invoke(FuncChain &amp;amp;funcs, ArgT &amp;amp;&amp;amp;...args) {
  if constexpr (Index + 1 == sizeof...(Func))
    return std::get&amp;lt;Index&amp;gt;(funcs)(std::forward&amp;lt;ArgT&amp;gt;(args)...);
  else   
    return _invoke&amp;lt;Index + 1&amp;gt;(funcs)(std::get&amp;lt;Index&amp;gt;(funcs)(std::forward&amp;lt;ArgT&amp;gt;(args)...)); 
} 

template &amp;lt;typename... ArgT&amp;gt; decltype(auto) operator()(ArgT &amp;amp;&amp;amp;...args) {
  return _invoke&amp;lt;0, ArgT...&amp;gt;(funcs, std::forward&amp;lt;ArgT&amp;gt;(args)...);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;如果当前是最后一个函数（&lt;code&gt;Index + 1 == sizeof...(Func)&lt;/code&gt;），那么直接返回结果，否则递归调用&lt;/p&gt;
&lt;p&gt;这样就完成了，但还有个小问题，我们现在的实现处理不了这种情况：中间某个函数返回了&lt;code&gt;void&lt;/code&gt;，比如&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;string s{&amp;quot;nihao&amp;quot;};
auto get_ref_to_my_name = [&amp;amp;]() -&amp;gt; string &amp;amp; { return s; };
auto then_modify_it = [](string &amp;amp;sref) -&amp;gt; void {
  sref = &amp;quot;goodbye&amp;quot;;
};
auto and_print = [&amp;amp;]() -&amp;gt; void {
  cout &amp;lt;&amp;lt; &amp;quot;s == \&amp;quot;&amp;quot; &amp;lt;&amp;lt; s &amp;lt;&amp;lt; &amp;quot;\&amp;quot; now\n&amp;quot;;
};
auto &amp;amp;&amp;amp;action1 = Compose(get_ref_to_my_name, then_modify_it, and_print);
action1();
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;因为&lt;code&gt;C/C++&lt;/code&gt;中&lt;code&gt;void&lt;/code&gt;比较特殊，如果有&lt;code&gt;void f(), void g()&lt;/code&gt;，那么&lt;code&gt;f(g())&lt;/code&gt;是不符表达式语法的，组合&lt;code&gt;f&lt;/code&gt;和&lt;code&gt;g&lt;/code&gt;应该用&lt;code&gt;f(), g()&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;所以这里我们对&lt;code&gt;void&lt;/code&gt;特判一下&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;decltype(auto) _invoke(FuncChain &amp;amp;funcs, ArgT &amp;amp;&amp;amp;...args) {
  // ...
  using CurrentResT = std::invoke_result_t&amp;lt;
      std::remove_reference_t&amp;lt;decltype(std::get&amp;lt;Index&amp;gt;(funcs))&amp;gt;, ArgT...&amp;gt;;
  if constexpr (!std::is_void_v&amp;lt;CurrentResT&amp;gt;)
    return _invoke&amp;lt;Index + 1, CurrentResT&amp;gt;(
        funcs, std::get&amp;lt;Index&amp;gt;(funcs)(std::forward&amp;lt;ArgT&amp;gt;(args)...));
  else {
    std::get&amp;lt;Index&amp;gt;(funcs)(std::forward&amp;lt;ArgT&amp;gt;(args)...);
    return _invoke&amp;lt;Index + 1&amp;gt;(funcs);
  }
} 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;其中使用&lt;code&gt;std::invoke_result_t&lt;/code&gt;让编译器告诉我们当前第&lt;code&gt;Index&lt;/code&gt;个函数的返回值类型，如果是&lt;code&gt;void&lt;/code&gt;，就避免把&lt;code&gt;void&lt;/code&gt;传递到下一个函数&lt;/p&gt;
&lt;p&gt;最后我们的&lt;code&gt;Compose&lt;/code&gt;是一个模板类，所以写一个模板参数引导&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;typename... FuncRef&amp;gt;
Compose(FuncRef...) -&amp;gt; Compose&amp;lt;std::remove_reference_t&amp;lt;FuncRef&amp;gt;...&amp;gt;;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这里的引导的作用是帮助编译器&lt;code&gt;Compose&lt;/code&gt;通过构造函数的形参类型推导出模板参数类型，我们构造函数输入是万能引用，存储的&lt;code&gt;Func&lt;/code&gt;是值类型，所以用&lt;code&gt;std::remove_reference_t&lt;/code&gt;擦除引用&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;auto &amp;amp;&amp;amp;action1 = Compose(get_ref_to_my_name, then_modify_it, and_print);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这样&lt;code&gt;Compose&lt;/code&gt;就不用写模板参数了&lt;/p&gt;
&lt;p&gt;那现在我们把它改成非递归版本的XD&lt;/p&gt;
&lt;h4 id=&#34;1-非递归实现&#34;&gt;1. 非递归实现&lt;/h4&gt;
&lt;p&gt;上文提到过的&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;∣&lt;/mi&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;a\ |\ f = f(a)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;∣&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;∣&lt;/mi&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;∣&lt;/mi&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;∣&lt;/mi&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;Compose(f_1, f_2, \dots, f_N)(a_1 \dots a_M) =    f_1(a_1\dots a_M) \ |\ f_2 \ |\ \dots\ |\ f_N&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.07153em;&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;M&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;M&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;∣&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;∣&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;∣&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;在表达能力不弱的&lt;code&gt;C++&lt;/code&gt;中也能实现，我们这里选择管道符&lt;code&gt;|&lt;/code&gt;重载函数调用关系，当然其他二元&lt;code&gt;operator&lt;/code&gt;比如逗号也可以，&lt;code&gt;|&lt;/code&gt;的话好看一点，以及&lt;code&gt;Unix&lt;/code&gt;管道与&lt;code&gt;C++ 20 ranges&lt;/code&gt;都是使用&lt;code&gt;|&lt;/code&gt;表示组合关系的&lt;/p&gt;
&lt;p&gt;首先实现&lt;code&gt;operator|&lt;/code&gt;的重载，同时为了处理&lt;code&gt;void&lt;/code&gt;，我们引入一个辅助的空类型&lt;code&gt;None&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;struct None {};
template &amp;lt;typename Arg, typename Func&amp;gt;
decltype(auto) operator|(Arg &amp;amp;&amp;amp;a, Func f) {
  using Ret = std::invoke_result_t&amp;lt;Func, decltype(a)&amp;gt;;
  if constexpr (std::is_void_v&amp;lt;Ret&amp;gt;) {
    f(a);
    return None{};
  } else
    return f(a);
}
template &amp;lt;typename Func&amp;gt; decltype(auto) operator|(None, Func f) {
  using Ret = std::invoke_result_t&amp;lt;Func&amp;gt;;
  if constexpr (std::is_void_v&amp;lt;Ret&amp;gt;) {
    f();
    return None{};
  } else
    return f();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;首先&lt;code&gt;a | f&lt;/code&gt;返回&lt;code&gt;f(a)&lt;/code&gt;，但如果返回&lt;code&gt;void&lt;/code&gt;的话就转而返回一个&lt;code&gt;None{}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;然后我们再为&lt;code&gt;None&lt;/code&gt;重载一个&lt;code&gt;operator|&lt;/code&gt;（第一个形参是&lt;code&gt;None&lt;/code&gt;不是泛型，重载优先级更高），避免&lt;code&gt;None{}&lt;/code&gt;被传入当前函数&lt;/p&gt;
&lt;p&gt;测试一下&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;auto add = [](auto a, auto b) { return a + b; };
auto multiply = [](auto x) { return x * 2; };
auto square = [](auto x) { return x * x; };
cout &amp;lt;&amp;lt; (add(3, 6) | multiply | square) &amp;lt;&amp;lt; endl;
// 324
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;现在只剩实现&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;∣&lt;/mi&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;∣&lt;/mi&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;∣&lt;/mi&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;Compose(f_1, f_2, \dots, f_N)(a_1 \dots a_M) =    f_1(a_1\dots a_M) \ |\ f_2 \ |\ \dots\ |\ f_N&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.07153em;&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;M&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;M&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;∣&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;∣&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;∣&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;了&lt;/p&gt;
&lt;p&gt;我们可以用&lt;code&gt;C++ 14&lt;/code&gt;折叠表达式，简单说，如果有边长模板参数&lt;code&gt;...F =  F2, F3 ... FN&lt;/code&gt;，那么&lt;code&gt;(result_of_F1 | ... | F)&lt;/code&gt;等价于&lt;code&gt;(((result_of_F1 | F2) | F3)... | FN)&lt;/code&gt;，这样结合重载的&lt;code&gt;|&lt;/code&gt;就实现函数组合了&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;typename ...Func&amp;gt; struct Compose {
private:
  // ...
  template &amp;lt;std::size_t... Indexes, typename... ArgT&amp;gt;
  decltype(auto) _invoke(FuncChain &amp;amp;funcs,
                         std::integer_sequence&amp;lt;std::size_t, Indexes...&amp;gt;,
                         ArgT &amp;amp;&amp;amp;...args) {
    return (std::get&amp;lt;0&amp;gt;(funcs)(std::forward&amp;lt;ArgT&amp;gt;(args)...) | ... |
            std::get&amp;lt;Indexes + 1&amp;gt;(funcs));
  };

public:
  // ...
  template &amp;lt;typename... ArgT&amp;gt; decltype(auto) operator()(ArgT &amp;amp;&amp;amp;...args) {
    return _invoke(funcs, std::make_index_sequence&amp;lt;sizeof...(Func) - 1&amp;gt;{},
                   std::forward&amp;lt;ArgT&amp;gt;(args)...);
  }
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这里&lt;code&gt;operator()&lt;/code&gt;向&lt;code&gt;_invoke&lt;/code&gt;传递了一个&lt;code&gt;std::make_index_sequence&amp;lt;sizeof...(Func) - 1&amp;gt;&lt;/code&gt;，也就是&lt;code&gt;std::integer_sequence&amp;lt;std::size_t, 0, 1, 2, sizeof...(Func) - 2&amp;gt;&lt;/code&gt;，这样&lt;code&gt;_invoke&lt;/code&gt;内部就能解构出这些下标，有了下标我们就能索引第&lt;code&gt;1&lt;/code&gt;（从&lt;code&gt;0&lt;/code&gt;计数）个函数到最后一个函数了&lt;/p&gt;
&lt;p&gt;在&lt;code&gt;_invoke&lt;/code&gt;内，我们首先用&lt;code&gt;std::get&amp;lt;0&amp;gt;(funcs)(std::forward&amp;lt;ArgT&amp;gt;(args)...) &lt;/code&gt;拿到第&lt;code&gt;0&lt;/code&gt;个函数返回值，然后用折叠表达式展开&lt;code&gt;operator()&lt;/code&gt;传入的下标，链式调用后续函数&lt;/p&gt;
&lt;p&gt;测试代码&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;using namespace std;
int main() {
  auto add = [](auto a, auto b) { return a + b; };
  auto multiply = [](auto x) { return x * 2; };
  auto square = [](auto x) { return x * x; };
  cout &amp;lt;&amp;lt; (add(3, 6) | multiply | square) &amp;lt;&amp;lt; endl;
  cout &amp;lt;&amp;lt; Compose(add, multiply, square) (3, 6)&amp;lt;&amp;lt; endl;
  // Case0: Normal func chain, output 324 324

  string s{&amp;quot;nihao&amp;quot;};
  auto get_ref_to_my_name = [&amp;amp;]() -&amp;gt; string &amp;amp; { return s; };
  auto then_modify_it = [](string &amp;amp;sref) -&amp;gt; void {
    sref = &amp;quot;goodbye&amp;quot;;
  };
  auto and_print = [&amp;amp;]() -&amp;gt; void {
    cout &amp;lt;&amp;lt; &amp;quot;s == \&amp;quot;&amp;quot; &amp;lt;&amp;lt; s &amp;lt;&amp;lt; &amp;quot;\&amp;quot; now\n&amp;quot;;
  };
  auto &amp;amp;&amp;amp;action1 = Compose(get_ref_to_my_name, then_modify_it, and_print);
  action1();
  // Case1: compose contains void on functional chain; output:s == &amp;quot;goodbye&amp;quot; now

  auto &amp;amp;&amp;amp;meaningless = Compose([] {});
  meaningless();
  // Case2: single compose 

  auto f1 = [](int a, int b) { return a + b; };
  auto f2 = [](int x) -&amp;gt; double { return x * 1.16666666666666; };
  auto &amp;amp;&amp;amp;action2 = Compose(
      Compose(f1, f2), [](auto x) { return &amp;quot;Result: &amp;quot; + std::to_string(x); });
  cout &amp;lt;&amp;lt; action2(-3, 5);
  // Case3: Nested compose
  // output:
  // Result: 2.333333
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;包含&lt;code&gt;4&lt;/code&gt;种情况：普通组合、中间有&lt;code&gt;void&lt;/code&gt;的组合、单个函数组合、嵌套组合&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Full code:&lt;/strong&gt; [&lt;a href=&#34;https://github.com/zixfy/cpp-algorithm/blob/main/functional/compose.hpp&#34;&gt;Github&lt;/a&gt;]&lt;/p&gt;
&lt;h3 id=&#34;currying&#34;&gt;Currying&lt;/h3&gt;
&lt;p&gt;接下来顺便写一个柯里化（&lt;code&gt;Currying&lt;/code&gt;），这里涉及到了函数形参类型的解构，所以我们主要利用&lt;code&gt;std::function&lt;/code&gt;类实现柯里化&lt;/p&gt;
&lt;p&gt;&lt;em&gt;柯里化（Currying）是一种将多参数函数转换为一系列单参数函数的技术&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;对于&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;N&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.68333em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;元函数&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;f(x_1, x_2, \dots, x_N)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;， 令&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;Curry(f)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.07153em;&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;为柯里化后的&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;f&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.8888799999999999em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;那么&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;Curry(f)(a_1)(a_2)\dots (a_N) = f(a_1, a_2, \dots a_N)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.07153em;&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;令&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;→&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;g = a \rightarrow f(x_1 = a_1, x_2, \dots x_N )&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.625em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;→&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;由于$Curry(g(a_1))(a_2)(a_3)\dots(a_N) = g(a_1)(a_1, a_2, \dots a_N) $&lt;/p&gt;
&lt;p&gt;两式结合也就是&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;Curry(f)(a_1)(a_2)\dots (a_N) = Curry(g(a_1))(a_2)(a_3)\dots(a_N)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.07153em;&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.07153em;&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;所以&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;→&lt;/mo&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;→&lt;/mo&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;Curry(f) = a \rightarrow Curry(g) = a \rightarrow Curry(f(x_1 = a, x_2, \dots ,x_N))&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.07153em;&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;→&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.07153em;&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;→&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.07153em;&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;所以我们将&lt;code&gt;Curry&lt;/code&gt;实现为一个递归闭包&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;typename RetT, typename... ArgsT&amp;gt;
auto Curry(std::function&amp;lt;RetT(ArgsT...)&amp;gt; func) {
  if constexpr (sizeof...(ArgsT) &amp;lt; 2)
    return func;
  else
    return _curry_combine&amp;lt;RetT, ArgsT...&amp;gt;(std::move(func));
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;创建一个模板函数&lt;code&gt;Curry&lt;/code&gt;解构出&lt;code&gt;std::function&lt;/code&gt;的返回值类型&lt;code&gt;RetT&lt;/code&gt;和形参类型&lt;code&gt;...ArgsT&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Curry&lt;/code&gt;接收原始&lt;code&gt;std::function&lt;/code&gt;，输出柯里化后的闭包，或原始函数的形参数量少于&lt;code&gt;2&lt;/code&gt;，那就直接返回原函数，这里使用使用&lt;code&gt;if constexpr&lt;/code&gt;条件编译&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;typename Return, typename Arg, typename... Args&amp;gt;
auto _curry_combine(std::function&amp;lt;Return(Arg, Args...)&amp;gt; original) {
   // f(x_1, x_2, ... x_N)
  if constexpr (sizeof...(Args) == 0)
    return original;
  else
    return [f = std::move(original)](Arg &amp;amp;&amp;amp;arg) { // arg -&amp;gt; curry(f(arg, x_2, x_3, ..., x_N))
      return _curry_combine(//curry(f(x_1 = arg, x_2, x_3, ..., x_N))
          std::function([&amp;amp;f, &amp;amp;arg](Args &amp;amp;&amp;amp;...args) {
       		 return f(std::forward&amp;lt;Arg&amp;gt;(arg), std::forward&amp;lt;Args&amp;gt;(args)...);
              // f((x_1 = arg, x_2, x_3, ..., x_N)
      }));
    };
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;_curry_combine&lt;/code&gt;用于生成递归闭包，每一层闭包存储当前的形参&lt;code&gt;arg&lt;/code&gt;与上一层闭包的引用&lt;code&gt;f&lt;/code&gt;即可&lt;/p&gt;
&lt;p&gt;最后我们处理的都是&lt;code&gt;std::function&lt;/code&gt;，但&lt;code&gt;std::function&lt;/code&gt;能从&lt;code&gt;C++&lt;/code&gt;函数或函数指针或函数对象构造&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;typename FuncLike&amp;gt;
auto Curry(FuncLike&amp;amp;&amp;amp; func) {
  return Curry(std::function{std::forward&amp;lt;FuncLike&amp;gt;(func)});
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;所以再重载一个&lt;code&gt;Curry&lt;/code&gt;支持其他的可调用对象，构造相应的&lt;code&gt;function&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;测试代码&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;auto f(int a, int b, int c, int d, int e, int f) {
  return a + b + c + d + e + f;
}
auto f2(int&amp;amp; ref, int val) { ref = val; }
int main() {
  auto cf1 = Curry(f);
  std::cout &amp;lt;&amp;lt; cf1(1)(1)(4)(5)(1)(4)&amp;lt;&amp;lt; std::endl;
  // Case0: normal
  // 16
  int what;
  auto cf2 = Curry(f2);
  auto &amp;amp;&amp;amp;setter = cf2(what);
  setter(107);
  std::cout &amp;lt;&amp;lt; what &amp;lt;&amp;lt; std::endl;
  //Case1: Delay Invoke
  //107
    
  auto cf3 = Curry([] (std::string const &amp;amp;a, std::string const &amp;amp; b) {return a + b;});
  std::cout &amp;lt;&amp;lt; cf3(std::string{&amp;quot;hola&amp;quot;})(std::string{&amp;quot; amigo&amp;quot;}) &amp;lt;&amp;lt; std::endl;
  // Case2: lambda
  // hola amigo
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;以上函数组合与柯里化的完整实现代码：[&lt;a href=&#34;https://github.com/zixfy/cpp-algorithm/blob/main/functional/compose.hpp&#34;&gt;compose.hpp&lt;/a&gt;, &lt;a href=&#34;https://github.com/zixfy/cpp-algorithm/blob/main/functional/curry.hpp&#34;&gt;curry.hpp&lt;/a&gt;]&lt;/p&gt;
">C++泛型之柯里化、函数组合</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/cshi-xian-jian-yi-rpc/"" data-c="
          &lt;p&gt;原文：&lt;a href=&#34;https://zhuanlan.zhihu.com/p/662574190&#34;&gt;https://zhuanlan.zhihu.com/p/662574190&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;好久没有在知乎写随笔捏.. 因为这些天在玩Octopath Traveler和学习&lt;a href=&#34;https://pdos.csail.mit.edu/6.824/schedule.html&#34;&gt;&lt;code&gt;MIT 6.5840&lt;/code&gt;&lt;/a&gt;课程的说&lt;/p&gt;
&lt;p&gt;在&lt;code&gt;MIT 6.5840&lt;/code&gt;课程&lt;code&gt;lab&lt;/code&gt;中构建分布式系统时，节点之间的通信都是通过远程过程调用（&lt;code&gt;Remote Procedure call&lt;/code&gt;）实现的，简单地说就是，&lt;code&gt;RPC&lt;/code&gt;客户端请求远程服务端执行指定函数，并将计算结果通过网络传回&lt;/p&gt;
&lt;p&gt;无论是&lt;code&gt;lab1&lt;/code&gt;使用的&lt;code&gt;Go&lt;/code&gt;语言标准库的&lt;code&gt;net/rpc/&lt;/code&gt;还是之后&lt;code&gt;lab&lt;/code&gt;中课程组模拟的带&lt;code&gt;RPC&lt;/code&gt;功能的网络，&lt;code&gt;RPC&lt;/code&gt;的大概流程都是&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;客户端将实参对象序列化到字节，发送到服务端&lt;/li&gt;
&lt;li&gt;服务端要根据客户端请求正确路由到指定函数，当然函数名可以放到&lt;code&gt;RPC&lt;/code&gt;传输所依赖的网络协议里，比如&lt;code&gt;HTTP&lt;/code&gt;或自己定义的。在我的实现里，我是利用&lt;code&gt;HTTP&lt;/code&gt;协议完成&lt;code&gt;RPC&lt;/code&gt;的，直接把函数名放在&lt;code&gt;HTTP url&lt;/code&gt;里了.. 然后在服务端写了个&lt;code&gt;url&lt;/code&gt;拦截&lt;/li&gt;
&lt;li&gt;服务端反序列化得到形参对象，把返回值对象序列化到字节回复客户端，客户端再反序列化&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;更多关于&lt;code&gt;RPC&lt;/code&gt;的详情，这篇带图的&lt;a href=&#34;https://xiaolincoding.com/network/2_http/http_rpc.html&#34;&gt;文章&lt;/a&gt;讲的很清楚！&lt;/p&gt;
&lt;p&gt;综上，为了能在&lt;code&gt;C++&lt;/code&gt;实现&lt;code&gt;RPC&lt;/code&gt;的方法（不用其他第三方库，除了&lt;code&gt;fmt&lt;/code&gt;因为我写时用的&lt;code&gt;C++ 17&lt;/code&gt;所以没有&lt;code&gt;std::format&lt;/code&gt;），我们得写这几部分代码&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;对象序列化/反序列化&lt;/li&gt;
&lt;li&gt;服务端函数注册和函数的路由&lt;/li&gt;
&lt;li&gt;客户端&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;当然第&lt;code&gt;1, 3&lt;/code&gt;部分是很简单啦，但在服务端侧处理&lt;code&gt;RPC&lt;/code&gt;函数时，我们要实现运行期函数多态，这里我是利用&lt;code&gt;std::function&lt;/code&gt;实现，当然用函数指针肯定也可以&lt;/p&gt;
&lt;p&gt;首先是对象序列化，搜了一下很多轮子都是用&lt;code&gt;Protobuf &lt;/code&gt;实现对象序列化的，好像是个根据配置文件自动生成类型序列化，反序列化代码的框架&lt;/p&gt;
&lt;p&gt;我用的是之前写的一个静态反射宏 + 内部嵌套模板的&lt;a href=&#34;https://github.com/zixfy/MyJson&#34;&gt;序列化库&lt;/a&gt;，本质上也是代码生成器罢了，只不过是&lt;code&gt;C++&lt;/code&gt;标准自带的而已。这样我们摆脱了对第三方框架的依赖，坏处是编译器会累一点&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;DEF_DATA_CLASS(Person, (unsigned short) age, (std::string) name,
               (std::vector&amp;lt;int&amp;gt;) scores);
Person p{24,  &amp;quot;alice&amp;quot;, {3, 4, 89}}; 
cout &amp;lt;&amp;lt; Json{p} &amp;lt;&amp;lt; endl;
cout &amp;lt;&amp;lt; Json{Json{p}.to_type&amp;lt;Person&amp;gt;().value()} &amp;lt;&amp;lt; endl;
//{&amp;quot;age&amp;quot;:24,&amp;quot;name&amp;quot;:&amp;quot;alice&amp;quot;,&amp;quot;scores&amp;quot;:[3,4,89]}
//{&amp;quot;age&amp;quot;:24,&amp;quot;name&amp;quot;:&amp;quot;alice&amp;quot;,&amp;quot;scores&amp;quot;:[3,4,89]}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;用法大概就是这样，现在我们虽然可以（反）序列化对象了，但是我这个实现很&lt;code&gt;naive&lt;/code&gt;，从代码可以看出我使用的序列化协议是&lt;code&gt;JSON&lt;/code&gt;，使用&lt;code&gt;JSON&lt;/code&gt;的话，就会有这些处理与传输开销：转义字符的处理、&lt;code&gt;JSON&lt;/code&gt;自描述（每次都要传输字段名字）、不好压缩空字段、&lt;code&gt;JSON&lt;/code&gt;文本的递归下降解析&lt;/p&gt;
&lt;p&gt;所以其实像&lt;code&gt;Protobuf&lt;/code&gt;与&lt;code&gt;Go&lt;/code&gt;中&lt;code&gt;net/rpc&lt;/code&gt;使用的序列化方案&lt;code&gt;gob&lt;/code&gt;都是使用二进制的方案提高性能，所以优化你的&lt;code&gt;rpc&lt;/code&gt;时，可以考虑设计一个高效的二进制序列化方案，然后传输在&lt;code&gt;TCP&lt;/code&gt;协议上&lt;/p&gt;
&lt;p&gt;举栗一个我做&lt;code&gt;MIT 6.5840&lt;/code&gt;时遇到的&lt;code&gt;bug&lt;/code&gt;说明&lt;code&gt;Go&lt;/code&gt;语言中&lt;code&gt;gob&lt;/code&gt;对数据空字段的优化&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[Worker 1116111] mapping, Task={7 pg-tom_sawyer.txt 0 8 10}
[Worker 1116111] reducing, Task={0  1 8 10}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这里我是同步顺序调用两个&lt;code&gt;RPC&lt;/code&gt;，期望的两个&lt;code&gt;Task&lt;/code&gt;返回值如上&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[Worker 1117085] mapping, Task={7 pg-tom_sawyer.txt 0 8 10}
[Worker 1117085] reducing, Task={7 pg-tom_sawyer.txt 1 8 10}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;但实际结果是这样的，这里的病灶是，客户端内两个&lt;code&gt;RPC&lt;/code&gt;接受返回值的&lt;code&gt;Task&lt;/code&gt;对象是同一个，但是前两个字段没有在第二次&lt;code&gt;RPC&lt;/code&gt;更新为&lt;code&gt;0&lt;/code&gt;和&lt;code&gt;&amp;quot;&amp;quot;&lt;/code&gt;，不用想都想得到这里因为是&lt;code&gt;int&lt;/code&gt;和&lt;code&gt;string&lt;/code&gt;的默认值，服务端应该没有把这两个字段序列化到&lt;code&gt;TCP&lt;/code&gt;字节流里。所以说&lt;code&gt;net/rpc&lt;/code&gt;假设了客户端是用一个&lt;code&gt;Go&lt;/code&gt;中的默认对象（&lt;code&gt;Type{}&lt;/code&gt;）来接受返回值的&lt;/p&gt;
&lt;p&gt;第二是选择&lt;code&gt;RPC&lt;/code&gt;底层的网络协议，认真写的话最好用&lt;code&gt;TCP&lt;/code&gt;，多套一层&lt;code&gt;HTTP&lt;/code&gt;有额外开销嘛，反正我因为之前用&lt;code&gt;Linux Epoll&lt;/code&gt;写了一个&lt;code&gt;HTTP&lt;/code&gt;服务器，所以选择在&lt;code&gt;HTTP&lt;/code&gt;之上传输，单纯是懒得再写一个应用层协议了..&lt;/p&gt;
&lt;p&gt;当我说应用层协议时，我想说的是我们必须要能分辨出&lt;code&gt;RPC&lt;/code&gt;数据的边界，有实践过网络编程的话就会知道&lt;code&gt;TCP/UDP&lt;/code&gt;传输的是字节流，服务端缓冲区单次读取可能读取的是不完整的&lt;code&gt;RPC&lt;/code&gt;请求，或是多个&lt;code&gt;RPC&lt;/code&gt;请求&lt;/p&gt;
&lt;p&gt;所以使用&lt;code&gt;TCP&lt;/code&gt;的话，至少请求起始处要有长度字段标明数据长度给服务端解析&lt;/p&gt;
&lt;p&gt;第三是服务端函数注册与路由&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;namespace my::net::rpc {
    static std::string_view default_route_prefix = &amp;quot;/rpc/&amp;quot;;
    using HandlerType = std::function&amp;lt;std::string(std::string_view)&amp;gt;;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这里我的函数名存在&lt;code&gt;HTTP url&lt;/code&gt;中，前缀默认为&lt;code&gt;/rpc/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;而&lt;code&gt;RPC&lt;/code&gt;函数的约束我参考的&lt;code&gt;Go rpc&lt;/code&gt;，形参数量必须为&lt;code&gt;1&lt;/code&gt;，而且形参和返回值类型必须能被我的&lt;code&gt;Json&lt;/code&gt;库序列化，对于每一个&lt;code&gt;RPC&lt;/code&gt;函数，创建一个&lt;code&gt;rpc::HandlerType&lt;/code&gt;，它是一个输入&lt;code&gt;std::string_view&lt;/code&gt;（指向&lt;code&gt;HTTP&lt;/code&gt;内存缓冲区内的&lt;code&gt;JSON&lt;/code&gt;），输出&lt;code&gt;std::string&lt;/code&gt;（序列化的&lt;code&gt;RPC&lt;/code&gt;返回值）的&lt;code&gt;std::function&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;namespace my::net::http {
    
using RpcFuncTable = std::unordered_map&amp;lt;std::string, rpc::HandlerType&amp;gt;;
    // ...
	RpcFuncTable m_rpc_funcs;
    // ...
    
template &amp;lt;typename Func&amp;gt;
  bool rpc_register(std::string const &amp;amp;name, Func func) {
    auto url = std::string{rpc::default_route_prefix} + name;
    // $&amp;quot;/rpc/{name}&amp;quot;
    if (m_rpc_funcs.find(url) != m_rpc_funcs.end())
      return false;
    m_rpc_funcs[url] = [f = func](std::string_view content) -&amp;gt; std::string {
      using namespace MyJson;
      auto j = Json::from_json_text(content);
      // ...
      using ArgT = std::remove_cv_t&amp;lt;std::remove_reference_t&amp;lt;rpc::FirstArgT&amp;lt;Func&amp;gt;&amp;gt;&amp;gt;; 
      auto arg = j.value().to_type&amp;lt;ArgT&amp;gt;();
      // ...
      return Json{f(arg.value())}.to_json_text();
    };
    return true;
  }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;所以服务端维护一个函数名到相应&lt;code&gt;HandlerType&lt;/code&gt;的哈希&lt;code&gt;m_rpc_funcs&lt;/code&gt;就可以&lt;/p&gt;
&lt;p&gt;当通过&lt;code&gt;rpc_register&amp;lt;Func&amp;gt;&lt;/code&gt;注册一个类型为&lt;code&gt;Func&lt;/code&gt;的新函数（&lt;code&gt;C++&lt;/code&gt;函数或函数指针或函数对象）时，利用&lt;code&gt;lambda&lt;/code&gt;写一个函数装饰器，生成的闭包也输入&lt;code&gt;string_view&lt;/code&gt;，返回&lt;code&gt;string&lt;/code&gt;，所以可以在哈希表里构造一个对应的&lt;code&gt;rpc::HandlerType&lt;/code&gt;（也就是&lt;code&gt;std::function&amp;lt;std::string(std::string_view)&amp;gt;&lt;/code&gt;）&lt;/p&gt;
&lt;p&gt;闭包内部反序列化、调用注册的函数、序列化就完成了&lt;code&gt;RPC&lt;/code&gt;函数的多态&lt;/p&gt;
&lt;p&gt;其中有一个&lt;code&gt;rpc::FirstArgT&amp;lt;Func&amp;gt;&lt;/code&gt;模板，是用于获取函数那单个形参类型的，如果函数是一个&lt;code&gt;C++&lt;/code&gt;函数对象&lt;code&gt;f&lt;/code&gt;，比如&lt;code&gt;lambda&lt;/code&gt;，那我们调用&lt;code&gt;f&lt;/code&gt;时实际调用的是&lt;code&gt;f.operator()&lt;/code&gt;，所以这个模板对函数指针和函数对象作了不同的特化&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;typename T&amp;gt; struct arg_type;
// function
template &amp;lt;typename R, typename Arg&amp;gt; struct arg_type&amp;lt;R(Arg)&amp;gt; { 
   using type = Arg; };
// function pointer
template &amp;lt;typename R, typename Arg&amp;gt; struct arg_type&amp;lt;R (*)(Arg)&amp;gt; { 
   using type = Arg; };
// member function pointer
template &amp;lt;typename C, typename R, typename Arg&amp;gt; struct arg_type&amp;lt;R (C::*)(Arg)&amp;gt; { 
   using type = Arg; };
// const member function pointer
template &amp;lt;typename C, typename R, typename Arg&amp;gt; struct arg_type&amp;lt;R (C::*)(Arg) const&amp;gt; {
   using type = Arg;};
template &amp;lt;typename F, typename = void&amp;gt; struct first_type { 
   using type = typename arg_type&amp;lt;F&amp;gt;::type; };
template &amp;lt;typename F&amp;gt; struct first_type&amp;lt;F, std::enable_if_t&amp;lt;std::is_class_v&amp;lt;F&amp;gt;&amp;gt;&amp;gt; {
   using type = typename arg_type&amp;lt;decltype(&amp;amp;F::operator())&amp;gt;::type;}; 

template &amp;lt;typename F&amp;gt; using FirstArgT = typename detail::first_type&amp;lt;F&amp;gt;::type;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;接下来只要让服务端正确路由&lt;code&gt;RPC&lt;/code&gt;请求到相应的&lt;code&gt;rpc::HandlerType&lt;/code&gt;，然后返回&lt;code&gt;HTTP&lt;/code&gt;报文&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;auto rpc_url = std::string{request.url};
if (rpc_table.find(rpc_url) != rpc_table.end()) {
    auto res = rpc_table[rpc_url](request.content);
    m_keep_alive = request.keep_alive;
    std::stringstream ss;
    ss &amp;lt;&amp;lt; &amp;quot;HTTP/1.1 200 OK\r\n&amp;quot;;
    ss &amp;lt;&amp;lt; &amp;quot;Connection: &amp;quot; &amp;lt;&amp;lt; (m_keep_alive ? &amp;quot;keep-alive&amp;quot; : &amp;quot;close&amp;quot;) &amp;lt;&amp;lt; &amp;quot;\r\n&amp;quot;;
    ss &amp;lt;&amp;lt; &amp;quot;Content-Length: &amp;quot; &amp;lt;&amp;lt; res.size() &amp;lt;&amp;lt; &amp;quot;\r\n\r\n&amp;quot;;
    ss &amp;lt;&amp;lt; res;
    m_response_buffer.s = ss.str();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;第四是写客户端，到这部分就是纯搬砖了..&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;Client cli;
cli.dial(&amp;quot;/*server_addr*/:/*server_port*/&amp;quot;);
cout &amp;lt;&amp;lt; cli.call&amp;lt;string, string&amp;gt;(&amp;quot;echo&amp;quot;, &amp;quot;i am client, rpc okay&amp;quot;).value() &amp;lt;&amp;lt; endl;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;类似&lt;code&gt;Go rpc&lt;/code&gt;先写一个&lt;code&gt;dial&lt;/code&gt;函数指定&lt;code&gt;RPC&lt;/code&gt;服务端&lt;code&gt;IP&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;然后写一个模板函数&lt;code&gt;call&amp;lt;ArgT, ResT&amp;gt;&lt;/code&gt;指明&lt;code&gt;RPC&lt;/code&gt;调用的输入输出类型，这里&lt;code&gt;call&lt;/code&gt;使用短连接的话，每次&lt;code&gt;connect&lt;/code&gt;一次服务端发送&lt;code&gt;HTTP&lt;/code&gt;请求&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;bool dial(const std::string &amp;amp;address);

template &amp;lt;typename ArgT, typename ResT&amp;gt;
std::optional&amp;lt;ResT&amp;gt; call(std::string const &amp;amp;name, ArgT const &amp;amp;arg)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;测试一下，先定义数据类型&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;namespace MyTypeList {
    DEF_DATA_CLASS(Arg, (float) a, (int) b)
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;然后在服务器上注册两个&lt;code&gt;RPC&lt;/code&gt;函数，分别是&lt;code&gt;lambda&lt;/code&gt;和普通函数&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;using namespace my; 
using namespace std;
using namespace MyTypeList; 
string f(Arg a) {
  return string {&amp;quot;[Server Add]&amp;quot;} 
    + std::to_string(a.a) + &amp;quot; + &amp;quot;
    + std::to_string(a.b) + &amp;quot; = &amp;quot;
    + std::to_string(a.b + a.a);
}
auto main(int argc, char *argv[]) -&amp;gt; int {
  // ...
  auto server = net::http::Reactor(config);
  server.rpc_register(&amp;quot;echo&amp;quot;, [](const std::string &amp;amp;x) {
    return std::string{&amp;quot;[Server Echo] &amp;quot;} + x;
  });

  server.rpc_register(&amp;quot;calculate&amp;quot;, f);
  server.run();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;我的服务端与客户端&lt;code&gt;Log&lt;/code&gt;分别成功打印了&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[********:49632][200](RPC) method=&amp;quot;POST&amp;quot;, url=&amp;quot;/rpc/echo&amp;quot;, version=&amp;quot;HTTP/1.1&amp;quot;, host=&amp;quot;&amp;quot;, keep-alive=false, content-length=23, content=&amp;quot;i am client, rpc okay&amp;quot;
[********:49640][200](RPC) method=&amp;quot;POST&amp;quot;, url=&amp;quot;/rpc/calculate&amp;quot;, version=&amp;quot;HTTP/1.1&amp;quot;, host=&amp;quot;&amp;quot;, keep-alive=false, content-length=20, content={&amp;quot;a&amp;quot;:7.59506,&amp;quot;b&amp;quot;:19}
[********:49650][200](RPC) method=&amp;quot;POST&amp;quot;, url=&amp;quot;/rpc/calculate&amp;quot;, version=&amp;quot;HTTP/1.1&amp;quot;, host=&amp;quot;&amp;quot;, keep-alive=false, content-length=20, content={&amp;quot;a&amp;quot;:1.42983,&amp;quot;b&amp;quot;:15}
[********:49652][200](RPC) method=&amp;quot;POST&amp;quot;, url=&amp;quot;/rpc/calculate&amp;quot;, version=&amp;quot;HTTP/1.1&amp;quot;, host=&amp;quot;&amp;quot;, keep-alive=false, content-length=19, content={&amp;quot;a&amp;quot;:11.4494,&amp;quot;b&amp;quot;:2}
[********:49668][200](RPC) method=&amp;quot;POST&amp;quot;, url=&amp;quot;/rpc/calculate&amp;quot;, version=&amp;quot;HTTP/1.1&amp;quot;, host=&amp;quot;&amp;quot;, keep-alive=false, content-length=19, content={&amp;quot;a&amp;quot;:12.5055,&amp;quot;b&amp;quot;:3}
[********:49682][200](RPC) method=&amp;quot;POST&amp;quot;, url=&amp;quot;/rpc/calculate&amp;quot;, version=&amp;quot;HTTP/1.1&amp;quot;, host=&amp;quot;&amp;quot;, keep-alive=false, content-length=20, content={&amp;quot;a&amp;quot;:3.33604,&amp;quot;b&amp;quot;:15}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;和&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[Server Echo] i am client, rpc okay
[Server Add]7.595060 + 19 = 26.595060
[Server Add]1.429830 + 15 = 16.429831
[Server Add]11.449400 + 2 = 13.449400
[Server Add]12.505500 + 3 = 15.505500
[Server Add]3.336040 + 15 = 18.336040
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Full Code&lt;/strong&gt;: [&lt;a href=&#34;https://github.com/zixfy/SimpleWebServer/blob/main/main.cpp&#34;&gt;server&lt;/a&gt;, &lt;a href=&#34;https://github.com/zixfy/SimpleWebServer/blob/main/rpc_client.cpp&#34;&gt;rpc_client&lt;/a&gt;]&lt;/p&gt;
">C++实现简易RPC</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/repos/"" data-c="
          &lt;h2 id=&#34;zhihu&#34;&gt;Zhihu&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://www.zhihu.com/people/leon-87-10&#34;&gt;https://www.zhihu.com/people/leon-87-10&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;leetcode&#34;&gt;Leetcode&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://leetcode.cn/u/zixfy/&#34;&gt;https://leetcode.cn/u/zixfy/&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;github&#34;&gt;Github&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;pyACLL-inference&lt;/strong&gt;&lt;/p&gt;
&lt;div style=&#34;display: flex; justify-content: flex-start;&#34;&gt;
    &lt;img src=&#34;https://img.shields.io/badge/license-MIT-blue?logo=git&amp;link=http%3A%2F%2Fgitlab.buaadml.info%2Fbdi%2Fpyacl-inference%2F-%2Fblob%2Fmain%2FLICENSE&#34;  style=&#34;margin: 5px&#34;&gt;
    &lt;img src=&#34;https://img.shields.io/badge/python-%3E%3D3.8-blue?logo=python&#34;  style=&#34;margin: 5px&#34;&gt;
    &lt;img src=&#34;https://img.shields.io/badge/Gitee-samples-red?logo=gitee&amp;cacheSeconds=https%3A%2F%2Fgitee.com%2Fascend%2Fsamples&#34;  style=&#34;margin: 5px&#34;&gt;
        &lt;img src=&#34;https://img.shields.io/badge/huawei-CANN-red?logo=huawei&amp;logoColor=red&amp;link=https%3A%2F%2Fwww.hiascend.com%2Fzh%2Fsoftware%2Fcann&#34;  style=&#34;margin: 5px&#34;&gt;
&lt;/div&gt;
&lt;p&gt;[&lt;a href=&#34;https://github.com/zixfy/pyACL-inference/&#34;&gt;Github&lt;/a&gt;] 一个华为&lt;code&gt;CANN&lt;/code&gt; &lt;code&gt;.om&lt;/code&gt;模型数据并行推理的接口(&lt;code&gt;AscendCL with python&lt;/code&gt;)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;leecode-cplusplus-solution&lt;/strong&gt;&lt;/p&gt;
&lt;div style=&#34;display: flex; justify-content: flex-start;&#34;&gt;
    &lt;img src=&#34;https://img.shields.io/badge/LICENSE-MIT-blue?logo=git&amp;logoColor=orange&#34;  style=&#34;margin: 5px&#34;&gt;
    &lt;img src=&#34;https://img.shields.io/badge/C%2B%2B-17-blue?logo=cplusplus&amp;logoColor=blue&#34;  style=&#34;margin: 5px&#34;&gt;
    &lt;img src=&#34;https://img.shields.io/badge/Leetcode-Zixfy-pink?style=social&amp;logo=leetcode&amp;logoColor=orange&#34;  style=&#34;margin: 5px&#34;&gt; 
&lt;/div&gt; 
&lt;p&gt;[&lt;a href=&#34;https://github.com/zixfy/cpp-advanced-container-template&#34;&gt;Github&lt;/a&gt;] 力扣&lt;code&gt;C++&lt;/code&gt;题目&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Advanced data structures Implement in C++&lt;/strong&gt;&lt;/p&gt;
&lt;div style=&#34;display: flex; justify-content: flex-start;&#34;&gt;
    &lt;img src=&#34;https://img.shields.io/badge/license-MIT-blue?logo=git&amp;logoColor=%20&#34;  style=&#34;margin: 5px&#34;&gt;
    &lt;img src=&#34;https://img.shields.io/badge/C%2B%2B-20-green?logo=cplusplus&amp;logoColor=blue&#34;  style=&#34;margin: 5px&#34;&gt;
    &lt;img src=&#34;https://img.shields.io/badge/cmake-3.22%2B-green?logo=cmake&amp;logoColor=deepskyblue&#34;  style=&#34;margin: 5px&#34;&gt;
        &lt;img src=&#34;https://img.shields.io/badge/compiler-x86%20MSVC%2019.29%2B-green?logo=compilerexplorer&#34;  style=&#34;margin: 5px&#34;&gt;
&lt;/div&gt; 
&lt;p&gt;[&lt;a href=&#34;https://github.com/zixfy/cpp-advanced-container-template&#34;&gt;Github&lt;/a&gt;] 一些数据结构与算法在&lt;code&gt;C++&lt;/code&gt;的模板实现&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;MyJson&lt;/strong&gt;&lt;/p&gt;
&lt;div style=&#34;display: flex; justify-content: flex-start;&#34;&gt;
    &lt;img src=&#34;https://img.shields.io/badge/license-MIT-blue?logo=git&amp;logoColor=%20&#34;  style=&#34;margin: 5px&#34;&gt;
    &lt;img src=&#34;https://img.shields.io/badge/C%2B%2B-17-green?logo=cplusplus&amp;logoColor=blue&#34;  style=&#34;margin: 5px&#34;&gt;
    &lt;img src=&#34;https://img.shields.io/badge/cmake-3.22%2B-green?logo=cmake&amp;logoColor=deepskyblue&#34;  style=&#34;margin: 5px&#34;&gt;
        &lt;img src=&#34;https://img.shields.io/badge/compiler-x86%20gcc%2011.3+-green?logo=compilerexplorer&#34;  style=&#34;margin: 5px&#34;&gt;   &lt;img src=&#34;https://img.shields.io/badge/compiler-x86%20MSVC%2019.29%2B-green?logo=compilerexplorer&#34;  style=&#34;margin: 5px&#34;&gt;
&lt;/div&gt; 
&lt;p&gt;[&lt;a href=&#34;https://github.com/zixfy/MyJson&#34;&gt;Github&lt;/a&gt;] 利用静态反射宏的对象序列化&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;SimpleWebServer&lt;/strong&gt;&lt;/p&gt;
&lt;div style=&#34;display: flex; justify-content: flex-start;&#34;&gt;
    &lt;img src=&#34;https://img.shields.io/badge/license-MIT-blue?logo=git&amp;logoColor=%20&#34;  style=&#34;margin: 5px&#34;&gt;
    &lt;img src=&#34;https://img.shields.io/badge/C%2B%2B-17-green?logo=cplusplus&amp;logoColor=blue&#34;  style=&#34;margin: 5px&#34;&gt;
    &lt;img src=&#34;https://img.shields.io/badge/cmake-3.22%2B-green?logo=cmake&amp;logoColor=deepskyblue&#34;  style=&#34;margin: 5px&#34;&gt;
        &lt;img src=&#34;https://img.shields.io/badge/Linux-18.04%20LTS-green?logo=linux&amp;logoColor=%20&#34;  style=&#34;margin: 5px&#34;&gt;   
        &lt;img src=&#34;https://img.shields.io/badge/github-fmt10.1.0-blue?logo=github&amp;logoColor=%20&amp;link=https%3A%2F%2Fgithub.com%2Ffmtlib%2Ffmt&#34;  style=&#34;margin: 5px&#34;&gt;
&lt;/div&gt;  
&lt;p&gt;[&lt;a href=&#34;https://github.com/zixfy/SimpleWebServer&#34;&gt;Github&lt;/a&gt;] 多线程单&lt;code&gt;Reactor&lt;/code&gt;静态&lt;code&gt;HTTP&lt;/code&gt;服务器&lt;/p&gt;
&lt;h2 id=&#34;题解索引&#34;&gt;题解索引&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;/post/leetcode-2262-zi-fu-chuan-de-zong-yin-li/&#34;&gt;【Leetcode】2262. 字符串的总引力&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;/post/leetcode/&#34;&gt;【Leetcode】2449. 使数组相似的最少操作次数&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;/post/leetcode-2503-ju-zhen-cha-xun-ke-huo-de-de-zui-da-fen-shu&#34;&gt;【Leetcode】2503. 矩阵查询可获得的最大分数&lt;/a&gt;&lt;/p&gt;
">Index</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/zai-czhong-chuang-jian-ju-ming-yuan-zu-namedtuple/"" data-c="
          &lt;p&gt;创作于&lt;a href=&#34;https://zhuanlan.zhihu.com/p/659506997&#34;&gt;zhihu&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;首先不建议使用&lt;code&gt;std::tuple&lt;/code&gt;，&lt;code&gt;tuple&lt;/code&gt;是给模板，而不是正常代码用的&lt;/p&gt;
&lt;p&gt;泛型中，有时我们不得不根据变长的&lt;code&gt;typename&lt;/code&gt;保存对象（&lt;code&gt;std::tuple&amp;lt;type_trait&amp;lt;T&amp;gt;...&amp;gt;&lt;/code&gt;）&lt;/p&gt;
&lt;p&gt;因为我们没法直接在模板类里根据变长的&lt;code&gt;typename&lt;/code&gt;存储变长的不同类型成员..&lt;/p&gt;
&lt;p&gt;比如像实现一个这样回滚的功能&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;size_t I, typename Tup, typename  Lhs, typename ...Oth&amp;gt;
void impl(Tup const &amp;amp; t, Lhs &amp;amp; lhs, Oth &amp;amp; ...oth) {
    lhs = std::get&amp;lt;I&amp;gt;(t);
    if constexpr (sizeof...(oth) &amp;gt; 0) impl&amp;lt;I + 1, Tup, Oth...&amp;gt;(t, oth...);
};
auto snapshot = [](auto &amp;amp;...arg) {
  return [&amp;amp;, rhs = std::tuple&amp;lt;std::remove_reference_t&amp;lt;decltype(arg)&amp;gt;...&amp;gt;{
                 arg...}]() { impl&amp;lt;0&amp;gt;(rhs, arg...); };
};

int main() {
  int a = 1, b = 2; string c = &amp;quot;2.33&amp;quot;;
  auto rollback = snapshot(a, b, c);
  try {
      a = b = 3;  c = &amp;quot;1&amp;quot;;
      throw 0;
  } catch (...) {
      rollback();
  }
  cout &amp;lt;&amp;lt; a &amp;lt;&amp;lt; &amp;quot;, &amp;quot; &amp;lt;&amp;lt; b &amp;lt;&amp;lt; &amp;quot;, &amp;quot; &amp;lt;&amp;lt; c;
//1, 2, 2.33
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;但在其他场景下，我们应该首先使用聚合体替代&lt;code&gt;tuple&lt;/code&gt;，因为&lt;code&gt;tuple&lt;/code&gt;一般通过多继承或递归继承实现，引入了额外开销&lt;/p&gt;
&lt;p&gt;其次&lt;code&gt;tuple&lt;/code&gt;没有可读性，如果我需要匿名类型，我会先质疑自己是不是在写屎山..&lt;/p&gt;
&lt;p&gt;而且&lt;code&gt;C++ 17&lt;/code&gt;中，我们可以对&lt;code&gt;struct&lt;/code&gt;使用结构化绑定了&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;struct Person {short age; int id; string name;}
auto&amp;amp; [a, i, n] = Person{17, 32, &amp;quot;bob&amp;quot;};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;如果我们真的需要拿&lt;code&gt;tuple&lt;/code&gt;来存数据的话（比如让类型兼容&lt;code&gt;std::apply&lt;/code&gt;或其他模板），也至少要实现具名元组(&lt;code&gt;namedtuple&lt;/code&gt;)的机制，因为对&lt;code&gt;tuple&lt;/code&gt;取单个成员时，硬编码的&lt;code&gt;std::get&amp;lt;0&amp;gt;&lt;/code&gt;,&lt;code&gt;std::get&amp;lt;1&amp;gt;&lt;/code&gt; ... 很脆弱，匿名字段让代码可维护性变得很差&lt;/p&gt;
&lt;p&gt;首先我们可以使用&lt;code&gt;enum&lt;/code&gt;变量名来作为&lt;code&gt;namedtuple&lt;/code&gt;中的字段名&lt;/p&gt;
&lt;p&gt;先定义一个模板类&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;typename T&amp;gt; struct Named;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;特化一个&lt;code&gt;Named&lt;/code&gt;，存储对应&lt;code&gt;tuple&lt;/code&gt;类型与枚举&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;struct Person;
template &amp;lt;&amp;gt; struct Named&amp;lt;Person&amp;gt; {
  enum { name = 0, address, id, age };
  using Tuple = tuple&amp;lt;string, string, int, short&amp;gt;;
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;其中&lt;code&gt;enum&lt;/code&gt;是匿名弱枚举，枚举变量名会上升到&lt;code&gt;Named&amp;lt;Person&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;之后可以这样使用&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;int main() {
  Named&amp;lt;Person&amp;gt;::Tuple t{&amp;quot;alice&amp;quot;, &amp;quot;CN&amp;quot;, 114514, 17};
  cout &amp;lt;&amp;lt; get&amp;lt;Named&amp;lt;Person&amp;gt;::name&amp;gt;(t) &amp;lt;&amp;lt; endl;
  cout &amp;lt;&amp;lt; get&amp;lt;Named&amp;lt;Person&amp;gt;::address&amp;gt;(t) &amp;lt;&amp;lt; endl;
  cout &amp;lt;&amp;lt; get&amp;lt;Named&amp;lt;Person&amp;gt;::age&amp;gt;(t) &amp;lt;&amp;lt; endl;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;但是这样的话，&lt;code&gt;enum&lt;/code&gt;里的名字和存储类型就分裂开了，也就是使用中不能方便地查看某个名字对应什么类型，可能看差眼了&lt;/p&gt;
&lt;p&gt;这种写法不够优雅，除了拿变量名当名字，我们其实所以可以把&lt;strong&gt;另一个类型名&lt;/strong&gt;作为具名元组中的字段名&lt;/p&gt;
&lt;p&gt;然后使用&lt;code&gt;std::pair&lt;/code&gt; 绑定字段名和字段类型&lt;/p&gt;
&lt;p&gt;这样通过简单的元编程，我们就可以实现一个比较好维护的&lt;code&gt;namedtuple&lt;/code&gt;，写法如下&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;namespace MyTypeList {
template &amp;lt;typename U, typename V&amp;gt; using _ = pair&amp;lt;U, V&amp;gt;;
struct name; struct address; struct age; struct id; struct master;
using Person = DefineNamedTuple&amp;lt;_&amp;lt;name, string&amp;gt;,  _&amp;lt;address, string&amp;gt;, _&amp;lt;id, int&amp;gt;, _&amp;lt;age, short&amp;gt;&amp;gt;;
using Dog = DefineNamedTuple&amp;lt;_&amp;lt;master, Person::Tuple&amp;gt;, _&amp;lt;name, string&amp;gt;&amp;gt;;
}; // namespace MyTypeList
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;因为使用类型名作为名字，所以我们要使用一个&lt;code&gt;namespace&lt;/code&gt;封住这些名字防止污染代码中其他类&lt;/p&gt;
&lt;p&gt;核心是实现&lt;code&gt;DefineNamedTuple&amp;lt;pair&amp;lt;Name, Type&amp;gt;...&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;typename... NameAndTypes&amp;gt; struct DefineNamedTuple {
  using Tuple = std::tuple&amp;lt;typename UnPackPair&amp;lt;NameAndTypes&amp;gt;::second...&amp;gt;;
  template &amp;lt;typename T&amp;gt; struct Index_ {
    template &amp;lt;std::size_t I, typename U, typename... V&amp;gt; struct Helper {
      constexpr inline static std::size_t _v =
          std::is_same_v&amp;lt;T, typename UnPackPair&amp;lt;U&amp;gt;::first&amp;gt;
              ? I
              : Helper&amp;lt;I + 1, V...&amp;gt;::_v;
    };
    template &amp;lt;std::size_t I, typename U&amp;gt; struct Helper&amp;lt;I, U&amp;gt; {
      constexpr inline static std::size_t _v =
          std::is_same_v&amp;lt;T, typename UnPackPair&amp;lt;U&amp;gt;::first&amp;gt; ? I
                                                           : I + 1;
    };
    constexpr inline static std::size_t _v = Helper&amp;lt;0, NameAndTypes...&amp;gt;::_v;
  };
  template &amp;lt;typename T&amp;gt; constexpr inline static std::size_t At = Index_&amp;lt;T&amp;gt;::_v;
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这个模板类接收变长的&lt;code&gt;NameAndTypes&lt;/code&gt;(&lt;code&gt;pair&lt;/code&gt;)，首先定义了&lt;code&gt;Tuple&lt;/code&gt;别名，解构出&lt;code&gt;pair&lt;/code&gt;中存储的实际值类型，然后得到实际&lt;code&gt;tuple&lt;/code&gt;类型&lt;/p&gt;
&lt;p&gt;其次内部有一个模板变量&lt;code&gt;At&amp;lt;T&amp;gt;&lt;/code&gt;让编译器计算名字&lt;code&gt;T&lt;/code&gt;对应的&lt;code&gt;tuple&lt;/code&gt;下标&lt;/p&gt;
&lt;p&gt;核心是内部的&lt;code&gt;Helper&lt;/code&gt;递归模板&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;std::size_t I, typename U, typename... V&amp;gt; struct Helper 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;表示当前遍历下标为&lt;code&gt;I&lt;/code&gt;，&lt;code&gt;tuple&lt;/code&gt;中下标&lt;code&gt;I&lt;/code&gt;对应的名字是&lt;code&gt;U::first&lt;/code&gt;，下标&lt;code&gt;I&lt;/code&gt;以后的名字是&lt;code&gt;V::first...&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;std::is_same_v&amp;lt;T, typename UnPackPair&amp;lt;U&amp;gt;::first&amp;gt;
              ? I
              : Helper&amp;lt;I + 1, V...&amp;gt;::_v;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;所以如果当前名字是&lt;code&gt;T&lt;/code&gt;，返回&lt;code&gt;I&lt;/code&gt;，否则&lt;code&gt;++I&lt;/code&gt;，在之后的名字&lt;code&gt;V::first...&lt;/code&gt;中查找&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;std::size_t I, typename U&amp;gt; struct Helper&amp;lt;I, U&amp;gt; {
    constexpr inline static std::size_t _v =
        std::is_same_v&amp;lt;T, typename UnPackPair&amp;lt;U&amp;gt;::first&amp;gt; 
            ? I
            : I + 1;
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;再特化一个&lt;code&gt;Helper&lt;/code&gt;模板表示递归边界（查找到了最后一个名字&lt;code&gt;U::first&lt;/code&gt;）&lt;/p&gt;
&lt;p&gt;其中的&lt;code&gt;UnpackPair&amp;lt;U, V&amp;gt;&lt;/code&gt;用于解构&lt;code&gt;pair&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;typename U&amp;gt; struct UnPackPair;
template &amp;lt;typename U, typename V&amp;gt; struct UnPackPair&amp;lt;pair&amp;lt;U, V&amp;gt;&amp;gt; {
  using first = U;
  using second = V;
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;使用举栗：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;int main() {
  using namespace MyTypeList;
  Person::Tuple t{&amp;quot;alice&amp;quot;,  &amp;quot;CN&amp;quot;, 114514, 17};
  Dog::Tuple t2{t, &amp;quot;big black&amp;quot;};
  cout &amp;lt;&amp;lt; get&amp;lt;Person::At&amp;lt;name&amp;gt;&amp;gt;(t) &amp;lt;&amp;lt; endl;
  cout &amp;lt;&amp;lt; get&amp;lt;Person::At&amp;lt;address&amp;gt;&amp;gt;(t) &amp;lt;&amp;lt; endl;
  cout &amp;lt;&amp;lt; get&amp;lt;Person::At&amp;lt;age&amp;gt;&amp;gt;(t) &amp;lt;&amp;lt; endl;
  cout &amp;lt;&amp;lt; get&amp;lt;Person::At&amp;lt;id&amp;gt;&amp;gt;(t) &amp;lt;&amp;lt; endl;
  cout &amp;lt;&amp;lt; get&amp;lt;Dog::At&amp;lt;name&amp;gt;&amp;gt;(t2) &amp;lt;&amp;lt; endl;
  cout &amp;lt;&amp;lt; get&amp;lt;Person::At&amp;lt;id&amp;gt;&amp;gt;(get&amp;lt;Dog::At&amp;lt;master&amp;gt;&amp;gt;(t2)) &amp;lt;&amp;lt; endl;
}
// alice
// CN
// 17
// 114514
// big black
// 114514
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;完整实现：&lt;a href=&#34;https://link.zhihu.com/?target=https%3A//gist.github.com/zixfy/65728e0457cddef17ff3e8d9d2ce1292&#34;&gt;Gist&lt;/a&gt;&lt;/p&gt;
">在C++中创建具名元组(namedtuple)</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/jie-jue-cduo-ji-cheng-zhong-override-xu-han-shu-qian-ming-chong-tu/"" data-c="
          &lt;p&gt;创作于：&lt;a href=&#34;https://zhuanlan.zhihu.com/p/659417326&#34;&gt;zhihu&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;C++&lt;/code&gt;本身并没有提供标准的接口（&lt;code&gt;Interface&lt;/code&gt;）类型&lt;/p&gt;
&lt;p&gt;所以我们可以有各种方式来实现接口机制&lt;/p&gt;
&lt;p&gt;考虑面向对象的范式，&lt;code&gt;C++&lt;/code&gt;提供了纯虚函数，所以我们可以自然地使用抽象类作为接口类型&lt;/p&gt;
&lt;p&gt;纯虚函数是以&lt;code&gt;= 0&lt;/code&gt;声明的虚函数（什么怪语法..）&lt;/p&gt;
&lt;p&gt;如果一个类内部有纯虚函数，或者继承链上有没被实现的纯虚函数，那么这个类成为抽象类&lt;/p&gt;
&lt;p&gt;抽象类对象无法构造，我们只能利用它的引用或指针类型多态，而实际派生出来的类通过继承抽象类并&lt;code&gt;override&lt;/code&gt;纯虚函数来实现接口&lt;/p&gt;
&lt;p&gt;一个简单的接口例子&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;struct IPrintable {
  virtual void print() = 0;
};

struct StrangePrinter : IPrintable {
  void print() override {
    cout &amp;lt;&amp;lt; &amp;quot;StrangePrinter::print() hola, amigo!&amp;quot; &amp;lt;&amp;lt; endl;
  }
};

struct NormalPrinter : IPrintable {
  void print() override {
    cout &amp;lt;&amp;lt; &amp;quot;NormalPrinter::print() hello, world!&amp;quot; &amp;lt;&amp;lt; endl;
  }
};

int main() {
  using PrinterPtr = IPrintable*;
  StrangePrinter s;
  NormalPrinter n;
  PrinterPtr ps = &amp;amp;s, pn = &amp;amp;n;
  ps-&amp;gt;print();
  pn-&amp;gt;print();
}
//output:
//StrangePrinter::print() hola, amigo!
//NormalPrinter::print() hello, world!
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;当然实际中我们不可能每个类只实现一个接口吧，如果是，是不是该考虑解耦了？&lt;/p&gt;
&lt;p&gt;&lt;code&gt;C++&lt;/code&gt;支持多重继承，所以我们直接让实际类继承多个抽象类实现多个接口&lt;/p&gt;
&lt;p&gt;但是如果多个接口内有相同签名的纯虚函数该如何应对&lt;/p&gt;
&lt;p&gt;比如我有一个&lt;code&gt;IHasMinimum&amp;lt;T&amp;gt;&lt;/code&gt;接口，&lt;code&gt;value()&lt;/code&gt;返回&lt;code&gt;T&lt;/code&gt;的最小值，和一个&lt;code&gt;IHasMaximum&amp;lt;T&amp;gt;&lt;/code&gt;接口，&lt;code&gt;value()&lt;/code&gt;返回&lt;code&gt;T&lt;/code&gt;的最大值&lt;/p&gt;
&lt;p&gt;然后又有一个&lt;code&gt;IHasBound&amp;lt;T&amp;gt;&lt;/code&gt;，其&lt;code&gt;min(), max()&lt;/code&gt;分别返回&lt;code&gt;T&lt;/code&gt;的最小（大）值，所以让&lt;code&gt;IHasBound&amp;lt;T&amp;gt;&lt;/code&gt;接口去实现&lt;code&gt;IHasMinimum&amp;lt;T&amp;gt;&lt;/code&gt;和&lt;code&gt;IHasMaximum&amp;lt;T&amp;gt;&lt;/code&gt;接口很合理吧&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;typename T&amp;gt; struct IHasMinimum {
  virtual T value() = 0;
};

template &amp;lt;typename T&amp;gt; struct IHasMaximum {
  virtual T value() = 0;
};
template &amp;lt;typename T&amp;gt;
struct IHasBound : public IHasMinimum&amp;lt;T&amp;gt;, public IHasMaximum&amp;lt;T&amp;gt; {
  virtual T min() = 0;
  virtual T max() = 0;
    // override IHasMinimum::value and IHasMaximum::value ???
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;但是这俩接口的&lt;code&gt;value&lt;/code&gt;签名都是&lt;code&gt;value()&lt;/code&gt;，如果&lt;code&gt;IHasBound&lt;/code&gt;内&lt;code&gt;override&lt;/code&gt;了&lt;code&gt;value&lt;/code&gt;，&lt;code&gt;IHasMinimum&lt;/code&gt;，&lt;code&gt;IHasMaximum&lt;/code&gt;的&lt;code&gt;value()&lt;/code&gt;都会被&lt;code&gt;override&lt;/code&gt;，一个要返回最大值，一个要最小值，不能返回相同的值啊..&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;typename T&amp;gt;
struct IHasBound : public IHasMinimum&amp;lt;T&amp;gt;, public IHasMaximum&amp;lt;T&amp;gt; {
  T value() override { /*...*/ }
    // override both IHasMinimum::value and IHasMaximum::value 
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;也许改个函数名就解决问题了，比如两个&lt;code&gt;value&lt;/code&gt;改名成&lt;code&gt;min_value&lt;/code&gt;，&lt;code&gt;max_value&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;但也许 1. 我们改不了父类代码 2. 取不出更好的名字 3. 承担不了重命名的痛&lt;/p&gt;
&lt;p&gt;如果可以这样分别为&lt;code&gt;IHasMinimum&lt;/code&gt;和&lt;code&gt;IHasMaximum&lt;/code&gt;  &lt;code&gt;override&lt;/code&gt;两个版本的&lt;code&gt;value()&lt;/code&gt;就好了&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;typename T&amp;gt;
struct IHasBound : public IHasMinimum&amp;lt;T&amp;gt;, public IHasMaximum&amp;lt;T&amp;gt; {
  T IHasMinimum&amp;lt;T&amp;gt;::value() override { /*...*/ }  
  T IHasMaximum&amp;lt;T&amp;gt;::value() override { /*...*/ }  
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;但&lt;code&gt;C++&lt;/code&gt;好像不支持这样的机制，&lt;code&gt;C#&lt;/code&gt;是支持的&lt;/p&gt;
&lt;p&gt;所以可以这样曲线救国，我们在&lt;code&gt;IHasBound&lt;/code&gt;和&lt;code&gt;IHasMinimum/IHasMaximum&lt;/code&gt;间分别再加一个新类，新类实现&lt;code&gt;value()&lt;/code&gt;，&lt;code&gt;override&lt;/code&gt;的方法中向下转型获取&lt;code&gt;IHasBound&lt;/code&gt;的&lt;code&gt;this&lt;/code&gt;指针&lt;/p&gt;
&lt;p&gt;为了减少垃圾命名，先定义一个模板类&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;typename Interface, typename Struct&amp;gt; struct Impl;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;然后这样&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;typename T&amp;gt; struct IHasMinimum {
  virtual T value() = 0;
};
template &amp;lt;typename T&amp;gt; struct IHasMaximum {
  virtual T value() = 0;
};

template &amp;lt;typename T&amp;gt; struct IHasBound;

template &amp;lt;typename T&amp;gt;
struct Impl&amp;lt;IHasMaximum&amp;lt;T&amp;gt;, IHasBound&amp;lt;T&amp;gt;&amp;gt; : public IHasMaximum&amp;lt;T&amp;gt; {
  T value() override { return static_cast&amp;lt;IHasBound&amp;lt;T&amp;gt; *&amp;gt;(this)-&amp;gt;max(); }
};
template &amp;lt;typename T&amp;gt;
struct Impl&amp;lt;IHasMinimum&amp;lt;T&amp;gt;, IHasBound&amp;lt;T&amp;gt;&amp;gt; : public IHasMinimum&amp;lt;T&amp;gt; {
  T value() override { return static_cast&amp;lt;IHasBound&amp;lt;T&amp;gt; *&amp;gt;(this)-&amp;gt;min(); }
};

template &amp;lt;typename T&amp;gt;
struct IHasBound : public Impl&amp;lt;IHasMaximum&amp;lt;T&amp;gt;, IHasBound&amp;lt;T&amp;gt;&amp;gt;,
                   public Impl&amp;lt;IHasMinimum&amp;lt;T&amp;gt;, IHasBound&amp;lt;T&amp;gt;&amp;gt; {
  virtual T min() = 0;
  virtual T max() = 0;
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;就好了，一个使用栗子，创建&lt;code&gt;Range&amp;lt;T&amp;gt;&lt;/code&gt;类实现&lt;code&gt;IHasBound&lt;/code&gt;，就可以同时也实现&lt;code&gt;IHasMinimum/IHasMaximum&lt;/code&gt;了&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;typename T&amp;gt; struct Range : public IHasBound&amp;lt;T&amp;gt; {
  T _mini, _maxi;
  T min() override { return _mini; }
  T max() override { return _maxi; }
  Range(T mini, T maxi) : _mini{mini}, _maxi{maxi} {}
};

int main() { 
  Range d(114.514, 1919.810);
  IHasMinimum&amp;lt;double&amp;gt; &amp;amp;i1 = d;
  IHasMaximum&amp;lt;double&amp;gt; &amp;amp;i2 = d;
  IHasBound&amp;lt;double&amp;gt; &amp;amp;i3 = d;
  IHasBound&amp;lt;double&amp;gt; *i4 = &amp;amp;d;
  std::cout &amp;lt;&amp;lt; std::fixed &amp;lt;&amp;lt; std::setprecision(3);
  std::cout &amp;lt;&amp;lt; &amp;quot;IHasMinimum::value(): &amp;quot; &amp;lt;&amp;lt; i1.value() &amp;lt;&amp;lt; std::endl;
  std::cout &amp;lt;&amp;lt; &amp;quot;IHasMaximum::value(): &amp;quot; &amp;lt;&amp;lt; i2.value() &amp;lt;&amp;lt; std::endl;
  std::cout &amp;lt;&amp;lt; &amp;quot;IHasBound::min(): &amp;quot; &amp;lt;&amp;lt; i3.min() &amp;lt;&amp;lt; std::endl;
  std::cout &amp;lt;&amp;lt; &amp;quot;IHasBound::max(): &amp;quot; &amp;lt;&amp;lt; i3.max() &amp;lt;&amp;lt; std::endl;
  std::cout &amp;lt;&amp;lt; &amp;quot;IHasBound-&amp;gt;min(): &amp;quot; &amp;lt;&amp;lt; i4-&amp;gt;min() &amp;lt;&amp;lt; std::endl;
  std::cout &amp;lt;&amp;lt; &amp;quot;IHasBound-&amp;gt;max(): &amp;quot; &amp;lt;&amp;lt; i4-&amp;gt;max() &amp;lt;&amp;lt; std::endl;
}
//IHasMinimum::value(): 114.514
//IHasMaximum::value(): 1919.810
//IHasBound::min(): 114.514
//IHasBound::max(): 1919.810
//IHasBound-&amp;gt;min(): 114.514
//IHasBound-&amp;gt;max(): 1919.810
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;btw，如果实现类不是模板类，以上写法可能会有&lt;code&gt;incomplete type&lt;/code&gt;错误&lt;/p&gt;
&lt;p&gt;这时可以使用&lt;code&gt;CRTP&lt;/code&gt;，大概这么写&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;#include &amp;lt;iostream&amp;gt;
using namespace std;

template &amp;lt;typename Interface, typename Struct&amp;gt; struct Impl;
struct Base1 {
  virtual void fun() = 0;
};

struct Base2 {
  virtual void fun() = 0;
};

struct child;
template &amp;lt;std::same_as&amp;lt;child&amp;gt; T&amp;gt; struct Impl&amp;lt;Base1, T&amp;gt; : public Base1 {
  void fun() override {
    cout &amp;lt;&amp;lt; static_cast&amp;lt;T *&amp;gt;(this)-&amp;gt;name &amp;lt;&amp;lt; &amp;quot;, hello from override for Base1&amp;quot; &amp;lt;&amp;lt; endl;
  }
};
template &amp;lt;std::same_as&amp;lt;child&amp;gt; T&amp;gt; struct Impl&amp;lt;Base2, T&amp;gt; : public Base2 {
  void fun() override { cout &amp;lt;&amp;lt; static_cast&amp;lt;T *&amp;gt;(this)-&amp;gt;name &amp;lt;&amp;lt; &amp;quot;, hello from override for Base2&amp;quot; &amp;lt;&amp;lt; endl; }
};

struct child : public Impl&amp;lt;Base1, child&amp;gt;, public Impl&amp;lt;Base2, child&amp;gt; {
    string name{&amp;quot;iam child&amp;quot;};
};
int main() {
  child c;
  Base1 &amp;amp;b1 = c;
  Base2 &amp;amp;b2 = c;
  b1.fun();
  // hello from override for Base1
  b2.fun();
  // hello from override for Base2
  //c.fun();
  // ERROR: member found by ambiguous name lookup
}
&lt;/code&gt;&lt;/pre&gt;
">解决C++多继承中override虚函数签名冲突</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/yong-cshi-xian-cde-shu-xing-properties/"" data-c="
          &lt;p&gt;设想这样一个场景，我们正在写一个通过代码生成&lt;code&gt;markdown&lt;/code&gt;的脚本&lt;/p&gt;
&lt;p&gt;&lt;code&gt;markdown&lt;/code&gt;中行内代码的语法为`code`，相应显示为&lt;code&gt;code&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;对应到编码中，我们可以创建一个&lt;code&gt;InlineCode&lt;/code&gt;类维护这种&lt;code&gt;markdown&lt;/code&gt;元素&lt;/p&gt;
&lt;p&gt;考虑到反引号只在输出&lt;code&gt;markdown&lt;/code&gt;时需要，且反引号内的内容可能频繁修改&lt;/p&gt;
&lt;p&gt;所以我们用一个&lt;code&gt;string&lt;/code&gt;成员变量&lt;code&gt;_text&lt;/code&gt;维护反引号内的内容(code)，而不是整个行内代码(`code`)&lt;/p&gt;
&lt;p&gt;而且修改内容后，我们可能还有些其他操作，比如说检查内容语法正确性啥的whatever&lt;/p&gt;
&lt;p&gt;反正我们现在最好把&lt;code&gt;_text&lt;/code&gt;变成私有的，然后定义&lt;code&gt;set_text&lt;/code&gt;，&lt;code&gt;get_formatted_text&lt;/code&gt;成员函数读写内容&lt;/p&gt;
&lt;p&gt;但这样代码的可读性就有点太好了 XD&lt;/p&gt;
&lt;p&gt;如果我们只用暴露一个成员&lt;code&gt;text&lt;/code&gt;给使用者，让&lt;code&gt;text&lt;/code&gt;可以像一个&lt;code&gt;string&lt;/code&gt;一样被使用，也就是它被读写时自动调用&lt;code&gt;set_text&lt;/code&gt;，&lt;code&gt;get_formatted_text&lt;/code&gt;就好了&lt;/p&gt;
&lt;p&gt;&lt;code&gt;C#&lt;/code&gt;原生支持这种代理模式，我们在&lt;code&gt;C#&lt;/code&gt;中可以将&lt;code&gt;InlineCode&lt;/code&gt;类实现如下&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c#&#34;&gt;public class InlineCode
{
    private string _text; 
    private void _notify(string old, string newer)
    { Console.WriteLine($&amp;quot;InlineCode.Text modified from `{old}` to `{newer}`&amp;quot;);}

    public string Text
    {
        get =&amp;gt; $&amp;quot;`{_text}`&amp;quot;;
        set {  _notify(_text, value); _text = value; }
    }

    public string Style, Dom; 
	// and may have other members, omit
    public InlineCode() { }
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;C# Properties&lt;/code&gt;在&lt;code&gt;MSLearn&lt;/code&gt;上的&lt;a href=&#34;https://learn.microsoft.com/zh-cn/dotnet/csharp/programming-guide/classes-and-structs/using-properties&#34;&gt;介绍&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;简单来说，对于一个类型为&lt;code&gt;T&lt;/code&gt;的&lt;code&gt;C#&lt;/code&gt;字段&lt;code&gt;Prop&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;其&lt;code&gt;get&lt;/code&gt;必须满足委托类型（也就是函数签名+返回值类型）为&lt;code&gt;T()&lt;/code&gt;，&lt;code&gt;set&lt;/code&gt;委托也必须为&lt;code&gt;void(T)&lt;/code&gt;的形式&lt;/p&gt;
&lt;p&gt;当读取&lt;code&gt;Prop&lt;/code&gt;时，返回&lt;code&gt;get()&lt;/code&gt;，当赋值&lt;code&gt;Prop&lt;/code&gt;时，调用&lt;code&gt;set(value)&lt;/code&gt;，其中&lt;code&gt;value&lt;/code&gt;是赋值表达式右手侧&lt;/p&gt;
&lt;p&gt;所以上述代码中，&lt;code&gt;Text&lt;/code&gt;属性&lt;code&gt;get&lt;/code&gt;返回带反引号的内容，注意&lt;code&gt;set&lt;/code&gt;的&lt;code&gt;value&lt;/code&gt;形参的声明在语法上省略了&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;class Program
{
    static void Main(string[] args)
    {
        var code = new InlineCode();
        code.Text = &amp;quot;Rust&amp;quot;;
        Console.WriteLine(code.Text);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;所以使用&lt;code&gt;InlineCode&lt;/code&gt;类时，只用关注内部文本内容，上述代码可以得到以下期望结果&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;InlineCode.Text modified from `` to `Rust`
`Rust`
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;现在考虑以下类似机制在&lt;code&gt;C++&lt;/code&gt;中的实现&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;第1版代码:&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;typename T&amp;gt; class Field {
  using Getter = std::function&amp;lt;T()&amp;gt;;
  using Setter = std::function&amp;lt;void(const T &amp;amp;)&amp;gt;;
  Getter _get;
  Setter _set;

public:
  explicit Field( Getter getter = {}, Setter setter = {})
      : _get{getter},
        _set{setter} {}

  T get() { return _get(); }
  operator T() { return _get(); }

  Field &amp;amp;operator=(const T &amp;amp;arg) {
    _set(arg);
    return *this;
  }
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;创建代理类&lt;code&gt;Field&amp;lt;T&amp;gt;&lt;/code&gt;，参考&lt;code&gt;C#&lt;/code&gt;，将&lt;code&gt;get&lt;/code&gt;的类型&lt;code&gt;Getter&lt;/code&gt;定义为&lt;code&gt;std::function&amp;lt;T()&amp;gt;&lt;/code&gt;，将&lt;code&gt;get&lt;/code&gt;的类型&lt;code&gt;Getter&lt;/code&gt;定义为&lt;code&gt;std::function&amp;lt;void(const T &amp;amp;)&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;这样，只要分别用一个&lt;code&gt;_get&lt;/code&gt;和&lt;code&gt;_set&lt;/code&gt;变量保存&lt;code&gt;Getter/Setter&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;然后再定义&lt;code&gt;T get()&lt;/code&gt;并重载它的&lt;code&gt;operator T() &lt;/code&gt;用于读取（&lt;code&gt;_get()&lt;/code&gt;），重载&lt;code&gt;Field &amp;amp;operator=(const T &amp;amp;arg)&lt;/code&gt;用于修改&lt;code&gt;_set(arg)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;在函数体中的使用：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;int main() {
  string str = &amp;quot;default&amp;quot;;
  auto quoted_getter = [&amp;amp;]( ) { return &amp;quot;`&amp;quot; + str + &amp;quot;`&amp;quot;; };
  auto quoted_setter = [&amp;amp;](const string&amp;amp;s){ cout &amp;lt;&amp;lt; &amp;quot;modified from `&amp;quot; &amp;lt;&amp;lt; str &amp;lt;&amp;lt; &amp;quot;` to `&amp;quot; &amp;lt;&amp;lt; s &amp;lt;&amp;lt; &amp;quot;`\n&amp;quot;; str = s;};
  Field&amp;lt;string&amp;gt; quoted( quoted_getter, quoted_setter); 
  quoted = string{&amp;quot;Rust&amp;quot;};
  cout &amp;lt;&amp;lt; string{quoted} &amp;lt;&amp;lt; endl;
}
// output:
//modified from `default` to `Rust`
//`Rust`
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;当然这里有个问题，&lt;code&gt;using Setter = std::function&amp;lt;void(const T &amp;amp;)&amp;gt;;&lt;/code&gt;固定了了&lt;code&gt;Setter&lt;/code&gt;的形参类型，我们甚至没有机会去重载一个&lt;code&gt;void(T &amp;amp;&amp;amp;)&lt;/code&gt;版本的&lt;code&gt;Setter&lt;/code&gt;用来区分实参的值类型&lt;/p&gt;
&lt;p&gt;嗯，在&lt;code&gt;C++&lt;/code&gt;里左右值引用是不同的变量类型，而在有&lt;code&gt;GC&lt;/code&gt;的&lt;code&gt;C#&lt;/code&gt;上，引用并无左右引用而言&lt;/p&gt;
&lt;p&gt;所以具体地，在&lt;code&gt;main()&lt;/code&gt;第&lt;code&gt;6&lt;/code&gt;行，我们向&lt;code&gt;Field&amp;lt;string&amp;gt;::operator=(const string&amp;amp;)&lt;/code&gt;传入了纯右值&lt;code&gt;string{&amp;quot;Rust&amp;quot;}&lt;/code&gt;，但函数内部不知情，不能移动&lt;code&gt;string&lt;/code&gt;来节省开销&lt;/p&gt;
&lt;p&gt;所以接下来把&lt;code&gt;Setter/Getter&lt;/code&gt;类型而不是被代理的类型&lt;code&gt;T&lt;/code&gt;作为模板参数&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;第2版代码:&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template&amp;lt;typename Getter, typename Setter&amp;gt;
class Field {
    Getter _get;
    Setter _set;
    using GetterResT = std::invoke_result_t&amp;lt;Getter&amp;gt;;
public:
    explicit Field(
            Getter getter = {},
            Setter setter = {}
    ) : _get{getter}, _set{setter} {}

    GetterResT get() { return _get(); }
    operator GetterResT() { return _get(); }

    template&amp;lt;typename Arg&amp;gt;
    Field &amp;amp;operator=(Arg &amp;amp;&amp;amp;arg) {
        _set(std::forward&amp;lt;Arg&amp;gt;(arg));
        return *this;
    }
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;其中&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;使用&lt;code&gt;std::invoke_result_t&amp;lt;Getter&amp;gt;&lt;/code&gt;获取&lt;code&gt;_get()&lt;/code&gt;返回值的类型&lt;/li&gt;
&lt;li&gt;&lt;code&gt;operator=&lt;/code&gt;修改为模板函数，可以同时处理左右值了&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;在函数体中的使用：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;int main() {
  string str = &amp;quot;default&amp;quot;;
  auto quoted_getter = [&amp;amp;]( ) { return &amp;quot;`&amp;quot; + str + &amp;quot;`&amp;quot;; };
  auto quoted_setter = [&amp;amp;](auto &amp;amp;&amp;amp;s){ 
    cout &amp;lt;&amp;lt; &amp;quot;modified from `&amp;quot; &amp;lt;&amp;lt; str &amp;lt;&amp;lt; &amp;quot;` to `&amp;quot; &amp;lt;&amp;lt; s &amp;lt;&amp;lt; &amp;quot;`\n&amp;quot;; 
    str = std::forward&amp;lt;decltype(s)&amp;gt;(s);
    };
  Field quoted( quoted_getter, quoted_setter); 
  quoted = string{&amp;quot;Rust&amp;quot;};
  cout &amp;lt;&amp;lt; string{quoted} &amp;lt;&amp;lt; endl;
}
// output:
//modified from `default` to `Rust`
//`Rust`
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;注意这里&lt;code&gt;setter&lt;/code&gt;(&lt;code&gt;_set&lt;/code&gt;)如果需要的话，定义为一个模板函数来处理左右值&lt;/p&gt;
&lt;p&gt;..完成一半了，接下来考虑&lt;code&gt;Field&lt;/code&gt;作为类中成员变量如何使用&lt;/p&gt;
&lt;p&gt;继续使用&lt;code&gt;lambda&lt;/code&gt;作为&lt;code&gt;getter/setter&lt;/code&gt;就不太可行了&lt;/p&gt;
&lt;p&gt;因为定义类时要写明&lt;code&gt;Getter/Setter&lt;/code&gt;类别，但我们拿不到&lt;code&gt;lambda&lt;/code&gt;类型&lt;/p&gt;
&lt;p&gt;因此改用具名的函数对象来捕获&lt;code&gt;this&lt;/code&gt;指针&lt;/p&gt;
&lt;p&gt;&lt;code&gt;InlineCode&lt;/code&gt;类在&lt;code&gt;C++&lt;/code&gt;中可以实现如下&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;struct InlineCode {
private:
    std::string _text;
    struct TextGetter {
        InlineCode *self;
        std::string operator()() {
            return &amp;quot;`&amp;quot; + self-&amp;gt;_text + &amp;quot;`&amp;quot;;
        }
    }  ;
    struct TextSetter {
        InlineCode *self;
        template&amp;lt;typename Str&amp;gt;
        void operator()(Str &amp;amp;&amp;amp;s) {
            cout &amp;lt;&amp;lt; &amp;quot;modified from `&amp;quot; &amp;lt;&amp;lt; self-&amp;gt;_text &amp;lt;&amp;lt; &amp;quot;` to `&amp;quot; &amp;lt;&amp;lt; s &amp;lt;&amp;lt; &amp;quot;`\n&amp;quot;;
            self-&amp;gt;_text = std::forward&amp;lt;decltype(s)&amp;gt;(s);;
        }
    };
public:
    Field&amp;lt;TextGetter, TextSetter&amp;gt; text;
    InlineCode(): _text{}, text{{this}, {this}}{}
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;使用：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;InlineCode code;
code.text = string{&amp;quot;Rust&amp;quot;};
cout &amp;lt;&amp;lt; string{code.text} &amp;lt;&amp;lt; endl;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;看起来类的命名因为&lt;code&gt;Getter/Setter&lt;/code&gt;的后缀有些乱了，那再举一个栗子优化下代码结构&lt;/p&gt;
&lt;p&gt;假设类型&lt;code&gt;SomeClass&lt;/code&gt;有一个属性&lt;code&gt;time&lt;/code&gt;，&lt;code&gt;getter&lt;/code&gt;返回带前缀的时间&lt;code&gt;string&lt;/code&gt;，&lt;code&gt;setter&lt;/code&gt;接收时间&lt;code&gt;string&lt;/code&gt;或&lt;code&gt;UNIX&lt;/code&gt;时间戳（&lt;code&gt;long long&lt;/code&gt;)&lt;/p&gt;
&lt;p&gt;实现如下&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template&amp;lt;typename T&amp;gt; using FieldAs = Field&amp;lt;typename T::Getter, typename T::Setter&amp;gt;;struct SomeClass {
    std::string _time;
    struct Time {
        struct Getter {
            SomeClass *self;
            std::string operator()() {
                return string{&amp;quot;time here is &amp;quot;} + self-&amp;gt;_time;
            }
        };
        struct Setter {
            SomeClass *self;
            template&amp;lt;typename Arg&amp;gt;
            void operator()(Arg &amp;amp;&amp;amp;arg) {
                using ValT = std::decay_t&amp;lt;Arg&amp;gt;;
                if constexpr (std::is_convertible_v&amp;lt;ValT, std::string_view&amp;gt;)
                    self-&amp;gt;_time = std::forward&amp;lt;Arg&amp;gt;(arg);
                else {
                    std::tm *tm = std::localtime(&amp;amp;arg);
                    std::stringstream ss;
                    ss &amp;lt;&amp;lt; std::put_time(tm, &amp;quot;%Y-%m-%d %H:%M:%S&amp;quot;);
                    self-&amp;gt;_time = ss.str();
                }
            }
        };
    };
    FieldAs&amp;lt;Time&amp;gt; time;
    SomeClass() : time{{this},
                       {this}} {};
}; 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;首先我们定义一个模板别名&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template&amp;lt;typename T&amp;gt; using FieldAs = Field&amp;lt;typename T::Getter, typename T::Setter&amp;gt;;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这样我们先在&lt;code&gt;SomeClass&lt;/code&gt;内部定义属性对应的类型&lt;code&gt;Time&lt;/code&gt;，&lt;code&gt;Time&lt;/code&gt;内部再定义&lt;code&gt;Getter/Setter&lt;/code&gt;类型，最后使用&lt;code&gt; FieldAs&amp;lt;Time&amp;gt;&lt;/code&gt;定义成员变量就行，这样命名更顺眼一点&lt;/p&gt;
&lt;p&gt;使用:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;int main() {
    SomeClass that;
    that.time = &amp;quot;2023-10-02&amp;quot;;
    cout &amp;lt;&amp;lt; string{that.time} &amp;lt;&amp;lt; endl;
    that.time = std::int64_t{1696232071};
    cout &amp;lt;&amp;lt; string{that.time} &amp;lt;&amp;lt; endl;
}
// output:
//time here is 2023-10-02
//time here is 2023-10-02 15:34:31
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;Full code:&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://gist.github.com/zixfy/c83955d511ebe1814b3dc1cd8422b87e&#34;&gt;Github Gist&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;当然我认为使用&lt;code&gt;Properties&lt;/code&gt;模式时，&lt;code&gt;Getter&lt;/code&gt;和&lt;code&gt;Setter&lt;/code&gt;内部逻辑不能太复杂，否则整体代码可读性太差&lt;/p&gt;
">用C++实现C#的属性（Properties）</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/dml-bdi-shi-yan-shi-zhi-bei/"" data-c="
          &lt;center&gt;&lt;b&gt;#只身打马过草原&lt;/b&gt;&lt;/center&gt;
&lt;p&gt;（本站图床托管于&lt;code&gt;Github&lt;/code&gt;，大概率会被屏蔽）&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;&lt;strong&gt;Acknowledgement:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://liyirui-git.github.io/tech/%E6%8A%98%E8%85%BE/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html&#34;&gt;liyirui-git.github.io&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://jingtao.fun/posts/5cce79bf/&#34;&gt;jingtao.fun&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;ssh&#34;&gt;SSH&lt;/h3&gt;
&lt;h4 id=&#34;ssh软件&#34;&gt;SSH软件&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;类Unix: &lt;code&gt;shell&lt;/code&gt;内的&lt;code&gt;ssh&lt;/code&gt;命令&lt;/li&gt;
&lt;li&gt;Windows: &lt;code&gt;cmd&lt;/code&gt;内的&lt;code&gt;ssh&lt;/code&gt;命令（win10/11自带&lt;code&gt;openssh&lt;/code&gt;），或&lt;code&gt;WindowsTerminal&lt;/code&gt;/&lt;code&gt;Putty&lt;/code&gt;/&lt;code&gt;Xshell&lt;/code&gt;/&lt;code&gt;WSL&lt;/code&gt;等软件，选个好看的&lt;/li&gt;
&lt;li&gt;Android:华为云等软件&lt;/li&gt;
&lt;li&gt;maxOS/iOS:&lt;code&gt;iTerm2&lt;/code&gt;，&lt;code&gt;xTerm256&lt;/code&gt;, &lt;code&gt;Termius&lt;/code&gt;, &lt;code&gt;Koder&lt;/code&gt;等软件&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;公钥免密登录&#34;&gt;公钥免密登录&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;（401服务器&lt;code&gt;ssh&lt;/code&gt;密码方式登录已禁用，2023.3）&lt;/li&gt;
&lt;li&gt;看&lt;code&gt;cat ~/.ssh/id_rsa.pub&lt;/code&gt;(&lt;code&gt;type \path\to\windows-user\.ssh\id_rsa.pub&lt;/code&gt;)是否存在，没有使用&lt;code&gt;ssh-keygen&lt;/code&gt;命令生成公钥&lt;/li&gt;
&lt;li&gt;让管理员将&lt;code&gt;id_rsa.pub&lt;/code&gt;中内容追加到&lt;code&gt;gaia.buaadml.info:/home/myUserName/.ssh/authorized_keys&lt;/code&gt;中以免密登录&lt;/li&gt;
&lt;li&gt;修改用户密码:&lt;code&gt;ldap&lt;/code&gt;管理员后台&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;注意&lt;/strong&gt;，无法&lt;code&gt;ssh&lt;/code&gt;登录时，请在&lt;code&gt;ssh&lt;/code&gt;末尾追加&lt;code&gt;-v&lt;/code&gt;选项，将报错信息发送而给&lt;code&gt;admin&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;nfs&#34;&gt;NFS&lt;/h3&gt;
&lt;h4 id=&#34;网络文件系统&#34;&gt;网络文件系统&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;简单地说，&lt;code&gt;gaia&lt;/code&gt;上&lt;code&gt;/home&lt;/code&gt;目录挂载的是物理磁盘，计算节点上&lt;code&gt;/home&lt;/code&gt;目录是通过&lt;code&gt;NFS&lt;/code&gt;文件协议用&lt;code&gt;TCP&lt;/code&gt;同步共享&lt;code&gt;gaia.buaadml.info:/home&lt;/code&gt;的，因此高&lt;code&gt;I/O&lt;/code&gt;，低计算的任务，如下载，请尽量使用gaia机器&lt;/li&gt;
&lt;li&gt;&lt;code&gt;NFS&lt;/code&gt;没设&lt;code&gt;intr&lt;/code&gt;选项(2023.3)，所以理论上切换目录无限等待且不能&lt;code&gt;Ctrl^C&lt;/code&gt;中断(&lt;code&gt;SIGINT&lt;/code&gt;)可能是&lt;code&gt;NFS&lt;/code&gt;问题（我个人在别的服务器上见过这种情况）&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;(base) zhaozixuan at gaia in ~  
$ mount | grep &#39;/dev/sd&#39;
#/dev/sda2 on / type ext4 (rw,relatime,data=ordered)
#/dev/sda1 on /boot/efi type vfat (rw,relatime,fmask=0022,dmask=0022,codepage=437,iocharset=iso8859-1,shortname=mixed,errors=remount-ro)
#/dev/sdb on /home type ext4 (rw,relatime,stripe=64,data=ordered)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;(base) zhaozixuan at jack in ~    
$ mount | grep &#39;/home&#39;
#buaadml.info:/ on /home type nfs4 (rw,relatime,vers=4.0,rsize=8192,wsize=8192,namlen=255,hard,proto=tcp,port=2041,timeo=14,retrans=2,sec=sys,clientaddr=10.134.139.116,local_lock=none,addr=10.134.138.250,_netdev)
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;更多参考&#34;&gt;更多参考&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;http://cn.linux.vbird.org/linux_server/0330nfs_1.php&#34;&gt;鸟哥的 Linux 私房菜 -- NFS 服务器&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;file-transfer&#34;&gt;File Transfer&lt;/h3&gt;
&lt;h4 id=&#34;命令行&#34;&gt;命令行&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;wget&lt;/code&gt;:通过url下载文件&lt;/li&gt;
&lt;li&gt;&lt;code&gt;scp&lt;/code&gt;/&lt;code&gt;rsync&lt;/code&gt;:个人机器/实验室服务器互传文件目录&lt;/li&gt;
&lt;li&gt;&lt;code&gt;curl&lt;/code&gt;:http报文&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;sftp协议软件推荐&#34;&gt;sftp协议软件（推荐）&lt;/h4&gt;
&lt;p&gt;推荐根据自己的&lt;code&gt;IDE&lt;/code&gt;,如&lt;code&gt;VSCode&lt;/code&gt;,&lt;code&gt;JetBrains&lt;/code&gt;系（自带）,安装可视化&lt;code&gt;sftp&lt;/code&gt;插件管理服务器文件&lt;/p&gt;
&lt;h3 id=&#34;linux-command&#34;&gt;Linux Command&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;1. man COMMAND / COMMAND -h/ COMMAND --help
# 查看某一命令COMMAND之说明
2. Ctrl^C
# 向进程发送SIGINT
3. Ctrl^D
# 退出shell/退出su切换到的用户/断开ssh
4. Ctrl^Z
# 挂起命令进程，jobs查看挂起进程
5. cd -
# 返回上次访问目录
6. grep &amp;quot;mykeyword&amp;quot;
# 查找关键字 
7. history | tail -n 50
# 最后50条历史命令 
8. alias
#为命令起别名，如 
alias jack=&#39;ssh zhaozixuan@jack.buaadml.info&#39;
9. alias
# 覆写命令对应程序的绝对路径，如 
alias cmake=&#39;/path/to/my/own/cmake&#39;
#但不建议alias python=&#39;/usr/bin/python3&#39;，因为alias python可能会覆盖conda虚拟环境的python
10. chomd [-r]/ chown
# 更改文件（目录）权限（归属用户/用户组）
11. tail [-f] [-n &amp;lt;number&amp;gt;]
# 查看文件最后&amp;lt;number&amp;gt;行，-f为实时刷新，适合查看志记文件
12. which COMMAND
# 查看命令对应程序位置， 如which pip3, which python
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;文件权限与chmod&#34;&gt;文件权限与chmod&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://www.runoob.com/linux/linux-comm-chmod.html&#34;&gt;link&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&#34;更多参考-2&#34;&gt;更多参考&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://www.man7.org/linux/man-pages/&#34;&gt;man-page&lt;/a&gt;, &lt;a href=&#34;https://book.douban.com/subject/35933905/&#34;&gt;Linux命令行与shell脚本编程大全（第4版）&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;vim&#34;&gt;Vim&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;vim&lt;/code&gt;三模式：一般模式，命令行模式，编辑模式，使用&lt;code&gt;vi/vim&lt;/code&gt;进入文件时是一般模式&lt;/p&gt;
&lt;h4 id=&#34;编辑模式&#34;&gt;编辑模式&lt;/h4&gt;
&lt;p&gt;一般模式下，进入编辑模式&lt;/p&gt;
&lt;p&gt;&lt;code&gt;i&lt;/code&gt;   光标前插入&lt;/p&gt;
&lt;p&gt;&lt;code&gt;a&lt;/code&gt;    光标后插入&lt;/p&gt;
&lt;p&gt;&lt;code&gt;o&lt;/code&gt;    光标下一行插入&lt;/p&gt;
&lt;h4 id=&#34;命令行模式&#34;&gt;命令行模式&lt;/h4&gt;
&lt;p&gt;一般模式下，进入命令行模式：&lt;code&gt;:&lt;/code&gt;, &lt;code&gt;/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;:num&lt;/code&gt; 跳至第&lt;code&gt;num&lt;/code&gt;行，&lt;code&gt;num=&amp;quot;$&amp;quot;&lt;/code&gt;时跳至文件尾&lt;/p&gt;
&lt;p&gt;&lt;code&gt;:set filetype=c&lt;/code&gt; 代码文件后缀与语言不一致时显式指引&lt;code&gt;vim&lt;/code&gt;进行正确的语法高亮&lt;/p&gt;
&lt;p&gt;&lt;code&gt;:q&lt;/code&gt;  退出 &lt;code&gt;vi&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;:q!&lt;/code&gt;  强制退出，不保存文件&lt;/p&gt;
&lt;p&gt;&lt;code&gt;:wq&lt;/code&gt;  保存文件并退出&lt;/p&gt;
&lt;p&gt;&lt;code&gt;/str&lt;/code&gt;  从光标处向文件尾部搜索，查找 &lt;code&gt;&amp;quot;str&amp;quot;&lt;/code&gt; 字符串，&lt;code&gt;n&lt;/code&gt;/&lt;code&gt;N&lt;/code&gt; 查看下/上一个位置&lt;/p&gt;
&lt;p&gt;&lt;code&gt;?str&lt;/code&gt;  从光标处向文件首部搜索，查找 &lt;code&gt;&amp;quot;str&amp;quot;&lt;/code&gt; 字符串，&lt;code&gt;n&lt;/code&gt;/&lt;code&gt;N&lt;/code&gt;查看下/上一个位置&lt;/p&gt;
&lt;p&gt;&lt;code&gt;:s/str1/str2/g&lt;/code&gt;  将当前行中所有的 &lt;code&gt;&amp;quot;str1&amp;quot;&lt;/code&gt;，均用 &lt;code&gt;&amp;quot;str2&amp;quot;&lt;/code&gt; 替换&lt;/p&gt;
&lt;p&gt;&lt;code&gt;:s/str1/str2/gc&lt;/code&gt;  将当前行中所有的 &lt;code&gt;&amp;quot;str1&amp;quot;&lt;/code&gt;，均用 &lt;code&gt;&amp;quot;str2&amp;quot;&lt;/code&gt; 替换， 替换时需要确认&lt;/p&gt;
&lt;p&gt;&lt;code&gt;:%s/str1/str2/g&lt;/code&gt;  将文件中所有的  &lt;code&gt;&amp;quot;str1&amp;quot;&lt;/code&gt;，均用 &lt;code&gt;&amp;quot;str2&amp;quot;&lt;/code&gt; 替换&lt;/p&gt;
&lt;p&gt;&lt;code&gt;:%s/str1/str2/gc&lt;/code&gt;  将文件中所有的  &lt;code&gt;&amp;quot;str1&amp;quot;&lt;/code&gt;，均用 &lt;code&gt;&amp;quot;str2&amp;quot;&lt;/code&gt; 替换，替换时需要确认&lt;/p&gt;
&lt;h4 id=&#34;一般模式&#34;&gt;一般模式&lt;/h4&gt;
&lt;p&gt;其他模式下，进入命令行模式：&lt;code&gt;Esc&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;gg&lt;/code&gt;  光标移动到文档头部&lt;/p&gt;
&lt;p&gt;&lt;code&gt;G&lt;/code&gt;  光标移动到文档尾部&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ngg&lt;/code&gt;  光标移动到第 &lt;code&gt;n&lt;/code&gt; 行头部&lt;/p&gt;
&lt;p&gt;&lt;code&gt;n+&lt;/code&gt;  光标向下移动 &lt;code&gt;n&lt;/code&gt; 行&lt;/p&gt;
&lt;p&gt;&lt;code&gt;n-&lt;/code&gt;  光标向上移动 &lt;code&gt;n&lt;/code&gt; 行&lt;/p&gt;
&lt;p&gt;&lt;code&gt;0&lt;/code&gt;  光标移动到当前行行首&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$&lt;/code&gt;  光标移动到当前行行尾&lt;/p&gt;
&lt;p&gt;&lt;code&gt;w&lt;/code&gt;  光标移动到下一个字的开头&lt;/p&gt;
&lt;p&gt;&lt;code&gt;b&lt;/code&gt;  光标移动到上一个字的开头&lt;/p&gt;
&lt;p&gt;&lt;code&gt;fx&lt;/code&gt;  光标移动到 当前行下一个字母&lt;code&gt;x&lt;/code&gt;的位置&lt;/p&gt;
&lt;p&gt;&lt;code&gt;yy&lt;/code&gt;  复制当前行（&lt;code&gt;Vim&lt;/code&gt;内部剪贴板）&lt;/p&gt;
&lt;p&gt;&lt;code&gt;nyy&lt;/code&gt;  复制当前行及下面的 &lt;code&gt;n-1&lt;/code&gt; 行&lt;/p&gt;
&lt;p&gt;&lt;code&gt;p&lt;/code&gt;  粘贴（&lt;code&gt;Vim&lt;/code&gt;内部剪贴板）&lt;/p&gt;
&lt;p&gt;&lt;code&gt;x&lt;/code&gt;  删除光标后一个字符&lt;/p&gt;
&lt;p&gt;&lt;code&gt;X&lt;/code&gt;  删除光标前一个字符&lt;/p&gt;
&lt;p&gt;&lt;code&gt;nx&lt;/code&gt;  删除光标后 &lt;code&gt;n&lt;/code&gt; 个字符&lt;/p&gt;
&lt;p&gt;&lt;code&gt;nX&lt;/code&gt;  删除光标前 &lt;code&gt;n&lt;/code&gt; 个字符&lt;/p&gt;
&lt;p&gt;&lt;code&gt;d0&lt;/code&gt;  从光标处删到行首&lt;/p&gt;
&lt;p&gt;&lt;code&gt;d$&lt;/code&gt;  从光标处删到行尾&lt;/p&gt;
&lt;p&gt;&lt;code&gt;dd&lt;/code&gt;  删除光标所在行&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ndd&lt;/code&gt;  删除光标所在行及其后 &lt;code&gt;n-1&lt;/code&gt; 行&lt;/p&gt;
&lt;p&gt;&lt;code&gt;u&lt;/code&gt;  撤销一步操作&lt;/p&gt;
&lt;p&gt;&lt;code&gt;v&lt;/code&gt; &lt;code&gt;visual&lt;/code&gt;模式，相当于鼠标拖动选取之操作，选择完后&lt;code&gt;y&lt;/code&gt;复制,&lt;code&gt;x&lt;/code&gt;剪切&lt;/p&gt;
&lt;h4 id=&#34;vim-配置文件&#34;&gt;Vim 配置文件&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;bashvim ~/.vimrc&lt;/code&gt;&lt;br&gt;
追加：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;syntax enable #开启语法高亮
set nu #开启行号显示
#set compatible 平等对待Vi/Vim指令
# 或者
#set nocompatible 不与 Vi 兼容（采用 Vim 自己的操作命令）。
set showmode #显示当前模式
set showcmd #命令行模式下显示键入的命令
#set shiftwidth=4
#set softtabstop=4 缩进设置，自行了解
set cursorline #高亮显示当前行
set ruler #显示光标
set showmatch #左右匹配括号高亮
set incsearch #启用&#39;/&#39;命令行模式的增量搜索，也就是每键入一个字符都会重新搜索字符串，通常可以更快搜索到结果
set mouse=a #开启鼠标控制（滚轮与鼠标控制`visual`模式的选取）
#...e.t.c.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;刷新配置：重启&lt;code&gt;vim&lt;/code&gt;进程，或命令行模式下&lt;code&gt;:source ~/.vimrc&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;注意：以上每行配置都可在&lt;code&gt;:&lt;/code&gt;命令模式下对当前文件设置，设置仅对当前打开文件对应的&lt;code&gt;vim&lt;/code&gt;进程有效&lt;/p&gt;
&lt;h4 id=&#34;vim-in-ide&#34;&gt;Vim in IDE&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;JetBrains&lt;/code&gt;系&lt;code&gt;IDE&lt;/code&gt;的官方维护的&lt;code&gt;vim&lt;/code&gt;插件：&lt;a href=&#34;https://plugins.jetbrains.com/plugin/164-ideavim&#34;&gt;ideaVim&lt;/a&gt;，&lt;code&gt;keymap&lt;/code&gt;中设置&lt;code&gt;Pulgin -&amp;gt; IdeaVim -&amp;gt; Vim&lt;/code&gt;快捷键快速启用/关闭&lt;code&gt;vim&lt;/code&gt;，有效集合了&lt;code&gt;vim&lt;/code&gt;和&lt;code&gt;GUI&lt;/code&gt;的优点&lt;/p&gt;
&lt;h3 id=&#34;shell&#34;&gt;SHELL&lt;/h3&gt;
&lt;h4 id=&#34;bashzshfishetc&#34;&gt;bash/zsh/fish/etc...&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;shell&lt;/code&gt;就是&lt;code&gt;ssh&lt;/code&gt;登上去的黑框框，这个与我们交互的进程通常默认是&lt;code&gt;bash&lt;/code&gt;，&lt;code&gt;zsh&lt;/code&gt;是另一种交互式终端，但在使用上基本与&lt;code&gt;bash&lt;/code&gt;无区别，优点在于完善，高度可定制的插件机制，用来提高我们的效率。为了减少烦人的敲&lt;code&gt;shell&lt;/code&gt;命令的时间，一些插件如自动补全与高亮是必要的，但&lt;code&gt;shell&lt;/code&gt;的配置/插件修改比较麻烦，&lt;code&gt;zsh&lt;/code&gt;的&lt;code&gt;oh-my-zsh&lt;/code&gt;框架可以大大简化这个过程&lt;/p&gt;
&lt;h4 id=&#34;zsh-oh-my-zsh推荐&#34;&gt;zsh &amp;amp; oh-my-zsh（推荐）&lt;/h4&gt;
&lt;p&gt;以&lt;code&gt;oh-my-zsh&lt;/code&gt;添加自动补全与语法高亮这两个常用插件为例&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;#1.进入zsh 
zsh
#2.安装oh-my-zsh
git clone https://github.com/robbyrussell/oh-my-zsh.git ~/.oh-my-zsh
cp ~/.oh-my-zsh/templates/zshrc.zsh-template ~/.zshrc
vim ~/.zshrc, &amp;quot;ZSH_THEME=...&amp;quot; #这一行可以自己修改成好看点的主题
#3.插件安装
cd ~/.oh-my-zsh/custom/plugins
git clone https://github.com/zsh-users/zsh-autosuggestions.git
git clone https://github.com/zsh-users/zsh-syntax-highlighting.git
vim ~/.zshrc #修改插件列表，plugins变量：plugins=(git zsh-autosuggestions zsh-syntax-highlighting)
source ~/.zshr #刷新配置
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;应该有补全效果了(按右箭头补全)&lt;/p&gt;
&lt;h4 id=&#34;prompt修改&#34;&gt;PROMPT修改&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;PROMPT&lt;/code&gt;指的是每次&lt;code&gt;shell&lt;/code&gt;等待输入时打印的信息，&lt;code&gt;oh-my-zsh&lt;/code&gt;是高度定制的，以最简单的&lt;code&gt;PROMPT&lt;/code&gt;修改为例&lt;/p&gt;
&lt;p&gt;1.显示&lt;code&gt;conda&lt;/code&gt;环境名，直接使用&lt;code&gt;conda&lt;/code&gt;之命令行&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;conda init zsh
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;2.以&lt;code&gt;steeef&lt;/code&gt;主题为例添加一个实时时间显示为例&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;vim ~/.zshrc
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;修改zsh_themesteeef&#34;&gt;修改ZSH_THEME=&amp;quot;steeef&amp;quot;&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;bashvim ~/.oh-my-zsh/themes/steeef.zsh-theme&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;#追加
if [[ $terminfo[colors] -ge 256 ]]; then
    turquoise=&amp;quot;%F{81}&amp;quot;
    orange=&amp;quot;%F{166}&amp;quot;
    purple=&amp;quot;%F{135}&amp;quot;
    hotpink=&amp;quot;%F{161}&amp;quot;
    limegreen=&amp;quot;%F{118}&amp;quot;
    violet=&amp;quot;%F{205}&amp;quot;
    darkorange=&amp;quot;%F{208}&amp;quot;
    cyan=&amp;quot;%F{51}&amp;quot;
else
    turquoise=&amp;quot;%F{cyan}&amp;quot;
    orange=&amp;quot;%F{yellow}&amp;quot;
    purple=&amp;quot;%F{magenta}&amp;quot;
    hotpink=&amp;quot;%F{red}&amp;quot;
    limegreen=&amp;quot;%F{green}&amp;quot;
    violet=&amp;quot;%F{violet}&amp;quot;
    darkorange=&amp;quot;%F{darkorange}&amp;quot;
    cyan=&amp;quot;%F{cyan}&amp;quot;
fi
#修改PROMPT
PROMPT=$&#39;%{$darkorange%}%n${PR_RST} at %{$violet%}%m${PR_RST} in %{$cyan%}%~${PR_RST} $vcs_info_msg_0_$(virtualenv_info)    %{$FG[040]%}%D{%Y/%m/%d} - %*%{$reset_color%}
$ &#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;以上操作修改了&lt;code&gt;PROMPT&lt;/code&gt;的颜色，添加了当前时间&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;vim ~/.zshrc
#追加
TMOUT=1
TRAPALRM () 
{ zle reset-prompt }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;以上操作使得&lt;code&gt;PROMPT&lt;/code&gt;每秒刷新一次，以显示实时时间&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;source ~/.zshrc
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;刷新配置后生效&lt;/p&gt;
&lt;p&gt;当然也有其他很多主题，如&lt;code&gt;powerline10k&lt;/code&gt;， &lt;code&gt;random&lt;/code&gt;，注意，你的终端需要支持主题相关的&lt;strong&gt;字体与彩显&lt;/strong&gt;，否则会有显示上的错误&lt;/p&gt;
&lt;h4 id=&#34;修改默认shell&#34;&gt;修改默认SHELL&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;现有账户默认&lt;code&gt;shell&lt;/code&gt;均为&lt;code&gt;bash&lt;/code&gt;（2023.3）&lt;/li&gt;
&lt;li&gt;在&lt;code&gt;~/.profile&lt;/code&gt;追加启动指定&lt;code&gt;shell&lt;/code&gt;的命令并没有真正改变默认&lt;code&gt;shell&lt;/code&gt;，而是在启动&lt;code&gt;bash&lt;/code&gt;时自动执行一条进入指定&lt;code&gt;shell&lt;/code&gt;的命令，例如此时&lt;code&gt;exit&lt;/code&gt;将回到&lt;code&gt;bash&lt;/code&gt;，而不是关闭&lt;code&gt;shell&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;chsh&lt;/code&gt;/&lt;code&gt;usermode&lt;/code&gt;指令并不能修改默认&lt;code&gt;shell&lt;/code&gt;，因为大家的&lt;code&gt;linux&lt;/code&gt;系统账户不是在节点机器本地管理，而是通过&lt;code&gt;VM chaos&lt;/code&gt;提供的&lt;code&gt;ldap&lt;/code&gt;协议服务管理，因此需要联系管理员在&lt;code&gt;chaos&lt;/code&gt;之&lt;code&gt;phpLDAPadmin&lt;/code&gt;上修改默认&lt;code&gt;shell&lt;/code&gt;启动路径&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;windows-subsystem-for-linux&#34;&gt;Windows Subsystem for Linux&lt;/h3&gt;
&lt;p&gt;不喜欢Win的&lt;code&gt;cmd&lt;/code&gt;就装个&lt;code&gt;wsl&lt;/code&gt;吧，比虚拟机软件更轻量，且自然地共存，可无缝切换的双系统方案&lt;/p&gt;
&lt;h4 id=&#34;wsl10&#34;&gt;WSL1.0&lt;/h4&gt;
&lt;p&gt;没有使用真正的&lt;code&gt;Linux&lt;/code&gt;内核，实际是把&lt;code&gt;Linux&lt;/code&gt;内核的系统调用转换成&lt;code&gt;Win&lt;/code&gt;的系统调用&lt;/p&gt;
&lt;p&gt;（所以慎重选择&lt;code&gt;WSL1.0&lt;/code&gt;作为开发用环境）&lt;/p&gt;
&lt;h4 id=&#34;wsl20&#34;&gt;WSL2.0&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;Hyper-V&lt;/code&gt;硬件虚拟化实现&lt;code&gt;Linux&lt;/code&gt;内核，可以简单理解为虚拟机&lt;/p&gt;
&lt;h4 id=&#34;wsl网络&#34;&gt;WSL网络&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://learn.microsoft.com/zh-cn/windows/wsl/networking&#34;&gt;link&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&#34;wsl桌面&#34;&gt;WSL桌面&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;Note: this section is a copy of &lt;a href=&#34;https://liyirui-git.github.io/tech/%E6%8A%98%E8%85%BE/WSL+Linux%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2.html&#34;&gt;https://liyirui-git.github.io/&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;准备工作&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;我使用的是&lt;code&gt;Windows&lt;/code&gt;应用商店中的&lt;code&gt;Ubuntu 18.04 LTS&lt;/code&gt;，安装完成以后，为了提高软件包下载速度，一般是要把软件库更换成清华开源镜像：&lt;code&gt;Ubuntu&lt;/code&gt;清华开源镜像。&lt;/p&gt;
&lt;p&gt;更换好以后，先执行下面的命令，更新&lt;code&gt;apt&lt;/code&gt;：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ sudo apt update
$ sudo apt upgrade
&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;
&lt;li&gt;安装图形化界面&lt;br&gt;
这里使用的是&lt;code&gt;xfce4&lt;/code&gt;，安装命令为：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ sudo apt install xfce4
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;它的优点主要是占用空间小，此外该界面主要是有一个图形界面可以使用&lt;code&gt;spacemacs&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;然后安装&lt;code&gt;xrdp&lt;/code&gt;：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ sudo apt install xrdp
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;软件配置&lt;br&gt;
配置&lt;code&gt;xrdp&lt;/code&gt;端口&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ sudo sed -i &#39;s/port=3389/port=3390/g&#39; /etc/xrdp/xrdp.ini
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;端口号要记住，后面从&lt;code&gt;windows&lt;/code&gt;进行连接的时候要用到。这里面 &lt;code&gt;3389&lt;/code&gt; 是默认配置，这里将其改为 &lt;code&gt;3390&lt;/code&gt; 是避免和 &lt;code&gt;windows&lt;/code&gt; 的端口冲突。因为两边的端口号是通的，在 &lt;code&gt;wsl&lt;/code&gt; 中开一个 &lt;code&gt;8080&lt;/code&gt; 端口的 &lt;code&gt;WebServer&lt;/code&gt;，在 &lt;code&gt;windows&lt;/code&gt; 可以直接访问。&lt;/p&gt;
&lt;p&gt;配置&lt;code&gt;xsession&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ sudo echo xfce4-session &amp;gt;~/.xsession
#这一步其实是在告诉系统，开启桌面环境的时候开启什么桌面环境。
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;启动 &lt;code&gt;xrdp&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ sudo service xrdp restart
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;&lt;code&gt;Windows&lt;/code&gt;远程连接&lt;br&gt;
打开&lt;code&gt;Windows&lt;/code&gt;中的“远程桌面连接” （快捷方式是 &lt;code&gt;win+r&lt;/code&gt; 输入&lt;code&gt;“mstsc”&lt;/code&gt;）&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;在计算机名的地方输入本地的&lt;code&gt;3390&lt;/code&gt;端口，用户名输入&lt;code&gt;root&lt;/code&gt;，如下图：&lt;/p&gt;
 &lt;img src=&#34;https://liyirui-git.github.io/tech/%E6%8A%98%E8%85%BE/WSL+Linux%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2.assets/image-20200809160433004.png&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;进入以后会显示一个小的对话框：&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://liyirui-git.github.io/tech/%E6%8A%98%E8%85%BE/WSL+Linux%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2.assets/image-20200809161018388.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;这个时候点击“ok”，会弹出填写用户名和密码的对话框，填写对应的用户名和密码：&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://liyirui-git.github.io/tech/%E6%8A%98%E8%85%BE/WSL+Linux%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2.assets/image-20200809161159946.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;点击OK即可登录到可视化界面：&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://liyirui-git.github.io/tech/%E6%8A%98%E8%85%BE/WSL+Linux%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2.assets/20190621201436773.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;如果WSL的Ubuntu系统关闭，如关机重启，会导致远程连接不上，此时需要先在Win10中打开Ubuntu的命令行界面，输入：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ sudo service xrdp restart
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;此时再远程连接，即可连接上。&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;4&#34;&gt;&lt;img src=&#34;https://liyirui-git.github.io/tech/%E6%8A%98%E8%85%BE/WSL+Linux%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2.assets/762700-20171116183439656-1751821230.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;尾声&lt;br&gt;
后续还看到一个特别牛批的大神做的：&lt;code&gt;WSL&lt;/code&gt;使用小结：&lt;a href=&#34;https://www.cnblogs.com/wurui1994/p/7839777.html&#34;&gt;从ArchLinux到Manjaro&lt;/a&gt;，以及知乎的问题：&lt;a href=&#34;https://www.zhihu.com/question/355179099&#34;&gt;Deepin Linux上架WSL要多久?&lt;/a&gt;，&lt;a href=&#34;https://zhuanlan.zhihu.com/p/51270874&#34;&gt;知乎文章：利用WSL打造Arch开发环境&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;后续可以继续折腾。&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note: End of the copy&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&#34;windows-terminal&#34;&gt;Windows Terminal&lt;/h3&gt;
&lt;p&gt;微软官方的终端软件：&lt;a href=&#34;https://learn.microsoft.com/zh-cn/windows/terminal/install&#34;&gt;link&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Windows Terminal&lt;/code&gt;相比于&lt;code&gt;cmd&lt;/code&gt;:1.好看 2.整合&lt;code&gt;cmd&lt;/code&gt;/&lt;code&gt;powerShell&lt;/code&gt;/&lt;code&gt;WSL&lt;/code&gt;/&lt;code&gt;git bash&lt;/code&gt;等需要终端显示的场景，集中终端配置&lt;/p&gt;
&lt;h4 id=&#34;以windows-terminal配置sshwsl发起为例&#34;&gt;以Windows Terminal配置ssh（WSL发起）为例&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;安装&lt;code&gt;wsl&lt;/code&gt;与&lt;code&gt;Windows Terminal&lt;/code&gt;，记不太清了，但好像&lt;code&gt;Windows Terminal&lt;/code&gt;会自动检测&lt;code&gt;WSL&lt;/code&gt;并为其生成默认配置文件&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Windows Terminal -&amp;gt; Settings&lt;/code&gt;，从&lt;code&gt;WSL&lt;/code&gt;的配置文件复制一份配置文件，修改&lt;code&gt;Command line&lt;/code&gt;，追加进行&lt;code&gt;ssh&lt;/code&gt;连接的命令（注意，这里的命令大概是在&lt;code&gt;shell&lt;/code&gt;配置文件之前执行的，因此不要依赖&lt;code&gt;~/.bashrc&lt;/code&gt;或&lt;code&gt;~/.zshrc&lt;/code&gt;创建的环境变量）&lt;/li&gt;
&lt;/ul&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;5&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230610222226.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;tmux推荐&#34;&gt;Tmux（推荐）&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;ssh&lt;/code&gt;默认长时间不操作会断开，为了防止耗时操作中&lt;code&gt;ssh&lt;/code&gt;终端断开，可以修改&lt;code&gt;/etc/ssh/ssh_config&lt;/code&gt;定时向服务器发报文保活，或者使用&lt;code&gt;autossh&lt;/code&gt;等软件&lt;/p&gt;
&lt;p&gt;不过更推荐&lt;code&gt;Tmux&lt;/code&gt;，&lt;code&gt;Tmux&lt;/code&gt;是在服务器本地创建多个&lt;code&gt;shell&lt;/code&gt;交互界面，所以不受&lt;code&gt;ssh&lt;/code&gt;连接生命期之影响，可以挂在后台，不用担心&lt;code&gt;ssh&lt;/code&gt;断了或者卡死&lt;code&gt;shell&lt;/code&gt;就中断了导致前台进程挂掉，而且可以灵活切换多个&lt;code&gt;SHELL&lt;/code&gt;界面&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Tmux&lt;/code&gt;中两个主要概念是&lt;code&gt;sessions&lt;/code&gt;与&lt;code&gt;windows&lt;/code&gt;，简单地说，可以对应于&lt;strong&gt;带图形用户界面的操作系统&lt;/strong&gt;中的&lt;strong&gt;桌面&lt;/strong&gt;与&lt;strong&gt;应用窗口&lt;/strong&gt;，一个&lt;code&gt;windows&lt;/code&gt;对应一个&lt;code&gt;shell&lt;/code&gt;进程，一个&lt;code&gt;sessions&lt;/code&gt;持有一个或多个&lt;code&gt;windows&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;使用&lt;code&gt;tmux&lt;/code&gt;指令将新建一个&lt;code&gt;session&lt;/code&gt;，&lt;code&gt;tmux rename mySessionName&lt;/code&gt;（在当前&lt;code&gt;session&lt;/code&gt;下）将为&lt;code&gt;session&lt;/code&gt;命名，不然默认就是数字序号。进入&lt;code&gt;tmux&lt;/code&gt;后按一次&lt;code&gt;Ctrl^B&lt;/code&gt;进入命令模式，&lt;code&gt;Ctrl^B&lt;/code&gt;后按&lt;code&gt;D&lt;/code&gt;键将当前&lt;code&gt;session&lt;/code&gt; &lt;code&gt;detach&lt;/code&gt;掉，也就是挂在后台，这将退回到原来的&lt;code&gt;shell&lt;/code&gt;（&lt;strong&gt;注意&lt;/strong&gt;，&lt;code&gt;tmux&lt;/code&gt;创建的&lt;code&gt;shell&lt;/code&gt;中使用&lt;code&gt;exit&lt;/code&gt;或&lt;code&gt;Ctrl^D&lt;/code&gt;仍然将杀死&lt;code&gt;shell&lt;/code&gt;，而不是把他挂在后台运行）。使用&lt;code&gt;tmux ls&lt;/code&gt;看当前所有&lt;code&gt;session&lt;/code&gt;，使用&lt;code&gt;tmux a -t mySessionName&lt;/code&gt;回到&lt;code&gt;session&lt;/code&gt;，使用&lt;code&gt;tmux kill-session -t mySessionName&lt;/code&gt;关闭后台&lt;code&gt;session&lt;/code&gt;，也可以进入&lt;code&gt;tmux session&lt;/code&gt;后 &lt;code&gt;Ctrl^B&lt;/code&gt;后按&lt;code&gt;S&lt;/code&gt;查看所有&lt;code&gt;session&lt;/code&gt;，并可以选择切换&lt;/p&gt;
&lt;p&gt;&lt;code&gt;tmux session&lt;/code&gt;中，默认只有一个全屏的&lt;code&gt;window&lt;/code&gt;，&lt;code&gt;Ctrl^B&lt;/code&gt;接&lt;code&gt;%&lt;/code&gt;把当前&lt;code&gt;window&lt;/code&gt;左右分割成两个&lt;code&gt;window&lt;/code&gt;，&lt;code&gt;Ctrl^B&lt;/code&gt;接&amp;quot;把当前&lt;code&gt;window&lt;/code&gt;上下分割，&lt;code&gt;Ctrl^B&lt;/code&gt;接方向键切换聚焦的&lt;code&gt;window&lt;/code&gt;，&lt;code&gt;Ctrl^B&lt;/code&gt;接&lt;code&gt;Ctrl^方向键&lt;/code&gt;调整&lt;code&gt;window&lt;/code&gt;尺寸&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Ctrl^B&lt;/code&gt;接&lt;code&gt;[&lt;/code&gt;可以上下滚动&lt;code&gt;shell&lt;/code&gt;输出&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;6&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230610222244.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;对tmux进行设置&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;生成配置文件 &lt;code&gt;vim ~/.tmux.conf&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;写入内容&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;set -g default-terminal &amp;quot;screen-256color&amp;quot;
# 开启xTerm256彩色显示
set -g default-shell /bin/zsh
# 设置默认SHELL
set-option -g mouse on
# 开启鼠标控制
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;注意：鼠标控制的&lt;code&gt;tmux&lt;/code&gt;下，按住&lt;code&gt;shift&lt;/code&gt;以鼠标框选，&lt;code&gt;Ctrl^shift^c/v&lt;/code&gt;以复制粘贴&lt;/li&gt;
&lt;li&gt;配置可热修改，使用&lt;code&gt;tmux source-file ~/.tmux.conf&lt;/code&gt;生效配置&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;更多参考-3&#34;&gt;更多参考&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;man tmux&lt;/code&gt; or &lt;a href=&#34;https://www.man7.org/linux/man-pages/man1/tmux.1.html&#34;&gt;link&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;screen&#34;&gt;Screen&lt;/h3&gt;
&lt;p&gt;类似的终端复用器还有 &lt;code&gt;GNU Screen&lt;/code&gt;。&lt;code&gt;Tmux&lt;/code&gt; 与它功能相似，但是通常来说&lt;code&gt;Tmux&lt;/code&gt;更易用，也更强大。&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note: This section is a copy of &lt;a href=&#34;https://liyirui-git.github.io/tech/%E6%8A%98%E8%85%BE/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html&#34;&gt; yirui的实验室服务器使用指南&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;h4 id=&#34;screen基础&#34;&gt;Screen基础&lt;/h4&gt;
&lt;p&gt;可以通过创建一个屏幕来实现后台运行，新建一个屏幕的命令是：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ screen -S [screen-name]  
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;查看当前所有屏幕的列表的命令是：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ screen -ls
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;进入某一个屏幕的命令是：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;bash$ screen -r [screen-name]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;kill一个屏幕的命令是在该屏幕中输入：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ exit
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Screen退出当前窗口但不杀死&lt;br&gt;
&lt;code&gt;ctrl + a + d&lt;/code&gt; 这一操作也叫&lt;code&gt;detached&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Screen&lt;/code&gt;杀死会话窗口&lt;br&gt;
如果想关掉一个多余的窗口，有3种方法：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;kill -9 threadnum &lt;/code&gt;例如在上面的2637，&lt;code&gt;kill -9 2637&lt;/code&gt; 即可杀死线程，当然就杀死了窗口&lt;/p&gt;
&lt;p&gt;使用&lt;code&gt;Ctrl a +k&lt;/code&gt; 杀死当前窗口和窗口中运行的程序&lt;/p&gt;
&lt;p&gt;使用&lt;code&gt;Ctrl a&lt;/code&gt; 然后输入&lt;code&gt;quit&lt;/code&gt;命令退出&lt;code&gt;Screen&lt;/code&gt;会话。需要注意的是，这样退出会杀死所有窗口并退出其中运行的所有程序&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Screen&lt;/code&gt;清除死去的窗口&lt;br&gt;
当窗口被杀死后，再用&lt;code&gt;screen -ls&lt;/code&gt; 可以看到该窗口后面的(???dead)字样，说明窗口死了，但是仍在占用空间。这时需要清除窗口&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ screen -wipe #自动清除死去的窗口
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这样的窗明几净了~&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Screen&lt;/code&gt;意外掉线重连&lt;br&gt;
有的时候，意外断开连接，再次进入某个screen会出现以下报错：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;(base) xxxx@i:~$ screen -r fastreid
There is a screen on:
        3157.fastreid   (2021年02月19日 15时19分14秒)   (Attached)
There is no screen to be resumed matching fastreid.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这个时候是因为它认为还有人在与screen连接，所以连接不上，这个时候，可以通过下面的命令，让screen与之前的连接断开，然后我们再连进去&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ screen -D -r fastreid
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;如何记录&lt;code&gt;screen&lt;/code&gt;屏幕日志&lt;/p&gt;
&lt;p&gt;第一种方法&lt;/p&gt;
&lt;p&gt;启动时添加选项&lt;code&gt;-L&lt;/code&gt;（Turn on output logging.）会在当前目录下生成&lt;code&gt;screenlog.0&lt;/code&gt;文件。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;screen -L -dmS test
1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;screen -L -dmS test&lt;/code&gt;的意思是启动一个开始就处于断开模式的会话，会话的名称是&lt;code&gt;test&lt;/code&gt;。&lt;br&gt;
&lt;code&gt;screen -r test&lt;/code&gt;连接该会话，在会话中的所有屏幕输出都会记录到&lt;code&gt;screenlog.0&lt;/code&gt;文件。&lt;/p&gt;
&lt;p&gt;第二种方法&lt;/p&gt;
&lt;p&gt;不加选项&lt;code&gt;-L&lt;/code&gt;，启动后，在&lt;code&gt;screen session&lt;/code&gt;下按&lt;code&gt;ctrl+a H&lt;/code&gt;，同样会在当前目录下生成&lt;code&gt;screenlog.0&lt;/code&gt;文件。&lt;/p&gt;
&lt;p&gt;第一次按下&lt;code&gt;ctrl+a H&lt;/code&gt;，屏幕左下角会提示&lt;code&gt;Creating logfile &amp;quot;screenlog.0&amp;quot;.&lt;/code&gt;，开始记录日志。&lt;br&gt;
再次按下&lt;code&gt;ctrl+a H&lt;/code&gt;，屏幕左下角会提示&lt;code&gt;Logfile &amp;quot;screenlog.0&amp;quot; closed.&lt;/code&gt;，停止记录日志。&lt;br&gt;
补充&lt;br&gt;
上面两个方法有个缺点：当创建多个&lt;code&gt;screen&lt;/code&gt;会话的时候，每个会话都会记录日志到&lt;code&gt;screenlog.0&lt;/code&gt;文件。&lt;code&gt;screenlog.0&lt;/code&gt;中的内容就比较混乱了。&lt;/p&gt;
&lt;p&gt;解决方法如下，让每个&lt;code&gt;screen&lt;/code&gt;会话窗口有单独的日志文件。&lt;/p&gt;
&lt;p&gt;在&lt;code&gt;screen&lt;/code&gt;配置文件&lt;code&gt;/etc/screenrc&lt;/code&gt;最后添加下面一行：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;logfile /tmp/screenlog_%t.log
1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;%t&lt;/code&gt;是指&lt;code&gt;window&lt;/code&gt;窗口的名称，对应&lt;code&gt;screen&lt;/code&gt;的&lt;code&gt;-t&lt;/code&gt;参数。所以我们启动screen的时候要指定窗口的名称，例如：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;screen -L -t window1 -dmS test
1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;screen -L -t window1 -dmS test&lt;/code&gt;的意思是启动test会话，test会话的窗口名称为window1。屏幕日志记录在&lt;code&gt;/tmp/screenlog_window1.log&lt;/code&gt;。如果启动的时候不加-L参数，在screen session下按&lt;code&gt;ctrl+a H&lt;/code&gt;，日志也会记录在&lt;code&gt;/tmp/screenlog_window1.log&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;注意&lt;/strong&gt;，如果写成：&lt;code&gt;logfile ./screenlog_%t.log&lt;/code&gt; 则是把日志文件记录到当前目录下。&lt;/p&gt;
&lt;p&gt;一个例子&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;screen -L -t name -S name ./name
1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;第一个name是记录日志的名字&lt;br&gt;
第二个name是&lt;code&gt;screen -ls&lt;/code&gt; 列表展示出来的名字&lt;br&gt;
第三个name是需要运行的程序&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note: End of the copy&lt;/em&gt;&lt;/p&gt;
&lt;h4 id=&#34;更多参考-4&#34;&gt;更多参考&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;man screen&lt;/code&gt; or &lt;a href=&#34;https://man7.org/linux/man-pages/man1/screen.1.html&#34;&gt;link&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;linux-daemon&#34;&gt;Linux Daemon&lt;/h3&gt;
&lt;ul class=&#34;contains-task-list&#34;&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-4777061&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-4777061&#34;&gt; #TODO&lt;/label&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;crontab&#34;&gt;crontab&lt;/h3&gt;
&lt;ul class=&#34;contains-task-list&#34;&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-2216655&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-2216655&#34;&gt; #TODO&lt;/label&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;gpu&#34;&gt;GPU&lt;/h3&gt;
&lt;h4 id=&#34;nvidia显卡信息查看&#34;&gt;Nvidia显卡信息查看&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;watch -n 5 &#39;nvidia-smi&#39;
# or
nvidia-smi
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;or&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;watch -n 5 &#39;curl gpu.buaadml.info&#39; 
# or
curl gpu.buaadml.info
# 输出格式参考python第三方库gpustat
# or visit http://gpu.buaadml.info
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;显驱与cuda安装卸载&#34;&gt;显驱与CUDA安装/卸载&lt;/h4&gt;
&lt;p&gt;英伟达显卡驱动 ：告诉计算机识别显卡硬件，调用其计算资源&lt;/p&gt;
&lt;p&gt;&lt;code&gt;CUDA&lt;/code&gt; ：是&lt;code&gt;NVIDIA&lt;/code&gt;推出的只能用于&lt;code&gt;Nvidia GPU&lt;/code&gt;的并行计算框架, 只有安装这个框架才能够进行复杂的并行计算， 主流的深度学习框架也都是基于&lt;code&gt;CUDA&lt;/code&gt;进行&lt;code&gt;GPU&lt;/code&gt;并行加速的&lt;/p&gt;
&lt;p&gt;&lt;code&gt;nvidia-smi&lt;/code&gt;查看驱动/&lt;code&gt;CUDA&lt;/code&gt;版本：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;+-----------------------------------------------------------------------------+
| NVIDIA-SMI 470.42.01    Driver Version: 470.42.01    CUDA Version: 11.4     |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|                               |                      |               MIG M. |
|#########################+###############==+###############==|
|   0  NVIDIA GeForce ...  Off  | 00000000:17:00.0 Off |                  N/A |
| 27%   45C    P0    59W / 250W |      0MiB / 11019MiB |      1%      Default |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+
|   1  NVIDIA GeForce ...  Off  | 00000000:18:00.0 Off |                  N/A |
| 42%   59C    P0    74W / 250W |      0MiB / 11019MiB |      0%      Default |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+
|   2  NVIDIA GeForce ...  Off  | 00000000:65:00.0 Off |                  N/A |
| 41%   58C    P0    63W / 250W |      0MiB / 11016MiB |      0%      Default |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;或&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;(base) zhaozixuan at jack in ~     2023/06/09 - 23:47:11
$ ll /usr/local/cuda* -d
lrwxrwxrwx  1 root root   21 Apr 28 14:56 /usr/local/cuda -&amp;gt; /usr/local/cuda-11.4/
drwxr-xr-x 18 root root 4.0K May  8  2022 /usr/local/cuda-10.1
drwxr-xr-x 18 root root 4.0K Feb 18 13:42 /usr/local/cuda-10.2
drwxr-xr-x 17 root root 4.0K Apr 28 14:59 /usr/local/cuda-11.4 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;一般来说，更新的显卡适配版本更高的&lt;code&gt;CUDA&lt;/code&gt;，而&lt;code&gt;CUDA&lt;/code&gt;并不能向下兼容所有显驱&lt;/p&gt;
&lt;p&gt;因此，在升级&lt;code&gt;CUDA&lt;/code&gt;时，如果&lt;code&gt;CUDA&lt;/code&gt;版本不能兼容老显驱，则首先卸载驱动&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;sudo nvidia-uninstall
sudo reboot
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;下载&lt;code&gt;Nvidia&lt;/code&gt;官方相应&lt;code&gt;CUDA&lt;/code&gt;的&lt;code&gt;runfile&lt;/code&gt;后&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;sudo sh /path/to/cuda_&amp;lt;cuda_version&amp;gt;_linux.run
&lt;/code&gt;&lt;/pre&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;7&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230610222326.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;若卸载了老驱动，则勾选安装驱动，其他不需要配置，傻瓜式安装&lt;/p&gt;
&lt;h4 id=&#34;比特大陆算丰显卡tpu&#34;&gt;比特大陆算丰显卡（TPU）&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;Note: This section is deprecated&lt;/em&gt;&lt;/p&gt;
&lt;h4 id=&#34;华为昇腾显卡npu&#34;&gt;华为昇腾显卡（NPU）&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;python&lt;/code&gt;运行时库:&lt;code&gt;pyACL&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/zixfy/pyACL-inference&#34;&gt;一个推理接口封装&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;conda&#34;&gt;CONDA&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;conda&lt;/code&gt;（&lt;code&gt;Anaconda&lt;/code&gt;/&lt;code&gt;miniconda&lt;/code&gt;）是用于管理虚拟&lt;code&gt;Python&lt;/code&gt;环境，以隔离多种&lt;code&gt;Python&lt;/code&gt;环境的软件，也是指定虚拟&lt;code&gt;Python&lt;/code&gt;环境下包版本管理的软件。&lt;code&gt;Anaconda&lt;/code&gt;通过下载运行相应的&lt;code&gt;runfile&lt;/code&gt;傻瓜式安装&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note: The following is a copy of &lt;a href=&#34;https://liyirui-git.github.io/tech/%E6%8A%98%E8%85%BE/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.html&#34;&gt;yirui的实验室服务器使用指南&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;h4 id=&#34;下载anaconda以及环境的搭建&#34;&gt;下载Anaconda以及环境的搭建&lt;/h4&gt;
&lt;p&gt;主要是要注意怎么把&lt;code&gt;conda&lt;/code&gt;命令加入到&lt;code&gt;Ubuntu&lt;/code&gt;系统变量中&lt;/p&gt;
&lt;p&gt;&lt;em&gt;注：&lt;code&gt;conda init &amp;lt;shell_name&amp;gt;&lt;/code&gt;, 如&lt;code&gt;conda init zsh&lt;/code&gt;&lt;/em&gt;&lt;/p&gt;
&lt;h4 id=&#34;anaconda国内镜像配置&#34;&gt;Anaconda国内镜像配置&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/
$ conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/
$ conda config --set show_channel_urls yes
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;创建虚拟环境&#34;&gt;创建虚拟环境&lt;/h4&gt;
&lt;p&gt;假设当前需要创建一个 &lt;code&gt;tensorflow-gpu 1.0&lt;/code&gt; 的环境，可以按照如下的步骤操作：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ conda create -n tf1-gpu python=3.6
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;注意&lt;/strong&gt;: &lt;code&gt;tensorflow 1.x&lt;/code&gt;版本仅支持到&lt;code&gt;python3.6&lt;/code&gt; 输入这一条命令以后，&lt;code&gt;anaconda&lt;/code&gt;就会自动的配置一个&lt;code&gt;python3.6&lt;/code&gt;版本的基础环境。之后需要进入到&lt;code&gt;tf1-gpu&lt;/code&gt;中，去配置相应的其他环境：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ conda activate tf1-gpu 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;然后就在新的环境下，配置tensorflow的环境依赖。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ conda install tensorflow-gpu=1.0
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;至此一个虚拟环境就创建出来了，后面就可以在这个新的环境中愉快地玩耍了。&lt;/p&gt;
&lt;p&gt;不过除此之外，还有一些其他常用的指令&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;conda remove -n [env-name] --all  #删除某一个环境
conda env list  #查看所创建的环境列表 
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;导出环境配置导入环境配置&#34;&gt;导出环境配置/导入环境配置&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;conda env export &amp;gt; environment.yaml #环境配置导出
conda env create -f environment.yaml #环境配置导入
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;em&gt;Note: End of the copy&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;清除&lt;code&gt;conda&lt;/code&gt;缓存: &lt;code&gt;conda clean --all &lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;mamba&lt;/code&gt;：为了不被单线程的&lt;code&gt;conda install&lt;/code&gt;指令慢的气死，可以考虑安装&lt;code&gt;mamba&lt;/code&gt;，多线程版&lt;code&gt;conda&lt;/code&gt;包（&lt;code&gt;conda install mamba -n base -c conda-forge&lt;/code&gt;），之后将管理指令中的&lt;code&gt;conda&lt;/code&gt;替换为&lt;code&gt;mamba&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;pytorch&#34;&gt;PyTorch&lt;/h3&gt;
&lt;h4 id=&#34;install&#34;&gt;Install&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://pytorch.org/get-started/previous-versions/&#34;&gt;https://pytorch.org/get-started/previous-versions/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;注意&lt;code&gt;pip&lt;/code&gt;安装的&lt;code&gt;.whl&lt;/code&gt;对应的&lt;code&gt;cu&lt;/code&gt;（&lt;code&gt;cuda&lt;/code&gt;）版本或&lt;code&gt;conda&lt;/code&gt;安装的&lt;code&gt;cudatoolkit&lt;/code&gt;版本，一般来说，不保证&lt;code&gt;pytorch&lt;/code&gt;库能兼容比其要求低的&lt;code&gt;cuda&lt;/code&gt;版本的环境&lt;/p&gt;
&lt;h4 id=&#34;cuda-device-dataparallel&#34;&gt;cuda device &amp;amp; DataParallel&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;print(&amp;quot;torch.__version__: &amp;quot;, torch.__version__)
print(&amp;quot;torch.cuda.is_available(): &amp;quot;, torch.cuda.is_available())
print(&amp;quot;torch.version.cuda: &amp;quot;, torch.version.cuda)
print(&amp;quot;cuda devices: &amp;quot;, [torch.cuda.get_device_properties(i) for i in range(torch.cuda.device_count())])
# 检查运行时cuda版本，cuda是否可用，GPU信息
########### 
# jupyter notebook @ jack
# torch.__version__:  1.12.1
# torch.cuda.is_available():  True
# torch.version.cuda:  10.2
# cuda devices:  [_CudaDeviceProperties(name=&#39;GeForce GTX 1080 Ti&#39;, major=6, minor=1, total_memory=11178MB, multi_processor_count=28), _CudaDeviceProperties(name=&#39;GeForce GTX 1080 Ti&#39;, major=6, minor=1, total_memory=11176MB, multi_processor_count=28)]
device = torch.device(&amp;quot;cuda&amp;quot; if torch.cuda.is_available() else &amp;quot;cpu&amp;quot;) 
model = MyNetwork()
model = nn.DataParallel(model).to(device)
# 使用所有GPU
model = nn.DataParallel(model, device_ids=[0, 2]).to(device)
# 指定第0，2号GPU
#or
import os 
os.environ[&#39;CUDA_VISIBLE_DEVICES&#39;] = &#39;0,2&#39;
model = nn.DataParallel(model).to(device)
#or
CUDA_VISIBLE_DEVICES=0,2 python3 train.py
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;remote-jupyter-notebook&#34;&gt;remote Jupyter NoteBook&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;jupyter&lt;/code&gt;框架对应的&lt;code&gt;.ipynb&lt;/code&gt;（&lt;code&gt;jupyter notebook&lt;/code&gt;）是可以分体运行+输出存储的&lt;code&gt;python&lt;/code&gt;脚本&lt;/p&gt;
&lt;p&gt;&lt;code&gt;jupyter&lt;/code&gt;的优点是，&lt;code&gt;matplotlib&lt;/code&gt;绘图可以内嵌在结果中，代码可以方便地按&lt;code&gt;cell&lt;/code&gt;分体运行，适合用来学习&lt;code&gt;python&lt;/code&gt;库（不少教程是&lt;code&gt;.ipynb&lt;/code&gt;的），或者看画图效果&lt;/p&gt;
&lt;p&gt;以实验室服务器&lt;code&gt;Anaconda&lt;/code&gt;多&lt;code&gt;Python&lt;/code&gt;环境下配置&lt;code&gt;jupyter&lt;/code&gt;，并使用&lt;code&gt;vscode&lt;/code&gt;/浏览器远程访问&lt;code&gt;jupyter&lt;/code&gt;服务为例&lt;/p&gt;
&lt;h4 id=&#34;jupyter-kernel&#34;&gt;Jupyter Kernel&lt;/h4&gt;
&lt;p&gt;注意，一个虚拟&lt;code&gt;Python&lt;/code&gt;环境对应于一个&lt;code&gt;Jupyter Kernel&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;首先要把&lt;code&gt;Anaconda&lt;/code&gt;中的虚拟&lt;code&gt;Python&lt;/code&gt;环境注册到&lt;code&gt;Jupyter Kernel&lt;/code&gt;中，所用工具为&lt;code&gt;ipykernel&lt;/code&gt;库&lt;/p&gt;
&lt;p&gt;在默认的&lt;strong&gt;base&lt;/strong&gt;环境下：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;conda install jupyter ipykernel
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在想要注册的环境下，例如一个&lt;code&gt;conda&lt;/code&gt;中名为&lt;code&gt;cuda11.4&lt;/code&gt;的环境：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;conda activate cuda11.4
conda install ipykernel
python -m ipykernel install --user  --name cuda11.4 --display-name &amp;quot;cuda11.4-for-learning-pytorch&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;注意：&lt;/strong&gt;&lt;code&gt;--name&lt;/code&gt;参数为&lt;code&gt;jupyter kernelspec list&lt;/code&gt;所列&lt;code&gt;kernel&lt;/code&gt;之名，&lt;code&gt;--display-name&lt;/code&gt;为&lt;code&gt;jupyter notebook&lt;/code&gt;的&lt;code&gt;web&lt;/code&gt;界面中&lt;code&gt;select kernel&lt;/code&gt;时所列&lt;code&gt;kernel&lt;/code&gt;之名&lt;/p&gt;
&lt;p&gt;回到默认的&lt;strong&gt;base&lt;/strong&gt;环境下（也就是使用&lt;code&gt;base&lt;/code&gt;环境管理&lt;code&gt;Jupyter&lt;/code&gt;，因为你不会想，也无法在&lt;code&gt;conda&lt;/code&gt;里删除&lt;code&gt;base&lt;/code&gt;环境）：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;conda activate base
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;远程访问jupyter&#34;&gt;远程访问jupyter&lt;/h4&gt;
&lt;p&gt;在服务器上，利用之前讲过的&lt;code&gt;tmux&lt;/code&gt;，在它里面挂一个以无&lt;code&gt;web&lt;/code&gt;界面的方式启动&lt;code&gt;jupyter&lt;/code&gt;的服务&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;tmux
tmux rename jupyter_server
conda activate base
jupyter notebook --no-browser --port=&amp;lt;server_port&amp;gt;
#例 jupyter notebook --no-browser --port=8889
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在&lt;strong&gt;个人计算机上&lt;/strong&gt;用ssh代理绕一下服务器防火墙:-/&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;ssh -N -f -L localhost:&amp;lt;local_port&amp;gt;:localhost:&amp;lt;server_port&amp;gt; &amp;lt;user&amp;gt;@&amp;lt;server_addr&amp;gt;
#例 ssh -N -f -L localhost:8002:localhost:8889 zhaozixuan@jack.buaadml.info
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;此时访问&lt;code&gt;http://localhost:&amp;lt;local_port&amp;gt;&lt;/code&gt;（例&lt;code&gt;http://localhost:8002&lt;/code&gt;）（带上&lt;code&gt;?toekn=&amp;lt;token&amp;gt;&lt;/code&gt;，如果配置了的话）进入&lt;code&gt;jupyter&lt;/code&gt;，注意，以上指令创建的&lt;code&gt;ssh&lt;/code&gt;进程在后台运行，需要时请&lt;code&gt;ps -ef|grep ssh&lt;/code&gt;找到对应进程&lt;code&gt;kill&lt;/code&gt;之&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;8&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230610222409.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h4 id=&#34;连接vscode&#34;&gt;连接vscode&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;vscode&lt;/code&gt;安装MircoSoft官方的&lt;code&gt;jupyter&lt;/code&gt;插件&lt;/li&gt;
&lt;li&gt;&lt;code&gt;.ipynb&lt;/code&gt;文件下点击右上角的&lt;code&gt;Select Kernel&lt;/code&gt;，将唤起&lt;code&gt;vscode&lt;/code&gt;的全局命令行&lt;/li&gt;
&lt;li&gt;选择&lt;code&gt;Existing Jupyter Server -&amp;gt; Enter the URL of the running Jupyter server&lt;/code&gt;，键入代理到本地的&lt;code&gt;jupyter&lt;/code&gt;地址，键入密码（如果设置了的话）和服务器配置名，选择&lt;code&gt;Kernel&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;9&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230610222428.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h4 id=&#34;显存释放&#34;&gt;显存释放&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;cell&lt;/code&gt;运行完后，&lt;code&gt;jupyter&lt;/code&gt;不会主动结束其&lt;code&gt;python&lt;/code&gt;进程，解释器的变量会驻存在内存/显存中，如果不再需要运行&lt;code&gt;cell&lt;/code&gt;得到新结果，请及时在结束计算后手动&lt;code&gt;shutdown&lt;/code&gt;内核或关闭&lt;code&gt;running&lt;/code&gt;的&lt;code&gt;notebook&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;或者在你最后想运行的&lt;code&gt;cell&lt;/code&gt;末尾追加&lt;code&gt;quit(0)&lt;/code&gt;，可以直接自动把内核挂掉&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;jetbrains-pycharm推荐&#34;&gt;Jetbrains Pycharm（推荐）&lt;/h3&gt;
&lt;h4 id=&#34;教育认证&#34;&gt;教育认证&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://www.jetbrains.com/zh-cn/community/education/#students&#34;&gt;link&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;建议使用北航邮箱激活Jetbrains教育认证，每次激活延期一年所有Jetbrains &lt;code&gt;Professional IDE&lt;/code&gt;的使用权&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;10&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230610220848.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;相比于&lt;code&gt;vscode&lt;/code&gt;, &lt;code&gt;pycharm IDE&lt;/code&gt;搭建环境比较方便，不需要多少额外插件，集成了&lt;code&gt;ssh-interpreter&lt;/code&gt;,&lt;code&gt;SFTP&lt;/code&gt;,对&lt;code&gt;conda&lt;/code&gt;,&lt;code&gt;venv&lt;/code&gt;的友好支持等。为了提高工作效率，可以在本地&lt;code&gt;pycharm&lt;/code&gt;编辑源码，利用服务器的&lt;code&gt;python&lt;/code&gt;解释器对代码解释与运行程序，使用&lt;code&gt;SFTP&lt;/code&gt;工具自动同步远程/本地&lt;/p&gt;
&lt;h4 id=&#34;以配置kevin的远程conda环境为例&#34;&gt;以配置kevin的远程conda环境为例&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Setting -&amp;gt; Project -&amp;gt; Add Interpreter -&amp;gt; On SSH...&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;填写地址&lt;code&gt;kevin.buaadml.info&lt;/code&gt;与&lt;code&gt;ldap&lt;/code&gt;用户名，确保当前设备可以&lt;code&gt;ssh&lt;/code&gt;免密&lt;/li&gt;
&lt;li&gt;连接到服务器，&lt;code&gt;IDE&lt;/code&gt;显示探查界面即连接&lt;/li&gt;
&lt;/ul&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;11&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230610220856.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;选择&lt;code&gt;System Interpreter&lt;/code&gt;，服务器上在相应&lt;code&gt;conda&lt;/code&gt;环境下&lt;code&gt;which python&lt;/code&gt;，将打印路径粘贴到配置，&lt;code&gt;Sync folders&lt;/code&gt;选项将新建一个&lt;code&gt;SFTP&lt;/code&gt;配置&lt;/li&gt;
&lt;/ul&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;12&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230610222457.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Menu -&amp;gt; Tools -&amp;gt; Depolyment -&amp;gt; Configuration &lt;/code&gt;修改&lt;code&gt;SFTP&lt;/code&gt;配置，解释器与&lt;code&gt;SFTP&lt;/code&gt;是独立的，可以将&lt;code&gt;Sync folders&lt;/code&gt;生成的删除之，使用与&lt;code&gt;gaia&lt;/code&gt;的文件同步即可。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;勾选&lt;code&gt;Menu -&amp;gt; Tools -&amp;gt; Depolyment -&amp;gt; Automatic Upload&lt;/code&gt;可启用保存时上传当前文件&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;btw, 喜欢&lt;code&gt;vscode UI&lt;/code&gt;的可以安装&lt;code&gt;2023.1&lt;/code&gt;后版本的&lt;code&gt;Pycharm&lt;/code&gt;，新&lt;code&gt;UI&lt;/code&gt;更现代，更接近&lt;code&gt;vscode&lt;/code&gt;的简洁风格&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;13&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230610222533.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h4 id=&#34;remote-clion-idea&#34;&gt;remote CLion, Idea...&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;JetBrains&lt;/code&gt;系&lt;code&gt;IDE&lt;/code&gt;远程环境配置 大差不差&lt;/p&gt;
&lt;p&gt;btw,远程协作方面推荐&lt;code&gt;JetBrains&lt;/code&gt;的原生插件&lt;code&gt;Code With Me&lt;/code&gt;:&lt;a href=&#34;https://www.jetbrains.com/code-with-me/&#34;&gt;link&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;python&#34;&gt;Python&lt;/h3&gt;
&lt;h4 id=&#34;三方库&#34;&gt;三方库&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://anaconda.org/&#34;&gt;https://anaconda.org/&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://pypi.org/&#34;&gt;https://pypi.org/&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&#34;python-进阶&#34;&gt;Python 进阶&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://book.douban.com/subject/27028517/&#34;&gt;Fluent Python&lt;/a&gt;, &lt;a href=&#34;https://python3-cookbook.readthedocs.io/zh_CN/latest/chapters/p09_meta_programming.html&#34;&gt;Python Cookbook&lt;/a&gt;, &lt;a href=&#34;https://book.douban.com/subject/35334595/&#34;&gt;Effective Python&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;掌握一门脚本语言吧，如&lt;code&gt;Python&lt;/code&gt;/&lt;code&gt;Linux Shell&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;docker&#34;&gt;Docker&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.docker.com/get-started/&#34;&gt;Docker Docs&lt;/a&gt;,&lt;a href=&#34;https://book.douban.com/subject/30486354/&#34;&gt;《深入浅出Docker》&lt;/a&gt;, &lt;a href=&#34;https://kubernetes.io/zh-cn/docs/home/&#34;&gt;K8s Doc&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;redis&#34;&gt;Redis&lt;/h3&gt;
&lt;h3 id=&#34;elasticsearch&#34;&gt;ElasticSearch&lt;/h3&gt;
&lt;p&gt;&lt;em&gt;Acknowledgement: This section was originally created by &lt;a href=&#34;https://github.com/zhangguiwei610&#34;&gt;zhangguiwei&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&#34;network-tools&#34;&gt;Network Tools&lt;/h3&gt;
&lt;h4 id=&#34;校园网登陆脚本&#34;&gt;校园网登陆脚本&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cd /home/dml_401/Login_Net
python Login.py#查看用法
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;postman&#34;&gt;postman&lt;/h4&gt;
&lt;p&gt;一个跨平台，并支持在线使用的&lt;code&gt;HTTP RESTful API&lt;/code&gt;调试工具，显然从功能性与易用性上看，是比&lt;code&gt;curl&lt;/code&gt;命令好用很多很多的&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://web.postman.co/&#34;&gt;link&lt;/a&gt;&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;14&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230610222552.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;注意，当请求地址是一个内网地址时，无法在线通过&lt;code&gt;postman&lt;/code&gt;连接，根据&lt;code&gt;postman&lt;/code&gt;报错指引&lt;code&gt;Use Postman&#39;s Desktop Agent&lt;/code&gt;本地安装一个&lt;code&gt;postman agent&lt;/code&gt;程序，启动之，就能继续在线调试内网上的接口&lt;/p&gt;
&lt;h4 id=&#34;ncnetstat&#34;&gt;nc/netstat&lt;/h4&gt;
&lt;p&gt;均为传输层的&lt;code&gt;Linux&lt;/code&gt;工具命令，&lt;code&gt;nc&lt;/code&gt;用于发起&lt;code&gt;TCP/UDP&lt;/code&gt;连接；&lt;code&gt;netstat&lt;/code&gt;用于探查端口，如&lt;code&gt;netstat -ntlp&lt;/code&gt;查看所有&lt;code&gt;TCP Socket&lt;/code&gt;，&lt;code&gt;lsof -i:&amp;lt;port_num&amp;gt;&lt;/code&gt;查看监听具名端口的进程&lt;/p&gt;
&lt;h4 id=&#34;wiresharktcpdump&#34;&gt;wireshark/tcpdump&lt;/h4&gt;
&lt;p&gt;链路层以上抓包工具，&lt;code&gt;tcpdump&lt;/code&gt;命令参考&lt;a href=&#34;https://man7.org/linux/man-pages/man1/tcpdump.1.html&#34;&gt;link&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;WireShark&lt;/code&gt;是一个跨平台的抓包软件，优点在于开源、支持协议多、&lt;code&gt;GUI&lt;/code&gt;友好&lt;/p&gt;
&lt;h3 id=&#34;domain-name-cloud-server&#34;&gt;Domain Name &amp;amp; Cloud Server&lt;/h3&gt;
&lt;h4 id=&#34;云服务器&#34;&gt;云服务器&lt;/h4&gt;
&lt;p&gt;可以是获得公网&lt;code&gt;IP&lt;/code&gt;的一种方式&lt;/p&gt;
&lt;p&gt;国内厂商: &lt;a href=&#34;https://developer.aliyun.com/plan/student&#34;&gt;阿里&lt;/a&gt;，&lt;a href=&#34;https://cloud.tencent.com/act/campus&#34;&gt;腾讯&lt;/a&gt;， &lt;a href=&#34;https://www.huaweicloud.com/product/hecs.html&#34;&gt;华为&lt;/a&gt;,  &lt;a href=&#34;https://cloud.baidu.com/campaign/PromotionActivity/index.html&#34;&gt;百度&lt;/a&gt; 等，&lt;/p&gt;
&lt;p&gt;以上厂商以学生认证+新用户购买的方式，基本可以以一百块左右买到一年的云服务器&lt;/p&gt;
&lt;p&gt;通常云服务器控制台会有安全组设置，也就是厂商层面的防火墙，构建应用时注意放行相应端口&lt;/p&gt;
&lt;h4 id=&#34;域名&#34;&gt;域名&lt;/h4&gt;
&lt;p&gt;1.厂商：国内阿里云、腾讯云等，国外&lt;code&gt;GoDaddy&lt;/code&gt;/&lt;code&gt;siteground&lt;/code&gt;等，注意，在国内厂商购买的域名，或是&lt;code&gt;.cn&lt;/code&gt;等后缀的域名，需要根据购买后厂商提示在工信部网站进行备案（同时严格遵守我国网信法），否则会被&lt;code&gt;DNS&lt;/code&gt;服务器拒绝域名解析&lt;/p&gt;
&lt;p&gt;2.&lt;code&gt;DNS&lt;/code&gt;：通常来讲，一个域名往往可以通过&lt;code&gt;DNS&lt;/code&gt;映射到一个&lt;code&gt;IP&lt;/code&gt;地址（&lt;code&gt;A&lt;/code&gt;）或另一个域名（&lt;code&gt;CNAME&lt;/code&gt;），但不与端口绑定，为实现一级域名或二级域名到具体端口的路由。可以使用&lt;code&gt;nginx&lt;/code&gt;的反向代理或&lt;code&gt;docker virtual host&lt;/code&gt;等技术&lt;/p&gt;
&lt;h3 id=&#34;github&#34;&gt;GitHub&lt;/h3&gt;
&lt;h4 id=&#34;pull-request&#34;&gt;Pull Request&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;GitHub&lt;/code&gt;网页上&lt;code&gt;fork&lt;/code&gt;原始仓库&lt;/li&gt;
&lt;li&gt;以&lt;code&gt;ssh&lt;/code&gt;协议&lt;code&gt;clone&lt;/code&gt;自己的&lt;code&gt;fork&lt;/code&gt;仓到本地（&lt;code&gt;GitHub&lt;/code&gt;官方已禁用用户密码管理仓库，不使用&lt;code&gt;ssh&lt;/code&gt;需要使用&lt;code&gt;GitHub token&lt;/code&gt;，你不会喜欢麻烦的&lt;code&gt;Github token&lt;/code&gt;的）&lt;/li&gt;
&lt;li&gt;&lt;code&gt;commit&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;git checkout -b any_branch_name
git add /path/to/upload/files
git status #检查git暂存区
git commit -m “更新说明”
git push origin any_branch_name
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;回到&lt;code&gt;GitHub&lt;/code&gt;网页&lt;code&gt;fork&lt;/code&gt;仓，会提示&lt;code&gt;compare &amp;amp; pull request&lt;/code&gt;，直接在网页端按提示操作&lt;/li&gt;
&lt;li&gt;&lt;code&gt;PR&lt;/code&gt;被批准通过后，原仓库可能会额外产生一次&lt;code&gt;merge commit&lt;/code&gt;，在自己&lt;code&gt;fork&lt;/code&gt;仓库的&lt;code&gt;github&lt;/code&gt;界面，点开之前&lt;code&gt;push&lt;/code&gt;的&lt;code&gt;branch&lt;/code&gt;的网页界面,有&lt;code&gt;sync fork&lt;/code&gt;选项快速同步合并更新后的原始仓库&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;github-pages&#34;&gt;Github Pages&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;Github Pages&lt;/code&gt;（仓库&lt;code&gt;Settings -&amp;gt; Code and automation -&amp;gt; Pages&lt;/code&gt;）可以由&lt;code&gt;github&lt;/code&gt;托管一个静态网站，所谓静态就是说没有后端，没有数据库，只有一坨&lt;code&gt;HTML/CSS/JS&lt;/code&gt;，一般来说&lt;code&gt;Github Pages&lt;/code&gt;上的大部分内容是我们写的&lt;code&gt;markdown&lt;/code&gt;渲染出的&lt;code&gt;HTML&lt;/code&gt;，一般通过&lt;code&gt;Pages branch&lt;/code&gt;/&lt;code&gt;Github Actions&lt;/code&gt;在&lt;code&gt;commit&lt;/code&gt;时构建网站&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;15&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230610222620.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;jekyll&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.github.com/zh/pages/setting-up-a-github-pages-site-with-jekyll/about-github-pages-and-jekyll&#34;&gt;jekyll&lt;/a&gt;是&lt;code&gt;github&lt;/code&gt;官方原生支持的静态建站框架，需要&lt;code&gt;Ruby&lt;/code&gt;环境，不会玩，欢迎补充&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Gridea&lt;br&gt;
&lt;code&gt;Gridea&lt;/code&gt;是相当简单的&lt;code&gt;Github Pages&lt;/code&gt;静态建站工具：&lt;a href=&#34;https://github.com/getgridea/gridea&#34;&gt;link&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;配置好&lt;code&gt;github token&lt;/code&gt;（注意&lt;code&gt;token&lt;/code&gt;需要对仓库操作放权）与仓库地址，写好&lt;code&gt;markdown&lt;/code&gt;一键同步即可，&lt;code&gt;Gridea&lt;/code&gt;主题:&lt;a href=&#34;https://github.com/topics/gridea-theme&#34;&gt;link&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;注意，使用&lt;code&gt;Gridea&lt;/code&gt;将放弃&lt;code&gt;git&lt;/code&gt;的版本控制功能，因为&lt;code&gt;Gridea&lt;/code&gt;的推送方式为&lt;code&gt;force reset branch&lt;/code&gt;再&lt;code&gt;commit&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;图床与防盗链&lt;/p&gt;
&lt;p&gt;为静态网站准备一个图床，因为：1.减小&lt;code&gt;Github Pages&lt;/code&gt;大小 2.如果把图片存储在&lt;code&gt;zhihu&lt;/code&gt;或&lt;code&gt;cnblogs&lt;/code&gt;这些启用防盗链的网站上，那么在这些站点之外的网站页面上链接到这些图像，那么会被拒绝加载（&lt;code&gt;403&lt;/code&gt;）&lt;/p&gt;
&lt;p&gt;可以使用非常简单易用的&lt;a href=&#34;https://picgo.github.io/PicGo-Doc/zh/&#34;&gt;PicGo&lt;/a&gt;，搭建&lt;code&gt;Github&lt;/code&gt;图床等图床&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Severless&lt;/p&gt;
&lt;p&gt;静态网站不能利用数据库，因此可以使用&lt;code&gt;Serverless &lt;/code&gt;的服务在云上存储动态数据，如使用非常简单的&lt;code&gt;valine&lt;/code&gt;（&lt;a href=&#34;https://valine.js.org/quickstart.html&#34;&gt;link&lt;/a&gt;）接入评论功能&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;搭建非静态网站&lt;/p&gt;
&lt;p&gt;可以在自己的服务器上建站，摆脱静态网站之限制，可以考虑&lt;code&gt;hexo&lt;/code&gt;, &lt;code&gt;Hugo&lt;/code&gt;, &lt;code&gt;Wordpress&lt;/code&gt;等框架&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;github-action&#34;&gt;Github Action&lt;/h4&gt;
&lt;h3 id=&#34;nat-traversal&#34;&gt;NAT traversal&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;！！！以下软件请仅用于个人计算机，且自行承担一切网安风险（如校园网环境下隧道有可能被北航墙掉）！！！&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;反向代理&#34;&gt;反向代理&lt;/h4&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;16&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230610220952.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;以上是正向代理与反向代理两种模式的示意图，可以看到正向代理下，被代理的是请求机器，所以代理客户端在请求机器，代理服务端跑在代理服务器上。这样，指明访问地址时，代理软件会帮我们通过代理服务器做中转，从而绕过防火墙等网络策略访问到目标服务器。&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;17&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230610221007.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;而在反向代理下，被代理的是目标服务器，请求机器上，代理服务器就等价于目标服务器。请求机器不必给代理服务器提供目标服务器的网址等路由信息，通常它也无法知晓。这时，代理软件需要在 代理服务器（中转服务器）上跑服务端，在目标服务器上跑客户端。反向代理的场景：1.负载均衡，请求转发到节点，如nginx 2.内网穿透：设想我想把个人计算机搭建为服务器，但没有公网IP，只有局域网IP，那么可以把我的计算机交给代理服务器代理，利用它的公网IP将个人计算机暴露在互联网上。没有公网IP时，自然的解决方案就可以是内网穿透，也就是打洞。&lt;/p&gt;
&lt;h4 id=&#34;frp&#34;&gt;frp&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;frp&lt;/code&gt;：开源软件，使用需要一台中转服务器&lt;/p&gt;
&lt;p&gt;以&lt;code&gt;frp&lt;/code&gt;反向代理实现内网穿透&lt;code&gt;Secure Shell&lt;/code&gt;服务为例&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Github Release&lt;/code&gt;: &lt;a href=&#34;https://github.com/fatedier/frp/releases&#34;&gt;link&lt;/a&gt; ,下载相应&lt;code&gt;os&lt;/code&gt;与指令集架构的压缩包，解压之，目录下&lt;code&gt;frpc&lt;/code&gt;/&lt;code&gt;frps&lt;/code&gt;是客户端，&lt;code&gt;frpc.ini&lt;/code&gt;/&lt;code&gt;frps.ini&lt;/code&gt;为相应配置文件&lt;/p&gt;
&lt;p&gt;在内网机器上配置&lt;code&gt;frpc.ini&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;[common]
server_addr = &amp;lt;remote_addr&amp;gt; #远程端frps端服务器的公网地址
server_port = 7001 #远程服务端frps占用端口
token = &amp;lt;use_a_random_generator_to_get_a_more_complex_token&amp;gt; 
# 客户端服务端对称认证密钥，可256位
use_encryption = true
use_compression = true
#报文对称加密与压缩
#tls_enable = true
#tls_trusted_ca_file = /to/ca/path/ca.crt
#TLS加密，https://gofrp.org/docs/features/common/network/network-tls/
#log_level = debug
log_file = /var/log/frpc.log
#志记
[ssh] #配置名字
type = tcp #指定协议
local_ip = 127.0.0.1 # 穿透的地址，本机可ssh登录的地址即可，可以是同局域网另一机器，可改
local_port = 22 # ssh监听端口
remote_port = 8022 # 代理到frps服务器的端口号，可改
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在中转机器上配置&lt;code&gt;frps.ini&lt;/code&gt;，确保中转机器可被请求机器与内网机器访问&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;[common]
bind_port = 7001 #frps占用端口
token = &amp;lt;use_a_random_generator_to_get_a_more_complex_token&amp;gt; 
# 客户端服务端对称认证密钥，可256位
use_encryption = true
use_compression = true
#报文对称加密与压缩
#vhost_http_port = 80 
#穿透http服务所用端口，https://gofrp.org/docs/examples/vhost-http/
#tls_enable = true
#tls_cert_file = /root/frp/server.crt
#tls_key_file = /root/frp/server.key
#TLS加密，https://gofrp.org/docs/features/common/network/network-tls/
#log_level = debug
log_file = /var/log/frps.log
#志记
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;以&lt;code&gt;/path/to/frpc -c /path/to/frpc.ini&lt;/code&gt;启动内网机器的客户端，&lt;code&gt;/path/to/frps -c /path/to/frps.ini&lt;/code&gt;启动中转服务器的服务端，此时在请求机器上&lt;code&gt;ssh &amp;lt;user&amp;gt;@&amp;lt;remote_addr&amp;gt; -p 8022&lt;/code&gt;等价于&lt;code&gt;ssh&lt;/code&gt;登录内网机器（&lt;code&gt;local_ip:local_port&lt;/code&gt;）&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;注意&lt;/strong&gt;，我们需要保证&lt;code&gt;frp&lt;/code&gt;，特别是&lt;code&gt;frpc&lt;/code&gt;的稳定性，因为&lt;code&gt;frpc&lt;/code&gt;中断后必须要有主动重连&lt;code&gt;frps&lt;/code&gt;的能力，因为&lt;code&gt;frps&lt;/code&gt;无法寻址到使用&lt;code&gt;NAT&lt;/code&gt;的内网机器&lt;/p&gt;
&lt;p&gt;所以使用上文说到的&lt;code&gt;systemd&lt;/code&gt;为例，为&lt;code&gt;frpc&lt;/code&gt;/&lt;code&gt;frps&lt;/code&gt;注册守护进程&lt;code&gt;vi /etc/systemd/system/frps.service&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;[Unit]
Description=frps(nei_wang_chuan_tou)
After=network.target
Wants=network.target

[Service]
Restart=on-failure
RestartSec=5
ExecStart=/root/frp/frps -c /root/frp/frps.ini

[Install]
WantedBy=multi-user.target                     
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;其中&lt;code&gt;ExecStart&lt;/code&gt;为启动命令（&lt;code&gt;systemctl start&lt;/code&gt;），当进程异常终止时等待&lt;code&gt;RestartSec=5&lt;/code&gt;秒重新启动&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;systemctl daemon-reload # 刷新配置
systemctl start frps.service # 启动服务
systemctl enable frps.service # 开机自启
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;autossh内网穿透&#34;&gt;autossh内网穿透&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://liyirui-git.github.io/tech/%E6%8A%98%E8%85%BE/autossh%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F.html&#34;&gt;liyirui.github.io&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&#34;闭源软件&#34;&gt;闭源软件&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;向日葵/ToDesk：主要功能是远程桌面控制&lt;/li&gt;
&lt;li&gt;花生壳：免费版有隧道数量限制，且已经不支持穿透&lt;code&gt;http&lt;/code&gt;协议，支持&lt;code&gt;tcp/udp/https&lt;/code&gt;（2023.3）&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ngrok&lt;/code&gt;：2.x版本已闭源&lt;/li&gt;
&lt;li&gt;&lt;code&gt;cpolar&lt;/code&gt;: 同样只需要部署客户端，服务端由厂商服务器支持,&lt;a href=&#34;https://www.cpolar.com/&#34;&gt; https://www.cpolar.com/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;以&lt;code&gt;cpolar&lt;/code&gt;实现通过&lt;code&gt;anna&lt;/code&gt;（windows）内网穿透&lt;code&gt;ssh&lt;/code&gt;与&lt;code&gt;http&lt;/code&gt;服务为例，配置&lt;code&gt;C:\Users\Administrator\.cpolar\cpolar.yml&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;authtoken: &amp;lt;cpolar_auth&amp;gt;
tunnels:
  ssh:
    proto: tcp
    addr: &amp;quot;10.*.*.*:22&amp;quot;
    remote_addr: 8.tcp.cpolar.top:1****
  vue:
    proto: http
    addr: &amp;quot;10.*.*.*:*****&amp;quot;
    subdomain: vssvue
  ssh2:
    proto: tcp
    addr: &amp;quot;10.*.*.*:22&amp;quot;
    remote_addr: 2.tcp.cpolar.top:****
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;注意&lt;/strong&gt;，其中被穿透的机器为&lt;code&gt;10.*.*.*&lt;/code&gt;，而不是&lt;code&gt;anna&lt;/code&gt;，&lt;code&gt;anna&lt;/code&gt;只是一个二级跳板&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&amp;lt;cpolar_auth&amp;gt;&lt;/code&gt;为&lt;code&gt;cpolar&lt;/code&gt;账户的密钥, &lt;code&gt;remote_addr&lt;/code&gt;与&lt;code&gt;subdomain&lt;/code&gt;字段为保留二级域名/端口，需要在&lt;code&gt;cpolar&lt;/code&gt;官网使用自己的账号购买&lt;/p&gt;
&lt;p&gt;启动&lt;code&gt;cpolar&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-powershell&#34;&gt;#cmd
D:\
cd cpolar
.\cpolar.exe list
.\cpolar.exe start vue
.\cpolar.exe start ssh
.\cpolar.exe start ssh2
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;以我当前的配置文件与&lt;code&gt;cpolar&lt;/code&gt;账号设置,使用&lt;code&gt;ssh root@***.cpolar.*** -p 1****&lt;/code&gt;登录内网机器，通过&lt;code&gt;http://*****.cpolar.***&lt;/code&gt;访问&lt;code&gt;web&lt;/code&gt;应用&lt;/p&gt;
&lt;p&gt;最后使用批处理脚本自动重启&lt;code&gt;cpolar&lt;/code&gt;客户端&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-powershell&#34;&gt;#ssh.bat
:start
.\cpolar.exe start ssh
timeout /t 60 /nobreak &amp;gt; nul
goto start
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;.\ssh.bat&lt;/code&gt;运行之&lt;/p&gt;
&lt;h3 id=&#34;ldap&#34;&gt;LDAP&lt;/h3&gt;
&lt;ul class=&#34;contains-task-list&#34;&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-5616441&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-5616441&#34;&gt; TODO&lt;/label&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;plugin-a-new-machine&#34;&gt;Plugin a new machine&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ubuntu启动盘制作：略&lt;/li&gt;
&lt;li&gt;装机脚本&lt;/li&gt;
&lt;li&gt;运行脚本后的LDAP配置&lt;/li&gt;
&lt;li&gt;安装显驱：使用nvidia runfile&lt;/li&gt;
&lt;li&gt;启动GPU监控脚本&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;latexmarkdown&#34;&gt;LaTeX/Markdown&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;toolchain: 1. &lt;code&gt;Overleaf&lt;/code&gt;, 在线就是方便 2.可以装一个跨平台&lt;code&gt;LaTeX&lt;/code&gt;编译器，如&lt;code&gt;TeXLive&lt;/code&gt;, &lt;code&gt;MikTex&lt;/code&gt;，然后使用相关&lt;code&gt;IDE&lt;/code&gt;，如&lt;code&gt;TeXstudio&lt;/code&gt;, &lt;code&gt;VSCode&lt;/code&gt;等&lt;/li&gt;
&lt;li&gt;LaTeX插入伪代码：&lt;code&gt;\usepackage{algorithmicx}&lt;/code&gt; or &lt;code&gt;\usepackage{algpseudocode}&lt;/code&gt; or &lt;code&gt;\usepackage{algpseudocodex}&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;LaTex做ppt: &lt;code&gt;Beamer&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;markdown编辑器：&lt;code&gt;Typora&lt;/code&gt;,所见即所得&lt;/li&gt;
&lt;li&gt;markdown最终会渲染为&lt;code&gt;HTML&lt;/code&gt;，所以&lt;code&gt;markdown&lt;/code&gt;是原生可内嵌&lt;code&gt;html&lt;/code&gt;块的&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;endnote&#34;&gt;EndNote&lt;/h3&gt;
&lt;ul class=&#34;contains-task-list&#34;&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-4906122&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-4906122&#34;&gt; TODO&lt;/label&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;util&#34;&gt;util&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/BHOSC/BUAAthesis&#34;&gt;北航毕设LaTeX模板&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/TheBloodthirster/BUAA_Course_Sharing&#34;&gt;北航课程资料仓&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cnblogs.com/khunkin/tag/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/&#34;&gt;北航计算机网络实验博客&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://bhpan.buaa.edu.cn:443/link/2206208E3EA8D07A4C70719806DE989E&#34;&gt;一个北航ppt白板模板&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://bhpan.buaa.edu.cn:443/link/8118A1CB56FD3022C8ADB123C6D0205F&#34;&gt;北航《大数据处理与机器学习算法实训》23春作业与代码&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://bhpan.buaa.edu.cn:443/link/6C0C4889FAFCC1D44F0B16A30AEC8A51&#34;&gt;北航《算法分析与设计》22秋作业&lt;/a&gt;， &lt;a href=&#34;https://bhpan.buaa.edu.cn:443/link/6F788707FB9D255AD75DD694F43FB828&#34;&gt;《算法分析与设计》20春作业&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://cs231n.stanford.edu/&#34;&gt;Stanford University CS231n&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/zixfy/cs231n_assignments_2021&#34;&gt;zixfy&#39;s cs231n_assignments_2021&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://godbolt.org/&#34;&gt;Compiler Exploer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.overleaf.com/&#34;&gt;Overleaf 编辑器&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cmor-faculty.rice.edu/~heinken/latex/symbols.pdf&#34;&gt;LaTeX Symbols&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.dokuwiki.org/zh:wiki:syntax&#34;&gt;DokuWiki tutorials&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://paperswithcode.com/&#34;&gt;paperswithcode&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;以上，初稿于2023.6&lt;/p&gt;
">DML-BDI实验室指北</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/c-shi-xian-er-cha-dui/"" data-c="
          &lt;p&gt;原文：&lt;a href=&#34;https://zhuanlan.zhihu.com/p/659218897&#34;&gt;zhihu&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;c++&lt;/code&gt;手撕一个简化版的优先队列..&lt;/p&gt;
&lt;p&gt;优先队列用于维护一组数据及其优先级，通常支持&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;O(1)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;O&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;查找优先级最大（小）的队首元素，&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;log(N)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.01968em;&#34;&gt;l&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;入队元素与弹出队首元素&lt;/p&gt;
&lt;p&gt;在&lt;code&gt;c#&lt;/code&gt;泛型优先队列中，优先值是显式的（&lt;code&gt;PriorityQueue&amp;lt;TElement,TPriority&amp;gt;&lt;/code&gt;），也就是同时存储元素和优先值，且维护队首元素优先值最小&lt;/p&gt;
&lt;p&gt;而在&lt;code&gt;C++ STL&lt;/code&gt;中&lt;code&gt;std::priority_queue&amp;lt;T&amp;gt;&lt;/code&gt;维护队首元素优先值最大，且优先值是隐式的，较小的元素有较小的优先值，默认的小于号比较器是&lt;code&gt;std::less&amp;lt;&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;也就是说&lt;code&gt;std::priority_queue&amp;lt;int, vector&amp;lt;int&amp;gt;, std::greater&amp;lt;&amp;gt;&amp;gt; &lt;/code&gt;维护最小值，&lt;code&gt;std::priority_queue&amp;lt;int, vector&amp;lt;int&amp;gt;, std::less&amp;lt;&amp;gt;&amp;gt; &lt;/code&gt;维护最大值&lt;/p&gt;
&lt;p&gt;所以如果实际中优先值与元素类型没有关系，我们可以把存储类型更改为&lt;code&gt;std::pair&amp;lt;TPriority, T&amp;gt;&lt;/code&gt;，或者新建类型绑定优先值与元素&lt;/p&gt;
&lt;p&gt;我们可以利用最大二叉堆实现一个类似的优先队列&lt;/p&gt;
&lt;p&gt;最大二叉堆是这样一颗完全二叉树（所有层，除了最后一层都一定是满的，且节点靠左排列）&lt;/p&gt;
&lt;p&gt;且二叉堆中任意节点满足&lt;strong&gt;性质&lt;/strong&gt;，节点大于所有其子节点&lt;/p&gt;
&lt;p&gt;由于是完全二叉树，可以直接用数组存储树结构，令根节点位于下标&lt;code&gt;0&lt;/code&gt;，则节点&lt;code&gt;x&lt;/code&gt;的父节点为&lt;code&gt;(x - 1) / 2 &lt;/code&gt;，左右节点为&lt;code&gt;2 * x + 1&lt;/code&gt;, &lt;code&gt;2 * x + 2&lt;/code&gt;&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20231001183409.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20231001183425.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;二叉堆的核心在于插入与删除，因为最大元素已经在数据开头了&lt;/p&gt;
&lt;p&gt;先声明优先队列的主要成员&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template&amp;lt;typename T, typename Compare = std::less&amp;lt;T&amp;gt;&amp;gt;
class PriorityQueue {
private:
    using uz = std::size_t;
    std::vector&amp;lt;T&amp;gt; _vec;
    Compare _cmp;
public:
    explicit PriorityQueue(Compare cmp = {}) : _vec{}, _cmp{cmp} {}
    template&amp;lt;typename Iterator&amp;gt;
    PriorityQueue(Iterator begin, Iterator end, Compare cmp = {}): _vec(begin, end),
                                                                   _cmp{cmp} { _maintain_from_chaos(); }

    inline auto size() { return _vec.size(); }
    inline auto empty() { return _vec.empty(); }
    inline auto clear() { _vec.clear(); }

    T const &amp;amp;peek();
    inline T const *try_peek();

    template&amp;lt;typename ForwardAsT = T&amp;gt; void push(ForwardAsT &amp;amp;&amp;amp;value);
    template&amp;lt;typename ...Args&amp;gt; void emplace(Args ...args);

    T pop();
    inline std::optional&amp;lt;T&amp;gt; try_pop();

private:
    inline auto _father_of(uz x) {return (x - 1) &amp;gt;&amp;gt; 1;}
    inline auto _left_of(uz x) {return (x &amp;lt;&amp;lt; 1) | 1;}

    void _maintain_up(uz current);
    void _maintain_down(uz current);
    inline void _maintain_from_chaos();
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;其中&lt;code&gt;uz&lt;/code&gt;为&lt;code&gt;std::size_t&lt;/code&gt;，&lt;code&gt;_cmp&lt;/code&gt;是小于号(&lt;code&gt;&amp;lt;&lt;/code&gt;)，&lt;code&gt;_vec&lt;/code&gt;是最大堆&lt;/p&gt;
&lt;p&gt;因为队列可能为空，为查询最大元素与出队最大元素也提供了安全的&lt;code&gt;try_peek()&lt;/code&gt;, &lt;code&gt;try_pop&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;入队元素的函数为&lt;code&gt;push&lt;/code&gt;与&lt;code&gt;emplace&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;push&lt;/code&gt;会从实参拷贝(移动)构造新元素&lt;code&gt;T&lt;/code&gt;，而&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template&amp;lt;typename ...Args&amp;gt; void emplace(Args ...args);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;的形参是&lt;code&gt;T&lt;/code&gt;构造函数的参数，我们将在这个函数中利用&lt;code&gt;std::vector::emplace_back&lt;/code&gt;原地构造对象，有些情况下可以节省一次拷贝或移动&lt;/p&gt;
&lt;p&gt;这里&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template&amp;lt;typename ForwardAsT = T&amp;gt; void push(ForwardAsT &amp;amp;&amp;amp;value);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;的万能引用写成&lt;code&gt;ForwardAsT &amp;amp;&amp;amp;&lt;/code&gt;而不是&lt;code&gt;T&amp;amp;&amp;amp;&lt;/code&gt;的原因是在&lt;code&gt;PriorityQueue&amp;lt;T, Compare&amp;gt;&lt;/code&gt;类内部，&lt;code&gt;T&lt;/code&gt;已经被替换成具体的元素类型了，所以&lt;code&gt;T&amp;amp;&amp;amp;&lt;/code&gt;是右值引用，而不是万能引用&lt;/p&gt;
&lt;p&gt;比如&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template&amp;lt;typename T&amp;gt; struct A { 
    void f(T&amp;amp;&amp;amp;) {
        cout &amp;lt;&amp;lt; &amp;quot;okay for overload of lvalue reference&amp;quot;;
    }
};
int main() { 
    int b = 2;
    A&amp;lt;int&amp;gt;{}.f(b);
} 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;报错&lt;code&gt;error: rvalue reference to type &#39;int&#39; cannot bind to lvalue of type &#39;int&#39;&lt;/code&gt;, 而以下代码可以编译&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template&amp;lt;typename T&amp;gt; struct A {
    template&amp;lt;typename TT = T&amp;gt;
    void f(TT&amp;amp;&amp;amp;) {
        cout &amp;lt;&amp;lt; &amp;quot;okay for overload of lvalue reference&amp;quot;;
    }
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;具体实现上，首先考虑入队，直接将新元素尾插二叉堆数组&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template&amp;lt;typename ForwardAsT = T&amp;gt;
void push(ForwardAsT &amp;amp;&amp;amp;value) {
    _vec.push_back(std::forward&amp;lt;ForwardAsT&amp;gt;(value));
    _maintain_up(_vec.size() - 1);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;而新插入的节点可能破坏了父节点的性质（比新节点还小），所以写一个&lt;code&gt;_maintain_up(x)&lt;/code&gt;函数用于维护&lt;code&gt;x&lt;/code&gt;的父节点的性质，如果父节点比&lt;code&gt;x&lt;/code&gt;小，就不断地交换二者&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;void _maintain_up(uz current) {
    while (current != 0) {
        auto father = _father_of(current);
        if (_cmp(_vec[father], _vec[current]))
            std::swap(_vec[father], _vec[current]);
        // if father &amp;lt; current , let current grow
        else break;
        current = father;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;而出队时，首先交换二叉堆数组开头元素（根节点）与末尾元素，弹出并返回末尾的最大值&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;T pop() {
    if (empty())
        throw std::runtime_error(&amp;quot;pop on a empty PriorityQueue&amp;quot;);
    std::swap(_vec.front(), _vec.back());
    auto ret = std::move(_vec.back());
    _vec.pop_back();
    _maintain_down(0);
    if (_vec.size() &amp;gt; 32 &amp;amp;&amp;amp; _vec.size() * 2 &amp;lt; _vec.capacity())
        _vec.shrink_to_fit();
    return ret;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;而此时根节点的性质可能被破坏，所以写一个&lt;code&gt;_maintain_down(x)&lt;/code&gt;函数用于维护&lt;code&gt;x&lt;/code&gt;节点的性质，如果&lt;code&gt;x&lt;/code&gt;比最大的孩子小，就不断地交换二者&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;void _maintain_down(uz current) {
    for (auto child = _left_of(current); child &amp;lt; _vec.size(); child = _left_of(current)) {
        // while there is still any children for current node
        if (auto sibling = child + 1; sibling &amp;lt; _vec.size() &amp;amp;&amp;amp; _cmp(_vec[child], _vec[sibling]))
            child = sibling;
        // select biggest child
        if (_cmp(_vec[current], _vec[child]))
            std::swap(_vec[current], _vec[child]);
        // if current  &amp;lt; child, let child grow
        else break;
        current = child;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;查询最大元素&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;T const &amp;amp;peek() {
    if (empty())
        throw std::runtime_error(&amp;quot;peek on a empty PriorityQueue&amp;quot;);
    return _vec.front();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;最后是构造函数，基本构造函数设计为迭代器形参&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template&amp;lt;typename Iterator&amp;gt;
PriorityQueue(Iterator begin, Iterator end, Compare cmp = {}): _vec(begin, end),
_cmp{cmp} { _maintain_from_chaos(); }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;由于初始二叉堆是无序的，在&lt;code&gt;_maintain_from_chaos&lt;/code&gt;函数中从底向上遍历二叉堆的节点，都调用一遍&lt;code&gt;_maintain_down&lt;/code&gt;维护自身性质即可&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;inline void _maintain_from_chaos() {
    for (uz i = _vec.size(); i &amp;gt; 0;)
        _maintain_down(--i);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;再完善一下构造函数，支持&lt;code&gt;std::initializer_list&lt;/code&gt;与可迭代类型&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;PriorityQueue(std::initializer_list&amp;lt;T&amp;gt; il, Compare cmp = {}) : PriorityQueue(il.begin(), il.end(), cmp) {}
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template&amp;lt;typename Container&amp;gt; using UniIter = std::conditional_t&amp;lt;
            std::is_rvalue_reference_v&amp;lt;Container&amp;gt;,
            std::move_iterator&amp;lt;typename std::decay_t&amp;lt;Container&amp;gt;::iterator&amp;gt;,
            typename std::decay_t&amp;lt;Container&amp;gt;::iterator&amp;gt;;
template&amp;lt;typename Container&amp;gt; explicit
PriorityQueue(Container &amp;amp;&amp;amp;container, Compare cmp = {}): PriorityQueue(
    UniIter&amp;lt;decltype(container)&amp;gt;(container.begin()), UniIter&amp;lt;decltype(container)&amp;gt;(container.end()), cmp) {}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这样就完成啦&lt;/p&gt;
&lt;p&gt;&lt;code&gt;code&lt;/code&gt;: &lt;a href=&#34;https://github.com/zixfy/cpp-algorithm/blob/main/data-structure/priority_queue.hpp&#34;&gt;Github&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;使用例：&lt;code&gt;pair&lt;/code&gt;的小根堆&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;int main() {
    std::mt19937 rng{std::random_device{}()};
    auto q1 = PriorityQueue&amp;lt;std::pair&amp;lt;int, int&amp;gt;, std::greater&amp;lt;&amp;gt;&amp;gt;{{114, 514}, {1919, 810}};
    for (int i = 0; i &amp;lt; 17; i++)
        q1.emplace(rng() % 4, rng() % 100);
    while (!q1.empty()) {
        auto [a, b] = q1.pop();
        cout &amp;lt;&amp;lt; &amp;quot;(&amp;quot; &amp;lt;&amp;lt; a &amp;lt;&amp;lt; &amp;quot;, &amp;quot; &amp;lt;&amp;lt; b &amp;lt;&amp;lt; &amp;quot;), &amp;quot;;
    }
}
// (0, 57), (0, 89), (1, 4), (1, 29), (1, 40), (1, 42), (1, 50), (2, 3), (2, 23), (2, 57), (2, 65), (2, 75), (3, 0), (3, 26), (3, 85), (3, 86), (3, 87), (114, 514), (1919, 810), 
&lt;/code&gt;&lt;/pre&gt;
">C++手写优先队列</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/c-di-gui-lambda-shi/"" data-c="
          &lt;p&gt;原文：&lt;a href=&#34;https://zhuanlan.zhihu.com/p/659147057&#34;&gt;zhihu&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;首先，什么是&lt;code&gt;lambda&lt;/code&gt;？&lt;/p&gt;
&lt;p&gt;是闭包，是函数对象（重载了&lt;code&gt;operator()&lt;/code&gt;的类型），是一种持有状态的函数&lt;/p&gt;
&lt;p&gt;当写下&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;auto a = 2;
auto f = [&amp;amp;](int x) {return a * x;};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;时，编译器会把代码翻译成大概下面这样，生成一个匿名类（&lt;a href=&#34;https://cppinsights.io/&#34;&gt;https://cppinsights.io/&lt;/a&gt;翻译的结果）&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;int a = 2;

class __lambda_6_12
{
    public: 
    inline /*constexpr */ int operator()(int x) const
    {
        return a * x;
    }

    private: 
    int &amp;amp; a;

    public:
    __lambda_6_12(int &amp;amp; _a)
        : a{_a}
    {}

};

__lambda_6_12 f = __lambda_6_12{a};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;lambda&lt;/code&gt;的优点在于简化了函数对象的编码，把函数对象定义在了调用处，同时减少了命名（无需类型命名，只需命名变量或无需命名），如果不打算重用函数，比如&lt;code&gt;std::thread&lt;/code&gt;构造函数传入的线程运行函数，可以考虑&lt;code&gt;lambda&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;但如果&lt;code&gt;lambda&lt;/code&gt;一定需要递归实现呢？&lt;/p&gt;
&lt;p&gt;比如说下文中我们想实现一个递归打印数字的&lt;code&gt;count_down&lt;/code&gt;函数，其中分隔符&lt;code&gt;sep&lt;/code&gt;不是固定的&lt;/p&gt;
&lt;p&gt;对于常规函数与函数对象（闭包），可以维护一个全局变量或成员变量&lt;code&gt;sep&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;std::string sep = get_sep();
auto count_down(int x) -&amp;gt; std::string  
    return x == 0 ? &amp;quot;0&amp;quot; : std::to_string(x) + sep + count_down(x - 1);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;或者把&lt;code&gt;sep&lt;/code&gt;作为一个额外形参&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;auto count_down(int x, std::string const&amp;amp; sep) -&amp;gt; std::string { 
    return  x == 0 ? &amp;quot;0&amp;quot; : std::to_string(x) + sep + count_down(x - 1, sep);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;而对于&lt;code&gt;lambda&lt;/code&gt;，我们可以首先尝试一下把&lt;code&gt;lambda&lt;/code&gt;式变量名按引用捕获到&lt;code&gt;lambda&lt;/code&gt;函数体里面&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;std::string sep = get_sep();
auto count_down = [&amp;amp;](int x) -&amp;gt; std::string { 
    return  x == 0 ? &amp;quot;0&amp;quot; : std::to_string(x) + sep + count_down(x - 1);
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;oops&lt;/code&gt;.. 编译失败了，报错是&lt;/p&gt;
&lt;p&gt;&lt;code&gt;error: variable &#39;count_down&#39; declared with deduced type &#39;auto&#39; cannot appear in its own initializer&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;因为我们需要把右侧匿名的&lt;code&gt;lambda&lt;/code&gt;赋值给左侧&lt;code&gt;auto&lt;/code&gt;的变量&lt;code&gt;count_down&lt;/code&gt;，而对于编译器，需要解析完赋值表达式的右侧才能确定&lt;code&gt;auto&lt;/code&gt;对应的&lt;code&gt;lambda&lt;/code&gt;类型，所以我们在函数体里使用类型未定的&lt;code&gt;count_down&lt;/code&gt;自身时，很不幸，编译器拒绝了类型推导&lt;/p&gt;
&lt;p&gt;所以问题在于在递归调用时需要确定&lt;code&gt;lambda&lt;/code&gt;本身的类型&lt;/p&gt;
&lt;p&gt;第一种解决方案，使用&lt;code&gt;std::function&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;std::string sep{&amp;quot;, &amp;quot;}
std::function&amp;lt;std::string(int)&amp;gt; count_down = [&amp;amp;](int x) -&amp;gt; std::string { 
    return  x == 0 ? &amp;quot;0&amp;quot; : std::to_string(x) + sep + count_down(x - 1);
};
cout &amp;lt;&amp;lt; count_down(5);
//5, 4, 3, 2, 1, 0
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;可以编译了的原因是&lt;code&gt;std::function&lt;/code&gt;对象内部存储了&lt;code&gt;lambda&lt;/code&gt;可调用对象，&lt;code&gt;std::function&lt;/code&gt;调用&lt;code&gt;operator()&lt;/code&gt;时，会把实参完美转发到内部的可调用对象，由于指定了&lt;code&gt;std::function&lt;/code&gt;的模板参数类型，我们回避了匿名类型的问题&lt;/p&gt;
&lt;p&gt;然而这里有两个小问题&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;由于&lt;code&gt;lambda&lt;/code&gt;存在&lt;code&gt;function&lt;/code&gt;里，递归的调用链是&lt;code&gt;function-&amp;gt;lambda-&amp;gt;function-&amp;gt;lambda-&amp;gt;...&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;函数签名重复写了两次，太丑了&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;好在&lt;code&gt;C++14&lt;/code&gt;支持了泛型&lt;code&gt;lambda&lt;/code&gt;，回想下问题在于在&lt;code&gt;lambda&lt;/code&gt;递归调用时需要确定本身的类型，那我们其实只给&lt;code&gt;lambda&lt;/code&gt;多加一个指向自身的泛型形参就好了，实现如下&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt; auto count_down = [impl = [&amp;amp;](auto const &amp;amp;self, int x) -&amp;gt; std::string {
    return x == 0 ? &amp;quot;0&amp;quot; : std::to_string(x) + sep + self(self, x - 1);
}](auto &amp;amp;&amp;amp;...args) {
    return impl(impl, std::forward&amp;lt;decltype(args)&amp;gt;(args)...);
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;思路就是把&lt;code&gt;lambda&lt;/code&gt;式存在另一个闭包里，闭包调用时，调用实际的递归函数，同时把它自身的引用作为第一个参数，这样实际上&lt;code&gt;lambda&lt;/code&gt;对象只是不断递归调用自身&lt;/p&gt;
&lt;p&gt;当然这么写还是麻烦，我们把生成新闭包和转发实参的部分也写成一个如下的泛型&lt;code&gt;lambda&lt;/code&gt;（函数装饰器）&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt; auto recursive_lambda = [](auto &amp;amp;&amp;amp;lam) {
     return [lam_impl = std::forward&amp;lt;decltype(lam)&amp;gt;(lam)](auto &amp;amp;&amp;amp;...args) {
         return lam_impl(lam_impl, std::forward&amp;lt;decltype(args)&amp;gt;(args)...);
     };
 };
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这样就实现了递归&lt;code&gt;lambda&lt;/code&gt;式&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;std::string sep{&amp;quot;...&amp;quot;};  
auto count_down = recursive_lambda([&amp;amp;](auto const &amp;amp;self, int x) -&amp;gt; std::string  { 
    return x == 0 ? &amp;quot;0&amp;quot; : std::to_string(x) + sep + self(self, x - 1);
});
cout &amp;lt;&amp;lt; count_down(5);
//10...9...8...7...6...5...4...3...2...1...0 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;注意上述&lt;code&gt;recursive_lambda&lt;/code&gt;使用时，如果返回类型不是&lt;code&gt;void&lt;/code&gt;，需要在&lt;code&gt;lambda&lt;/code&gt;形参之后，函数体之前使用&lt;code&gt;-&amp;gt;&lt;/code&gt;尾置返回类型&lt;/p&gt;
">【c++】递归lambda式</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/c-kuai-su-pai-xu/"" data-c="
          &lt;p&gt;快速排序的方法是给定待排序数组&lt;code&gt;vec&lt;/code&gt;，首先从&lt;code&gt;vec&lt;/code&gt;中选取一个基准值&lt;code&gt;base&lt;/code&gt;，然后根据基准值划分数组，再递归排序子数组，伪码如下，当然这个伪码中重新分配了数组，带来了时空开销，基准值划分数组时，最好是原地进行的&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;def quick_sort(arr: List[T]) -&amp;gt; List[T]:
    if len(arr) &amp;lt;= 1:
        return arr
    base: T = arr[len(arr) // 2]
    left: List[T] = [x for x in arr if x &amp;lt; base]
    middle: List[T] = [x for x in arr if x == base]
    right: List[T] = [x for x in arr if x &amp;gt; base]
    return quick_sort(left) + middle + quick_sort(right)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;原地划分数组可以使用填坑法: &lt;a href=&#34;https://www.runoob.com/w3cnote/quick-sort.html&#34;&gt;link&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;当然这种方法很丑，可以看到循环里判断了&lt;code&gt;5&lt;/code&gt;次&lt;code&gt;i &amp;lt; j&lt;/code&gt;，因为这里维护划分数组的形式为&lt;code&gt;&amp;lt;&lt;/code&gt;基准值的、基准值本身、除了基准值本身&lt;code&gt;&amp;gt;=&lt;/code&gt;基准值的三部分&lt;/p&gt;
&lt;p&gt;但这里主要的问题是基准值选取的位置是固定的，对于&lt;code&gt;[1, 2, 3, .. N]&lt;/code&gt;或&lt;code&gt;[N, N-1, N-2, .. 1]&lt;/code&gt;之类的输入，时间复杂度会从估计的&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;NlogN&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.8888799999999999em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.01968em;&#34;&gt;l&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;上升到&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msup&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;N^2&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.8141079999999999em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.8141079999999999em;&#34;&gt;&lt;span style=&#34;top:-3.063em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c&#34;&gt;void quick_sort(int s[], int l, int r)
{
    if (l &amp;lt; r)
    {
        //Swap(s[l], s[(l + r) / 2]); //将中间的这个数和第一个数交换 参见注1
        int i = l, j = r, x = s[l];
        while (i &amp;lt; j)
        {
            while(i &amp;lt; j &amp;amp;&amp;amp; s[j] &amp;gt;= x) // 从右向左找第一个小于x的数
                j--;  
            if(i &amp;lt; j) 
                s[i++] = s[j];
            
            while(i &amp;lt; j &amp;amp;&amp;amp; s[i] &amp;lt; x) // 从左向右找第一个大于等于x的数
                i++;  
            if(i &amp;lt; j) 
                s[j--] = s[i];
        }
        s[i] = x;
        quick_sort(s, l, i - 1); // 递归调用 
        quick_sort(s, i + 1, r);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;首先我们也可以只分为两部分,&lt;code&gt;&amp;gt;=&lt;/code&gt;基准值的和&lt;code&gt;&amp;lt;=&lt;/code&gt;基准值的，这样循环只要遍历一次，根据当前元素与基准的大小关系判断即可&lt;/p&gt;
&lt;p&gt;问题在于如何处理等于基准值的部分？&lt;/p&gt;
&lt;p&gt;当然是&lt;strong&gt;不能&lt;/strong&gt;随意放到某一部分的，因为只分成两个子数组，可能在以下情况无限递归&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;如果数组中元素全相同，而我们将等于基准值的部分都放到同一子数组&lt;/li&gt;
&lt;li&gt;如果基准值选取的位置是固定，而且每次选中唯一的最大值或唯一的最小值&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;针对以上问题&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;如果数组中某个位置等于基准值，贪心地划分到元素较少的子数组&lt;/li&gt;
&lt;li&gt;随机选取基准值&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;由于随机选取基准值，时间复杂度也许更接近理论的&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;NlogN&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.8888799999999999em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.01968em;&#34;&gt;l&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;一个&lt;code&gt;C++&lt;/code&gt;模板实现如下&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;typename Iter, typename Compare = std::less&amp;lt;typename Iter::value_type&amp;gt;, typename RandomEngineT = std::mt19937&amp;gt;
void quick_sort(Iter left, Iter right, Compare cmp = {}) {
    static std::random_device rd{};
    static RandomEngineT rng{rd()};
    auto length = std::distance(left, right);
    if (length &amp;lt; 2)
        return;
    // [left, right)
    std::swap(*(left + rng() % length), *left);
    auto&amp;amp; base = *left;
    auto iter1 = left + 1, iter2 = right - 1;
    // [left, iter1), (iter2, right)
    while (iter1 &amp;lt;= iter2) {
        if (cmp(*iter1, base) || (!cmp(base, *iter1) &amp;amp;&amp;amp; std::distance(left, iter1) &amp;lt; std::distance(iter2, right)))
            ++iter1;
        else
            std::swap(*iter1, *(iter2--));
    }
    quick_sort(left, iter1);
    quick_sort(iter2 + 1, right);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;首先我们定义形参为左闭右开的迭代器&lt;code&gt;[left, right)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;定义左右数组范围分别为左闭右开、左开右开的迭代器&lt;code&gt;[left, iter1), (iter2, right)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;当&lt;code&gt;iter1 &amp;lt;= iter2&lt;/code&gt;时，说明还有元素没划分，当&lt;code&gt;*iter1&lt;/code&gt;小于基准值&lt;code&gt;base&lt;/code&gt;，或相等且左边子数组更短时划分到&lt;code&gt;[left, iter1)&lt;/code&gt;，否则划分到&lt;code&gt;(iter2, right)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;这里写成&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;    std::swap(*(left + rng() % length), *left);
    auto&amp;amp; base = *left;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;而不是&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;    auto  base = *(left + rng() % length);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;是为了支持排序元素类型&lt;code&gt;Iter::value_type&lt;/code&gt;只可移动不可复制（如&lt;code&gt;std::unique_ptr&lt;/code&gt;）的情况&lt;/p&gt;
&lt;p&gt;同时为了降低递归次数，考虑如果数组只有两个元素&lt;code&gt;[a,b]&lt;/code&gt; 且&lt;code&gt;a != b&lt;/code&gt; 时，根据代码中的策略，有&lt;code&gt;1/2&lt;/code&gt; 的概率把两个数都分到左边，重新再在&lt;code&gt;[a,b]&lt;/code&gt; 上递归一次&lt;/p&gt;
&lt;p&gt;也就是说数组中元素较少时，我们更容易选中唯一的最大值或唯一的最小值，导致取随机数和递归的开销增加，但是数组中元素较少时，本身有序的概率也更大。所以元素小于&lt;code&gt;10&lt;/code&gt; 的时候，直接冒泡排序&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230930192550.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;以上优化过的快排在&lt;a href=&#34;https://leetcode.cn/problems/sort-an-array/submissions/470590957/&#34;&gt;leetcode-912.&lt;/a&gt;中时间开销可以达到&lt;code&gt;104ms&lt;/code&gt; ，和直接&lt;code&gt;std::sort&lt;/code&gt;（&lt;code&gt;112ms&lt;/code&gt;）差不多&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;使用例&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;Copyable&lt;/code&gt;类型&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;vector v{321, 23, -2, 0, 9, -2, 89, 17};
quick_sort(v.begin(), v.end());
for (auto c : v)
    cout &amp;lt;&amp;lt; c &amp;lt;&amp;lt; &amp;quot;, &amp;quot;;
// -2, -2, 0, 9, 17, 23, 89, 321,
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;&lt;code&gt;only-movable&lt;/code&gt;类型&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;vector&amp;lt;std::unique_ptr&amp;lt;int&amp;gt;&amp;gt; vv{};
vv.emplace_back(new int(2));
vv.emplace_back(new int(1));
vv.emplace_back(new int(3));
quick_sort(vv.begin(), vv.end(), [](auto const&amp;amp;a, auto const&amp;amp; b) {
    return *a &amp;lt; *b;
});
for (auto&amp;amp; c : vv)
    cout &amp;lt;&amp;lt; *c &amp;lt;&amp;lt; &amp;quot;, &amp;quot;;
// 1, 2, 3,
&lt;/code&gt;&lt;/pre&gt;
">【C++】快速排序</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/shu-ju-jie-gou-aa-shu/"" data-c="
          &lt;p&gt;&lt;strong&gt;Reference:&lt;/strong&gt;&lt;br&gt;
&lt;a href=&#34;https://blog.xehoth.cc/AATree/&#34;&gt;https://blog.xehoth.cc/AATree/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://oi-wiki.org/ds/aa-tree/&#34;&gt;https://oi-wiki.org/ds/aa-tree/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/AA_tree&#34;&gt;https://en.wikipedia.org/wiki/AA_tree&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;1-树高维护&#34;&gt;1. 树高维护&lt;/h3&gt;
&lt;p&gt;.todo&lt;/p&gt;
&lt;h3 id=&#34;2-增删旋转&#34;&gt;2. 增删旋转&lt;/h3&gt;
&lt;p&gt;.todo&lt;/p&gt;
&lt;h3 id=&#34;3-code&#34;&gt;3. Code&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;//
// Created by wwww on 2023/9/24.
//

#ifndef CPP_ADVANCED_CONTAINER_TEMPLATE_AA_TREESET_HPP
#define CPP_ADVANCED_CONTAINER_TEMPLATE_AA_TREESET_HPP

#include &amp;lt;algorithm&amp;gt;
#include &amp;lt;vector&amp;gt;
#include  &amp;lt;memory&amp;gt;

template&amp;lt;typename Key, typename Compare = std::less&amp;lt;Key&amp;gt;&amp;gt;
class AATree {

private:
    struct Node;

public:
    explicit AATree(Compare cmp = Compare{}) : _size{0}, _cmp{cmp}, _root{nullptr} {}

    ~AATree() { delete _root; }

    [[nodiscard]] inline std::size_t size() const { return _size; }

    [[nodiscard]] inline bool empty() const { return _size == 0; }

    inline Key min() {
        return _min(_root);
    }

    inline Key max() {
        return _max(_root);
    }

    void clear() {
        delete _root;
        _root = nullptr;
        _size = 0;
    }

    bool contains(const Key &amp;amp;key) {
        // BST search
        auto current = _root;
        while (current != nullptr) {
            if (_cmp(key, current-&amp;gt;key))
                current = current-&amp;gt;left;
            else if (_cmp(current-&amp;gt;key, key))
                current = current-&amp;gt;right;
            else return true;
        }
        return false;
    }

    inline bool insert(const Key &amp;amp;key) {
        return _insert(_root, key);
    }

    inline bool erase(const Key &amp;amp;key) {
        return _erase(_root, key);
    }

private:
    struct Node {
        Key key;
        int level;
        Node *left, *right;

        ~Node() {
            delete left;
            delete right;
        }

        Node *detach() {
            left = right = nullptr;
            return this;
        }
    };

    Compare _cmp;
    std::size_t _size;
    Node *_root;

    Key _min(Node *current) const {
        auto p = current;
        while (p-&amp;gt;left != nullptr)
            p = p-&amp;gt;left.get();
        return p-&amp;gt;key;
    }

    Key _max(Node *current) const {
        auto p = current;
        while (p-&amp;gt;right != nullptr)
            p = p-&amp;gt;right.get();
        return p-&amp;gt;key;
    }

    inline void _split(Node *&amp;amp;current) {
        if (current == nullptr)
            return;
        auto right_child = current-&amp;gt;right;
        if (right_child != nullptr &amp;amp;&amp;amp; right_child-&amp;gt;right != nullptr &amp;amp;&amp;amp;
            right_child-&amp;gt;right-&amp;gt;level == current-&amp;gt;level) {
            current-&amp;gt;right = right_child-&amp;gt;left;
            right_child-&amp;gt;left = current;

            current = right_child;
            ++current-&amp;gt;level;
        }
    }

    inline void _skew(Node *&amp;amp;current) {
        if (current == nullptr)
            return;
        auto left_child = current-&amp;gt;left;
        if (left_child != nullptr &amp;amp;&amp;amp; left_child-&amp;gt;level == current-&amp;gt;level) {
            current-&amp;gt;left = left_child-&amp;gt;right;
            left_child-&amp;gt;right = current;

            current = left_child;
        }
    }

    bool _insert(Node *&amp;amp;current, const Key &amp;amp;key) {
        auto has_inserted = false;
        if (current == nullptr) {
            current = new Node{key, 1, nullptr, nullptr};
            ++_size;
            has_inserted = true;
        } else if (_cmp(key, current-&amp;gt;key))
            has_inserted = _insert(current-&amp;gt;left, key);
        else if (_cmp(current-&amp;gt;key, key))
            has_inserted = _insert(current-&amp;gt;right, key);
        _skew(current);
        _split(current);
        return has_inserted;
    }

    void _maintain_after_erase(Node *&amp;amp;current) {
        auto left_child = current-&amp;gt;left, right_child = current-&amp;gt;right;
        auto left_level = (left_child != nullptr) ? left_child-&amp;gt;level : 0;
        auto right_level = (right_child != nullptr) ? right_child-&amp;gt;level : 0;
        if ((left_level &amp;lt; current-&amp;gt;level - 1) ||
            (right_level &amp;lt; current-&amp;gt;level - 1)) {
            --current-&amp;gt;level;
            if (right_child != nullptr &amp;amp;&amp;amp; (right_level &amp;gt; current-&amp;gt;level))
                right_child-&amp;gt;level = current-&amp;gt;level;
            _skew(current);
            _skew(current-&amp;gt;right);
            if (current-&amp;gt;right != nullptr)
                _skew(current-&amp;gt;right-&amp;gt;right);
            _split(current);
            _split(current-&amp;gt;right);
        }

    }

    bool _erase(Node *&amp;amp;current, const Key &amp;amp;key) {
        if (nullptr == current)
            return false;
        if (_cmp(key, current-&amp;gt;key)) {
            // case &amp;lt;
            auto has_erased = _erase(current-&amp;gt;left, key);
            if (has_erased)
                _maintain_after_erase(current);
            return has_erased;
        } else if (_cmp(current-&amp;gt;key, key)) {
            // case &amp;gt;
            auto has_erased = _erase(current-&amp;gt;right, key);
            if (has_erased)
                _maintain_after_erase(current);
            return has_erased;
        }
        // case ==
        if ((current-&amp;gt;left == nullptr) || (current-&amp;gt;right == nullptr)) {
            // no more than 2 children
            auto old = current;
            current = (current-&amp;gt;left == nullptr) ? current-&amp;gt;right : current-&amp;gt;left;
            old = old-&amp;gt;detach();
            delete old;
            --_size;
        } else {
            // have 2 children
            auto next = current-&amp;gt;right;
            while (next-&amp;gt;left != nullptr)
                next = next-&amp;gt;left;
            current-&amp;gt;key = next-&amp;gt;key;
            _erase(current-&amp;gt;right, next-&amp;gt;key);
            _maintain_after_erase(current);
        }
        return true;
    }
};

#endif //CPP_ADVANCED_CONTAINER_TEMPLATE_AA_TREESET_HPP


&lt;/code&gt;&lt;/pre&gt;
">【TODO】【数据结构】(红黑树变体)AA树</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/todo-shu-ju-jie-gou-zuo-pian-hong-hei-shu/"" data-c="
          &lt;p&gt;.todo&lt;/p&gt;
">【TODO】【数据结构】左偏红黑树</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/todo-shu-ju-jie-gou-skiplist/"" data-c="
          &lt;p&gt;.todo&lt;/p&gt;
">【TODO】【数据结构】Skiplist</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/todo-c-http-bao-wen-jie-xi/"" data-c="
          &lt;h3 id=&#34;1-http协议格式&#34;&gt;1. HTTP协议格式&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;HTTP&lt;/code&gt;协议（超文本传输协议&lt;code&gt;HyperText Transfer Protocol&lt;/code&gt;）是一种应用层的网络协议，传输层利用&lt;code&gt;TCP&lt;/code&gt;协议。&lt;code&gt;HTTP&lt;/code&gt;协议是&lt;code&gt;Web&lt;/code&gt;应用客户端和服务端进行数据传输的基本协议&lt;/p&gt;
&lt;p&gt;&lt;code&gt;HTTP&lt;/code&gt;报文格式上不同部分由&lt;code&gt;\r\n&lt;/code&gt;分隔，分为一行请求行（&lt;code&gt;Request Line&lt;/code&gt;），多行头部字段（&lt;code&gt;Headers&lt;/code&gt;），数据（&lt;code&gt;Content&lt;/code&gt;，长度由头部的&lt;code&gt;Content-Length&lt;/code&gt;决定）&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230921144303.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;HTTP&lt;/code&gt;是一种无状态（&lt;code&gt;stateless&lt;/code&gt;）协议，但可以引入&lt;code&gt;Cookie&lt;/code&gt;等字段维护客户端状态，使用&lt;code&gt;HTTP/1.1&lt;/code&gt;的&lt;code&gt;keep-alive&lt;/code&gt; 建立长连接以持久化通信状态。&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230921144320.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;2-http请求解析&#34;&gt;2. HTTP请求解析&lt;/h3&gt;
&lt;p&gt;我在使用&lt;code&gt;C++&lt;/code&gt;编写一个静态&lt;code&gt;web&lt;/code&gt;服务器时，首先要考虑的是如何从&lt;code&gt;TCP&lt;/code&gt;字节流中解析出请求信息&lt;/p&gt;
&lt;p&gt;&lt;code&gt;TCP&lt;/code&gt;是面向字节流的，也就是说传输时候数据像“水流一样”，是没有边界的，因此从&lt;code&gt;TCP socket&lt;/code&gt;完成一次&lt;code&gt;read()&lt;/code&gt;读取后，可能得到的是不完整的&lt;code&gt;HTTP&lt;/code&gt;请求&lt;/p&gt;
&lt;p&gt;因此先声明一个枚举类&lt;code&gt;http::IOState&lt;/code&gt;表示当前解析&lt;code&gt;HTTP&lt;/code&gt;请求的状态，&lt;code&gt;OK&lt;/code&gt;：完成，&lt;code&gt;PENDING&lt;/code&gt;：需要继续从客户端读，&lt;code&gt;BAD&lt;/code&gt;：报文格式错误&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;enum class IOState { OK, PENDING, BAD, KEEP_ALIVE };
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;声明&lt;code&gt;Http Request&lt;/code&gt;结构体，存储关心的头部字段&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;struct Request {
  std::string_view url, version, host, method;
  size_t content_length{0};
  bool keep_alive{false};
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;有说过服务端从客户端&lt;code&gt;socket&lt;/code&gt;读&lt;code&gt;HTTP&lt;/code&gt;请求时，可能一次读不完，所以一般用一个&lt;code&gt;char[]&lt;/code&gt;或&lt;code&gt;std::string&lt;/code&gt;缓存用户发送的数据，为了可读性与性能，选择使用视图类&lt;code&gt;std::string_view&lt;/code&gt;作为解析器类&lt;code&gt;RequestParser&lt;/code&gt;接口的形参类型&lt;/p&gt;
&lt;p&gt;&lt;code&gt;RequestParser&lt;/code&gt;暴露接口为&lt;code&gt;upwrap&lt;/code&gt;（返回请求解析结果）与&lt;code&gt;update&lt;/code&gt;（解析传入接受客户端缓存区的&lt;code&gt;char[]&lt;/code&gt;或&lt;code&gt;std::string&lt;/code&gt;，如果返回&lt;code&gt;PENDING&lt;/code&gt;说明需要继续读客户端更新缓存区，再调用&lt;code&gt;update&lt;/code&gt;），内部维护&lt;code&gt;m_pivot&lt;/code&gt;作为客户端缓存区上的指针，随解析的过程后移；同时记录当前在解析报文的哪一部分（&lt;code&gt;ProtocolState&lt;/code&gt;）&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;class RequestParser {
private:
  Request m_request{};
  size_t m_pivot{0};
  enum class ProtocolState {
    ON_REQUEST_LINE,
    ON_HEADERS,
    ON_CONTENT
  } m_protocol_state{ProtocolState::ON_REQUEST_LINE};
  IOState parse_request_line(std::string_view);
  IOState parse_header_line(std::string_view);
  IOState parse_content(std::string_view);
  std::pair&amp;lt;IOState, std::string_view&amp;gt; next_line(std::string_view);

public:
  inline const Request &amp;amp;unwrap() { return m_request; };
  IOState update(std::string_view);
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;首先实现从&lt;code&gt;m_pivot&lt;/code&gt;开始解析出一行内容的&lt;code&gt;next_line&lt;/code&gt;，行间的分隔是&lt;code&gt;\r\n&lt;/code&gt;，而不是&lt;code&gt;\n&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;auto RequestParser::next_line(std::string_view text)
    -&amp;gt; std::pair&amp;lt;IOState, std::string_view&amp;gt; { 
  auto len = text.size();
  for (auto i = m_pivot; i &amp;lt; len; ++i) {
    auto c = text[i];
    if (c == &#39;\r&#39;) {
      if (i + 1 == len)
        return {IOState::PENDING, {}};
      else if (text[i + 1] == &#39;\n&#39;) {
        std::string_view line{text.data() + m_pivot, i - m_pivot}; 
        m_pivot = i + 2;
        return {IOState::OK, line};
      }
      return {IOState::BAD, {}};
    }
  }
  return {IOState::PENDING, {}};
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;HTTP&lt;/code&gt;请求各部分间的状态转移&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;auto RequestParser::update(std::string_view text) -&amp;gt; IOState {
  while (true) {
    switch (m_protocol_state) {
    case ProtocolState::ON_REQUEST_LINE: {
      auto state = parse_request_line(text);
      if (state != IOState::OK)
        return state;
      break;
    }
    case ProtocolState::ON_HEADERS: {
      auto state = parse_header_line(text);
      if (state != IOState::OK)
        return state;
      break;
    }
    case ProtocolState::ON_CONTENT: {
      return parse_content(text);
    }
    }
  }
  return IOState::PENDING;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;请求行只需&lt;code&gt;split&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;auto RequestParser::parse_request_line(std::string_view text) -&amp;gt; IOState {
  auto [state, line] = next_line(text); 
  if (state != IOState::OK)
    return state;
  auto end_of_method = line.find_first_of(&amp;quot; \t&amp;quot;);
  if (end_of_method == decltype(line)::npos)
    return IOState::BAD;
  auto end_of_url = text.find_first_of(&amp;quot; \t&amp;quot;, end_of_method + 1);
  if (end_of_url == decltype(line)::npos)
    return IOState::BAD;
  m_request.method = std::string_view{line.data(), end_of_method};
  m_request.url = std::string_view{line.data() + end_of_method + 1,
                                   end_of_url - end_of_method - 1};
  m_request.version = std::string_view{line.data() + end_of_url + 1,
                                       line.size() - end_of_url - 1};
  m_protocol_state = ProtocolState::ON_HEADERS;
  return IOState::OK;
}

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;头部各行都是&lt;code&gt;key : value\r\n&lt;/code&gt;的格式&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;auto RequestParser::parse_header_line(std::string_view text) -&amp;gt; IOState {
  constexpr static std::string_view CONNECTION_PREFIX = &amp;quot;Connection&amp;quot;,
                                    CONTENT_LENGTH_PREFIX = &amp;quot;Content-Length&amp;quot;,
                                    HOST_PREFIX = &amp;quot;Host&amp;quot;;
  auto [state, line] = next_line(text); 
  if (state != IOState::OK)
    return state;

  // end of headers
  if (line.empty()) {
    m_protocol_state = ProtocolState::ON_CONTENT;
    return IOState::OK;
  }

  auto sep = line.find_first_of(&#39;:&#39;);
  if (sep == decltype(line)::npos)
    return IOState::BAD;
  auto start_of_value = line.find_first_not_of(&amp;quot; \t&amp;quot;, sep + 1);
  if (start_of_value == decltype(line)::npos)
    return IOState::BAD;
  auto field = std::string_view{line.data(), sep};
  auto value = std::string_view{line.data() + start_of_value,
                                line.size() - start_of_value};
  if (CONNECTION_PREFIX == field) {
    m_request.keep_alive = (value == &amp;quot;keep-alive&amp;quot;); 
  } else if (CONTENT_LENGTH_PREFIX == field)
    m_request.content_length = std::atoi(value.data());
  else if (HOST_PREFIX == field)
    m_request.host = value;
  else
    ; 
  return IOState::OK;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;并不需要关心&lt;code&gt;Content&lt;/code&gt;部分内部是否换行，只要读取的&lt;code&gt;Content&lt;/code&gt;部分长度达到了&lt;code&gt;Content-Length&lt;/code&gt;，就说明已经读入并解析了一个完整的&lt;code&gt;HTTP&lt;/code&gt;请求&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;auto RequestParser::parse_content(std::string_view text) -&amp;gt; IOState {
  if (m_request.content_length + m_pivot &amp;lt; text.size())
    return IOState::PENDING;
  return IOState::OK;
}
&lt;/code&gt;&lt;/pre&gt;
">【C++】HTTP报文解析</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/c-stdpair-stdtuple-ha-xi/"" data-c="
          &lt;p&gt;一般不能将函数/类注入&lt;code&gt;namespace std&lt;/code&gt;，但模板函数对象类&lt;code&gt;std::hash&lt;/code&gt;是一个例外&lt;br&gt;
为了能使用&lt;code&gt;std::pair / std::tuple&lt;/code&gt;作为哈希表的键值与哈希集合的元素，需要特化&lt;code&gt;std::hash&lt;/code&gt;函数对象（&lt;code&gt;operator()&lt;/code&gt;返回&lt;code&gt;std::size_t&lt;/code&gt;的哈希值），&lt;code&gt;std::pair / std::tuple&lt;/code&gt;包含了多个元素，参与到哈希值计算中的元素都相同时，哈希值相同，所以每个元素都应该参与到哈希值计算中。&lt;/p&gt;
&lt;p&gt;采用&lt;code&gt;boost::hash_combine&lt;/code&gt;的实现，先定义一个辅助函数组合总体哈希值与某一元素的哈希值&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;namespace std {
namespace {
template &amp;lt;typename T&amp;gt; inline void hash_combine(std::size_t &amp;amp;seed, T const &amp;amp;v) {
  seed ^= hash&amp;lt;T&amp;gt;()(v) + 0x9e3779b9 + (seed &amp;lt;&amp;lt; 6) + (seed &amp;gt;&amp;gt; 2);
}
}// namespace  
}// namespace std
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;std::pair&lt;/code&gt;的哈希特化是简单的，因为&lt;code&gt;std::pair&lt;/code&gt;定长为&lt;code&gt;2&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;namespace std { 
template &amp;lt;typename U, typename V&amp;gt; struct hash&amp;lt;std::pair&amp;lt;U, V&amp;gt;&amp;gt; {
  size_t operator()(std::pair&amp;lt;U, V&amp;gt; const &amp;amp;tt) const {
    size_t seed = 0;
    hash_combine(seed, tt.first);
    hash_combine(seed, tt.second);
    return seed;
  }
};
} // namespace std
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;对于变长的&lt;code&gt;std::tuple&lt;/code&gt;，可以使用&lt;code&gt;std::apply&lt;/code&gt;解构&lt;code&gt;std::tuple&lt;/code&gt;，&lt;code&gt;std::apply&lt;/code&gt;会将&lt;code&gt;tuple&lt;/code&gt;中每一个元素完美转发到&lt;code&gt;f&lt;/code&gt;的形参上，而&lt;code&gt;f&lt;/code&gt;是&lt;code&gt;std::apply&lt;/code&gt;第一个实参。&lt;code&gt;f&lt;/code&gt;参数长度不确定，可以使用变长模板参数的&lt;code&gt;lambda&lt;/code&gt;来接&lt;code&gt;tuple&lt;/code&gt;中的元素&lt;code&gt;...x&lt;/code&gt;，函数体内部再用折叠表达式展开一个逗号表达式，其子表达式调用&lt;code&gt;hash_combine(seed, x)&lt;/code&gt;即可&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;namespace std { 
template &amp;lt;typename... TT&amp;gt; struct hash&amp;lt;std::tuple&amp;lt;TT...&amp;gt;&amp;gt; {
  size_t operator()(std::tuple&amp;lt;TT...&amp;gt; const &amp;amp;tt) const {
    size_t seed = 0;
    std::apply([&amp;amp;seed](auto &amp;amp;&amp;amp;...x) { ((hash_combine(seed, x)), ...); }, tt);
    return seed;
  }
};
} // namespace std
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;完整代码&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;#include &amp;lt;tuple&amp;gt;
namespace std {
namespace {
template &amp;lt;typename T&amp;gt; inline void hash_combine(std::size_t &amp;amp;seed, T const &amp;amp;v) {
  seed ^= hash&amp;lt;T&amp;gt;()(v) + 0x9e3779b9 + (seed &amp;lt;&amp;lt; 6) + (seed &amp;gt;&amp;gt; 2);
}
} // namespace

template &amp;lt;typename... TT&amp;gt; struct hash&amp;lt;std::tuple&amp;lt;TT...&amp;gt;&amp;gt; {
  size_t operator()(std::tuple&amp;lt;TT...&amp;gt; const &amp;amp;tt) const {
    size_t seed = 0;
    std::apply([&amp;amp;seed](auto &amp;amp;&amp;amp;...x) { ((hash_combine(seed, x)), ...); }, tt);
    return seed;
  }
};

template &amp;lt;typename U, typename V&amp;gt; struct hash&amp;lt;std::pair&amp;lt;U, V&amp;gt;&amp;gt; {
  size_t operator()(std::pair&amp;lt;U, V&amp;gt; const &amp;amp;tt) const {
    size_t seed = 0;
    hash_combine(seed, tt.first);
    hash_combine(seed, tt.second);
    return seed;
  }
};
} // namespace std
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;使用例&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;#include &amp;lt;iostream&amp;gt;
#include &amp;lt;unordered_map&amp;gt;
#include &amp;lt;unordered_set&amp;gt;
int main() {
  std::unordered_set&amp;lt;std::pair&amp;lt;std::string, int&amp;gt;&amp;gt; h1{
      {&amp;quot;java&amp;quot;, 18}, {&amp;quot;golang&amp;quot;, 105}, {&amp;quot;cpp&amp;quot;, 23}, {&amp;quot;rust&amp;quot;, 172}};
  std::unordered_map&amp;lt;std::tuple&amp;lt;float, std::string, int&amp;gt;, int&amp;gt; h2{
      {{1.8, &amp;quot;java&amp;quot;, 18}, -1}, {{1.05, &amp;quot;golang&amp;quot;, 105}, -2}};
  for (auto &amp;amp;&amp;amp; v: h1)
    std::cout &amp;lt;&amp;lt; v.first &amp;lt;&amp;lt; &amp;quot;, &amp;quot; &amp;lt;&amp;lt; v.second &amp;lt;&amp;lt; &#39;\n&#39;;
}
&lt;/code&gt;&lt;/pre&gt;
">【c++】std::pair, std::tuple哈希</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/todo-cmake-cmakelists-mo-ban/"" data-c="
          &lt;p&gt;.todo&lt;/p&gt;
">【TODO】【CMAKE】CMakeLists模板</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/c-ke-li-hua/"" data-c="
          &lt;p&gt;refer: &lt;a href=&#34;https://sighingnow.github.io/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/cpp_currying_partial_application.html&#34;&gt;C++ 实现 Currying 和 Partial application&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;New Bing:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;柯里化（Currying）是一种将多参数函数转换为一系列单参数函数的技术。它源自于数学家哈斯凯尔·柯里（Haskell Curry）的工作，因此得名。&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;柯里化的基本思想是将一个接受多个参数的函数转换为一系列接受单一参数的函数。例如，假设我们有一个接受两个参数的函数 &lt;code&gt;f(x, y)&lt;/code&gt;，我们可以将其柯里化为一个新函数 &lt;code&gt;g(x)(y)&lt;/code&gt;，其中 &lt;code&gt;g(x)&lt;/code&gt; 返回一个新函数，该函数接受一个参数 &lt;code&gt;y&lt;/code&gt; 并返回 &lt;code&gt;f(x, y)&lt;/code&gt; 的结果。&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;柯里化的优点在于它能够让我们更灵活地使用函数。通过传递部分参数，我们可以创建新的函数，这些新函数固定了部分参数并等待剩余参数的传递。这样，我们就可以将复杂的函数拆分为多个简单的函数，并在不同的上下文中重用它们。&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;此外，柯里化还能够提高代码的可读性和可维护性。通过将复杂的函数拆分为多个简单的函数，我们可以更清楚地表达代码的意图，并更容易地理解和维护代码&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;使用&lt;code&gt;c++ template&lt;/code&gt;与&lt;code&gt;std::function&lt;/code&gt;实现柯里化：&lt;/p&gt;
&lt;p&gt;首先定义一个函数模板&lt;code&gt;curry&lt;/code&gt;，模板参数为返回待处理函数类型&lt;code&gt;RetT&lt;/code&gt;，变长形参类型&lt;code&gt;...ArgsT&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;输入原函数构造的&lt;code&gt;std::function&lt;/code&gt;，输出柯里化的&lt;code&gt;std::function&lt;/code&gt;，显然，如果一个函数的形参数量少于&lt;code&gt;2&lt;/code&gt;，则柯里化的函数即原函数，因此先使用&lt;code&gt;if constexpr&lt;/code&gt;条件编译&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template &amp;lt;typename RetT, typename... ArgsT&amp;gt;
auto curry(std::function&amp;lt;RetT(ArgsT...)&amp;gt; func) {
  if constexpr (sizeof...(ArgsT) &amp;lt; 2)
    return func;
  else
    return detail::curry_impl&amp;lt;RetT, ArgsT...&amp;gt;(func);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;现在考虑真正需要柯里化的情况，如果记原函数为&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;f&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.8888799999999999em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;， 则输出应该为&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;curry(f)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;且&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;≡&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;.&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;.&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;.&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;curry(f)(x_1)(x_2)(x_3)\dots (x_N) \equiv f(x_1, x_2, x_3, ... x_N)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;≡&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;记&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;→&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;g(a) \rightarrow f(x_1=a, x_2, x_3, \dots, x_N)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;→&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;，则&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;≡&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;.&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;.&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;.&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;curry(g(a)())(x_2)(x_3)\dots(x_N) \equiv f(x_1=a, x_2, x_3, ... x_N)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;≡&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;所以&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;≡&lt;/mo&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;curry(g(a)())(x_2)(x_3)\dots(x_N) \equiv curry(f)(a)(x_2)(x_3)\dots (x_N)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;≡&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;因此&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;→&lt;/mo&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;curry(f) = a\rightarrow curry(g(a)())&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;→&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;，即&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;→&lt;/mo&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mo&gt;…&lt;/mo&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;curry(f) = a \rightarrow curry(f(x_1=a, x_2, x_3, \dots, x_N))&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;→&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;…&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.32833099999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10903em;&#34;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;因此可以使用递归闭包实现柯里化&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;递归边界&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;namespace {
namespace detail {
template &amp;lt;typename Return, typename Arg&amp;gt;
auto curry_impl(std::function&amp;lt;Return(Arg)&amp;gt; f) {
  return f;
}
} // namespace detail
} // namespace
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;递归闭包&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;namespace {
namespace detail { 
template &amp;lt;typename Return, typename Arg, typename... Args&amp;gt;
auto curry_impl(std::function&amp;lt;Return(Arg, Args...)&amp;gt; f) {
    // f(x_1, x_2, ... x_N)
  return [f](Arg&amp;amp;&amp;amp; arg) { // a -&amp;gt; curry(f(a, x_2, x_3, ..., x_N))
    return curry_impl( //curry(f(a, x_2, x_3, ..., x_N))
        std::function([&amp;amp;f, &amp;amp;arg](Args&amp;amp;&amp;amp;... args) {
      return f(std::forward&amp;lt;Arg&amp;gt;(arg), std::forward&amp;lt;Args&amp;gt;(args)...);
            // f(a, x_2, x_3, ..., x_N)
    }));
  };
}
} // namespace detail
} // namespace
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;complete code:&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;#include &amp;lt;iostream&amp;gt;
#include &amp;lt;functional&amp;gt;
#include &amp;lt;string&amp;gt;
namespace {
namespace detail {
template &amp;lt;typename Return, typename Arg&amp;gt;
auto curry_impl(std::function&amp;lt;Return(Arg)&amp;gt; f) {
  return f;
}

template &amp;lt;typename Return, typename Arg, typename... Args&amp;gt;
auto curry_impl(std::function&amp;lt;Return(Arg, Args...)&amp;gt; f) {
  return [f](Arg&amp;amp;&amp;amp; arg) {
    return curry_impl(std::function([f, &amp;amp;arg](Args&amp;amp;&amp;amp;... args) {
      return f(std::forward&amp;lt;Arg&amp;gt;(arg), std::forward&amp;lt;Args&amp;gt;(args)...);
    }));
  };
}
} // namespace detail
} // namespace
template &amp;lt;typename RetT, typename... ArgsT&amp;gt;
auto curry(std::function&amp;lt;RetT(ArgsT...)&amp;gt; func) {
  if constexpr (sizeof...(ArgsT) &amp;lt; 2)
    return func;
  else
    return detail::curry_impl&amp;lt;RetT, ArgsT...&amp;gt;(func);
}


&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;使用例：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;auto f(int a, int b, int c, int d, int e, int f) {
  return a + b + c + d + e + f;
}
auto f2(int a, int b) { return a + b; }
auto f3(std::string a, std::string b) { return a + b; }
int main() {
  auto cf1 = curry(std::function(f));
  std::cout &amp;lt;&amp;lt; cf1(1)(1)(4)(5)(1)(4)&amp;lt;&amp;lt; std::endl;
  // 16
  auto cf2 = curry(std::function(f2));
  std::cout &amp;lt;&amp;lt; cf2(2)(3) &amp;lt;&amp;lt; std::endl;
  //5
  auto cf3 = curry(std::function(f3));
  std::cout &amp;lt;&amp;lt; cf3(std::string{&amp;quot;hola&amp;quot;})(std::string{&amp;quot; amigo&amp;quot;}) &amp;lt;&amp;lt; std::endl;
  // hola amigo
}
&lt;/code&gt;&lt;/pre&gt;
">【c++】柯里化</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/todo-c-pan-duan-lei-shi-fou-you-te-ding-cheng-yuan-bian-liang-yu-qi-zhi/"" data-c="
          &lt;p&gt;&lt;code&gt;SFINAE&lt;/code&gt;（&lt;code&gt;std::enable_if&lt;/code&gt;）是&lt;code&gt;C++11&lt;/code&gt;模板中利用类型萃取判断泛型是否满足特定鸭子类型，从而保证模板代码能正确地条件化生成的方法，但是语法上可读性差，不易扩展。&lt;/p&gt;
&lt;p&gt;而 &lt;code&gt;C++20&lt;/code&gt;中的&lt;code&gt;Concept&lt;/code&gt;使用不求值表达式表达泛型约束，语法上限制更少，可读性强，结合&lt;code&gt;C++14&lt;/code&gt;的&lt;code&gt;if constexpr&lt;/code&gt;，可以平替满是语法噪音的 &lt;code&gt;SFINAE&lt;/code&gt;。最重要的是，&lt;code&gt;concepts&lt;/code&gt;报错能精确到&lt;code&gt;requires&lt;/code&gt;，而没有与&lt;code&gt;static_assert&lt;/code&gt;的 &lt;code&gt;SFINAE&lt;/code&gt;很难定位写模板时的&lt;code&gt;bug&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;假设一个模板函数内，要根据类型是否具有特定成员变量（函数）使用&lt;code&gt;if constexpr&lt;/code&gt;条件编译，比如下方代码需要确定类&lt;code&gt;T&lt;/code&gt;是否有&lt;code&gt;public&lt;/code&gt;的&lt;code&gt;int x&lt;/code&gt;, &lt;code&gt;auto f() -&amp;gt; void&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;struct A{
    double x;
    void f(){};
};
struct B{
    int x;
    void g(){};
};
template &amp;lt;typename T&amp;gt; t_func(T t) {
    if constexpr (has_x&amp;lt;T&amp;gt; &amp;amp;&amp;amp; has_f&amp;lt;T&amp;gt;)
        branch1();
    else 
        branch2();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;C++20&lt;/code&gt;前使用 &lt;code&gt;SFINAE&lt;/code&gt;可以这样写：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template&amp;lt;typename T&amp;gt;
struct has_x {
    template&amp;lt;typename U, typename = void&amp;gt;
    struct has_x_impl : std::false_type {
    };
    template&amp;lt;typename U&amp;gt;
    struct has_x_impl&amp;lt;U, std::void_t&amp;lt;decltype(std::declval&amp;lt;U&amp;gt;().x)&amp;gt;&amp;gt; {
        constexpr inline bool static value = std::is_same_v&amp;lt;int, decltype(std::declval&amp;lt;U&amp;gt;().x)&amp;gt;;
    };
    constexpr inline bool static value = has_x_impl&amp;lt;T&amp;gt;::value;
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;如果&lt;code&gt;T::x&lt;/code&gt;存在，则&lt;code&gt;has_x&amp;lt;T&amp;gt;&lt;/code&gt;会实例化为没有默认&lt;code&gt;typename = void&lt;/code&gt;的第二个版本的&lt;code&gt;has_x_impl&lt;/code&gt;，&lt;code&gt;has_x&amp;lt;T&amp;gt;::value&lt;/code&gt;当&lt;code&gt;T::x&lt;/code&gt;为&lt;code&gt;int&lt;/code&gt;时为真&lt;/p&gt;
&lt;p&gt;如果&lt;code&gt;T::x&lt;/code&gt;不存在，第二个版本的&lt;code&gt;has_x_impl&lt;/code&gt;替换失败，根据&lt;code&gt;SFINAE&lt;/code&gt;实例化为第一个版本，&lt;code&gt;has_x&amp;lt;T&amp;gt;::value==false&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;为了实现 &lt;code&gt;SFINAE&lt;/code&gt;，使用了：1.一个额外的&lt;code&gt;typename=void&lt;/code&gt;用于触发&lt;code&gt;SFINAE&lt;/code&gt; 2.&lt;code&gt;decltype&lt;/code&gt;用于类型提取 3. 在&lt;code&gt;decltype&lt;/code&gt;的不求值表达式中使用&lt;code&gt;std::declval&amp;lt;U&amp;gt;()&lt;/code&gt;，防止&lt;code&gt;U&lt;/code&gt;没有默认构造函数导致编译错误&lt;/p&gt;
&lt;p&gt;判断成员函数的代码类似&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template&amp;lt;typename T&amp;gt;
struct has_f {
    template&amp;lt;typename U, typename = void&amp;gt;
    struct has_f_impl : std::false_type {
    };
    template&amp;lt;typename U&amp;gt;
    struct has_f_impl&amp;lt;U, std::void_t&amp;lt;decltype(std::declval&amp;lt;U&amp;gt;().f())&amp;gt;&amp;gt; {
        constexpr inline bool static value = std::is_same_v&amp;lt;void, decltype(std::declval&amp;lt;U&amp;gt;().f())&amp;gt;;
    };
    constexpr inline bool static value = has_f_impl&amp;lt;T&amp;gt;::value;
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;而在&lt;code&gt;c++20&lt;/code&gt;中，使用&lt;code&gt;Concepts&lt;/code&gt;将上述满满语法噪音的代码化简为：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template&amp;lt;typename T&amp;gt;
concept has_x = requires(T a) { 
    requires std::same_as&amp;lt;decltype(a.x), int&amp;gt; ;
}; 
template&amp;lt;typename T&amp;gt;
concept has_f = requires(T a) {
    {a.f()} -&amp;gt; std::same_as&amp;lt;void&amp;gt;;
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;当然&lt;code&gt;has_x&lt;/code&gt;也可写成&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template&amp;lt;typename T&amp;gt;
concept has_x = requires(T a) { 
    {a.x} -&amp;gt; std::same_as&amp;lt;int&amp;amp;&amp;gt; ;
};  
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;不写成&lt;code&gt;std::same_as&amp;lt;int&amp;gt;&lt;/code&gt;是因为这里和&lt;code&gt;{} -&amp;gt;&lt;/code&gt;检查的是表达式&lt;code&gt;a.x&lt;/code&gt;的类型，而不是变量&lt;code&gt;a.x&lt;/code&gt;本身的类型。编译器转换的代码大致等价于&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;template&amp;lt;typename T&amp;gt;
concept has_x = requires(T a) { 
    requires std::same_as&amp;lt;decltype((a.x)), int&amp;amp;&amp;gt; ;
};  
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;requires&lt;/code&gt;表达式中从&lt;code&gt;T&lt;/code&gt;类型对象中拿出成员，嵌套一层&lt;code&gt;requires&lt;/code&gt;检查变量类型/函数签名&lt;/p&gt;
&lt;p&gt;使用例&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;struct A{
    double x;
    void f(){};
    A() = delete;
};
struct B{
    int x;
    void g(){};
};

int main(){ 
    cout  &amp;lt;&amp;lt; has_x&amp;lt;A&amp;gt; &amp;lt;&amp;lt; endl &amp;lt;&amp;lt; has_x&amp;lt;B&amp;gt; &amp;lt;&amp;lt; endl;
    cout  &amp;lt;&amp;lt; has_f&amp;lt;A&amp;gt; &amp;lt;&amp;lt; endl &amp;lt;&amp;lt; has_f&amp;lt;B&amp;gt; &amp;lt;&amp;lt; endl; 
    // 0, 1, 1, 0
}
&lt;/code&gt;&lt;/pre&gt;
">【C++】Concept, SFINAE判断类是否有特定非静态成员</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/clion-shi-yong-msvc-bian-yi-qi/"" data-c="
          &lt;ol&gt;
&lt;li&gt;添加工具链：&lt;code&gt;Setting -&amp;gt; Build -&amp;gt; Toolchains -&amp;gt; + -&amp;gt; Visual Studio&lt;/code&gt;，选择&lt;code&gt;VS&lt;/code&gt;根目录&lt;/li&gt;
&lt;/ol&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/8793c169b3cc810691b06880da46bed.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;
&lt;p&gt;坑点：&lt;/p&gt;
&lt;p&gt;a) &lt;code&gt;CLion&lt;/code&gt;默认文件编码&lt;code&gt;utf-8&lt;/code&gt;，&lt;code&gt;MSVC&lt;/code&gt;默认文件编码&lt;code&gt;utf-8 with BOM&lt;/code&gt;，导致不能编译&lt;/p&gt;
&lt;p&gt;b) &lt;code&gt;MSVC&lt;/code&gt;非标准模式模式下，可能产生与&lt;code&gt;c++&lt;/code&gt;标准不符的行为，影响代码在不同编译器间的移植性&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;解决方法：通过&lt;code&gt;CMake&lt;/code&gt;设置&lt;code&gt;MSVC&lt;/code&gt;参数，使用&lt;code&gt;utf-8&lt;/code&gt;编码与标准模式: &lt;code&gt;-DCMAKE_CXX_FLAGS=&amp;quot;/utf-8 /permissive-&amp;quot;&lt;/code&gt;&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230901164015.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
">【CLion】使用MSVC编译器</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/todo-c-json-xu-lie-hua-ku-4-ju-he-ti-zi-dong-xu-lie-hua-jing-tai-fan-she/"" data-c="
          &lt;p&gt;.kkep&lt;/p&gt;
">【TODO】【C++】Json序列化库(4) 聚合体自动序列化： 静态反射</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/todo-c-json-xu-lie-hua-ku-3-fan-xu-lie-hua/"" data-c="
          &lt;p&gt;.todo&lt;/p&gt;
">【TODO】【C++】Json序列化库(3) 反序列化</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/todo-c-json-xu-lie-hua-ku-2-xu-lie-hua/"" data-c="
          &lt;p&gt;.todo&lt;/p&gt;
">【TODO】【C++】Json序列化库(2) 序列化</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/todo-c-shi-xian-http-fu-wu-qi-1-xian-cheng-chi/"" data-c="
          &lt;p&gt;.keep&lt;/p&gt;
">【TODO】【C++】实现HTTP服务器(1) 线程池</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/todo-c-json-xu-lie-hua-ku-1-lei-xing-she-ji/"" data-c="
          &lt;p&gt;。keep&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;基本类型&lt;/li&gt;
&lt;li&gt;nullptr_t nullopt_t&lt;/li&gt;
&lt;li&gt;Json&lt;/li&gt;
&lt;li&gt;Json::ValueType&lt;/li&gt;
&lt;li&gt;stl_range&lt;/li&gt;
&lt;li&gt;stl_map&lt;/li&gt;
&lt;li&gt;custom_type&lt;/li&gt;
&lt;/ol&gt;
">【TODO】【C++】Json序列化库(1) 类型设计</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/todo-redis-cong-0-kai-shi-de-shu-ju-ku-xue-xi-1/"" data-c="
          &lt;p&gt;.keep&lt;/p&gt;
">【TODO】【Redis】从0开始的数据库学习-1</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/todo-c-ju-he-lei-xing-jing-tai-fan-she/"" data-c="
          &lt;p&gt;.kkep&lt;/p&gt;
">【TODO】【C++】聚合类型静态反射</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/todo-c-typelist/"" data-c="
          &lt;p&gt;.keep&lt;/p&gt;
">【TODO】【C++】TypeList</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/todo-python-pep-ming-ming-gui-fan-jie-shao/"" data-c="
          &lt;h3 id=&#34;一-基本类型&#34;&gt;一、基本类型&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.python.org/3/library/typing.html#&#34;&gt;link&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;使用&lt;code&gt;python&lt;/code&gt;的标准库&lt;code&gt;typing&lt;/code&gt;（&lt;code&gt;Python3.5+&lt;/code&gt;）可以为变量、函数、类提供类型注解，但在运行期，解释器并不会对注解的变量进行类型检查。&lt;/p&gt;
&lt;p&gt;类型注解也没有静态类型检查的要求，需要&lt;code&gt;mypy/pylint&lt;/code&gt;等静态检查器，或者一个足够现代，集成了静态代码分析的&lt;code&gt;IDE&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;如果这样，我们就可以&lt;/p&gt;
&lt;p&gt;1.通过类型推导自动获取调用函数的签名、返回值类型，提高可读性与开发效率&lt;/p&gt;
&lt;p&gt;2.通过类型检查，让运行期潜在的类型安全问题提前暴露&lt;/p&gt;
&lt;p&gt;单变量注解的语法为：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;apple: int = 0 + 0.0
# or
apple: &amp;quot;int&amp;quot; = 2.3
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;上述代码会在&lt;code&gt;Pycharm2023&lt;/code&gt;提示一个&lt;code&gt;warning: Expected type &#39;int&#39;, got &#39;float&#39; instead&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;这个语法补丁在一些场合不适用，比如元组解构&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;butter: int, charlie: float = (114, 5.14)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;因为根据官方文档[&lt;a href=&#34;https://docs.python.org/3/reference/simple_stmts.html#annassign&#34;&gt;link&lt;/a&gt;]中的文法，&lt;code&gt;python&lt;/code&gt;中带注解的赋值表达式的左手侧只能单变量，不支持解构&lt;/p&gt;
&lt;p&gt;可以改写成下方丑陋的形式&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;butter: int
charlie: float
butter, charlie = (114, 5.14)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;注意&lt;code&gt;butter: int&lt;/code&gt;并非&lt;code&gt;butter&lt;/code&gt;的声明，在赋值前使用会抛出&lt;code&gt;undefined NameError&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;函数注解中，使用带注解的赋值表达式的语法注解形参，函数体使用&lt;code&gt;-&amp;gt;&lt;/code&gt;与尾置类型来注解返回值类型&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;def stoi(s: str, base: int = 10) -&amp;gt; int:
    return int(s, base=base)
b: int = stoi(&amp;quot;107&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在运行期，通过&lt;code&gt;__annotations__&lt;/code&gt;或&lt;code&gt;typing.get_type_hints&lt;/code&gt;可以获取注解的函数签名与返回类型，对于全局变量，使用&lt;code&gt;globals()[&#39;__annotations__&#39;]&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;print(type(stoi))
# &amp;lt;class &#39;function&#39;&amp;gt;
print(stoi.__annotations__)
# {&#39;s&#39;: &amp;lt;class &#39;str&#39;&amp;gt;, &#39;base&#39;: &amp;lt;class &#39;int&#39;&amp;gt;, &#39;return&#39;: &amp;lt;class &#39;int&#39;&amp;gt;}

print(typing.get_type_hints(stoi))
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;使用管道符&lt;code&gt;|&lt;/code&gt;可以从不同类型创建可变类型（&lt;code&gt;python3.10+&lt;/code&gt;），如&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;duff: int | float = 1.2
duff = int(duff)
print(duff)
# 1
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;二-typing&#34;&gt;二、typing&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;typing&lt;/code&gt; 模块(&lt;code&gt;python3.5+&lt;/code&gt;)提供了复合注解功能&lt;/p&gt;
&lt;h4 id=&#34;1类型约束&#34;&gt;1.类型约束&lt;/h4&gt;
&lt;h5 id=&#34;聚合类型&#34;&gt;聚合类型&lt;/h5&gt;
&lt;p&gt;使用&lt;code&gt;typing.Union[...Types]&lt;/code&gt;创建可变类型，等效于类型间的管道运算符&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;var = Union[T1, T2, T3]
assert(var == T1 | T2 | T3)
# a ref type may holding type T1 or T2 or T3
&lt;/code&gt;&lt;/pre&gt;
&lt;h5 id=&#34;noreturn&#34;&gt;NoReturn&lt;/h5&gt;
&lt;p&gt;注解函数返回值类型，标识函数不能通过&lt;strong&gt;正常&lt;/strong&gt;控制流返回，所以函数体若只有&lt;code&gt;return&lt;/code&gt;或&lt;code&gt;pass&lt;/code&gt;，也是类型错误的，因为会隐式地&lt;code&gt;return None&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from typing import *
def handler_bad_request(state: my.HttpConnectState) -&amp;gt; NoReturn:
    code: int = my.parse_http_error_code(state)
    raise my.BadHttpRequestError(code)
&lt;/code&gt;&lt;/pre&gt;
&lt;h5 id=&#34;无返回值函数&#34;&gt;无返回值函数&lt;/h5&gt;
&lt;p&gt;尾置类型为&lt;code&gt;None&lt;/code&gt;或&lt;code&gt;type(None)&lt;/code&gt;注解一个无返回值函数（因为隐式返回&lt;code&gt;None&lt;/code&gt;），当然&lt;code&gt;None&lt;/code&gt;是一个类型为&lt;code&gt;NoneType&lt;/code&gt;的单例对象，不是真正的无返回值，不能对位于&lt;code&gt;c/c++&lt;/code&gt;中的&lt;code&gt;void&lt;/code&gt;。以下代码可通过&lt;code&gt;mypy&lt;/code&gt;检查&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;def get_none() -&amp;gt; None:
    return None
&lt;/code&gt;&lt;/pre&gt;
&lt;h5 id=&#34;可空类型&#34;&gt;可空类型&lt;/h5&gt;
&lt;p&gt;使用&lt;code&gt;typing.Optional[T]&lt;/code&gt;注解一个可空类型（常用于形参、返回值），其类型为&lt;code&gt;None&lt;/code&gt;或&lt;code&gt;T&lt;/code&gt;，即等效于&lt;code&gt;Union[None, T]&lt;/code&gt;，对位于&lt;code&gt;csharp&lt;/code&gt;中的可空值类型（&lt;code&gt;Nullable&amp;lt;T&amp;gt;&lt;/code&gt;），&lt;code&gt;c++17&lt;/code&gt;中的&lt;code&gt;std::optional&amp;lt;T&amp;gt;&lt;/code&gt;。使用&lt;code&gt;Optional[T]&lt;/code&gt;作为函数返回值，可以提醒调用者处理空值&lt;code&gt;None&lt;/code&gt;&lt;/p&gt;
&lt;h5 id=&#34;动态类型&#34;&gt;动态类型&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;typing.Any&lt;/code&gt;不约束类型，也就是&lt;code&gt;python&lt;/code&gt;本质的动态类型，使用&lt;code&gt;typing.Any&lt;/code&gt;时，优先考虑&lt;code&gt;Union&lt;/code&gt;或&lt;code&gt;TypeVar&lt;/code&gt;泛型注解平替，因为&lt;code&gt;Any&lt;/code&gt;无法体现函数输入输出的类型关系。对位于&lt;code&gt;csharp&lt;/code&gt;中的动态类型（&lt;code&gt;dynamic&lt;/code&gt;），&lt;code&gt;c++17&lt;/code&gt;中的&lt;code&gt;std::any&lt;/code&gt;&lt;/p&gt;
&lt;h5 id=&#34;函数对象&#34;&gt;函数对象&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;typing.Callable&lt;/code&gt;在注解中相当于&lt;code&gt;collections.abc.Callable&lt;/code&gt;抽象类，其中的纯虚函数为&lt;code&gt;__call__&lt;/code&gt;，使用&lt;code&gt;typing.Callable&lt;/code&gt;注解&lt;code&gt;def&lt;/code&gt;定义的函数或实现&lt;code&gt;__call__&lt;/code&gt;的对象，一个举例是装饰器等高阶函数&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from typing import *
import time

def tictoc(func: Callable) -&amp;gt; Callable:
    def wrapper(*args, **kwargs):
        tic = time.time()
        func(*args, **kwargs)
        print(f&amp;quot;clock time cost: {time.time() - tic}s&amp;quot;)
    return wrapper
@tictoc
def f() -&amp;gt; None:
    time.sleep(1)
f()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;如果关心函数签名，则&lt;code&gt;def f(arg1: T1, ... argn: TN) -&amp;gt; RT&lt;/code&gt;注解为&lt;code&gt;Callable[[T1, T2, ..., TN], RT]&lt;/code&gt;&lt;/p&gt;
&lt;h5 id=&#34;类型类型&#34;&gt;类型类型&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;typing.Type&lt;/code&gt;在注解中相当于&lt;code&gt;type&lt;/code&gt;，&lt;code&gt;type&lt;/code&gt;也是一个内置类，且&lt;code&gt;type(type) == type&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;之所以要像&lt;code&gt;Callable&lt;/code&gt;使用一个代理类是因为注解中，有时必要使用&lt;code&gt;[]&lt;/code&gt;来表达类型的约束，而&lt;code&gt;python3.9&lt;/code&gt;前的&lt;code&gt;type&lt;/code&gt;没有&lt;code&gt;[]&lt;/code&gt;下标运算符，&lt;code&gt;list, map, set&lt;/code&gt;等内置类型也没有&lt;/p&gt;
&lt;p&gt;因为&lt;code&gt;type(type) == type&lt;/code&gt;，所以可以用&lt;code&gt;Type&lt;/code&gt;注解一个运行期决定的类型&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;import numpy as np
from typing import *
import random
dummy = np.zeros((3, 3), dtype=np.int32)
def up_cast(arr: np.ndarray) -&amp;gt; np.ndarray:
    t: Type = random.choice([np.single, np.half, np.double])
    return arr.astype(t)
print(up_cast(dummy))
&lt;/code&gt;&lt;/pre&gt;
&lt;h5 id=&#34;self&#34;&gt;Self&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;python&lt;/code&gt;注解中，以下代码会让解释器停止思考&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;class Foo: 
    def clone(self) -&amp;gt; Foo:
        return self
f = Foo().clone()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在第&lt;code&gt;2&lt;/code&gt;行，似乎解释器还未解析完&lt;code&gt;Foo&lt;/code&gt;类型，使用&lt;code&gt;Foo&lt;/code&gt;注解引起了&lt;code&gt;undefined error&lt;/code&gt;，为此要前向声明这个类型，如使用&lt;code&gt;TypeVar&lt;/code&gt;封装&lt;code&gt;Foo&lt;/code&gt;用于注解。另外使用&lt;code&gt;Self&lt;/code&gt;可以达到相同效果，可以将代码改成以下两种相当丑陋的形式&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from typing import Self
class Foo: 
    def clone(self: Self) -&amp;gt; Self:
        return self
f = Foo().clone()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;or&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;class Foo: 
    def clone(self: &amp;quot;Foo&amp;quot;) -&amp;gt; &amp;quot;Foo&amp;quot;:
        return self
f = Foo().clone()
&lt;/code&gt;&lt;/pre&gt;
&lt;h5 id=&#34;鸭子类型&#34;&gt;鸭子类型&lt;/h5&gt;
&lt;p&gt;鸭子类型中，类型匹配不在于继承关系，而是在某种上下文中，一种类型能否在&lt;code&gt;syntax&lt;/code&gt;上替换某种未确定的类型&lt;/p&gt;
&lt;p&gt;&lt;code&gt;cpp&lt;/code&gt;模板便是利用静态鸭子类型实现编译期泛型的，如任何实现了&lt;code&gt;operator*=(const T&amp;amp;)&lt;/code&gt;、&lt;code&gt;operator++()&lt;/code&gt;、&lt;code&gt;operator!=(const T&amp;amp;)&lt;/code&gt;的类型，都能作为&lt;code&gt;std::for_each&lt;/code&gt;的迭代器参数。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;typing.Protocol&lt;/code&gt;可视为&lt;code&gt;python&lt;/code&gt;中的鸭子类型概念，当类型&lt;code&gt;T&lt;/code&gt;实现了某一&lt;code&gt;Protocol&lt;/code&gt;子类&lt;code&gt;P&lt;/code&gt;中所有属性/方法时，注解才将&lt;code&gt;T, P&lt;/code&gt;视作匹配的类型&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;class HasRunMethod(Protocol):
    def run(self) -&amp;gt; None:
        pass

class A:
    def run(self) -&amp;gt; None:
        print(&amp;quot;running A&amp;quot;)

class B:
    def lazy(self) -&amp;gt; None:
        pass
valid_runner: HasRunMethod = A()
invalid_runner: HasRunMethod = B()
# Expected type &#39;HasRunMethod&#39;, got &#39;B&#39; instead
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;2-容器&#34;&gt;2. 容器&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;List[T]/Set[T]&lt;/code&gt;注解存储类型&lt;code&gt;T&lt;/code&gt;的列表/集合&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Tuple[T1, T2, T3, ..., TN]&lt;/code&gt;注解存储类型&lt;code&gt;T1, T2, T3, ..., TN&lt;/code&gt;的元组&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Dict[K, V]&lt;/code&gt;注解键类型&lt;code&gt;K&lt;/code&gt;，值类型&lt;code&gt;V&lt;/code&gt;的字典&lt;/p&gt;
&lt;p&gt;&lt;code&gt;typing&lt;/code&gt;内还有其他非内置容器类型，如&lt;code&gt;NamedTuple, DefaultDict&lt;/code&gt;等（&lt;code&gt;namedtuple&lt;/code&gt;是创建&lt;code&gt;NamedTuple&lt;/code&gt;的工厂函数）&lt;/p&gt;
&lt;h4 id=&#34;3泛型&#34;&gt;3.泛型&lt;/h4&gt;
&lt;p&gt;聚合类型&lt;code&gt;Union&lt;/code&gt;的具体类型是始终不确定的，而泛型类型&lt;code&gt;typing.TypeVar&lt;/code&gt;表示一种待确定的类型，静态类型检查器可以通过形参推导出&lt;code&gt;T&lt;/code&gt;的具体类型&lt;/p&gt;
&lt;p&gt;&lt;code&gt;TypeVar&lt;/code&gt;创建模板参数，模板约束只能进行类型匹配或继承匹配(&lt;code&gt;bound&lt;/code&gt;)，无法进行语义上的类型约束（类似&lt;code&gt;cpp&lt;/code&gt;中的&lt;code&gt;SFINAE&lt;/code&gt;或&lt;code&gt;concepts&lt;/code&gt;）。后者利用了不求值表达式，这在&lt;code&gt;python&lt;/code&gt;语法中没有，所以或许该考虑组合&lt;code&gt;TypeVar&lt;/code&gt;与&lt;code&gt;Protocol&lt;/code&gt;达成相同效果&lt;/p&gt;
&lt;p&gt;一个泛型函数举例&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from typing import List, TypeVar

T = TypeVar(&#39;T&#39;, int, float)
# only int or float is acceptable
def quick_sort(arr: List[T]) -&amp;gt; List[T]:
    if len(arr) &amp;lt;= 1:
        return arr
    pivot: T = arr[len(arr) // 2]
    left: List[T] = [x for x in arr if x &amp;lt; pivot]
    middle: List[T] = [x for x in arr if x == pivot]
    right: List[T] = [x for x in arr if x &amp;gt; pivot]
    return quick_sort(left) + middle + quick_sort(right)
res = quick_sort([1, 2, 3])
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;在&lt;code&gt;Pycharm2023&lt;/code&gt;中，上文代码中&lt;code&gt;res&lt;/code&gt;成功推导为&lt;code&gt;list[int]&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;另外，让&lt;code&gt;class&lt;/code&gt;继承&lt;code&gt;typing.Generic[T1, T2, ..., Tn]&lt;/code&gt;，可以实现模板参数为&lt;code&gt;T1, T2, ..., Tn&lt;/code&gt;的类模板&lt;/p&gt;
">【Python】类型注解（3.5+）</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/leetcode-2503-ju-zhen-cha-xun-ke-huo-de-de-zui-da-fen-shu/"" data-c="
          &lt;p&gt;Original: &lt;a href=&#34;https://leetcode.cn/problems/maximum-number-of-points-from-grid-queries/solutions/2361523/cyan-du-you-xian-sou-suo-by-zixfy-pe8x/&#34;&gt;link&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Problem: &lt;a href=&#34;https://leetcode.cn/problems/maximum-number-of-points-from-grid-queries/description/&#34;&gt;2503. 矩阵查询可获得的最大分数&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;思路&#34;&gt;思路&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;广度优先搜索&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;解题方法&#34;&gt;解题方法&lt;/h1&gt;
&lt;p&gt;维护一个哈希表&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;[&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;]&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;dict[time: int, value: int]&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.8888799999999999em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.01968em;&#34;&gt;l&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;表示单次查询&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;mo&gt;≥&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;q \ge time&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.8304100000000001em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;q&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;≥&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.65952em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;e&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;时所能获得的最大分数&lt;/p&gt;
&lt;p&gt;所以在从&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;grid(0, 0)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;出发的广度优先搜索中，每次拓展节点时维护当前遍历过所有节点的个数&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;sum&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;m&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;（分数）与最大值&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;max&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;，更新&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;[&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;]&lt;/mo&gt;&lt;mo&gt;←&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;dict[max] \leftarrow sum&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;←&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;m&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;所以搜索中每次拓展节点时选择&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;grid&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.8888799999999999em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;d&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;值最小的节点，以维护&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;dict&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.69444em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;的正确性，否则会漏掉一些可以遍历到的点，使用&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;_&lt;/mi&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;std::priority\_queue&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.69444em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.9695199999999999em;vertical-align:-0.31em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mord&#34; style=&#34;margin-right:0.02778em;&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;q&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;e&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;维护小根堆存储拓展节点队列&lt;/p&gt;
&lt;p&gt;哈希表排序后，对于查询数组二分查找获得答案&lt;/p&gt;
&lt;h1 id=&#34;复杂度&#34;&gt;复杂度&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;时间复杂度:&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;添加时间复杂度, 示例： &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;×&lt;/mo&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;O(mn\times log(mnk))&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;O&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mbin&#34;&gt;×&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.01968em;&#34;&gt;l&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03148em;&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;空间复杂度:&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;添加空间复杂度, 示例： &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;O(mn)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;O&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;code&#34;&gt;Code&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-C++&#34;&gt;
using xy = pair&amp;lt;int, int&amp;gt;;
using wxy = pair&amp;lt;int, xy&amp;gt;;
constexpr std::array&amp;lt;xy, 4&amp;gt; dirs{{{0, 1}, {0, -1}, {-1, 0}, {1, 0}}};
class Solution {
public:
  vector&amp;lt;int&amp;gt; maxPoints(vector&amp;lt;vector&amp;lt;int&amp;gt;&amp;gt; &amp;amp;grid, vector&amp;lt;int&amp;gt; &amp;amp;queries) {
    using u8 = uint8_t;
    auto m = grid.size(), n = grid[0].size(), l = queries.size();

    vector vis(m, vector(n, u8{}));
    std::priority_queue&amp;lt;wxy, vector&amp;lt;wxy&amp;gt;, greater&amp;lt;&amp;gt;&amp;gt; q;
    q.emplace(grid[0][0], xy{0, 0});
    vis[0][0] = true;

    std::unordered_map&amp;lt;int, int&amp;gt; threshold2value;
    int cur_sum = 0, cur_max = 0;

    //广度优先搜索
    while (!q.empty()) {
      auto [cur, pos] = q.top();
      q.pop();

      cur_max = max(cur_max, cur);
      ++cur_sum;

      threshold2value[cur_max] = cur_sum;

      for (auto [dx, dy] : dirs) {
        auto nx = pos.first + dx, ny = pos.second + dy;
        if (nx &amp;lt; m &amp;amp;&amp;amp; nx &amp;gt; -1 &amp;amp;&amp;amp; ny &amp;gt; -1 &amp;amp;&amp;amp; ny &amp;lt; n &amp;amp;&amp;amp; !vis[nx][ny])
          vis[nx][ny] = true, q.emplace(grid[nx][ny], xy{nx, ny});
      }
    }

    //排序后二分查找
    vector&amp;lt;xy&amp;gt; kv(threshold2value.begin(), threshold2value.end());
    std::sort(kv.begin(), kv.end());
    std::transform(
        queries.begin(), queries.end(), queries.begin(), [&amp;amp;kv](int q) {
          auto iter = std::upper_bound(kv.begin(), kv.end(), xy{q, 0});
          if (iter == kv.begin())
            return 0;
          return std::prev(iter)-&amp;gt;second;
        });
    return queries;
  }
};

&lt;/code&gt;&lt;/pre&gt;
">【Leetcode】2503. 矩阵查询可获得的最大分数</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/shu-ju-jie-gou-xian-duan-shu/"" data-c="
          &lt;p&gt;c++区间修改求和，带惰性计算的实现：&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;//
// Created by wwww on 2023/5/1.
//

#ifndef LEETCODE_SEGMENT_TREE_HPP
#define LEETCODE_SEGMENT_TREE_HPP

#include &amp;lt;bits/stdc++.h&amp;gt;
using namespace std;
template &amp;lt;typename T&amp;gt; struct BasicSegTreeNode {
  using DataType = T;
  using p_node = BasicSegTreeNode&amp;lt;T&amp;gt; *;
  BasicSegTreeNode(size_t l, size_t r, DataType d)
      : data(d), left_bound(l), right_bound(r), right_child(nullptr),
        left_child(nullptr), lazy{} {};
  BasicSegTreeNode(size_t l, size_t r) : BasicSegTreeNode(l, r, DataType{}){};
  void push_down() {
    if (!lazy)
      return;
    left_child-&amp;gt;lazy_inc(lazy);
    right_child-&amp;gt;lazy_inc(lazy);
    lazy = DataType{};
  }
  void pull_up() { data = left_child-&amp;gt;data + right_child-&amp;gt;data; }
  void lazy_inc(DataType inc) {
    lazy += inc;
    data += inc * (right_bound - left_bound + 1);
  }
  bool within(size_t ql, size_t qr) const {
    return ql &amp;lt;= left_bound &amp;amp;&amp;amp; right_bound &amp;lt;= qr;
  }
  bool overlap(size_t ql, size_t qr) const {
    return !(ql &amp;gt; right_bound || qr &amp;lt; left_bound);
  }
  DataType val() { return data; }
  decltype(auto) left() { return *left_child; }
  decltype(auto) right() { return *right_child; }
  void set_child(BasicSegTreeNode&amp;lt;T&amp;gt; &amp;amp;l, BasicSegTreeNode&amp;lt;T&amp;gt; &amp;amp;r) {
    left_child = &amp;amp;l, right_child = &amp;amp;r;
  }

private:
  p_node left_child, right_child;
  size_t left_bound, right_bound;
  DataType data, lazy;
};
template &amp;lt;typename T = int&amp;gt; class SegTree {
  using Node = BasicSegTreeNode&amp;lt;T&amp;gt;;
  vector&amp;lt;Node&amp;gt; tree;
  std::reference_wrapper&amp;lt;const vector&amp;lt;T&amp;gt;&amp;gt; arr;

public:
  explicit SegTree(const vector&amp;lt;T&amp;gt; &amp;amp;v) : arr(v) {
    int n = arr.get().size();
    tree.reserve(n &amp;lt;&amp;lt; 1);
    _build(0, n - 1);
  }
  SegTree() = delete;
  T range_sum(int l, int r) { return _range_query(l, r, tree.front()); }
  void range_add(int l, int r, int val) {
    _range_modify(l, r, val, tree.front());
  }

private:
  T _range_query(int ql, int qr, Node &amp;amp;cur) {
    if (!cur.overlap(ql, qr))
      return {};
    if (cur.within(ql, qr))
      return cur.val();
    cur.push_down();
    return _range_query(ql, qr, cur.left()) + _range_query(ql, qr, cur.right());
  }

  void _range_modify(int ql, int qr, T val, Node &amp;amp;cur) {
    if (!cur.overlap(ql, qr))
      return;
    if (cur.within(ql, qr)) {
      cur.lazy_inc(val);
      return;
    }
    cur.push_down();
    _range_modify(ql, qr, val, cur.left());
    _range_modify(ql, qr, val, cur.right());
    cur.pull_up();
  }

  Node &amp;amp;_build(size_t l, size_t r) {
    if (l == r) {
      tree.emplace_back(l, r, arr.get()[l]);
      return tree.back();
    }
    tree.emplace_back(l, r);
    auto &amp;amp;ret = tree.back();
    auto m = l + ((r - l) &amp;gt;&amp;gt; 1);
    ret.set_child(_build(l, m), _build(m + 1, r));
    ret.pull_up();
    return ret;
  }
};
#endif // LEETCODE_SEGMENT_TREE_HPP



&lt;/code&gt;&lt;/pre&gt;
">【TODO】【数据结构】线段树</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/bili-qian-ru-shi-pin-ce-shi/"" data-c="
          &lt;p&gt;iframe&lt;/p&gt;
&lt;iframe src=&#34;//player.bilibili.com/player.html?aid=80433022&amp;bvid=BV1GJ411x7h7&amp;cid=137649199&amp;page=1&#34; scrolling=&#34;no&#34; border=&#34;0&#34; frameborder=&#34;no&#34; framespacing=&#34;0&#34; allowfullscreen=&#34;true&#34; style=&#34;width:100%;height:50vh;&#34;&gt; &lt;/iframe&gt;">【Gridea】bili嵌入视频测试</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/suan-fa-zui-jin-gong-gong-zu-xian/"" data-c="
          &lt;h2 id=&#34;lca&#34;&gt;LCA&lt;/h2&gt;
&lt;p&gt;让我们先回顾树上&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;LCA(Lowest\ Common\ Ancestor)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;L&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.07153em;&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;L&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02691em;&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.07153em;&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 的定义，对于有向树&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;T&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.68333em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.13889em;&#34;&gt;T&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;中任意结点对&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;&amp;lt;x, y&amp;gt;&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.5782em;vertical-align:-0.0391em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.7335400000000001em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&#39;katex-block&#39;&gt;&lt;span class=&#34;katex-display&#34;&gt;&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mtable side=&#34;right&#34;&gt;&lt;mlabeledtr&gt;&lt;mtd&gt;&lt;mtext&gt;(1)&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mrow&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;{&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;∣&lt;/mi&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mo&gt;∨&lt;/mo&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;∃&lt;/mi&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;→&lt;/mo&gt;&lt;mo&gt;⋯&lt;/mo&gt;&lt;mo&gt;→&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;}&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mlabeledtr&gt;&lt;/mtable&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;A(x) = \{a\ |\ a = x \ \lor\ \exists P(P:\ a \rightarrow \cdots \rightarrow x)\} \tag{1}
&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;∣&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.55556em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mbin&#34;&gt;∨&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;∃&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.13889em;&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.13889em;&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;→&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;⋯&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;→&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;tag&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord text&#34;&gt;&lt;span class=&#34;mord&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&#39;katex-block&#39;&gt;&lt;span class=&#34;katex-display&#34;&gt;&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mtable side=&#34;right&#34;&gt;&lt;mlabeledtr&gt;&lt;mtd&gt;&lt;mtext&gt;(2)&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mrow&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mspace linebreak=&#34;newline&#34;&gt;&lt;/mspace&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;munder&gt;&lt;mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;∈&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;∩&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mrow&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;D&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;E&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;P&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;T&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;H&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mlabeledtr&gt;&lt;/mtable&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;z  = LCA(x, y)  \\ = \mathop{arg\ max}\limits_{f\in A(x) \cap A(y)}\ \mathrm{DEPTH}(f ) \tag{2}   
&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.04398em;&#34;&gt;z&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;L&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.07153em;&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace newline&#34;&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1.91044em;vertical-align:-1.16044em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mop op-limits&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.43056000000000016em;&#34;&gt;&lt;span style=&#34;top:-2.11456em;margin-left:0em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:3em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mrel mtight&#34;&gt;∈&lt;/span&gt;&lt;span class=&#34;mord mathdefault mtight&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;mopen mtight&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault mtight&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mclose mtight&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mbin mtight&#34;&gt;∩&lt;/span&gt;&lt;span class=&#34;mord mathdefault mtight&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;mopen mtight&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mclose mtight&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;top:-3.0000000000000004em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:3em;&#34;&gt;&lt;/span&gt;&lt;span&gt;&lt;span class=&#34;mop&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;ma&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:1.16044em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathrm&#34;&gt;D&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;H&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10764em;&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;tag&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1.91044em;vertical-align:-1.16044em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord text&#34;&gt;&lt;span class=&#34;mord&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;即 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;x, y&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.625em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 的 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;LCA(z)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;L&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.07153em;&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.04398em;&#34;&gt;z&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 是他们的公共祖先，且在树中 的深度最大,当然 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;z&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.04398em;&#34;&gt;z&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 可以是 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;x&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 或者 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;y&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.625em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;  。之所以称为最近公共祖先，是因为 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;z&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.04398em;&#34;&gt;z&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 到 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;x, y&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.625em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 距离之和最小&lt;/p&gt;
&lt;p&gt;我们关心 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;x, y&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.625em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 间的距离，往往是因为原输入 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;T_0&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.83333em;vertical-align:-0.15em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.13889em;&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 是无向树， &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;x, y&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.625em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;  在 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;T_0&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.83333em;vertical-align:-0.15em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.13889em;&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 中是可达的，所以有向树 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;T&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.68333em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.13889em;&#34;&gt;T&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 只是在 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;T_0&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.83333em;vertical-align:-0.15em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.13889em;&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 的基础上随便选了个根节点而已。因此如果 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;T_0&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.83333em;vertical-align:-0.15em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.13889em;&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 中有简单路径 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;↔&lt;/mo&gt;&lt;mo&gt;⋯&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;⋯&lt;/mo&gt;&lt;mo&gt;↔&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;P_{xy}:\ x \leftrightarrow \cdots t \cdots \leftrightarrow y&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.969438em;vertical-align:-0.286108em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.13889em;&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15139200000000003em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.286108em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;↔&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.61508em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;⋯&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;⋯&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;↔&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.625em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; ,这里并不是任取中间结点 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;t&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.61508em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; ,而是选取出这样的 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;∈&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;t \in P_{xy}&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.65418em;vertical-align:-0.0391em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;∈&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.969438em;vertical-align:-0.286108em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.13889em;&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15139200000000003em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.286108em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 满足 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;∀&lt;/mi&gt;&lt;msup&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo mathvariant=&#34;normal&#34;&gt;′&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo mathvariant=&#34;normal&#34;&gt;′&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;∈&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;→&lt;/mo&gt;&lt;mrow&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;D&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;E&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;P&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;T&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;H&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;≤&lt;/mo&gt;&lt;mrow&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;D&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;E&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;P&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;T&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;H&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo mathvariant=&#34;normal&#34;&gt;′&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\forall t^{\prime}(t^{\prime} \in P_{xy} \rightarrow \mathrm{DEPTH}(t) \le \mathrm{DEPTH}(t^{\prime}))&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1.001892em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;∀&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.751892em;&#34;&gt;&lt;span style=&#34;top:-3.063em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;′&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.751892em;&#34;&gt;&lt;span style=&#34;top:-3.063em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;′&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;∈&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.969438em;vertical-align:-0.286108em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.13889em;&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15139200000000003em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.286108em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;→&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathrm&#34;&gt;D&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;H&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;≤&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1.001892em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathrm&#34;&gt;D&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;H&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.751892em;&#34;&gt;&lt;span style=&#34;top:-3.063em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;′&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; ，所以 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;P_{xy}&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.969438em;vertical-align:-0.286108em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.13889em;&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15139200000000003em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.286108em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 对应 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;T&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.68333em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.13889em;&#34;&gt;T&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 中两条路径(为了叙述方便，认为结点到本身自然有路径)&lt;/p&gt;
&lt;p class=&#39;katex-block&#39;&gt;&lt;span class=&#34;katex-display&#34;&gt;&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mtable side=&#34;right&#34;&gt;&lt;mlabeledtr&gt;&lt;mtd&gt;&lt;mtext&gt;(3)&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;→&lt;/mo&gt;&lt;mo&gt;⋯&lt;/mo&gt;&lt;mo&gt;→&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mspace width=&#34;1em&#34;/&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;→&lt;/mo&gt;&lt;mo&gt;⋯&lt;/mo&gt;&lt;mo&gt;→&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mspace linebreak=&#34;newline&#34;&gt;&lt;/mspace&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;∈&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;∩&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mlabeledtr&gt;&lt;/mtable&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;P_{tx}:\ t \rightarrow \cdots \rightarrow x\quad P_{ty}:\ t \rightarrow \cdots \rightarrow y\\ \Rightarrow t \in A(x) \cap A(y) \tag{3}  
&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.83333em;vertical-align:-0.15em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.13889em;&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.2805559999999999em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mord mathdefault mtight&#34;&gt;x&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.61508em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;→&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;⋯&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;→&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.969438em;vertical-align:-0.286108em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:1em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.13889em;&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.28055599999999997em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.286108em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.61508em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;→&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;⋯&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;→&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.625em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace newline&#34;&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.65418em;vertical-align:-0.0391em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;∈&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mbin&#34;&gt;∩&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;tag&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1.036108em;vertical-align:-0.286108em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord text&#34;&gt;&lt;span class=&#34;mord&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;则仅当 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;z = t&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.04398em;&#34;&gt;z&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.61508em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;t&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 时  &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;x, y&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.625em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;  有最短距离&lt;/p&gt;
&lt;p class=&#39;katex-block&#39;&gt;&lt;span class=&#34;katex-display&#34;&gt;&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mtable side=&#34;right&#34;&gt;&lt;mlabeledtr&gt;&lt;mtd&gt;&lt;mtext&gt;(4)&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;D&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;I&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;S&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;D&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;I&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;S&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;D&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;I&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;S&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mspace linebreak=&#34;newline&#34;&gt;&lt;/mspace&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;D&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;E&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;P&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;T&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;H&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;−&lt;/mo&gt;&lt;mrow&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;D&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;E&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;P&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;T&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;H&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;D&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;E&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;P&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;T&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;H&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;−&lt;/mo&gt;&lt;mrow&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;D&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;E&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;P&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;T&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;H&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mspace linebreak=&#34;newline&#34;&gt;&lt;/mspace&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;D&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;E&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;P&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;T&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;H&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;D&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;E&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;P&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;T&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;H&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;−&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mo&gt;×&lt;/mo&gt;&lt;mrow&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;D&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;E&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;P&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;T&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;H&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mlabeledtr&gt;&lt;/mtable&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\mathrm{DIS}(x, y) = \mathrm{DIS}(z, x) + \mathrm{DIS}(z, y)\\ =(\mathrm{DEPTH}(x) - \mathrm{DEPTH}(z)) + (\mathrm{DEPTH}(y) - \mathrm{DEPTH}(z))\\  =\mathrm{DEPTH}(x)+ \mathrm{DEPTH}(y) - 2\times \mathrm{DEPTH}(z) \tag{4}  
&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathrm&#34;&gt;D&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;I&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;S&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathrm&#34;&gt;D&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;I&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;S&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.04398em;&#34;&gt;z&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mbin&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathrm&#34;&gt;D&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;I&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;S&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.04398em;&#34;&gt;z&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace newline&#34;&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathrm&#34;&gt;D&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;H&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mbin&#34;&gt;−&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathrm&#34;&gt;D&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;H&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.04398em;&#34;&gt;z&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mbin&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathrm&#34;&gt;D&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;H&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mbin&#34;&gt;−&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathrm&#34;&gt;D&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;H&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.04398em;&#34;&gt;z&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace newline&#34;&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathrm&#34;&gt;D&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;H&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mbin&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathrm&#34;&gt;D&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;H&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mbin&#34;&gt;−&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.72777em;vertical-align:-0.08333em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mbin&#34;&gt;×&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathrm&#34;&gt;D&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;E&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;H&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.04398em;&#34;&gt;z&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;tag&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord text&#34;&gt;&lt;span class=&#34;mord&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord&#34;&gt;4&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;有时我们更关心 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;x, y&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.625em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 的最短带权距离，假设每条边都有一个非负权值,比如运输	网之类的。根据 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;(3)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 易知此时最短路径仍是以最近公共祖先 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;z&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.04398em;&#34;&gt;z&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 为中转点，因此只要求 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;D&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;I&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;S&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mrow&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;D&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;I&lt;/mi&gt;&lt;mi mathvariant=&#34;normal&#34;&gt;S&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\mathrm{DIS}(z, x), \mathrm{DIS}(z, y)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathrm&#34;&gt;D&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;I&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;S&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.04398em;&#34;&gt;z&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathrm&#34;&gt;D&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;I&lt;/span&gt;&lt;span class=&#34;mord mathrm&#34;&gt;S&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.04398em;&#34;&gt;z&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;，两条固定路径上的权值和&lt;/p&gt;
&lt;p&gt;进一步地，如果要求这是一个在线算法呢，即边输入边查询，边权值动态变化。类似的在数组的 在线 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;RMQ&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.8777699999999999em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.00773em;&#34;&gt;R&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.10903em;&#34;&gt;M&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;Q&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; （求定义域为下标区间的函数，如区间和）问题中我们手搓一个树状数组，线段树之类的递归树结构就可以解决,而且单次查询可以达到的时间复杂度。&lt;/p&gt;
&lt;p&gt;那么对于一棵树，其实我们把结点都按某个顺序存到&lt;/p&gt;
&lt;p&gt;(关于如何求解 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;LCA&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.68333em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;L&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.07153em;&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;A&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; ，最易实现的是二分查找，下面给出一个古早的树链剖分求&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;LCA&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.68333em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;L&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.07153em;&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;A&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;的&lt;code&gt;c&lt;/code&gt;实现，记不清了，修改下文代码中&lt;code&gt;qpath&lt;/code&gt;函数应该就能求&lt;code&gt;LCA&lt;/code&gt;)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;重链剖分&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-c&#34;&gt;#include &amp;lt;bits/stdc++.h&amp;gt;
const int MAXN = 1e5 + 7;
int MOD = 0;
using namespace std;

long long addin;
inline int read();
inline long long add(long long a, long long b) {return (a + b) % MOD;}
inline long long mul(long long a, long long b) {return (a * b) % MOD;}
inline int lson(int i) {return i &amp;lt;&amp;lt; 1;}
inline int rson(int i) {return (i &amp;lt;&amp;lt; 1) | 1;}

typedef struct node_ {
    int l, r, m, ls, rs;
    long long laz, sum;
} node;

typedef struct e_ {
    int to, next;
} edge;

node ns[MAXN &amp;lt;&amp;lt; 2];
edge es[MAXN &amp;lt;&amp;lt; 1];
int w[MAXN], cnt, heads[MAXN];
int pa[MAXN], dep[MAXN], hs[MAXN], sz[MAXN], top[MAXN], dfn[MAXN], rnk[MAXN], rear[MAXN];
int t;

long long build_tree(int l, int r, int p) {
    node &amp;amp;d = ns[p];
    d.l = l, d.r = r, d.m = (l + r) &amp;gt;&amp;gt; 1;
    if (l == r) {
        d.sum = w[rnk[l]];
        return d.sum;
    }
    d.ls = p &amp;lt;&amp;lt; 1;
    d.rs = d.ls + 1;
    return d.sum = add(build_tree(l, d.m, d.ls), build_tree(d.m + 1, r, d.rs));
}

inline void push_down(int p) {
    node &amp;amp;ls = ns[ns[p].ls];
    node &amp;amp;rs = ns[ns[p].rs];
    long long &amp;amp;laz = ns[p].laz;
    if (ns[p].laz) {
        ls.laz = add(ls.laz, laz), ls.sum = add(ls.sum, mul(laz, ns[p].m - ns[p].l + 1));
        rs.laz = add(rs.laz, laz), rs.sum = add(rs.sum, mul(laz, ns[p].r - ns[p].m));
        laz = 0;
    }
}

long long update(int x, int y, int p) {
    int &amp;amp;l = ns[p].l;
    int &amp;amp;r = ns[p].r;
    if (x &amp;lt;= r &amp;amp;&amp;amp; l &amp;lt;= y) {
        if (r &amp;lt;= y &amp;amp;&amp;amp; l &amp;gt;= x) 
            ns[p].laz = add(ns[p].laz, addin), ns[p].sum = add(ns[p].sum, mul(r - l + 1, addin));
        else 
            push_down(p), ns[p].sum = add(update(x, y, ns[p].ls), update(x, y, ns[p].rs));
    }
    return ns[p].sum;
}

long long qsum(int x, int y, int p) {
    int &amp;amp;l = ns[p].l;
    int &amp;amp;r = ns[p].r;
    long long res = 0;
    if (r &amp;lt;= y &amp;amp;&amp;amp; l &amp;gt;= x) return ns[p].sum;
    push_down(p);
    if (x &amp;lt;= ns[p].m) res = add(res, qsum(x, y, ns[p].ls));
    if (y &amp;gt;= ns[p].m + 1) res = add(res, qsum(x, y, ns[p].rs));
    return res;
}

inline void add_e(int x, int y) {es[++cnt] = {y, heads[x]}, heads[x] = cnt;}

void dfs0(int u, int f) {
    sz[u] = 1;
    pa[u] = f;
    dep[u] = dep[f] + 1;
    for (int i = heads[u]; i; i = es[i].next) {
        int &amp;amp;v = es[i].to;
        if (v != f) {
            dfs0(v, u);
            sz[u] += sz[v];
            if (!hs[u] || sz[v] &amp;gt; sz[hs[u]]) hs[u] = v;
        }
    }
}

void dfs1(int u, int f, int smit) {
    dfn[u] = ++t;
    rnk[t] = u;
    top[u] = smit;
    if (hs[u]) dfs1(hs[u], u, smit);
    for (int i = heads[u]; i; i = es[i].next) {
        int &amp;amp;v = es[i].to;
        if (v != f &amp;amp;&amp;amp; v != hs[u])
            dfs1(v, u, v);
    }
    rear[u] = t;
}

long long qpath(int x, int y) {
    long long res = 0;
    while (top[x] != top[y]) {
        if (dep[top[x]] &amp;gt; dep[top[y]]) swap(x, y);
        res = add(res, qsum(dfn[top[y]], dfn[y], 1));
        y = pa[top[y]];
    }
    if (dep[x] &amp;gt; dep[y]) swap(x, y);
    return add(res, qsum(dfn[x], dfn[y], 1));
}

void apath(int x, int y) {
    while (top[x] != top[y]) {
        if (dep[top[x]] &amp;gt; dep[top[y]]) swap(x, y);
        update(dfn[top[y]], dfn[y], 1);
        y = pa[top[y]];
    }
    if (dep[x] &amp;gt; dep[y]) swap(x, y);
    update(dfn[x], dfn[y], 1);
}

int main() {
    int n, m, root, x, y, op;
    n = read(), m = read(), root = read(), MOD = read();
    dep[0] = -1;
    for (int i = 1; i &amp;lt;= n; i++) w[i] = read();
    for (int i = 0; i &amp;lt; n - 1; i++) 
        x = read(), y = read(), add_e(x, y), add_e(y, x);
    dfs0(root, 0);
    dfs1(root, 0, root);
    build_tree(1, n, 1);  
    for (int i = 0; i &amp;lt; m; i++) {
        op = read(), x = read();
        if (op == 4) printf(&amp;quot;%lld\n&amp;quot;, qsum(dfn[x], rear[x], 1));
        else if (op == 3) addin = read(), update(dfn[x], rear[x], 1);
        else {
            y = read();
            if (op == 2) printf(&amp;quot;%lld\n&amp;quot;, qpath(x, y));
            else addin = read(), apath(x, y);
        }
    }
}

inline int read() {
    int x = 0, f = 1; char c = getchar();
    while (!isdigit(c)) {if (c == &#39;-&#39;) f = -1; c = getchar();}
    while (isdigit(c)) x = (x &amp;lt;&amp;lt; 3) + (x &amp;lt;&amp;lt; 1) + c - &#39;0&#39;, c = getchar();
    return x * f;
}
&lt;/code&gt;&lt;/pre&gt;
">【算法】最近公共祖先</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/suan-fa-xian-zhuang-shu-zu/"" data-c="
          &lt;p&gt;.keep&lt;/p&gt;
">【TODO】【算法】树状数组</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/gridea-tu-pian-yu-lan/"" data-c="
          &lt;p&gt;本站托管于&lt;code&gt;Github Pages&lt;/code&gt;，内容由&lt;code&gt;Gridea&lt;/code&gt;生成&lt;/p&gt;
&lt;p&gt;主题为&lt;a href=&#34;https://github.com/hsxyhao/gridea-theme-next&#34;&gt;hexo-next&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;但我在使用这个主题时，如果当前页面图片过多，点击图片打开的灯箱会很卡&lt;/p&gt;
&lt;p&gt;定位到使用&lt;code&gt;fancybox.js&lt;/code&gt;实现图片预览的代码(&lt;code&gt;$GRIDEA_HOME\themes\gridea-theme-next-master\templates\_blocks\footer.ejs&lt;/code&gt;)&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;&amp;lt;link rel=&amp;quot;stylesheet&amp;quot; href=&amp;quot;&amp;lt;%= site.customConfig.cdn %&amp;gt;/media/css/jquery.fancybox.css&amp;quot; /&amp;gt;
&amp;lt;script src=&amp;quot;&amp;lt;%= site.customConfig.cdn %&amp;gt;/media/js/jquery.fancybox.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;script&amp;gt;
  let images = document.querySelectorAll(&amp;quot;.section img&amp;quot;);
  images.forEach((image) =&amp;gt; {
    var parent = image.parentElement;
    var next = image.nextElementSibling;
    parent.removeChild(image);
    var aelem = document.createElement(&amp;quot;a&amp;quot;);
    aelem.href = image.src;
    aelem.dataset[&amp;quot;fancybox&amp;quot;] = &amp;quot;images&amp;quot;;
    aelem.dataset[&amp;quot;rel&amp;quot;] = &amp;quot;fancybox-button&amp;quot;;
    aelem.classList.add(&amp;quot;fancybox&amp;quot;);
    aelem.appendChild(image);
    parent.insertBefore(aelem, next);
  });
&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;反正就是很卡，浏览器点开图片时资源占用率明显上升，不看&lt;code&gt;fancybox&lt;/code&gt;源码也不知道什么问题&lt;/p&gt;
&lt;p&gt;忍不了了，在&lt;code&gt;github&lt;/code&gt;上找到一个写的比较好的图像预览的&lt;code&gt;js&lt;/code&gt;（&lt;a href=&#34;https://github.com/Tokinx/ViewImage&#34;&gt;link&lt;/a&gt;），下载下来并把上述代码替换成以下代码，问题就解决了&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;&amp;lt;script src=&amp;quot;&amp;lt;%= site.customConfig.cdn %&amp;gt;/media/js/view-image.min.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;script&amp;gt;
  window.ViewImage &amp;amp;&amp;amp; ViewImage.init(&#39;.section img&#39;);
&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
">【Gridea】图片预览</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/qi-you-2022-nian-qi-xing-liu-nian/"" data-c="
          &lt;p&gt;研一上骑行活动留念&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/2b02f98f862954706e8633986abfac1.jpg&#34; style=&#34;zoom: 33%;&#34; /&gt;
&lt;p&gt;第一次骑的昌平绿道，路况很烂，而且需要频繁穿越机动车道，太傻逼了&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611163217.png&#34; style=&#34;zoom:33%;&#34; /&gt;
&lt;p&gt;回龙观的自行车专用道&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/1686654322385.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;沙航&lt;br&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/IMG20220924122139.jpg&#34;  /&gt;&lt;br&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230613185915.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230613190636.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;香山附近（路况可以，没什么车），淋着小雨回来的，但很快乐&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611164233.png&#34; style=&#34;zoom:33%;&#34; /&gt;
&lt;p&gt;夜骑二环（路况差），我记得因为返校时已是凌晨，还要申请返校，闹麻了&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611164512.png&#34; style=&#34;zoom:33%;&#34; /&gt;
&lt;p&gt;十三陵水库，也没什么风景吧，G6辅路车很多，比较危险&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611164712.png&#34; style=&#34;zoom:33%;&#34; /&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611164859.png&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;首钢园，三环，每次出去都要在立交拐错&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611165220.png&#34; style=&#34;zoom:33%;&#34; /&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/abded102814fe4255bf808ea44925c2.jpg&#34; style=&#34;zoom: 50%;&#34; /&gt;
&lt;p&gt;昌平安四路，爬到百望路时搭上了三个小伙伴，大家成队冲下来的，很快乐&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611165640.png&#34; style=&#34;zoom:33%;&#34; /&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611170043.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;4&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611170013.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;戒台-潭柘&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611170635.png&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611170742.png&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;在首钢大桥&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/fotor_1667644265966.jpg&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;5&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/fotor_1667644307720.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;从上地爬到戒台寺&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;6&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/fotor_1667644492888.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;望门头沟&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;7&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/fotor_1667644449207.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;在潭柘寺牌坊，不理解这么多人信香火呢&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;8&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/IMG20221105140001.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;寒假封校没有骑了&lt;/p&gt;
&lt;p&gt;返校四环复健，艰难&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611170202.png&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;啊啊啊啊啊暑假回北京我必狠狠地骑🥵，狠狠地强身健体&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;9&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230613195929.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
">【骑游】2022年骑行留念</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/leetcode-2262-zi-fu-chuan-de-zong-yin-li/"" data-c="
          &lt;p&gt;&lt;em&gt;original: &lt;a href=&#34;https://leetcode.cn/problems/total-appeal-of-a-string/solutions/2230619/cplus-2262-zi-fu-chuan-de-zong-yin-li-by-c35w/&#34;&gt;link&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Problem: &lt;a href=&#34;https://leetcode.cn/problems/total-appeal-of-a-string/description/&#34;&gt;2262. 字符串的总引力&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;解题方法&#34;&gt;解题方法&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;目标：&lt;/strong&gt; 计算输入字符串所有子字符串之独特小写字母数量&lt;br&gt;
&lt;strong&gt;方法：&lt;/strong&gt; 1. 对于每个小写字母&lt;code&gt;char c&lt;/code&gt;，计算包含&lt;code&gt;c&lt;/code&gt;的子字符串数量，加起来就是答案&lt;br&gt;
2.但所有子字符串数量为&lt;code&gt;len(s) * [len(s) + 1] / 2&lt;/code&gt;，计算不包含&lt;code&gt;c&lt;/code&gt;的子字符串数量便可知包含&lt;code&gt;c&lt;/code&gt;的子字符串数量&lt;br&gt;
3.假设&lt;code&gt;c&lt;/code&gt;在&lt;code&gt;s&lt;/code&gt;中出现的索引为&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;≤&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;≤&lt;/mo&gt;&lt;mo&gt;⋯&lt;/mo&gt;&lt;mo&gt;≤&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;λ&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;p_1 \leq  p_2 \leq \cdots \leq p_\lambda&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.8304100000000001em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;≤&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.8304100000000001em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;≤&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.7719400000000001em;vertical-align:-0.13597em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;⋯&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;≤&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.625em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.33610799999999996em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34;&gt;λ&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;，则不包含&lt;code&gt;c&lt;/code&gt;的子字符串只能落在一对相邻的&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;[&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;]&lt;/mo&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;[&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;]&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;s[p_i], s[p_{i+1}]&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.31166399999999994em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34;&gt;i&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.311664em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;mbin mtight&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.208331em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;，或者&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;[&lt;/mo&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;]&lt;/mo&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;[&lt;/mo&gt;&lt;mo&gt;−&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;]&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;s[len(s)], s[-1]&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.01968em;&#34;&gt;l&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;−&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;之间，令&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;−&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;λ&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;p_0 = -1, p_{\lambda + 1} = len(s)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.625em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.852771em;vertical-align:-0.208331em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;−&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.3361079999999999em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34;&gt;λ&lt;/span&gt;&lt;span class=&#34;mbin mtight&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.208331em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.01968em;&#34;&gt;l&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;，则包含&lt;code&gt;c&lt;/code&gt;的子字符串数量为$$\frac{len(s) \times [len(s) + 1]}  {2} - \sum_{1 \leq i \leq \lambda + 1} \frac{(p_i - p_{i-1}) \times (p_i - p_{i-1} - 1) }{2}$$&lt;/p&gt;
&lt;p&gt;4.代码中遍历字符串，维护每个小写字母的最新索引即可&lt;/p&gt;
&lt;h1 id=&#34;复杂度&#34;&gt;复杂度&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;时间复杂度:&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;O(len(s))&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;O&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.01968em;&#34;&gt;l&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;空间复杂度:&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;O(1)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;O&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;code&#34;&gt;Code&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-C++&#34;&gt;class Solution {
private:
    inline static long long cal(long long l, long long r) {
        return (r - l) * (r - l - 1) / 2;
    }
public:
    long long appealSum(string s) {
        const int n = s.length();
        long long ans{13ll * n * (n + 1)};
        array&amp;lt;int, 26&amp;gt; las{};
        std::fill(las.begin(), las.end(), -1);
        // 加入s第0个字符左边的位置(-1)
        for (int i = 0; i &amp;lt; n; ++i) {
            int _{s[i] - &#39;a&#39;};
            ans -= cal(las[_], i);
            las[_] = i;
        }
        for (int i = 0; i &amp;lt; 26; ++i)
            ans -= cal(las[i], n);
        // 加入s最后字符右边的位置(s.length())
        return ans;
    }
};
&lt;/code&gt;&lt;/pre&gt;
">【Leetcode】2262. 字符串的总引力</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/leetcode/"" data-c="
          &lt;p&gt;&lt;em&gt;original: &lt;a href=&#34;https://leetcode.cn/problems/minimum-number-of-operations-to-make-arrays-similar/solutions/2269918/fen-lei-tao-lun-by-zixfy-6lxi/&#34;&gt;link&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Problem: &lt;a href=&#34;https://leetcode.cn/problems/minimum-number-of-operations-to-make-arrays-similar/description/&#34;&gt;2449. 使数组相似的最少操作次数&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;解题方法&#34;&gt;解题方法&lt;/h1&gt;
&lt;p&gt;1.分组，使得&lt;code&gt;nums&lt;/code&gt;,&lt;code&gt;target&lt;/code&gt;形如&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mo&gt;⋯&lt;/mo&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mo&gt;⋯&lt;/mo&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;(a_0,a_1,\cdots,a_i,b_0,b_1,\cdots,c_j)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1.036108em;vertical-align:-0.286108em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;⋯&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.31166399999999994em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34;&gt;i&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;⋯&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.311664em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.05724em;&#34;&gt;j&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.286108em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;，其中 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mo&gt;⋯&lt;/mo&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;a_0,a_1,\cdots, a_i&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.625em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;⋯&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.31166399999999994em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34;&gt;i&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 为奇数，&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mo&gt;⋯&lt;/mo&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;b_0, b_1,\cdots, b_j&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.980548em;vertical-align:-0.286108em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;⋯&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.311664em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.05724em;&#34;&gt;j&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.286108em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;为偶数，在&lt;code&gt;nums&lt;/code&gt;上的操作不能改变元素奇偶性，所以输入&lt;code&gt;nums&lt;/code&gt;,&lt;code&gt;target&lt;/code&gt;中奇偶元素个数&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;i,j&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.85396em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.05724em;&#34;&gt;j&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;必相等，因此分组后&lt;code&gt;nums&lt;/code&gt;,&lt;code&gt;target&lt;/code&gt;奇数、偶数分前后两段对应&lt;/p&gt;
&lt;p&gt;2.使得数组相似需要两步：A).&lt;code&gt;nums&lt;/code&gt;中奇数和与偶数和调整与&lt;code&gt;target&lt;/code&gt;一致 B).&lt;code&gt;nums&lt;/code&gt;中奇数&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mo&gt;⋯&lt;/mo&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;a_0, a_1, \cdots, a_i&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.625em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;⋯&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.31166399999999994em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34;&gt;i&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;与&lt;code&gt;target&lt;/code&gt;中奇数依次对齐，偶数同理。&lt;/p&gt;
&lt;p&gt;3.因此计算&lt;code&gt;odd_above, odd_below, even_above, even_below&lt;/code&gt;为&lt;code&gt;nums&lt;/code&gt;逐位置与&lt;code&gt;target&lt;/code&gt;比较，奇数（偶数）超出（少于）部分的累加和，由于输入保证合法，必有&lt;code&gt;abs(even_below - even_above) == abs(odd_below - odd_above)&lt;/code&gt;,这是一个与操作方案无关的定值，也就是条件A之成本&lt;/p&gt;
&lt;p&gt;4.随后&lt;code&gt;nums&lt;/code&gt;中奇数&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mo&gt;⋯&lt;/mo&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;a_0, a_1, \cdots, a_i&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.625em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;⋯&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.31166399999999994em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34;&gt;i&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;与&lt;code&gt;target&lt;/code&gt;中奇数依次对齐成本为&lt;code&gt;min(odd_below, odd_above)&lt;/code&gt;,同理偶数依次对齐成本为&lt;code&gt;min(even_above, even_below)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;5.所以仅剩问题就是如何决定操作方案对应的&lt;code&gt;num&lt;/code&gt;和&lt;code&gt;target&lt;/code&gt;的对齐顺序，也就是最小化&lt;code&gt;min(odd_below, odd_above)&lt;/code&gt;，用反证法可证明两个数组偶数、奇数分别降序排列时，条件B的成本最小。以奇数为例，假设&lt;code&gt;nums&lt;/code&gt;中两个数为&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;a &amp;lt; b&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.5782em;vertical-align:-0.0391em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.69444em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;b&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;，&lt;code&gt;target&lt;/code&gt;中两个数为&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;c &amp;lt; d&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.5782em;vertical-align:-0.0391em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.69444em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;d&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;，易证以&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;(a,d), (b,c)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;比较时（按&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;[&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo&gt;]&lt;/mo&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mo&gt;[&lt;/mo&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo&gt;]&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;[a, b], [c,d]&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;有无交集分两种情况讨论）&lt;code&gt;min(odd_below, odd_above)&lt;/code&gt;增加或不变，所以先贪心地降序或升序排列两个数组&lt;/p&gt;
&lt;p&gt;6.&lt;code&gt;ans = (abs(odd_below - odd_above) + min(odd_below, odd_above) + min(even_above, even_below)) / 2;&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&#34;复杂度&#34;&gt;复杂度&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;时间复杂度:&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;O(nlog(n))&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;O&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.01968em;&#34;&gt;l&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03588em;&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;空间复杂度:&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;O(1)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;O&lt;/span&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;code&#34;&gt;Code&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-C++&#34;&gt;class Solution {
public:
  long long makeSimilar(vector&amp;lt;int&amp;gt; &amp;amp;nums, vector&amp;lt;int&amp;gt; &amp;amp;target) {
    auto f = [](const int a, const int b) {
      if ((a &amp;amp; 1) ^ (b &amp;amp; 1))
        return bool(a &amp;amp; 1);
      return a &amp;gt; b;
    };
    sort(nums.begin(), nums.end(), f);
    sort(target.begin(), target.end(), f);
    const auto n = nums.size();
    long long odd_above = 0, odd_below = 0, even_above = 0, even_below = 0;
    for (int i = 0; i &amp;lt; n; ++i) {
      int dif = abs(nums[i] - target[i]);
      if (nums[i] &amp;amp; 1)
        (nums[i] &amp;gt; target[i] ? odd_above : odd_below) += dif;
      else
        (nums[i] &amp;gt; target[i] ? even_above : even_below) += dif;
    }
    long long ans = 0;
    ans += abs(odd_below - odd_above) + min(odd_below, odd_above) + min(even_above, even_below);
    return ans &amp;gt;&amp;gt; 1;
  }
};

&lt;/code&gt;&lt;/pre&gt;
">【Leetcode】2449. 使数组相似的最少操作次数</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/todo-reid-lun-wen-bi-ji-pha-patch-wise-high-frequency-augmentation-for-transformer-based-person-re-identification/"" data-c="
          &lt;p&gt;&lt;a href=&#34;https://openaccess.thecvf.com/content/CVPR2023/html/Zhang_PHA_Patch-Wise_High-Frequency_Augmentation_for_Transformer-Based_Person_Re-Identification_CVPR_2023_paper.html&#34;&gt;A paper of CVPR&#39; 23 HightLight&lt;/a&gt;&lt;/p&gt;
&lt;ul class=&#34;contains-task-list&#34;&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-3776571&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-3776571&#34;&gt; todo&lt;/label&gt;&lt;/li&gt;
&lt;/ul&gt;
">【TODO】【ReID论文笔记】PHA: Patch-Wise High-Frequency Augmentation for Transformer-Based Person Re-Identification</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/reid-lun-wen-bi-ji-discover-cross-modality-nuances-for-visible-infrared-person-re-identification-mpanet/"" data-c="
          &lt;p&gt;&lt;a href=&#34;https://github.com/LittleGuoKe/AI-and-Person-ReID/blob/main/%E8%AE%BA%E6%96%87%E5%88%86%E4%BA%AB%E6%B1%87%E6%80%BB/%E8%B5%B5%E5%AD%90%E8%BD%A9_20230510_MPAnet.pptx&#34;&gt;组会slides&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;VI-ReID&lt;/code&gt;，也就是可见光-红外的跨模态场景下的行人再识别，分享的论文是&lt;code&gt;MPANet&lt;/code&gt;，我们之前未涉及跨模态方面的&lt;code&gt;ReID&lt;/code&gt;，因此今天的议程分为两部分，首先我带大家总结一下&lt;code&gt;VI-ReID&lt;/code&gt;方向大概是在搞什么，然后再看一下今天的论文。&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611202310.png&#34; style=&#34;zoom: 50%;&#34; /&gt;
&lt;p&gt;首先我们回顾一下常见的&lt;code&gt;ReID&lt;/code&gt;公开数据集，比如&lt;code&gt;MSMT17&lt;/code&gt;和&lt;code&gt;Market1501&lt;/code&gt;，我们可以说其中大部分图像都是在白天，或者说光线比较充足的场景下采集的。然而如果在一台设备上进行不间断的再识别，那么在夜晚光线较暗时，可见光监控头成像可能整体都是暗的，采到的图像基本就不包含啥信息了。因此这时使用红外成像更加合适，比如最右边圆圈中这组图像就是近红外采集的，可见在低光照场景下，还是能从红外图像中分辨出行人与背景。再者，现在部分监控头是双摄的，也就是在检测到光照较暗时自动换用红外摄像头。所以说在&lt;code&gt;ReID&lt;/code&gt;实际落地中，红外数据是我们有必要考虑到的，但加入红外数据后，只在可见光数据上训练的模型表现往往会变差，因为可见光和红外的成像原理不一样，两个模态间的&lt;code&gt;gap&lt;/code&gt;比较大。现在我们可以暂且理解红外为单通道的灰度图嘛，直观上相比于&lt;code&gt;RGB&lt;/code&gt;图像丢失了色彩和一些纹理信息，所以我们要想办法减小两种模态间的&lt;code&gt;gap&lt;/code&gt;才能利用上红外数据。这样，我们很自然地知道了&lt;code&gt;VI-ReID&lt;/code&gt;的任务目标：给定一种模态，比如说可见光图像作为&lt;code&gt;query&lt;/code&gt;查询，而另一种模态，比如果红外图像作为&lt;code&gt;gallery&lt;/code&gt;底库，也可以很准确地再识别。&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611202348.png&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;（平凡地对齐全局特征，难以利用上模态特有细粒度信息,导致模型泛化能力退化） 红外和可见光的模态差异其一是，同&lt;code&gt;ID&lt;/code&gt;不同模态特征分布差距较大。其二，两种模态成像原理不同啊，模型能从中学到的信息也不同，两者共有的主要是行人轮廓，姿态上的信息。设想一下，我们如果只是什么也不做，利用模型已有的&lt;code&gt;loss&lt;/code&gt;拉近图1中相同&lt;code&gt;ID&lt;/code&gt;的两种模态的特征，那么可能的情况是模型被驱使着学到更通用，或者说两种模态共有的全局&lt;code&gt;level&lt;/code&gt;的特征，但是淡化区分度更高的局部&lt;code&gt;level&lt;/code&gt;的特征，那这样模型在&lt;code&gt;ReID&lt;/code&gt;任务上的泛化能力会退化。比如同&lt;code&gt;ID&lt;/code&gt;不同模态下行人衣服纹理这个差别是比较大的，所以我们对齐后的特征不容易体现出这一局部信息。所以如何在融合不同模态时，利用上这些留在模态内部，或者说不同模态间视觉表现差距很大的信息是一个难点。&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611202434.png&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;在讲跨模态问题的思路之前我们先来看看研究中常用的数据集，也就是中山大学的&lt;code&gt;MM01&lt;/code&gt;数据集和&lt;code&gt;RegDB&lt;/code&gt;数据集，前者是一个包含&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;4w+&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.72777em;vertical-align:-0.08333em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02691em;&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;+&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;张图像，&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mn&gt;491&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;491&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.64444em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;个行人的大数据集，而&lt;code&gt;RegDB&lt;/code&gt;是一个&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mn&gt;8&lt;/mn&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;8k+&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.77777em;vertical-align:-0.08333em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.03148em;&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;+&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;图像的小型数据集。首先两者的红外图像有些差异，&lt;code&gt;SYSU&lt;/code&gt;中使用的是近红外摄像头，而&lt;code&gt;RegDB&lt;/code&gt;使用的远红外热成像，简单的讲就是两者成像所用的波长不一样，远红外光和可见光差异更大，因此&lt;code&gt;RegDB&lt;/code&gt;中红外图像纹理细节损失地更多，这点我们从样例图片就能看出来，但研究中通常不会区别对待这两个数据集。&lt;code&gt;RegDB&lt;/code&gt;中每个行人都有&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mn&gt;10&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;10&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.64444em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;张可见光图像和&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mn&gt;10&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;10&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.64444em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;张红外图，是模态平衡的数据集，因此在&lt;code&gt;RegDB&lt;/code&gt;的测试集上，一般都是&lt;code&gt;RGB&lt;/code&gt;和&lt;code&gt;IR&lt;/code&gt;相互作为&lt;code&gt;query&lt;/code&gt;进行跨模态查询。而&lt;code&gt;MM01&lt;/code&gt;中&lt;code&gt;IR&lt;/code&gt;图像较少，模型评估一般就是用红外图像去匹配可见光图像。另外，&lt;code&gt;RegDB&lt;/code&gt;的两个&lt;code&gt;camera&lt;/code&gt;就是在同一个位置上，而&lt;code&gt;MM01&lt;/code&gt;的场景变化和图像数更多，后者也许更能验证模型的泛化能力&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611202505.png&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;在&lt;code&gt;VI-Reid&lt;/code&gt;方向，为了克服我们之前说过的跨模态信息损失的问题，一般的方法分为两种，也就是首先在两个模态上取交集或并集，前者可以总结为模态共享的特征学习，那这种方法往往会在对齐模态之前，设计一些结构保留住模态内部，那些区分度高的特征，从而提高&lt;code&gt;ReID&lt;/code&gt;任务上的泛化能力嘛。而后者，也就是模态信息补偿的思路就是根据输入的模态生成另一种模态的图像，或者中间特征张量，然后再对齐两种模态下的特征。这种思路的难点就是加入容易受噪的生成式结构后怎么得到可靠的输出，尤其是如果要用红外生成可见光特征，红外其实本身信息量会比可见光少很多，这样的话还是比较困难的。示例图中实线框住的是原始输入的模态特征，虚线框住的是对齐后的特征&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611202522.png&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;接下来我们简单看一下一些已有的工作，首先是生成式的方案，像&lt;code&gt;AlignGAN&lt;/code&gt;就是利用可见光图像生成红外图像再送到后续网络中对齐特征。当然由于可见光/红外间的模态差异较大，比较难生成高质量的图像，&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mn&gt;22&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;22&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.64444em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;年的&lt;code&gt;FMCNet&lt;/code&gt;等工作的思路就是更端到端一点，只生成中间的特征，通常是对得到的输出解耦出两种模态下特定的特征再送后续&lt;code&gt;GAN&lt;/code&gt;&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611202552.png&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;然后就是模态共享特征学习，像我们之前说的，这些方法通常要同时对齐全局和细粒度的特征，从而有效利用两个模态。比如说深层网络中浅层主要是体现底层视觉信息，而深层才是人员&lt;code&gt;ID&lt;/code&gt;相关的信息，所以像&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mn&gt;23&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;23&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.64444em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;年的&lt;code&gt;DEEN&lt;/code&gt;等就是融合了多&lt;code&gt;level&lt;/code&gt;的特征。再比如说&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mn&gt;22&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;22&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.64444em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;年&lt;code&gt;DTRM&lt;/code&gt;等工作就是把我们之前分享过的&lt;code&gt;PCB&lt;/code&gt;的那种空间分块之类的方法应用到跨模态数据上，主要是融合行人的全局特征和部位特征。还有，我们可以引入注意力机制，这种思路的优点是模型会少一些先验，注意力权重能让模型学习到应该更关注通道上或者空间上的哪些区域，这对于提取模态共有的全局特征或局部特征都是挺有用的，今天要分享的&lt;code&gt;MPANet&lt;/code&gt;就是主要利用了空间注意力。当然其他的思路还有不少，比如说，不从模型结构入手，而是设计度量损失函数，使得无论何种模态，输出的特征都要在不同&lt;code&gt;ID&lt;/code&gt;间具有区分性，我们就不再细说了。&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611202630.png&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;接下来我们解读一下&lt;code&gt;MPANet&lt;/code&gt;这篇工作，它要解决的问题，就像我们一开始说的一样，简单地对齐可见光红外的全局特征的话，粒度就比较粗。这样一些细粒度的信息由于在模态间差异太大，就不好体现在全局特征里，也就是信息损失，学习不到了。作者强调的就是要在对齐模态前找出一些细粒度信息，也就是标题里的&lt;code&gt;nuance&lt;/code&gt;，文章中指的是空间上的局部特征，这篇工作主要的内容就是用空间注意力生成多种局部特征，然后同时对齐全局特征和局部的。 作者是通过一个例子来支持他的&lt;code&gt;motivation&lt;/code&gt;的，图中是一个平凡的&lt;code&gt;backbone&lt;/code&gt;，不同id红外特征比较接近，这就说明红外模态的特征信息熵比较小。这可能是因为红外图像包含的&lt;code&gt;ID&lt;/code&gt;相关的信息一般比可见光的要小，因此模态对齐带来的信息损失更明显。我们再细看一下对应图像，一些局部信息，比如说头，裤腿，应该还是对&lt;code&gt;ReID&lt;/code&gt;有帮助的，所以有必要从全局中把这些区分性强的&lt;code&gt;nuance&lt;/code&gt;抽离出来。&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611202704.png&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;引完问题后作者是这样写作&lt;code&gt;cotribution&lt;/code&gt;的，首先再强调一下&lt;code&gt;motivation&lt;/code&gt;，也就是我们觉得只用全局不好使。在具体工作上可以分为三个部分，其一是&lt;code&gt;mam&lt;/code&gt;，这是一个嵌在&lt;code&gt;resnet50 backbone&lt;/code&gt;中的结构，它使用带通道注意力的&lt;code&gt;Instance Norm&lt;/code&gt;减小模态分布上的&lt;code&gt;gap&lt;/code&gt;，其二&lt;code&gt;pam&lt;/code&gt;结构用来生成几种不同的空间注意力权重，作者把这个叫做&lt;code&gt;patterns&lt;/code&gt;，也就是期望不同的&lt;code&gt;attention map&lt;/code&gt;能关注不同语义的局部特征，其三，拼接局部和全局特征后，使用互学习的思想，其中添加的&lt;code&gt;loss&lt;/code&gt;一方面拉近了用两种模态特征得到的id预测的分布，另一方面又驱使模型根据当前输入模态学习，也就是给一个约束来减小模态对齐的信息损失。&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611202740.png&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;首先来看&lt;code&gt;mam&lt;/code&gt;模块，核心是&lt;code&gt;IN&lt;/code&gt;, 经过&lt;code&gt;IN&lt;/code&gt;，不同模态的特征在同一个通道上的均值方差就一样，都是&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;γ&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mtext&gt; &lt;/mtext&gt;&lt;msub&gt;&lt;mi&gt;β&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\gamma_k,\ \beta_k&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.8888799999999999em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.05556em;&#34;&gt;γ&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.33610799999999996em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.05556em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.03148em;&#34;&gt;k&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.05278em;&#34;&gt;β&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.33610799999999996em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathdefault mtight&#34; style=&#34;margin-right:0.03148em;&#34;&gt;k&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;了，原本不同模态的特征分布可能差异很大，但现在&lt;code&gt;IN&lt;/code&gt;可以从分布统计量上 缓解这种差异。利用这种方法在模型前头缓解模态之间的&lt;code&gt;gap&lt;/code&gt;，可以让后续结构的训练更加简单。 作者还引了一片研究&lt;code&gt;IN&lt;/code&gt;相关的论文，其中说道&lt;code&gt;IN&lt;/code&gt;的作用是消除图像间视觉特征的不一致，但是也会因此丢掉一些信息。比如说一方面&lt;code&gt;IN&lt;/code&gt;不仅拉近了不同模态，也拉近了不同&lt;code&gt;ID&lt;/code&gt;特征的距离，那在识别匹配就变困难了。尤其是两层&lt;code&gt;mam&lt;/code&gt;比较靠近输出端了，这两层输出对最终特征影响是比较大的,直接用&lt;code&gt;IN&lt;/code&gt;的话，实验效果证明很差。 既然in有好处有害处，那我们就把这个操作软化掉。首先考虑通道上的信息分解，每个通道的&lt;code&gt;feature map&lt;/code&gt;能对应于整张输入图像，可以认为每个通道关注的是不同角度的语义信息，我们在这里加一个通道注意力机制，让模型学习到的注意力权重决定in的输出在最终输出中的占比。理论上，由于最后&lt;code&gt;ReID&lt;/code&gt;的&lt;code&gt;id loss&lt;/code&gt;/ &lt;code&gt;metric loss&lt;/code&gt;的存在，如果&lt;code&gt;mam&lt;/code&gt;输入中某个通道包含了行人&lt;code&gt;ID&lt;/code&gt;相关的信息，那就弱化&lt;code&gt;IN&lt;/code&gt;的加权系数，如果某个通道无所谓，那就强化&lt;code&gt;IN&lt;/code&gt;的影响来缓解模态&lt;code&gt;gap&lt;/code&gt;&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611202807.png&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;&lt;code&gt;pam&lt;/code&gt;结构很简单，用来生成几种不同的空间注意力权重，期望不同的&lt;code&gt;attention map&lt;/code&gt;能关注不同语义的局部特征&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611202910.png&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;最后模型末端的&lt;code&gt;mutual learning&lt;/code&gt;结构的作用就是我们一直在讲的，有些信息，可能是可以对齐，可以在模态间&lt;code&gt;share&lt;/code&gt;的局部信息 但因为模态间这个信息差异比较大。它在模态对齐的&lt;code&gt;loss&lt;/code&gt;上相比于更抽象的全局特征不占优势，因此模型会倾向忽略这些信息，那这些信息就留在模态内部了，也就是模态融合后就学不到这些信息了。所以作者在这部分&lt;code&gt;loss&lt;/code&gt;设计上首先给不同模态输入用了不同的预测头计算&lt;code&gt;id loss&lt;/code&gt;，驱使模型尽可能多地利用上某一个模态下和人员&lt;code&gt;ID&lt;/code&gt;相关的信息。&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611202910.png&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;另一方面，&lt;code&gt;kl loss&lt;/code&gt;指引下，特征过不同模态的预测头的输出分布趋近，也就是驱使模型从两个模态中抽离出更多的与模态无关，或者说模态共享的信息。这样就打到模态对齐效果 那么在两个&lt;code&gt;loss&lt;/code&gt;的对抗的作用下，我们理论上就能尽可能利用上两个模态下有用的信息。&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611202851.png&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;但还记得对比学习吗，如果&lt;code&gt;loss&lt;/code&gt;有一个捷径解，那么网络可能就会坍塌到这个捷径解，在&lt;code&gt;kl loss&lt;/code&gt;中捷径解是两模态的分类器参数趋同，而且分类器是&lt;code&gt;linear layer&lt;/code&gt;，更容易被梯度扰动。动量更新保证&lt;code&gt;classier&lt;/code&gt;趋同之前有足够的时间来对齐可见光和红外的特征。最后，因为两个模态的特征已经对齐，所以我们就可以把两个特征平等来看，进行&lt;code&gt;id loss&lt;/code&gt;和中心损失的训练，这里的&lt;code&gt;id loss&lt;/code&gt;两个模态用同一个分类器&lt;/p&gt;
">【ReID论文笔记】Discover Cross-Modality Nuances for Visible-Infrared Person Re-Identification (MPANet)</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/lun-wen-yue-du-emerging-properties-in-self-supervised-vision-transformers-dino/"" data-c="
          &lt;p&gt;&lt;a href=&#34;https://github.com/LittleGuoKe/AI-and-Person-ReID/blob/main/%E8%AE%BA%E6%96%87%E5%88%86%E4%BA%AB%E6%B1%87%E6%80%BB/%E8%B5%B5%E5%AD%90%E8%BD%A9_20230315_DINO.pptx&#34;&gt;组会slides&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;首先简单看一下对比学习领域&lt;code&gt;DINO&lt;/code&gt;同时期或之前工作的经典方法，主要是这两个，1.&lt;code&gt;simCLR&lt;/code&gt;结构比较经典，也比较简单； 2. &lt;code&gt;DINO&lt;/code&gt;的模型结构与&lt;code&gt;BYOL&lt;/code&gt;相近，&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611173044.png&#34; style=&#34;zoom:67%;&#34; /&gt;
&lt;p&gt;首先对比学习是种自监督学习方法。有监督学习中每条数据的&lt;code&gt;Ground Truth&lt;/code&gt;，或者说语义标签，来自于人工标注，比如图示中用于分类的类标签&lt;code&gt;dog&lt;/code&gt;/ &lt;code&gt;cat&lt;/code&gt; ，但自监督学习没有利用人工标注，而是从无标注的数据中构造 &lt;code&gt;label&lt;/code&gt; ，而这个过程可以看作一个 &lt;code&gt;pretext task&lt;/code&gt;，委托任务或者说代理任务，比如说 &lt;code&gt;MAE&lt;/code&gt; 中将随机遮挡的图像作为输入，原图像作为&lt;code&gt;ground truth&lt;/code&gt;，设计损失函数让输出与原图像尽可能相似。我们可以期待在一个设计合理的&lt;code&gt;pretext task&lt;/code&gt;中，其训练的&lt;code&gt;backbone&lt;/code&gt;网络能被驱使着多多少少学习到，如何表达无标注数据的语义特征。&lt;/p&gt;
&lt;p&gt;自监督学习的场景往往是在大量无标注数据上预训练模型，之后再在标注有限的下游任务中微调模型参数&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611173526.png&#34; style=&#34;zoom: 67%;&#34; /&gt;
&lt;p&gt;那么很显然，不同自监督方法的一大区别是可以设计不同的代理任务，而对比学习中通常构建一个个体判别&lt;code&gt;Instance discrimination&lt;/code&gt;的任务，这个&lt;code&gt;task&lt;/code&gt;简单地说就是，既然无标注数据每张图片，都没有&lt;code&gt;label&lt;/code&gt;，那就每张图片都各自临时对应一个独特的&lt;code&gt;label&lt;/code&gt;好了，也就是如果把这个任务看作分类，那么每张图片单独作为一类，模型训练的目标就是尽可能把各张图片区分开来。其次呢，一张图片x可以通过数据增强得到一些图片(&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msubsup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;/msubsup&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;/msubsup&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;x^+_1, x^+_2&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1.0777700000000001em;vertical-align:-0.266308em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.811462em;&#34;&gt;&lt;span style=&#34;top:-2.433692em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;top:-3.1031310000000003em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mbin mtight&#34;&gt;+&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.266308em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.811462em;&#34;&gt;&lt;span style=&#34;top:-2.433692em;margin-left:0em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;top:-3.1031310000000003em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mbin mtight&#34;&gt;+&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.266308em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;)，这些图都可以视为相同&lt;code&gt;label&lt;/code&gt;，彼此互为正样本。而数据集中&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;x&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;以外的图片，和&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;x&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;x&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 的&lt;code&gt;label&lt;/code&gt;不同，彼此互为负样本。假设通过模型f提取图像特征，那么损失函数的设计原则就是最大化正样本特征的相似度，最小化负样本特征的相似度。&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611173610.png&#34; style=&#34;zoom:67%;&#34; /&gt;
&lt;p&gt;以上就是个体判别任务的流程，实质上这个任务给学习到的特征施加了两个约束，首先是&lt;code&gt;Alignment&lt;/code&gt;，也就是训练中损失函数迫使模型拉近正样本间的距离，因为正样本是同一张图像增强得到的不同图像，宏观上看是将相似的图像聚集了。数据增强中底层的视觉特征容易改变，比如旋转改变了像素纹理方向，而更抽象的语义特征不容易改变，比如一张&lt;code&gt;cat&lt;/code&gt;的图像旋转后里面的cat还是只有两只耳朵两只眼睛。&lt;/p&gt;
&lt;p&gt;让模型在这种过程中学习到对某些变换（例如平移，旋转，缩放等）不敏感的特征，而这种特征恰好就包含了图像的语义，因为图像无论平移，旋转，缩放，其语义是不变的&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Alignment&lt;/code&gt;这一约束保障模型能提取出数据增强中不变的语义信息；另一方面，&lt;code&gt;Uniformity&lt;/code&gt;这一约束拉开了负样本间的距离，这将驱使无标注数据中每张图像在特征空间中均匀分布，&lt;code&gt;Uniformity&lt;/code&gt;是有必要的，如果没有这个约束，那么模型就存在一个捷径解，那就是收敛时所有图像都输出相同或相近的特征，这样学到的特征没有意义，因为区分不开不同图片了，或者说模型只学到了所有数据共有的，更底层的语义。可以说&lt;code&gt;Alignment&lt;/code&gt;和&lt;code&gt;Uniformity&lt;/code&gt;是很多对比学习工作的方法论&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611173755.png&#34; style=&#34;zoom:67%;&#34; /&gt;
&lt;p&gt;&lt;code&gt;DINO&lt;/code&gt;模型结构相对复杂一点，首先来看相关工作&lt;code&gt;SimCLR&lt;/code&gt;的结构，首先构造正样本和负样本，假设&lt;code&gt;bactch_size&lt;/code&gt;为&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;n&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;n&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;那么其中每张图像通过数据增强得到&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;2&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.64444em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;个正样本，这一对正样本与其他&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;−&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;2n-2&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.72777em;vertical-align:-0.08333em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mbin&#34;&gt;−&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.64444em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;个增强数据互为负样本。损失函数的话是&lt;code&gt;softmax&lt;/code&gt;+交叉熵的形式，所有样本计算余弦相似度，损失函数分式中分子是一对正样本的相似度，分母是其中一个正样本与所有负样本相似度之和，这样模型参数优化中会受到 &lt;code&gt;Alignment&lt;/code&gt;与&lt;code&gt;Uniformity&lt;/code&gt;两种约束，符合对比学习的套路。在模型结构上呢分为两部分，&lt;strong&gt;Representation&lt;/strong&gt; 部分用&lt;code&gt;Resnet50&lt;/code&gt;提取特征，后面Projection是一层&lt;code&gt;MLP&lt;/code&gt;。最终舍弃Projection层，只保留Representation网络&lt;/p&gt;
&lt;p&gt;如果没有Projection层，那么在对比损失函数中就是直接比较&lt;code&gt;Resnet50&lt;/code&gt;提取的图像特征相似度，这会让正样本特征直接趋近，但正样本是同一图像数据增强得到的，这样得到的特征会损失数据增强相关的语义信息。例如一张猫的图片 旋转不同角度的图像特征相近，那就难以通过特征分布分辨猫的头是朝那边的了。加上一层&lt;code&gt;MLP&lt;/code&gt;的话，正样本间就可能不需要特别趋近了，只要特征过&lt;code&gt;MLP&lt;/code&gt;的结果趋近就行，一定程度上保留下了数据增强相关的语义信息&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611173910.png&#34; style=&#34;zoom:67%;&#34; /&gt;
&lt;p&gt;下面讲&lt;code&gt;BYOL&lt;/code&gt;，首先这篇工作follow了&lt;code&gt;simCLR&lt;/code&gt;的架构，其次&lt;code&gt;DINO&lt;/code&gt;的模型结构大体与&lt;code&gt;BYOL&lt;/code&gt;一样，因此原理上只重点讲一下&lt;code&gt;BYOL&lt;/code&gt;，它和&lt;code&gt;simCLR&lt;/code&gt;最大的不同是没有负样本了，只利用正样本，正样本还是成对的，损失函数就是正样本间的&lt;code&gt;MSE&lt;/code&gt;，但是还记得我们之前说过对比学习往往要靠负样本对特征施加&lt;code&gt;Uniformity&lt;/code&gt;约束吗&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611174041.png&#34; style=&#34;zoom:67%;&#34; /&gt;
&lt;p&gt;可以肯定的是，没有&lt;code&gt;Uniformity&lt;/code&gt;的对比学习是容易模型坍塌的，也就是特征空间中所有样本点集中到一起，因为&lt;code&gt;Uniformity&lt;/code&gt;是样本间的斥力，而&lt;code&gt;Alignment&lt;/code&gt;是样本间的吸引力&lt;/p&gt;
&lt;p&gt;为什么&lt;code&gt;BYOL&lt;/code&gt;能避免模型坍塌，这件事可能比较微妙，但很可能是&lt;code&gt;BYOL&lt;/code&gt;中的非对称模型结构导致的，我认为主要有以下两点原因&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611174116.png&#34; style=&#34;zoom:67%;&#34; /&gt;
&lt;p&gt;首先&lt;code&gt;BYOL&lt;/code&gt;中一对正样本送入的两支网络不是同一个网络（&lt;code&gt;simCLR&lt;/code&gt;中是同一个），而其中一支叫做&lt;code&gt;online network&lt;/code&gt;（上面一支）&lt;code&gt;target&lt;/code&gt;（下面），&lt;code&gt;target&lt;/code&gt;作为辅助网络，最终只保留&lt;code&gt;online&lt;/code&gt;的repersetation层.&lt;code&gt;online&lt;/code&gt;是通过损失函数的梯度更新的，而&lt;code&gt;target network&lt;/code&gt;在梯度计算中直接&lt;code&gt;detach&lt;/code&gt;掉了，每次迭代&lt;code&gt;target &lt;/code&gt;网络&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;ξ&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\xi&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.8888799999999999em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.04601em;&#34;&gt;ξ&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;会去直接照搬&lt;code&gt;online&lt;/code&gt;网络的权重&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;θ&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\theta&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.69444em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.02778em;&#34;&gt;θ&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;，但每次只会照搬一点点，也就是动量更新，其中每次更新中自身参数权重为&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mn&gt;0.99&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;0.99&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.64444em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;9&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;，因此&lt;code&gt;target &lt;/code&gt;网络可以看作是在和&lt;code&gt;online&lt;/code&gt;网络同步训练，但更新速度远慢于&lt;code&gt;online&lt;/code&gt;。由于随机初始化，&lt;code&gt;target&lt;/code&gt;初始时特征分布是分散的，训练过程中&lt;code&gt;online&lt;/code&gt;网络的特征分布不断地对&lt;code&gt;target&lt;/code&gt;的特征分布进行拟合，而由于动量更新，&lt;code&gt;target&lt;/code&gt;的特征分布改变的慢，因此起码在训练初期可以维持住一定的&lt;code&gt;Uniformity&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;但是动量更新应该是无法完全避免模型坍塌的，如果&lt;code&gt;target &lt;/code&gt;网络通过动量更新，其参数与&lt;code&gt;online&lt;/code&gt;网络特别相近时，那就可以看作同一个网络，此时就和&lt;code&gt;simCLR&lt;/code&gt;一样了，那肯定会有模型坍塌的问题，因此&lt;code&gt;BYOL&lt;/code&gt;的关键可能在于引入了一个非对称的prediction层，这一层和projection一样也是普通的&lt;code&gt;MLP&lt;/code&gt;。我们可以从以下角度理解这个改进，模型坍塌是说特征集中到同一点，或者说模型输出常数，因为只有&lt;code&gt;ALIgnment&lt;/code&gt;约束的话这就是最优解，这样模型会没法继续更新。而多加入一层&lt;code&gt;MLP&lt;/code&gt;的话模型训练时拟合的就是&lt;code&gt;online&lt;/code&gt;的prediciton的分布与&lt;code&gt;target&lt;/code&gt;的projection，那两支网络在projection层的分布就不一定相同，而projection层之前&lt;code&gt;target&lt;/code&gt;网络参数是来源于&lt;code&gt;online&lt;/code&gt;的，因此&lt;code&gt;target&lt;/code&gt;网络肯定能继续更新（参数存在差异），上下两支网络就很难把最终的&lt;code&gt;Loss&lt;/code&gt;降下来。可以把这个prediction理解成一种随机扰动，让上下两支网络难以陷入稳定的输出一致的状态&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611174259.png&#34; style=&#34;zoom:67%;&#34; /&gt;
&lt;p&gt;然后来看&lt;code&gt;DINO&lt;/code&gt;，&lt;code&gt;DINO&lt;/code&gt;的话也是一个非对称结构，与&lt;code&gt;BYOL&lt;/code&gt;不同，DINO&lt;code&gt;去掉&lt;/code&gt;了prediciton，而是在&lt;code&gt;target&lt;/code&gt;网络，也就是动量更新参数的那个网络上加入了一个&lt;code&gt;Centering&lt;/code&gt;操作，实际上就是去均值，&lt;code&gt;target&lt;/code&gt;网络会维护一个变量&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;C&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.68333em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.07153em;&#34;&gt;C&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;,&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;C&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.68333em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.07153em;&#34;&gt;C&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;是&lt;code&gt;target&lt;/code&gt;网络所有输出的指数移动平均，&lt;code&gt;Centering&lt;/code&gt;强行改变了target输出的分布，让&lt;code&gt;target&lt;/code&gt;网络的输出减去均值&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;C&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.68333em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.07153em;&#34;&gt;C&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;，&lt;code&gt;target&lt;/code&gt;输出的特征分布便很难聚集到一点，&lt;code&gt;online&lt;/code&gt;的输出分布又是需要去拟合&lt;code&gt;target&lt;/code&gt;的，因此保证了最终模型的&lt;strong&gt;Uniformity&lt;/strong&gt;。但是去均值操作可能让&lt;code&gt;target&lt;/code&gt;输出接近均匀分布，这样&lt;code&gt;online&lt;/code&gt;学到的输出也可能是均匀分布，那就没有意义了，因此&lt;code&gt;Centering&lt;/code&gt;后接&lt;code&gt;softmax&lt;/code&gt;放大输出中各维度的差异，&lt;code&gt;online&lt;/code&gt;后也接&lt;code&gt;softmax&lt;/code&gt;，&lt;code&gt;DINO&lt;/code&gt;损失函数是两个&lt;code&gt;softmax&lt;/code&gt;得到分布的交叉熵，效果也是拉近正样本间的距离&lt;/p&gt;
&lt;p&gt;以上就是&lt;code&gt;DINO&lt;/code&gt;的架构原理，下面我们按写作顺序看看原文&lt;/p&gt;
&lt;p&gt;从文章标题&lt;strong&gt;Emerging Properties in Self-Supervised Vision Transformers&lt;/strong&gt;看，这篇论文的工作就是把视觉&lt;code&gt;Transformer&lt;/code&gt;模型和自监督结合起来。&lt;/p&gt;
&lt;p&gt;首先来看&lt;code&gt;motivation&lt;/code&gt;，&lt;code&gt;ViT&lt;/code&gt;一般比卷积网络参数量更大，训练时间更长，是数据驱动的模型，但有监督的&lt;code&gt;vit&lt;/code&gt;学到的特征可能缺少可解释的特性。而在&lt;code&gt;NLP&lt;/code&gt;中，&lt;code&gt;BERT&lt;/code&gt;等模型通过自监督预训练，一定程度上可以表征更高层的语义信息，比如通过可视化注意力权重可证明模型学习到了句子上下文的关联，因此作者主要参考了视觉领域中的自监督学习的工作，这里主要引用了&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;4&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.64444em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;4&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;篇，&lt;code&gt;SwAV&lt;/code&gt;, &lt;code&gt;simCLR&lt;/code&gt;,&lt;code&gt;MOCO&lt;/code&gt;,&lt;code&gt;BYOL&lt;/code&gt;，都用的是对比学习，&lt;code&gt;DINO&lt;/code&gt;改进了对比学习的网络结构，提出新的避免模型坍塌的方法，而且之前工作中represetation层一般用卷积网络，这里换成了ViT,是一个创新的地方&lt;/p&gt;
&lt;p&gt;而&lt;code&gt;Contribution&lt;/code&gt;主要是，&lt;code&gt;DINO&lt;/code&gt;通过自监督预训练使&lt;code&gt;ViT&lt;/code&gt;学到了富含语义信息，而且适用于下游任务的特征。下面这个图中是将&lt;code&gt;ViT&lt;/code&gt;的&lt;code&gt;class token&lt;/code&gt;相关的注意力权重可视化的结果，可以看到ViT学到了场景布局、物体边界等空间结构上的语义。其次，将预训练的&lt;code&gt;ViT&lt;/code&gt;用于&lt;code&gt;Imagenet&lt;/code&gt;的分类任务上，特征分类器只用简单的&lt;code&gt;k&lt;/code&gt;邻近就能达到&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mn&gt;78&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;78&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.64444em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;8&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;的&lt;code&gt;acc&lt;/code&gt;。最后作者强调了网络结构，具体改进前面说了，作者把他的对比学习方法强调为无标注的知识蒸馏，这也是&lt;code&gt;DINO&lt;/code&gt;简称来源&lt;/p&gt;
&lt;p&gt;相关工作部分，作者首先讲了使用负样本的对比学习的缺点，那就是一个正样本要和足够的负样本去比较，不然&lt;code&gt;Uniformity&lt;/code&gt;的约束肯定很弱，那就学不好，通常每个&lt;code&gt;batch&lt;/code&gt;中不同图片互为负样本，那这就要&lt;code&gt;batch_size&lt;/code&gt;足够匹配数据集大小，这种方法在大型数据集就会受限于&lt;code&gt;batch_size&lt;/code&gt;&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611174552.png&#34; style=&#34;zoom:67%;&#34; /&gt;
&lt;p&gt;作者将&lt;code&gt;DINO&lt;/code&gt;的对比学习视为一种知识蒸馏，这一种不同视点的解释也更能支撑文章的方法吧。在这里，他将使用梯度更新的网络叫做&lt;code&gt;student&lt;/code&gt;，动量更新的网络称为&lt;code&gt;teacher&lt;/code&gt;，一般知识蒸馏是&lt;code&gt;student&lt;/code&gt;拟合&lt;code&gt;teacher&lt;/code&gt;，&lt;code&gt;teacher&lt;/code&gt;是固定的。但这里&lt;code&gt;teacher&lt;/code&gt;也是通过动量更新与&lt;code&gt;student&lt;/code&gt;缓慢同步的，简单来说，&lt;code&gt;DINO&lt;/code&gt;就是让模型不断从以前的自己学习，总结&lt;code&gt;student&lt;/code&gt;学到的知识然后超越&lt;code&gt;teacher&lt;/code&gt;，通过自我内卷让自己从无到有训练出一个好的&lt;code&gt;backbone&lt;/code&gt;（&lt;em&gt;really?&lt;/em&gt;）&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611174820.png&#34; style=&#34;zoom:67%;&#34; /&gt;
&lt;p&gt;下一部分&lt;code&gt;Approach&lt;/code&gt;，之前讲了原理，那就只看一下几个细节，作者提出方法的切入点是知识蒸馏，而知识蒸馏中通常用交叉熵损失函数拉近&lt;code&gt;student-teacher&lt;/code&gt;的输出分布，所以&lt;code&gt;DINO&lt;/code&gt;沿用了了交叉熵损失。第二，正样本在数据增强前都是通过随机裁剪获得，student网络使用大尺寸裁剪，&lt;code&gt;teacher&lt;/code&gt;使用小尺寸，根据对比学习的方法论，我们可以鼓励模型学习到局部-全局视图下不变的特征。第三，不使用&lt;code&gt;BN&lt;/code&gt;，因为&lt;code&gt;BYOL&lt;/code&gt;这篇工作避免模型坍塌的机制被质疑是&lt;code&gt;BN&lt;/code&gt;作用。&lt;em&gt;(但是&lt;code&gt;BN&lt;/code&gt;有去均值，&lt;code&gt;centering&lt;/code&gt;不就是近似去均值了么？)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;然后作者解释了防止模型坍塌的策略，这个之前讲过了，作者这里强调了一下&lt;code&gt;centering&lt;/code&gt;中&lt;code&gt;teacher&lt;/code&gt;的输出均值是动量更新的，那受&lt;code&gt;batch_size&lt;/code&gt;影响就比较小，&lt;code&gt;batch_size&lt;/code&gt;较小的话计算的均值偏差大，动量更新的话可以减小偏差对&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;c&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34;&gt;c&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;的影响&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Approach&lt;/code&gt;的下半部分主要介绍了训练的具体实现，数据集是&lt;code&gt;Imagenet&lt;/code&gt;的去标注数据，训练用的模型有&lt;code&gt;resnet50&lt;/code&gt;, &lt;code&gt;vit-b&lt;/code&gt;, &lt;code&gt;vit-s&lt;/code&gt;，完成与训练后要在下游任务上对学到的特征进行评估，因为对于无监督或自监督，在下游任务中表现好预训练的特征才是好的特征，这里下游任务是&lt;code&gt;imagenet&lt;/code&gt;验证集上的图像分类，后面实验中用了两种方法做这个下游任务,在预训练模型后接一个线性分类器，或k邻近分类，这两个分类头的区别在于线性分类器会&lt;code&gt;finetune&lt;/code&gt;预训练模型，而&lt;code&gt;knn&lt;/code&gt;无参数，不调整预训练参数。&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611175000.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;实验部分，作者为了给自己的&lt;code&gt;Contribution&lt;/code&gt;提供支撑，也把结果分为两部分，首先在&lt;code&gt;imagenet&lt;/code&gt;上验证ViT学到的特征适用于下游任务；其次分析了ViT学到的特征的语义。首先在&lt;code&gt;imagenet&lt;/code&gt;上，作者与其他自监督工作的横向对比，使用相同的&lt;code&gt;backbone&lt;/code&gt;网络&lt;code&gt;resnet50&lt;/code&gt;时，&lt;code&gt;DINO&lt;/code&gt;达到&lt;code&gt;SOTA&lt;/code&gt;。在使用&lt;code&gt;Vit-s&lt;/code&gt;时&lt;em&gt;outperforms BYOL, MoCov2 and SwAV by +3.5% with linear classification and by +7.9% with k-NN evaluation.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;另外作者的一点发现就是&lt;code&gt;DINO backbone&lt;/code&gt;使用&lt;code&gt;vit-s&lt;/code&gt;时&lt;code&gt;KNN&lt;/code&gt;相比于&lt;code&gt;linear&lt;/code&gt;准确率降得很少，那这说明&lt;code&gt;vit&lt;/code&gt;学到的特征分布已经比较接近&lt;code&gt;ImageNet&lt;/code&gt;验证集的数据分布了啊，所以&lt;code&gt;linear&lt;/code&gt;这种有参数的分类器虽然可以缩小两者的&lt;code&gt;gap&lt;/code&gt;,但提升效果更有限。所以作者认为&lt;code&gt;vit&lt;/code&gt;学到的特征可能更适合直接比较特征的下游任务，因此还做了相关的后续实验。&lt;/p&gt;
&lt;p&gt;其次是&lt;code&gt;DINO&lt;/code&gt;改用不同的&lt;code&gt;backbone&lt;/code&gt;网络的纵向对比，相比于在&lt;code&gt;vit&lt;/code&gt;中增加&lt;code&gt;Transformer&lt;/code&gt;层数。这是很自然的结果，减小&lt;code&gt;vit&lt;/code&gt;分割图块的大小的话&lt;code&gt;vit&lt;/code&gt;将输入图片转换成的&lt;code&gt;token&lt;/code&gt;序列就变长了，输入信息损失更少，更容易学到好的表征。这与&lt;code&gt;vit&lt;/code&gt;原文中有监督任务一致，减小图块的大小提升模型性能。&lt;em&gt;(ViT-B/(8 × 8 patches) with DINO achieves 80.1% top-1 in linear and 77.4% with a k-NN classifier with 10× less parameters and 1.4× faster run time than previous SOTA(SCLRv2))&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;在实验第二部分，作者试图解释&lt;code&gt;DINO&lt;/code&gt;自监督的&lt;code&gt;viT&lt;/code&gt;学到的特征的特性，一共是三个特性：一是特征直接用于检索，二是学习到了图像中物体位置的信息，三是到下游任务良好的可迁移性&lt;/p&gt;
&lt;p&gt;首先作者观察到&lt;code&gt;vit+kNN&lt;/code&gt;在&lt;code&gt;IMAGENET&lt;/code&gt;上的表现，&lt;code&gt;DINO&lt;/code&gt;中&lt;code&gt;vit&lt;/code&gt;学到的特征可能适合直接用于检索，在图像检索任务上使用&lt;code&gt;kNN&lt;/code&gt;对&lt;code&gt;backbone&lt;/code&gt;输出的特征进行检索，可以看到，使用&lt;code&gt;DINO&lt;/code&gt;预训练时，&lt;code&gt;vit-S&lt;/code&gt;在两个数据集上表现比有监督训练的好，另外作者强调自监督的优点在于可以用大量无标注数据进行训练，在换了个大型数据集后，&lt;code&gt;vit-s&lt;/code&gt;的平均准确度接近了有监督的&lt;code&gt;resnet101&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;DINO+viT&lt;/code&gt;的第二个特征是能学到图像的结构信息，&lt;code&gt;vit&lt;/code&gt;中把输入图像的所有&lt;code&gt;patch&lt;/code&gt;转成&lt;code&gt;token&lt;/code&gt;序列后，会再加入一个&lt;code&gt;class token&lt;/code&gt;， 最终输出为通过&lt;code&gt;transformer encoder&lt;/code&gt;的&lt;code&gt;class token&lt;/code&gt;，所以&lt;code&gt;class token&lt;/code&gt;与其他&lt;code&gt;patch&lt;/code&gt;的注意力分数就体现了&lt;code&gt;vit&lt;/code&gt;最终输出的特征更注意原图中哪些位置，把注意力分数还原到每个&lt;code&gt;patch&lt;/code&gt;对应的位置，然后可视化得到一个&lt;code&gt;self-attention map&lt;/code&gt;，可以看到这个&lt;code&gt;map&lt;/code&gt;明显体现了原图的空间结构，所以作者认为&lt;code&gt;viT&lt;/code&gt;的特征适合做图像分割任务，甚至这种可视化的&lt;code&gt;self-attention map&lt;/code&gt;也可以用来直接做分割任务。【&lt;code&gt;vit&lt;/code&gt;原文中用的是 &lt;code&gt;attention rollout&lt;/code&gt;算法可视化&lt;code&gt;attention map&lt;/code&gt;】&lt;/p&gt;
&lt;p&gt;于是作者首先利用&lt;code&gt;DINO&lt;/code&gt;预训练的&lt;code&gt;vit&lt;/code&gt;，在&lt;code&gt;DAVIS-2017&lt;/code&gt;数据集上做视频实例分割任务，作者说只直接利用连续帧的特征做分割，不对预训练模型&lt;code&gt;finetune&lt;/code&gt;，结果&lt;code&gt;Vit-s/8&lt;/code&gt;比有监督方法还要好，足以说明&lt;code&gt;DINO&lt;/code&gt;中的&lt;code&gt;vit&lt;/code&gt;确实学到了一些空间结构信息&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611175432.png&#34; style=&#34;zoom:67%;&#34; /&gt;
&lt;p&gt;然后作者又对&lt;code&gt;vit&lt;/code&gt;的&lt;code&gt;self-attention map&lt;/code&gt;做了一些其他实验，首先&lt;code&gt;class token&lt;/code&gt;与其他&lt;code&gt;patch&lt;/code&gt;的注意力分数之和为&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;1&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.64444em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;，作者只保留部分&lt;code&gt;patch&lt;/code&gt;，使其注意力分数之和不超过&lt;code&gt;0.6&lt;/code&gt;，保留的&lt;code&gt;patch&lt;/code&gt;直接作为图像分割的&lt;code&gt;mask&lt;/code&gt;。这样做的话，在&lt;code&gt;PASCAL VOC12&lt;/code&gt;数据集上，&lt;code&gt;DINO&lt;/code&gt;自监督预训练的的&lt;code&gt;vit-s&lt;/code&gt;甚至比直接有监督图像分割的性能好&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230611175525.png&#34; style=&#34;zoom:67%;&#34; /&gt;
&lt;p&gt;其次我们刚才可视化的是&lt;code&gt;class token&lt;/code&gt;在所有注意力头上与其他&lt;code&gt;patch&lt;/code&gt;的注意力分数，接下来作者把 每个自注意力头对应的&lt;code&gt;self-attention map&lt;/code&gt;用不同颜色绘制后叠加，可以看到不同&lt;code&gt;attention head&lt;/code&gt;注意的是图像不同的部分，佐证了&lt;code&gt;dino&lt;/code&gt;可以引导模型学习一些高层的语义。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;DINO+viT&lt;/code&gt;的第三个特征是能学到迁移性好的特征，因为自监督的对比学习中，模型训练中不以人为定义的&lt;code&gt;label&lt;/code&gt;为导向，学到的可能是更通用的语义信息。为在一开始的实验中，&lt;code&gt;DINO&lt;/code&gt;的&lt;code&gt;viT&lt;/code&gt;是在去除标注的&lt;code&gt;imagenet&lt;/code&gt;训练集预训练的，而下游任务是&lt;code&gt;imagenet&lt;/code&gt;验证集上的图像分类，同源数据说明不了预训练模型的可迁移性，所以作者有针对这一点做了新的实验，同样是&lt;code&gt;imagenet&lt;/code&gt;上预训练&lt;code&gt;vit&lt;/code&gt;，但在不同数据集上微调模型做下游任务，结论是&lt;code&gt;DINO&lt;/code&gt;比起有监督预训练在不同下游任务的泛化性更强，指标上基本高&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;∼&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;1\sim 2&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.64444em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;∼&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.64444em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;个点。&lt;/p&gt;
&lt;p&gt;最后是两个消融实验,首先作者想证明&lt;code&gt;DINO&lt;/code&gt;网络结构中各个部分的有效性，于是对比了几种&lt;code&gt;DINO&lt;/code&gt;结构的变种，加上参考工作中的结构或是删除原有部分。可以看出对于提升预训练效果比较关键的部分是&lt;code&gt;DINO&lt;/code&gt;默认使用的交叉熵&lt;code&gt;loss&lt;/code&gt;，以及对正样本采用不同尺寸的裁剪。不使用动量更新的策略时，发生了模型坍塌，所以无负样本对比学习的一个关键可能是构造非对称的网络结构,另外就是验证了减小&lt;code&gt;vit&lt;/code&gt;中图块的大小能提升模型自监督训练的效果&lt;/p&gt;
">【论文阅读】Emerging Properties in Self-Supervised Vision Transformers (DINO)</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/za-wu-dai-tian-keng-kai-keng/"" data-c="
          &lt;p&gt;最近要写/想写的文章：&lt;/p&gt;
&lt;ul class=&#34;contains-task-list&#34;&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-562225&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-562225&#34;&gt; 实验室新手教程补全（易）&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-8507743&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-8507743&#34;&gt; 华为昇腾显卡编译/推理框架（难）&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-1030847&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-1030847&#34;&gt; gitlab协作与维护教程（易）&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-3501306&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-3501306&#34;&gt; redis底层数据结构与实现（难）&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-2407678&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-2407678&#34;&gt; wandb（易）&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-5780386&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-5780386&#34;&gt; python元编程（难）&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-364819&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-364819&#34;&gt; 《c++20设计模式——可复用的面向对象设计方法》/《c++并发编程实战》/《多线程服务端编程muduo》随笔（难）&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-6315577&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-6315577&#34;&gt; 红黑树/AVL/Splay/B+树原理与c++实现（中等）&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-9270195&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-9270195&#34;&gt; Linux网络编程（难）&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-9645621&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-9645621&#34;&gt; .NET开坑（难）&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-772300&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-772300&#34;&gt;  树莓派（明年云服务器退役后准备换树莓派+内网穿透了）&lt;/label&gt;&lt;/li&gt;
&lt;li class=&#34;task-list-item&#34;&gt;&lt;input class=&#34;task-list-item-checkbox&#34; disabled=&#34;&#34; type=&#34;checkbox&#34; id=&#34;task-item-3973246&#34;&gt;&lt;label class=&#34;task-list-item-label&#34; for=&#34;task-item-3973246&#34;&gt; 实验室管理员教程（难）&lt;/label&gt;&lt;/li&gt;
&lt;/ul&gt;
">【杂物】待填坑/开坑</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/2021-ruan-gong-ti-wen-hui-gu-yu-ge-ren-zong-jie/"" data-c="
          &lt;center&gt;#北航本科软件工程导论，2021年春季学期&lt;/center&gt;
&lt;!--more--&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/2021-ruan-gong-ti-wen-hui-gu-yu-ge-ren-zong-jie.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;项目&lt;/th&gt;
&lt;th&gt;内容&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;这个作业属于哪个课程&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://edu.cnblogs.com/campus/buaa/BUAA_SE_2021_LR&#34;&gt;2021春季软件工程（罗杰 任健）&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;这个作业的要求在哪里&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://edu.cnblogs.com/campus/buaa/BUAA_SE_2021_LR/homework/12089&#34;&gt;提问回顾与个人总结&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;我在这个课程的目标是&lt;/td&gt;
&lt;td&gt;和我的团队开发一个真正的软件，一起提升开发与合作的能力&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;这个作业在哪个具体方面帮助我实现目标&lt;/td&gt;
&lt;td&gt;对软工课程作总结&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;以前提问的博客&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://www.cnblogs.com/zixfy/p/14527968.html&#34;&gt;2021软工-个人阅读作业#2&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;一-解答自己提出的问题&#34;&gt;一、解答自己提出的问题&lt;/h4&gt;
 &lt;center&gt; &lt;h5&gt;问题A&lt;/h5&gt; &lt;/center&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;结对编程总能做到1 + 1 &amp;gt; 2 吗？教材中第四章出现了结对编程(&lt;code&gt;Pair programming&lt;/code&gt;)，这是一种变态的代码复审，有别于传统的&lt;code&gt;Code Review&lt;/code&gt;。书中强调&amp;quot;复审的目的在于纠错改进与教育更多的开发人员&amp;quot;，随后在4.5.3节说到Pair中两人对程序深入了解，复审效果好。但代码复审包括具体代码、效能、设计规范等多方面，Pair中有时间像Code Review一样周全的考虑吗？在传授经验这个方面，Pair中比较多的也是口头交流吧，那么有些经验不就只停留在两人之间了吗？当开发想到一个新idea，为什么不形成书面形式在Code Review中“让更多的成员熟悉项目各部分的代码”？为什么想着不间断地复审而不去花时间提高团队Code Review的效率？&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;结对编程的优点是可以进行实时的代码复审与交流，从而提高二人的工作效率,减少可能出现的bugs。在团队开发中，相同分工的人员也适合以结对编程的形式进行开发，修复难以发现的漏洞时结对编程也往往能快速定位问题。而团队内的代码复审可以让成员对一份签入代码从一致性、编码风格、安全与冗余等方面综合监督，同时及时发现所用技术方案/框架的不足，减小试错成本。相比于结对编程大量的面对面交流，代码复审还能自然地衍生出技术说明、API说明等文档，一份确定的代码规范不可或缺，一方面可以统一项目代码风格，另一方面也能提高团队代码复审的效率。总之，在实际开发中是否进行结对编程，都需要从时间、工作重合度、成员相性等方面考量，灵活选择开发的方式。&lt;/p&gt;
&lt;center&gt; &lt;h5&gt;问题B&lt;/h5&gt; &lt;/center&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;代码测试中覆盖率要达到100%吗？教材提到“100%的代码覆盖率并不等同于100%的正确性”。从投入产出比的角度考虑，覆盖率达到100%势必要更多地考虑琐碎的问题，覆盖率不错的情况下边际收益岂不是下降了？100%的代码覆盖率并不说明代码正确，我认为覆盖率是一个基本指标，而不是目标。全覆盖的测试不一定考虑全了外部的问题&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;代码覆盖率是一个基本指标，而不是目标，也不能保证代码完全没有问题。结对编程项目中虽然实现了较高的行覆盖率，但分支覆盖率与特殊输入数据方面没有做到尽可能完善，导致在评测中仍出现了一些问题。在实际团队开发中，生产环境中的各种细节需要考虑，代码的性能，可靠性与可拓展性也很重要，软件不是做到刚好可用的程度就行了，发布前需要通过压力测试、CI/CD自动化测试等手段保障质量。在生产环境中，可能遇到开发时难以察觉的问题，如数据的存储安全与鉴权问题、远程服务器带宽限制，因此无法全面考虑周全时，就需要开发组吃狗食或尽早发布征求用户反馈，及时处理新问题。其次一个例子是多设备适配的问题，无论WEB/移动端/小程序都可能遇到，团队项目仅发布于Android平台，而Android设备型号过多，在发布软件后，确实在部分机型上出现了分辨率自适应、硬件性能不足的问题，软件发布前可以增加测试用设备、使用WeTest等工具，以解决机型适配问题。&lt;/p&gt;
&lt;center&gt; &lt;h5&gt;问题C&lt;/h5&gt; &lt;/center&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;根据敏捷理论，对于执行原定计划更倾向于响应变化，并与客户合作。所以在冲刺中产生新的需求不应是常态嘛。真有重要变化时，为什么不在Scrum Meeting中一齐讨论此改动的重要性和急迫性再考虑进不进行工作上的调整？既然每次新的需求产生时都可能波及到系统中多个模块，或者是现在完全没有考虑的优化方向，那么有时重构不可避免，拖到Sprint结束会不会导致问题积压，错过重构的黄金时间，Sprint中的安排不可改变吗？敏捷还强调个人和交流，这在小团队很奏效，团队规模大了以后难以保证高效的交流。而且相比传统的软件开发模式不重视正式的文档，这在团队工作交接的时候会不会有困难，敏捷开发中怎么将一个项目做大做长远？&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;实际团队项目中，只有两次冲刺的工时，因此需要适当舍弃一些边缘功能，尽可能接近开发计划吧，比如考虑到开发时间与功能重要性，团队软件最终没有实现好友、聊天等功能，但将精力投入在联机游戏这个核心功能之上。同时在β阶段初期，为了实现联机功能，及时花时间修改了原有代码，抽象出“玩家”实体，以防止冲刺阶段中出现难以拓展代码的问题。敏捷开发中，很重要的一环就是在冲刺结束后根据用户反馈及时调整计划，修改需求，团队开发中在β阶段就根据反馈额外加入了教程等功能。&lt;/p&gt;
&lt;p&gt;为了保证团队工作的交接，首先代码本身需要有良的架构，不能内部过度耦合；其次要保证有必要的规范化的文档，如客户端/服务端的接口说明文档，代码细节方面首先需要统一代码风格，否则接手者可能难以适应混乱的编码方式；同时需要pydoc/jsdoc等格式化的注释，方便快速上手代码。&lt;/p&gt;
&lt;center&gt; &lt;h5&gt;问题D&lt;/h5&gt; &lt;/center&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;写不出好代码的PM是好PM吗？既然PM要做其他的那么多事情，那么对TA的代码能力有要求吗，要求多好呢？我认为PM应该做到的是对开发使用的技术路线与架构有个基本的认识，才能更合理地评估某一功能开发的难度，这样可以避免异想天开的设计，也更方便与开发者交流。&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;PM也不一定需要对开发使用的技术路线与架构都很了解，有能力把握住团队项目的全栈开发的要求太高了，所以我认为合适的团队组织形式是根据开发方向固定经验最多的一辆位成员作为技术顾问，并负责团队的技术选型与代码架构设计。在课程团队开发中，PM更不可代替的作用应是团队开发计划的制定、PUSH成员落实开发进度、及时协调成员间的工作。&lt;/p&gt;
&lt;center&gt; &lt;h5&gt;问题E&lt;/h5&gt; &lt;/center&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;创新不必是领域内专家，关键不必是技术？如果很多企业都只安于跟上主流技术，一味追求这些模式创新，怎么解决相关市场的同质化问题？&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;软件不一定需要通过技术创新成功，在团队项目中，大家都是在做传统的互联网软件，而且都是C端的软件。因此软件背后使用什么技术，使用者很难关心，使用者的评价往往是依据实际使用中的直接反馈，因此团队开发的重点是进行“模式”上的创新，应用现有的技术/框架去满足用户最重要的需求。没有硬性指标，因此在开发中只需要实现安全、可靠的服务端，性能只需要满足个体使用的需求，如解决服务器带宽限制、应对大量并发访问等；开发中需要实现好用的客户端，因为客户端直接与客户打交道，UI界面设计、交互流程设计、网络性能优化都是值得投入大量开发精力的模块。&lt;/p&gt;
&lt;p&gt;同时团队项目中开发的软件为移动端游戏，因此创新方面还涉及到游戏机制的创新，这方面开发组没有选择独立从头设计一套游戏机制，主要考虑到自定游戏机制可能对玩家入门产生一定门槛，因此和广大游戏一样，开发的游戏基于多种游戏玩法，对原有游戏机制进行了细节上的修改与创新。&lt;/p&gt;
&lt;h4 id=&#34;二-实践中学到的知识点&#34;&gt;二、实践中学到的知识点&lt;/h4&gt;
&lt;center&gt; &lt;h5&gt;需求&lt;/h5&gt; &lt;/center&gt;
&lt;p&gt;首先需求分析阶段需要通过问卷等调研方案获得一定量的真实反馈，用户需求很难是自己心中想当然的样子，它需要数据来佐证。同时另一个重点是对现有竞品的调查，找出自软件拿得出手的差异化功能是必要的，表面的同质化会直接影响用户使用的欲望。&lt;/p&gt;
&lt;center&gt; &lt;h5&gt;设计&lt;/h5&gt; &lt;/center&gt;
&lt;p&gt;对于一个万行级的团队项目，开发前的设计相当关键，如上文言，经过专门的代码架构设计才能把软件功能模块化，拆分成可分配的任务。同时作为游戏开发组，团队项目中设计环节更加重要，游戏机制上的变更难以预测，有时需要根据反馈修改游戏底层逻辑，因此开发中的游戏状态机设计与游戏运行脚本需要解耦合，有良的可拓展性&lt;/p&gt;
&lt;center&gt; &lt;h5&gt;实现/测试&lt;/h5&gt; &lt;/center&gt;
&lt;p&gt;开发中高效工作的关键是及时的沟通与合理利用Git等多人协作开发工具，我体会到了每日例会的重要性，小组成员可以在例会上找到开发的节奏，及时总结并找出现存问题。在测试方面，不但要做好客户端/服务端的单元测试，也要综合考虑软件的安全性，如数据传输与存储的加密。当然，团队开发中，游戏客户端的多设备适配与测试、服务端的压力测试都是不可或缺的一环。&lt;/p&gt;
&lt;center&gt; &lt;h5&gt;发布/维护&lt;/h5&gt; &lt;/center&gt;
&lt;p&gt;软件发布后，如果很难通过过硬的核心功能吸引长期用户，则有必要通过各种宣发手段招徕用户，即使是短时性的用户，因此需要通过微信、产品主页等方式积极进行宣传。在维护方面，如果想把团队项目长远地做下去，那么详尽的文档是必要的，同时在迭代开发中，要充分考虑到软件更新对旧版本的影响，在WEB开发中，接口地址的更改并无太大影响，但在Android平台上已发布的APP会遇到接口不可用的问题（如替换HTTP为HTTPS），这时就需要在代理网关处进行重定向，在不强制更新的情况下把对用户使用的影响降至最低。&lt;/p&gt;
&lt;h4 id=&#34;三-项目经历之中的心得&#34;&gt;三、 项目经历之中的心得&lt;/h4&gt;
&lt;center&gt; &lt;h5&gt;个人/结对项目&lt;/h5&gt; &lt;/center&gt;
&lt;p&gt;个人阅读作业1中我归档计算机系中学习历程，思考自己的定位与未来；个人阅读作业2中我通过阅读教材提炼所思所惑，并初探&lt;code&gt;Git,  CI/CD&lt;/code&gt;相关工具链。在结对项目中，我最大的收获是提升了交流能力，并体会到了代码架构设计的重要性，同时我也为无法进行阶段三的迭代开发任务感到可惜。&lt;/p&gt;
&lt;center&gt; &lt;h5&gt;团队项目&lt;/h5&gt; &lt;/center&gt;
&lt;p&gt;在团队项目中，我们的团队进行的是一个安卓手游的开发，我作为一个没有接触过Unity 3D的开发人员，却在发开阶段得到了有相关经验的队友的大力帮助，从而顺利地完成了一部分场景、脚本搭建以及游戏内UI开发的工作。依靠团队的力量，我们才能从零开始实现一个五脏俱全的游戏软件，在此感谢PM/服务端开发lcy，网络编程/游戏脚本开发组qy，wcf，UI组yyh，zsk的共同努力与付出。&lt;/p&gt;
">【老物】2021软工-提问回顾与个人总结</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/lao-wu-zai-tan-jie-dui-bian-cheng-xia/"" data-c="
          &lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;项目&lt;/strong&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;内容&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;这个作业属于哪个课程&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;a href=&#34;https://edu.cnblogs.com/campus/buaa/BUAA_SE_2021_LR/&#34;&gt;2021春季计算机学院软件工程(罗杰 任健)&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;这个作业的要求在哪里&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;a href=&#34;https://edu.cnblogs.com/campus/buaa/BUAA_SE_2021_LR/homework/11906&#34;&gt;结对项目-第三阶段&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;我们在这个课程的目标是&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;和团队开发真正的软件，一起提升开发与合作的能力&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;这个作业在哪个具体方面帮助我们实现目标&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;通过结对编程学习协作设计与编码、代码复审、CI使用等&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h5 id=&#34;成员介绍&#34;&gt;成员介绍&lt;/h5&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;项目&lt;/th&gt;
&lt;th&gt;内容&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;结对项目第一阶段的&lt;code&gt;Gitlab&lt;/code&gt;仓库地址&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://gitlab.buaaoo.top/2021_alige_homeworks/pair_works/2021_zhengyang_zhu-zixuan_zhao_pair_work&#34;&gt;Pair Programming&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;二人的学号后四位&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;博客地址&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://www.cnblogs.com/ha-na-se/&#34;&gt;MadokaHomura(朱正阳)&lt;/a&gt;,  &lt;a href=&#34;https://www.cnblogs.com/zixfy/&#34;&gt;zixfy(赵子轩)&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h5 id=&#34;前情回顾&#34;&gt;前情回顾&lt;/h5&gt;
&lt;p&gt;&lt;a href=&#34;https://www.cnblogs.com/zixfy/p/14578813.html&#34;&gt;初见，结对编程！(上)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.cnblogs.com/zixfy/p/14612331.html&#34;&gt;磨练，结对编程! (中)&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;一-结对项目实践反思&#34;&gt;一、结对项目实践反思&lt;/h3&gt;
&lt;h4 id=&#34;1问题分析&#34;&gt;1.问题分析&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;针对前面两个阶段中出现的问题，分析问题的特征、产生的根源和对质量的影响程度&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;测试的不充分&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在第一阶段的测试中，过分地追求代码测试的覆盖率，然而忽略了单元测试的局限性，即1. &lt;code&gt;Junit&lt;/code&gt;对于你应该写而没有写的代码是无能为力，测不出来的。2. 当前某一条语句被测试代码覆盖了，并不代表这条语句对应的行为逻辑是完备的，你可能忽略掉输入数据为极端数据的情况而不知情。第一阶段中产生的几个&lt;code&gt;bug&lt;/code&gt;皆源自此类原因，说明我们测试的片面与朴素。在第二阶段中，指导书部分指令的语义复杂程度很高，要求比较繁多，因此捋清指导书需求并对每个分支展开测试其实成了一大挑战，此阶段中产生的唯二&lt;code&gt;Bug&lt;/code&gt;出于一种异常错误信息的格式错误与一个两人对指导书&lt;code&gt;mv/cp&lt;/code&gt;覆盖文件时共同的理解偏差，因此在代码变得有些复杂时考虑程序所要处理的各种边边角角的情况其实也变成了一个挑战&lt;/p&gt;
&lt;h4 id=&#34;2需求分析&#34;&gt;2.需求分析&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;总结结对项目中的需求分析实践体会，并分析哪些bug是因为需求分析不足而带来的&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这两阶段的需求分析严格意义上来说是分析指导书要求实现的功能。需求分析对于编程和测试都是起决定作用，重要性不言而喻。但是在这两阶段两人都是在简单通读指导书，理解指导书的大致内容之后便进行了架构设计，开始编码。这导致编码与需求分析实际上是在同步进行的，对需求的不完全分析也导致了后期的许多修改，编码效率下降。&lt;/p&gt;
&lt;p&gt;例如第二阶段对于&lt;code&gt;mv/cp&lt;/code&gt;中对于“覆盖”的理解既成为了实际开发中纠结的地方，也在强测中出现了问题。尽管&lt;a href=&#34;https://gitlab.buaaoo.top/2021_alige_public/pair_work/homework_2_guidebook/issues/35&#34;&gt;#issue35&lt;/a&gt;中在最后有同学提出了疑问并得到了助教的解答，但由于此时已经是结束的前一天晚上，第二阶段项目已经进入收尾阶段（当天下午我们进行了对&lt;code&gt;issue&lt;/code&gt;区提到的各种情况进行了测试），这个讨论就被两个人都忽视掉了。&lt;/p&gt;
&lt;p&gt;其实这也引发了我的思考：要怎样才能在需求分析阶段就能及时检查自己对于需求的理解是否是正确的呢？此次的指导书相较于真实的需求分析，对于需求的要求是相对明确的，但是实际的需求分析不确定性更高~~（甲方奇妙的“五彩斑斓的黑”）~~此时需求分析有绝对的标准吗？怎样才能更好的进行需求分析？&lt;/p&gt;
&lt;h4 id=&#34;3架构设计&#34;&gt;3.架构设计&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;总结结对中的架构设计实践体会，描述通过改进设计来提高程序的性能改进的思路和方法，并分析哪些bug是因为架构设计不足（特别的，需求变化）而触发的bug&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;架构方面第一阶段中的文件系统实现的完全是物理意义上的文件系统，即文件内容&lt;br&gt;
与单个文件一一对应，但此设计多处于自身的感性认知，导致此架构设计缺乏深入的调研与复审，在第二阶段遇到新的需求(软硬连接时)无法快速优雅地进行增量开发&lt;/p&gt;
&lt;center&gt;
&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609151558.png&#34;
     style = &#34;width:50%;&#34;
    &gt;&lt;/center&gt;
&lt;p&gt;因此在第二阶段中，我们对于&lt;code&gt;linux&lt;/code&gt;文件系统模型进行了一定程度上的调研与分析，在上述架构的基础之上进行了修改，根据&amp;quot;一切皆文件&amp;quot;的核心思想将文件间的逻辑关系信息与管理内容解耦开，将各功能模块的功能清晰划分如下&lt;/p&gt;
&lt;center&gt;
&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609151638.png&#34;
     style = &#34;width:50%;&#34;
    &gt;&lt;/center&gt;
&lt;p&gt;幸运地是，没有遇到过因为架构设计不足而产生的&lt;code&gt;bug&lt;/code&gt;，但由于从架构一到架构二的转变并不平滑，这其中牵扯出一些第一阶段中没有深入思考的具体细节问题，它们在阶段二最后进行&lt;code&gt;mv/cp&lt;/code&gt;功能开发时爆发出来,(详见&lt;a href=&#34;https://www.cnblogs.com/zixfy/p/14612331.html&#34;&gt;相关博文&lt;/a&gt;2、3楼)，在最后发布时，代码实际是未经过重构的版本，因为当时弱测已通过，再次变更代码有一定风险&lt;/p&gt;
&lt;p&gt;至于架构引发的&lt;code&gt;Bug&lt;/code&gt;，其实也没有啦..一二阶段强测产生的&lt;code&gt;Bug&lt;/code&gt;都出在逻辑细节上&lt;/p&gt;
&lt;p&gt;关于&lt;em&gt;改进设计来提高程序的性能改进的思路和方法&lt;/em&gt;，上文&lt;code&gt;UML&lt;/code&gt;图中未包括&lt;code&gt;PathManager&lt;/code&gt;，一种我们在第一阶段设计的解析路径的&lt;strong&gt;迭代器&lt;/strong&gt;，事实证明这个工具类解耦得比较成功，它只负责路径格式解析而与文件系统无关。而且作为迭代器得设计使它可以灵活复用于&lt;code&gt;mkdir -p/ln&lt;/code&gt;等索引文件方式有区别得指令中，而且迭代器不用在可能产生异常时完全解析完路径，降低了程序复杂度&lt;/p&gt;
&lt;p&gt;另一个主要的优化方向是避免递归，有两个可能产生递归操作的地方:1.删除目录时 2.移动目录时 都可能需要递归更新子目录/文件相关的属性。我们使用了懒更新策略，删除目录时可能需要递归解除所有硬链接(普通文件)同&lt;code&gt;inode&lt;/code&gt;的链接，但我们考虑到在本文件系统中删除操作是&lt;strong&gt;永久删除&lt;/strong&gt;，因此在删除目录时仅设置其父目录为&lt;code&gt;null&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;同时我们在文件内容更新时遍历每一个与其链接的硬链接，每个硬链接自底向上更新，若在抵达根目录之前遇到&lt;code&gt;null&lt;/code&gt;则说明此文件在之前已被删除，此时再解除硬链接同&lt;code&gt;inode&lt;/code&gt;与文件内容的链接，这样复杂度理论上会小于等于暴力递归删除&lt;/p&gt;
&lt;p&gt;同时牟哥提到可以给目录/文件加时间戳来在移动目录时懒更新文件修改时间，但是我们考虑到绝对/相对路径处理比较麻烦，故在第三阶段没有进行类似的优化(摸了)&lt;/p&gt;
&lt;p&gt;还有&lt;a href=&#34;https://www.cnblogs.com/zixfy/p/14612331.html&#34;&gt;上篇总结&lt;/a&gt;中提到的不存储绝对路径，这样使得程序不需要额外考虑指令操作对路径的影响，而且一条指令至多输出一条真实的绝对路径，因此不存储绝对路径程序总复杂度也不见得会更高&lt;/p&gt;
&lt;h4 id=&#34;4进度-质量与沟通管理&#34;&gt;4.进度、质量与沟通管理&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;总结结对过程中的进度、质量和沟通管理实践体会，并分析哪些哪些bug是因为两个人的理解不一致而导致&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;进度管理：&lt;br&gt;
进度管理这方面在整个结对编程过程中做的都不算太好。由于指导书的不断更改以及对项目难度的把握不足，在实际开发过程大部分精力投入在开发中，进度管理缺乏投入，很难保持预期进度。而且结对过程中一个主要问题是时间的碎片化，我们只有周一有相对长的时间进行结对，其他时间段被课程分割，以致有时还需线上交流，一定程度上影响了进度跟进。不过我们也会在每日结束时进行一次总结，既保证进度不会太慢，又方便下一次的编程不会遗忘一些历史问题。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;质量管理：&lt;br&gt;
每一阶段代码在初步写完时都会进行单元测试、回归测试以及代码复审来保证代码的质量，同时在完成代码覆盖率测试后也会展开特殊输入数据的测试。遇到一些问题时也会选择进行局部重构来保证代码的鲁棒性。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;沟通管理：&lt;br&gt;
整个结对编程过程中，基本都是在线下进行的，沟通无障碍。同时也利用&lt;code&gt;Code with me&lt;/code&gt;中“&lt;code&gt;follow me&lt;/code&gt;/&lt;code&gt;full sync&lt;/code&gt;”的功能更快地定位交流对象的位置，减少了不必要的沟通时间花销&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;由于线下交流时间长，许多步骤都是经过两人多次交流确认之后才进行的开发，因此没有出现因为两个人理解不一致而导致bug，但因此也确实存在两人理解一致的bug（笑）。&lt;/p&gt;
&lt;h4 id=&#34;5建议&#34;&gt;5.建议&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;提出建议：根据三个阶段的结对项目的实践经验，对如何更好的实施和管理结对项目提出自己的建议&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;需求分析阶段的交流是必要的，一个人很容易看漏一些需求，而两个人相互交流能解决很多理解上的问题&lt;s&gt;两人都理解错了怎么办&lt;/s&gt;&lt;/li&gt;
&lt;li&gt;合理利用一些软件帮助实施和管理结对项目（例如&lt;code&gt;Code with me&lt;/code&gt;以及助教在&lt;a href=&#34;https://www.cnblogs.com/zixfy/p/14578813.html&#34;&gt;第一阶段博客&lt;/a&gt;中提到的&lt;code&gt;gitlab&lt;/code&gt;的&lt;code&gt;milestones&lt;/code&gt;和&lt;code&gt;Issues&lt;/code&gt;功能等）&lt;/li&gt;
&lt;li&gt;在两人出现分歧的时候，不要陷入死循环，理性地、有理有据地说服对方能提升开发效率&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;二-ci体验感想&#34;&gt;二、CI体验感想&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;通过这次结对编程，你对CI的使用体验如何？你对这一工具有何认识？&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;通过这次结对编程，实际上我们还是对&lt;code&gt;CI&lt;/code&gt;进行了真正的入门吧，虽然我们作业中使用的&lt;code&gt;yaml&lt;/code&gt;脚本比较简单，只有编译、测试(再次感谢牟哥的&lt;a href=&#34;https://gitlab.buaaoo.top/2021_alige_public/pair_work/homework_1_guidebook/issues/12&#34;&gt;配置神贴&lt;/a&gt;)与提交或者查分这几个固定的操作，但使用&lt;code&gt;CI&lt;/code&gt;后首先可以对一版代码进行自动化的测试以及可能的部署，其次可以增强团队成员对代码的知情权，了解到当前代码的质量，及时进行复审。&lt;code&gt;CI&lt;/code&gt;还有&lt;code&gt;milestone/issue&lt;/code&gt;跟进进度的功能，&lt;code&gt;milestone&lt;/code&gt;适用于定期进行集成，并发布阶段的新版本，这一功能或许在后续团队敏捷开发中会很实用&lt;/p&gt;
&lt;h3 id=&#34;三-结对编程感想&#34;&gt;三、结对编程感想&lt;/h3&gt;
&lt;h4 id=&#34;1结对形式&#34;&gt;1.结对形式&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;描述你们结对的方法、结对过程中遇到的困难与收获，结合自己的结对经历，说明结对编程的优点和缺点，分享可以推广的结对妙招。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我们结对时绝大多数时间是线下一起进行编程，结对场地包括&lt;code&gt;wings&lt;/code&gt;,新北超商还有学六食堂&lt;/p&gt;
&lt;h5 id=&#34;zzy&#34;&gt;zzy：&lt;/h5&gt;
&lt;p&gt;我遇到的最大的困难其实是如何说服自己与队友进行“平等的交流”。在最初接触zzx的时候，我就意识到了自己与zzx之间各方面的差距，欣喜 ~~(能抱大腿)~~的同时，更多的是一种无力以及愧疚感，这种负面情感让我在最初的时候只会点头同意，没有提出任何建设性的建议。第二阶段身份互换之后，才逐渐放开自己。（感谢不嫌弃我的zzx）&lt;/p&gt;
&lt;p&gt;我的收获同样也有很多。认识了一个很棒的队友；之前从来不敢再issue区发声的我首次发声提问（总是害怕是自己看的不够仔细，或者想着等待他人提问）；以及对于架构设计和测试的全新认识；首次使用&lt;code&gt;maven&lt;/code&gt;以及&lt;code&gt;Code with me&lt;/code&gt;等都是很好的体验与收获。&lt;/p&gt;
&lt;p&gt;对于结对编程的评价&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;优点：
&lt;ul&gt;
&lt;li&gt;是团队项目之前一次很好的预热，提前体验了与他人共同完成一次开发的全过程&lt;/li&gt;
&lt;li&gt;两人之间的交流相比团队能够更加充分&lt;/li&gt;
&lt;li&gt;两人相互辅助，能在一定程度上减少错误发生的概率&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;缺点：
&lt;ul&gt;
&lt;li&gt;实际效率不一定大于1+1&lt;/li&gt;
&lt;li&gt;两人之间的磨合需要时间&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;zzx&#34;&gt;zzx：&lt;/h5&gt;
&lt;p&gt;虽然说阶段三如果还有迭代开发任务的话，我可能会肝死罢，但我还是想再结对一次啊。没能完整做完这个小项目其实有些可惜，我们的架构刚经过重构比较清晰了，我与zzy快要走完结对的磨合阶段了。啊啊啊好像证明我们可以出色完成用户权限相关的开发啊。&lt;/p&gt;
&lt;p&gt;关于结对编程本身，我还是不能肯定它的性价比有多高，只能说合作得越久，两人开发的效率才可能更高吧。要说结对的推广，建议课程组大力安利一下&lt;code&gt;Code with Me&lt;/code&gt;，这么适合结对的工具我们早了解到就好了&lt;/p&gt;
&lt;h4 id=&#34;2互评&#34;&gt;2.互评&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;评价你的队友，使用&lt;a href=&#34;https://www.cnblogs.com/xinz/archive/2011/08/22/2148776.html?fileGuid=Q6TDtx9rRqVHdKRd&#34;&gt;汉堡点评法&lt;/a&gt;评价你的结对伙伴，务必给TA 提改进意见。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h5 id=&#34;zzy-to-zzx&#34;&gt;zzy To zzx&lt;/h5&gt;
&lt;p&gt;能力很强，对于架构设计、编码、测试等态度也很认真；交流态度很好，也不嫌弃菜鸡的我；有时有些自谦过度，给我一种妄自菲薄的感觉，但是实际交流问题的时候很自信。总之是一名非常可靠的队友！&lt;/p&gt;
&lt;h5 id=&#34;zzx-to-zzy&#34;&gt;zzx To zzy&lt;/h5&gt;
&lt;p&gt;就像我在个人博客中所说的，我本人其实具有相当鲁莽的编码风格，喜欢边敲代码边想思路(老重构怪了)。但zzy相对我而言就是那种比较喜欢多思考，做事交流比较严谨，二人可以说是有种森林冰火人的感觉(?)。zzy比我更能考虑到细节与编码背后可能带来的问题，感谢他在第二阶段中一步步帮懵圈的我理清了新需求的&lt;code&gt;N&lt;/code&gt;中抛异常的情况、提出无数代码中的细节问题等等等.. 其次一点zzy对待工作真的很认真，结对过程中从没有向我显露过疲态，实际上每天都是我想摸了的时候才会提醒他收工，做事相当踏实仔细。&lt;/p&gt;
&lt;p&gt;我对zzy的改进意见是可以在以后的&lt;code&gt;coop&lt;/code&gt;中都可以更加从容地显示与发挥自身的能力，同时可以坦诚指出同伴的不足啊。或也有我的问题，在这次结对中因为我的带点表现欲的主动，其实我在交流中一直在抢占话语权，甚至显得有些咄咄逼人。但实际上我与zzy的实力相近，而且我的一些想法与代码也没有zzy那样周全，我也为我在第一阶段近乎垄断了整体架构思路感到错了，事实证明那是个失败的设计😂 。zzy完全可以相信自己的实力，思路慎密，学习能力也比较强，做起精细的工作肯定是分靠谱，加油！&lt;/p&gt;
&lt;h4 id=&#34;3开发工具&#34;&gt;3.开发工具&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;描述在本次结对编程的过程中，你们使用了哪些软件工具，是如何应用于实践的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;具体使用工具:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;Code With me&lt;/code&gt;：在第二阶段的结对中引入了&lt;code&gt;JetBrains&lt;/code&gt;系&lt;code&gt;IDE&lt;/code&gt;自支持的&lt;code&gt;Code With Me&lt;/code&gt;，一款用于在线协作编辑、运行、测试代码的插件。&lt;code&gt;相比于git&lt;/code&gt;,&lt;code&gt;Code With Me&lt;/code&gt;在协作中的实时性更强，更方便不同模块的同时编写与代码复审&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Maven/Junit4.12&lt;/code&gt;:&lt;code&gt;Maven&lt;/code&gt;用于整个项目的管理与配置，同时我们使用&lt;code&gt;Junit&lt;/code&gt;同时进行单元测试与集成测试&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Jacoco&lt;/code&gt;: &lt;code&gt;Jacoco&lt;/code&gt;类似于&lt;code&gt;Cobetura&lt;/code&gt;，需要配合&lt;code&gt;Junit&lt;/code&gt;与&lt;code&gt;Maven&lt;/code&gt;使用，可以统计代码的行数覆盖率与分支覆盖率(精确到语句级)，为一次测试自动生成网页或&lt;code&gt;csv&lt;/code&gt;形式的测试报告&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Git Bash/Ubuntu 16.04&lt;/code&gt;:第二阶段中涉及到了&lt;code&gt;Ubuntu&lt;/code&gt;相关指令执行的细节，因此我们在&lt;code&gt;Linux&lt;/code&gt;环境下展开了相关的实验，对于较为模糊的情况，先在&lt;code&gt;Linux&lt;/code&gt;环境下复现一遍，并比较与指导书的异同之处&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Processon/HedgeDoc&lt;/code&gt;: 文字相关工作中所用的工具，前者为常用的在线协作绘图工具，&lt;a href=&#34;https://demo.hedgedoc.org/&#34;&gt;后者&lt;/a&gt;是一个便捷的在线协作编辑&lt;code&gt;markdown&lt;/code&gt;的网站，我们用于博问的撰写&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;4吐槽与建议&#34;&gt;4.吐槽与建议&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;描述通过本次结对编程的感悟和体会，对本次作业的有哪些想吐槽的，觉得本次结对作业内容可以在哪些方面做出改进？&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;指导书的部分已经有很多同学吐槽过了，确实由于指导书里的一些问题我们也吃了很多苦头&lt;/li&gt;
&lt;li&gt;其次是对于&lt;code&gt;issue&lt;/code&gt;区的管理。尽管助教在最后发了一个总结帖来总结各个&lt;code&gt;issue&lt;/code&gt;的内容，但是整个&lt;code&gt;issue&lt;/code&gt;区管理上还是比较乱，获取有用信息的效率不高&lt;/li&gt;
&lt;/ul&gt;
">【老物】再探，结对编程! （下）</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/lao-wu-2021-ruan-gong-zuo-ye-oj-ruan-jian-an-li-fen-xi/"" data-c="
          &lt;center&gt;Luogu &amp; Leetcode&lt;/center&gt;
&lt;!-- more --&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;项目&lt;/strong&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;内容&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;这个作业属于哪个课程&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;a href=&#34;https://edu.cnblogs.com/campus/buaa/BUAA_SE_2021_LR/&#34;&gt;2021春季计算机学院软件工程(罗杰 任健)&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;这个作业的要求在哪里&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;a href=&#34;https://edu.cnblogs.com/campus/buaa/BUAA_SE_2021_LR/homework/11869&#34;&gt;案例分析作业要求&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;我在这个课程的目标是&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;和我的团队开发一个真正的软件，一起提升开发与合作的能力&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;这个作业在哪个具体方面帮助我实现目标&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;分析现有具体的软件，用软工的方法论进行表里两面的剖析&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;在线评测系统&lt;/strong&gt;（英语：&lt;strong&gt;Online Judge&lt;/strong&gt;，缩写&lt;strong&gt;OJ&lt;/strong&gt;）是一种在算法竞赛中用来测试参赛程序的在线系统，也可以用于平时练习。这些年来（2016年或更早）亦出现一些&lt;strong&gt;针对求职面试&lt;/strong&gt;的在线评测系统。许多OJ网站会自发组织一些竞赛。此外，OJ网站通常会设立用户排名，以用户的提交答案通过数多少或某个题目执行时间快慢为排名依据。	(&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E5%9C%A8%E7%BA%BF%E8%AF%84%E6%B5%8B%E7%B3%BB%E7%BB%9F&#34;&gt;from wikipedia&lt;/a&gt;)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;下文中，我将对曾经有所接触过的两个&lt;code&gt;OJ&lt;/code&gt;平台： &lt;a href=&#34;https://www.luogu.com.cn/&#34;&gt;Luogu(洛谷)&lt;/a&gt;与&lt;a href=&#34;https://leetcode-cn.com/&#34;&gt;LeetCode(力扣)&lt;/a&gt;重新上手使用并进行各功能的评测，当然我也会将找出一些软件&lt;code&gt;Bug&lt;/code&gt;作为使用过程中的目标之一，因此我先给出一个非专业的&lt;code&gt;Bug&lt;/code&gt;分级标准如下&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;严重程度&lt;/th&gt;
&lt;th&gt;备注&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;👾&lt;/td&gt;
&lt;td&gt;&lt;em&gt;不明显的小缺陷&lt;/em&gt;，可能只是个显示问题，不影响用户后续操作&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;👾👾&lt;/td&gt;
&lt;td&gt;对用户有误导作用，或软件逻辑与用户预期的使用逻辑&lt;em&gt;相悖&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;👾👾👾&lt;/td&gt;
&lt;td&gt;阻碍用户完成预期操作，但可以自动或通过软件其他操作&lt;em&gt;恢复&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;👾👾👾👾&lt;/td&gt;
&lt;td&gt;用户无法完成预期的操作、获取想要的信息，并且短期内&lt;em&gt;找不到&lt;/em&gt;解决方案&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;👾👾👾👾👾&lt;/td&gt;
&lt;td&gt;软件系统性的&lt;em&gt;安全&lt;/em&gt;性问题、&lt;em&gt;不可逆&lt;/em&gt;的崩溃问题&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;luogu&#34;&gt;Luogu&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;&amp;quot;在洛谷，享受Coding的欢乐&amp;quot;&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;洛谷创办于2013年，其目标用户主要是参与&lt;code&gt;NOI/NOIP&lt;/code&gt;的&lt;code&gt;OIers&lt;/code&gt;以及&lt;code&gt;ACMers&lt;/code&gt;，洛谷的各功能围绕着两个核心功能进行开发, 一是基于大量题库的快速、便捷的在线评测功能，二是包括题解、讨论帖子、博客在内的相对完备的社区功能，这一点不仅增加了用户粘性，而且通过社区内的引导，编程新手也能获得比较好的体验。&lt;/p&gt;
&lt;p&gt;笔者没有参与过算法竞赛，但洛谷确实是我使用最多的&lt;code&gt;OJ&lt;/code&gt;，这是因为洛谷的题解功能实在是出色，相比于&lt;code&gt;POJ/SPOJ&lt;/code&gt;等基本每一道题目都有相应的题解，而且审核机制保证了题解的高质量。大一程设时期我在遇到困难时经常学习题解，丰富的思路与技巧对新手很有帮助！&lt;/p&gt;
&lt;h3 id=&#34;一-使用及体验&#34;&gt;一、使用及体验&lt;/h3&gt;
&lt;h4 id=&#34;1洛谷主站&#34;&gt;1.洛谷主站&lt;/h4&gt;
&lt;p&gt;首先来到洛谷的&lt;a href=&#34;https://www.luogu.com.cn/&#34;&gt;主页&lt;/a&gt;，先入眼的是一个偌大的几个青少年算法竞赛的countdown，其下方是一个记录做题量的图表，这个记录的粒度大概是最近一年的每个月和最近一个月的每一天，为用户统计自己的做题量是挺好的功能。主页下方是一些比赛与帖子的列表，洛谷整体的&lt;code&gt;UI&lt;/code&gt;风格比较简洁，基本没有冗余信息，主页中左侧边栏功能划分清晰，新用户也能很快上手。&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609144941.png&#34; style=&#34;width:90%;&#34;&gt;
&lt;/center&gt;
&lt;p&gt;接下来我们来看一下和题目直接相关的界面，首先是难度划分，可以看到难度也是针对竞赛而划分的，同时难度共&lt;code&gt;7&lt;/code&gt;个等级，比力扣(只有简中难&lt;code&gt;3&lt;/code&gt;种)更细，用户更能了解自己所处的“段位”，洛谷也有排名系统(下图右侧上方)，这里的排名是按近期各种参与度（咕值）产生的动态排名。但是这个题目列表看起来比较混乱，每个链接只是标了题号，在这个界面并不知道是什么题，是何种类型的题，我更希望在这里看到按类型(如标签)分类的题目列表来了解自己哪方面需要加强，我不明白直接把所有题号罗列出来的意义何在。&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609145001.png&#34; style=&#34;width:90%;&#34;&gt;
&lt;/center&gt;
&lt;p&gt;&lt;a href=&#34;https://www.luogu.com.cn/problem/list&#34;&gt;题库&lt;/a&gt;界面相当的&lt;strong&gt;专业&lt;/strong&gt;！首先是题量方面，洛谷本体题库有&lt;code&gt;6,387&lt;/code&gt;道题目，而算上使用&lt;code&gt;Remote Judge(Vitural Judge)&lt;/code&gt;的四个附加题库，洛谷的总题量高达&lt;code&gt;23,979&lt;/code&gt;；其次题目的类型(标签)基本涵盖了算法竞赛中具体的各种算法与问题，而且十分细致(比如&lt;code&gt;dp&lt;/code&gt;还细分为了插头&lt;code&gt;dp&lt;/code&gt;，区间&lt;code&gt;dp&lt;/code&gt;等)；同时对于源语言为外文的题目也进行了大量的翻译&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609145032.png&#34; style=&#34;width:90%;&#34;&gt;
&lt;/center&gt;
&lt;p&gt;现在我先随手选一道&lt;a href=&#34;https://www.luogu.com.cn/problem/P3369&#34;&gt;题目&lt;/a&gt;()，可以看到题目界面也很清爽，左侧是标准的题面，右侧显示一些题目信息和此题目对应的&lt;strong&gt;讨论区&lt;/strong&gt;与&lt;strong&gt;题解区&lt;/strong&gt;，讨论区类似贴吧的模式，可以向他人请教&lt;code&gt;DEBUG&lt;/code&gt;，题解区类似知乎回答的模式，由于有审核机制，题解的技术力普遍较高&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609145058.png&#34; style=&#34;width:90%;&#34;&gt;
&lt;/center&gt;
&lt;p&gt;记录界面可进行历史提交信息的检索，点开一条非&lt;code&gt;AC&lt;/code&gt;的&lt;a href=&#34;https://www.luogu.com.cn/record/38350554&#34;&gt;记录&lt;/a&gt;可以看到&lt;strong&gt;各个&lt;/strong&gt;测试点的情况，根据本人的使用经验，很多题目有&lt;code&gt;10&lt;/code&gt;个以上的测试点信息，同时可以下载首个错误点的&lt;code&gt;IO&lt;/code&gt;信息方便&lt;code&gt;DEBUG&lt;/code&gt;,而不是对着一声&lt;code&gt;WA&lt;/code&gt;不知所措，这也是洛谷对新手友好的方面之一&lt;/p&gt;
&lt;div style=&#34;display:flex&#34;&gt;
    &lt;div style=&#34;width:48%;margin-right:1%;margin-left:1%;&#34;&gt;
        &lt;img src =&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609145130.png&#34; style=&#34;width:100%&#34;&gt;
    &lt;/div&gt;
    &lt;div  style=&#34;width:48%;margin-right:1%;margin-left:1%;&#34;&gt;
        &lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609145211.png&#34; style=&#34;width:100%&#34;&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;center&gt;&lt;font style=&#34;font-style:italic;font-size:small&#34;&gt;(点击图片以放大)&lt;/font&gt;&lt;/center&gt;
&lt;p&gt;题解区大佬很多，而且题解对内容与排版进行了审核并支持&lt;code&gt;markdown/latex&lt;/code&gt;，从而保证了用户的浏览体验，通过题解可以学到很多竞赛中的&lt;s&gt;奇技淫巧&lt;/s&gt;调优自己的程序，也能学习到不少新奇的解题思路哦&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609145317.png&#34; style=&#34;width:90%;&#34;&gt;
&lt;/center&gt;
&lt;p&gt;&lt;a href=&#34;https://www.luogu.com.cn/training/list&#34;&gt;题单&lt;/a&gt;取代了“试炼场”，主要是加入了用户题单，题单好啊，可以找自己感兴趣的方向有针对性的刷题，这个功能现在的&lt;code&gt;OJ&lt;/code&gt;大多都有实现；洛谷的论坛是帖子-回复模式，可以直接与管理员联系，&lt;s&gt;给我的感觉比较亲切，简单地浏览一些帖子，可以发现洛谷&lt;code&gt;OI&lt;/code&gt;亚文化与二次元氛围浓厚&lt;/s&gt;&lt;/p&gt;
&lt;div style=&#34;display:flex&#34;&gt;
    &lt;div style=&#34;width:48%;margin-right:1%;margin-left:1%;&#34;&gt;
        &lt;img src =&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609145345.png&#34; style=&#34;width:100%&#34;&gt;
    &lt;/div&gt;
    &lt;div  style=&#34;width:48%;margin-right:1%;margin-left:1%;&#34;&gt;
        &lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609145418.png&#34; style=&#34;width:100%&#34;&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;同时我注意到洛谷有一个团队功能(右上角头像 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 我的团队)，支持团队内自定义题目、团队内举办比赛、团队作业等功能，这部分功能不是所有&lt;code&gt;OJ&lt;/code&gt;都有开放的，这个功能主要还是针对&lt;a href=&#34;https://www.luogu.com.cn/blog/luogu/premium-team&#34;&gt;开展信息学竞赛训练的学校与机构的&lt;/a&gt;。下面是我对团队功能的试用:团队自定义题目的题面编辑(下图左上)与数据点编辑(下图右上)，团队作业监督(下图左下)与团队内举办比赛(下图右下，支持&lt;code&gt;OI/ACM&lt;/code&gt;等多种赛制)&lt;/p&gt;
&lt;div style=&#34;display:flex&#34;&gt;
    &lt;div style=&#34;width:48%;margin-right:1%;margin-left:1%;&#34;&gt;
        &lt;img src =&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609145454.png&#34; style=&#34;width:100%&#34;&gt;
    &lt;/div&gt;
    &lt;div  style=&#34;width:48%;margin-right:1%;margin-left:1%;&#34;&gt;
        &lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609145509.png&#34; style=&#34;width:100%&#34;&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;div style=&#34;display:flex&#34;&gt;
    &lt;div style=&#34;width:48%;margin-right:1%;margin-left:1%;&#34;&gt;
        &lt;img src =&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609145524.png&#34; style=&#34;width:100%&#34;&gt;
    &lt;/div&gt;
    &lt;div  style=&#34;width:48%;margin-right:1%;margin-left:1%;&#34;&#34;&gt;
        &lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609145541.png&#34; style=&#34;width:100%&#34;&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;(插播采访)&lt;/p&gt;
&lt;h4 id=&#34;采访环节-1&#34;&gt;采访环节-1&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;采访对象&lt;/strong&gt;: Kumo君&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;被访者介绍&lt;/strong&gt;: 编程小能手，有扎实的编码能力，曾三天自通数据库全栈，自主研发过&lt;code&gt;qq&lt;/code&gt;小助手，同时荣任过大一信息类《程序设计基础》与《数据结构》的助教&lt;/li&gt;
&lt;li&gt;**采访动机/需求介绍:**因为我在使用上文的团队功能时觉得这个和他当助教时在校内&lt;code&gt;OJ&lt;/code&gt;后台出题的功能很像，于是邀请他从助教的角度试用团队功能，同时他也用过&lt;code&gt;luogu&lt;/code&gt;刷题，我也想知道他对&lt;code&gt;luogu&lt;/code&gt;的评价&lt;/li&gt;
&lt;li&gt;**实际使用栏目:**洛谷-我的团队&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;zixfy: Hey, Kumo, 我注意到洛谷的团队功能可能可以满足作为助教进行出题的需求，同时你也曾在校内的&lt;a href=&#34;https://accoding.cn/index&#34;&gt;Accoding&lt;/a&gt;(oj4th)上出过题目，能采访一下你体验的异同吗?&lt;/p&gt;
&lt;p&gt;(试用题面编辑中) Kumo: 洛谷的题面编辑结构清晰，有&lt;code&gt;md&lt;/code&gt;快捷键，只要填写背景、样例等部分就行，相比之下oj4th只有一个朴素的富文本编辑器，整个题面靠手撸&lt;/p&gt;
&lt;p&gt;(试用测试点设置中) Kumo: 洛谷可以批量打包上传测试点，而oj4th要一个一个点设置&lt;code&gt;I/O&lt;/code&gt;，不太人性化，但没看到洛谷提供评测对比标准的设置或&lt;code&gt;Special Judge&lt;/code&gt;功能&lt;/p&gt;
&lt;p&gt;zixfy: 嗯嗯，总体看来洛谷在出题人方面做的比较细腻，你觉得洛谷的团队功能能胜任程设课程的作业与比赛吗？&lt;/p&gt;
&lt;p&gt;Kumo: 相比于校内&lt;code&gt;OJ&lt;/code&gt;的话，洛谷给我的体验可能比较流畅吧，校内&lt;code&gt;OJ&lt;/code&gt;有一些&lt;code&gt;bug&lt;/code&gt;，如测试点不能删除过多次、题解功能鸡肋的问题，洛谷大家都在用的话相关功能可以得到及时的维护。但校内&lt;code&gt;OJ&lt;/code&gt;对于课程管理而言是必需的，它的灵活性是洛谷肯定替代不了的&lt;/p&gt;
&lt;p&gt;zixfy: 瞭解了，你觉得团队模块里有什么吸引你的功能吗？&lt;/p&gt;
&lt;p&gt;Kumo: 其实我觉得不一定非要有什么亮眼的功能，我觉得软件用起来顺手才是重点，团队功能还可以，洛谷整体也称得上是这样“好用”的网站&lt;/p&gt;
&lt;p&gt;zixfy: 我看到你也有&lt;code&gt;luogu&lt;/code&gt;账号，用来刷题感觉如何呢？&lt;/p&gt;
&lt;p&gt;Kumo: 我是在大一时注册的，当时经常刷练习赛，选择洛谷的主要原因是题量大，而且难度覆盖广，可以循序渐进地做题，而且题解功能很棒!&lt;/p&gt;
&lt;p&gt;zixfy: 同感！那你觉得洛谷的&lt;code&gt;UI&lt;/code&gt;做得怎么样，我认为它显然十分简明，但其界面在当代有些朴素。&lt;/p&gt;
&lt;p&gt;Kumo: 确实，自己有写一些前端后，感觉洛谷的&lt;code&gt;UI&lt;/code&gt;也比较好自己复现出来，其实没有特别高端的感觉&lt;/p&gt;
&lt;p&gt;zixfy: ありがとう&lt;/p&gt;
&lt;/blockquote&gt;
&lt;center &gt;
&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609145602.png&#34; style = &#34;width:60%&#34;&gt;
&lt;/center&gt;
&lt;p&gt;btw洛谷还有个相当厉害的功能&lt;code&gt;Remote Judge(Vitural Judge)&lt;/code&gt;，其核心思想是从远程题库爬取题目题面信息放到本站上 ，当用户在相应题目进行代码提交时，洛谷后台运行脚本通过公用号或用户提供的账号在远程题库提交并抓取结果&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609145642.png&#34; style=&#34;width:90%;&#34;&gt;
&lt;/center&gt;
&lt;p&gt;稍微试用了一下&lt;code&gt;UVa&lt;/code&gt;，速度其实还蛮快的嘛，&lt;code&gt;Vitural Judge&lt;/code&gt;这方面做的比较全的应该是&lt;a href=&#34;https://vjudge.net/&#34;&gt;vjudge&lt;/a&gt;吧，当然洛谷的也很好用，支持绑定个人用户，拓展的题量也不少&lt;/p&gt;
&lt;h4 id=&#34;2bugs&#34;&gt;2.Bugs&lt;/h4&gt;
&lt;h5 id=&#34;bug-a&#34;&gt;bug A&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;测试环境:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;OS:&lt;/strong&gt; &lt;code&gt;Win10 18363.1440&lt;/code&gt;(家庭版)；&lt;strong&gt;Browser:&lt;/strong&gt; &lt;code&gt;Google Chrome x64&lt;/code&gt;(&lt;code&gt;v89.0.4389.114&lt;/code&gt;)，全文都是此环境，下文不再赘述&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;bug复现: (&lt;strong&gt;必然发生&lt;/strong&gt;)&lt;/p&gt;
&lt;p&gt;洛谷主页 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 右上角头像 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; &amp;quot;个人设置&amp;quot;  &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&amp;quot;选择图片&amp;quot; &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 选择一张比列不为&lt;code&gt;1 : 1&lt;/code&gt;的图片上传&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;具体描述:&lt;/p&gt;
&lt;p&gt;洛谷头像的比例是&lt;code&gt;1 : 1&lt;/code&gt;，但上传一张比列不为&lt;code&gt;1 : 1&lt;/code&gt;的图片图片后没有出现预期中的裁剪选项，导致我上传的二次元头像被挤压型变以&lt;strong&gt;适应比例&lt;/strong&gt;&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609145740.png&#34; style=&#34;width:85%;&#34;&gt;
&lt;/center&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;bug分析:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;严重性:👾👾, 完全不影响使用，毕竟只是个头像(，但可能用户确实想正常上传头像就需要自行裁剪，有些麻烦&lt;/li&gt;
&lt;li&gt;成因: 没做这个功能，小细节对于整个&lt;code&gt;OJ&lt;/code&gt;而言不重要&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;bug-b&#34;&gt;bug B&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;bug复现:(&lt;strong&gt;偶尔发生&lt;/strong&gt;， 20次尝试中复现了5、6次)&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;通过主页右上头像 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; “我的题库” &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 选择一道创建的题目或主页右上头像 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; “我的团队” &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; &amp;quot;题目&amp;quot; &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 选择一道创建的题目&lt;/li&gt;
&lt;li&gt;&amp;quot;编辑题目&amp;quot; &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; “数据点配置” &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; “上传数据” &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;  选择非&lt;code&gt;.zip&lt;/code&gt;格式的文件上传&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;具体描述:&lt;/p&gt;
&lt;p&gt;洛谷测试点文件只能为&lt;code&gt;ZIP&lt;/code&gt;压缩包，上传错误格式后上传按钮被禁用，并显示&amp;quot;等待系统校验&amp;quot;字样，这个系统校验不是指因为格式不对而要校验，因为我观察到上传&lt;code&gt;ZIP&lt;/code&gt;后也有此字样，随后成功上传，所以此时上传卡在了校验阶段，但按钮被禁用无法重传&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609145804.png&#34; style=&#34;width:85%;&#34;&gt;
&lt;/center&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;bug分析:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;严重性:👾👾👾，遇到这个&lt;code&gt;Bug&lt;/code&gt;只能刷新页面重置按钮&lt;/li&gt;
&lt;li&gt;可能成因: 可能是前端或者前后交互上的锅，没有及时更新&lt;code&gt;UI&lt;/code&gt;，同时可能是软件测试不足，没有充分测试这种异常情况下的输入&lt;/li&gt;
&lt;li&gt;改进建议: 当后端解析到错误格式时不进行测试点文件的覆盖，回传给前端错误信息，前端及时更新&lt;code&gt;UI&lt;/code&gt;，将按钮设置为重新上传，醒目地给用户警告&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;bug-c&#34;&gt;bug C&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;bug复现:(&lt;strong&gt;必然发生&lt;/strong&gt;)&lt;/p&gt;
&lt;p&gt;洛谷主页 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 切换到&amp;quot;记录&amp;quot;模块 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 切换记录状态为&lt;code&gt;Unaccepted&lt;/code&gt; &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 点击蓝色的&amp;quot;清除所有筛选条件&amp;quot;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;具体描述:&lt;/p&gt;
&lt;p&gt;切到&amp;quot;记录&amp;quot;模块时我能看到自己所有的提交记录，下图中的&amp;quot;用户名或ID&amp;quot;默认是我自己的，在复现第三步后可以看到所有失败的提交，我在第四步时期望的是筛选选项重置，我又可以看到所有提交。但此时报错了，可以观察到清除条件时用户ID的文本框也被清除了，导致无法重新检索。事实上，无论筛选选项是什么状态，只要点击“清除”都会引发这个问题。&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609145830.png&#34; style=&#34;width:85%;&#34;&gt;
&lt;/center&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;bug分析&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;严重性:👾👾👾👾，这是一个永远触发异常的按钮，无法通过其他操作修正&lt;/li&gt;
&lt;li&gt;可能成因:前端逻辑有问题，没注意清除ID后已无法正常检索，却还是自动重新进行了一次检索&lt;/li&gt;
&lt;li&gt;改进建议:1.清除时前端不重置ID对应的文本框 2.或者后端增加特殊判断，当传入的用户名/ID为空时重定向为请求用户的ID&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;3总评&#34;&gt;3.总评&lt;/h4&gt;
&lt;p&gt;总体而言，洛谷既具备一个竞赛&lt;code&gt;OJ&lt;/code&gt;的硬核性，也有良好的社区功能完善用户体验，因此我认为是&lt;strong&gt;e) 非常推荐&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;采用&lt;a href=&#34;https://www.cnblogs.com/xinz/p/3308608.html&#34;&gt;邹欣老师给出的表格&lt;/a&gt;，我具体的量化评价如下:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;类别&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;描述&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;评价&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;评分([-3, 10]）&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;核心功能&lt;/td&gt;
&lt;td&gt;分析三个核心功能，功能设计和质量&lt;/td&gt;
&lt;td&gt;题库充实，评测快，社区硬核&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;细节&lt;/td&gt;
&lt;td&gt;有什么为用户考虑的细节?&lt;/td&gt;
&lt;td&gt;有一些没有为用户考虑的细节，见Bugs&lt;/td&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;用户体验&lt;/td&gt;
&lt;td&gt;当用户完成功能时，不干扰用户 。&lt;/td&gt;
&lt;td&gt;基本没有弹窗，信息简明&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;辅助功能&lt;/td&gt;
&lt;td&gt;一些辅助功能如皮肤等&lt;/td&gt;
&lt;td&gt;博客、图床以及在线&lt;code&gt;IDE&lt;/code&gt;、洛谷日报、网课和信息学竞赛真题&lt;/td&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;差异化功能&lt;/td&gt;
&lt;td&gt;这个软件独特的功能. 它对用户的吸引力?&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Remote Judge&lt;/code&gt;，完整的团队功能&lt;/td&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;软件的效能&lt;/td&gt;
&lt;td&gt;占用内存, 启动速度, 内存泄漏情况&lt;/td&gt;
&lt;td&gt;&lt;em&gt;拥有专利“一种高并发的在线程序评测系统（申请中）”，可以应对每5分钟1200个评测量&lt;/em&gt;（据&lt;a href=&#34;https://www.luogu.com.cn/blog/luogu/about-luogu&#34;&gt;官方&lt;/a&gt;）&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;软件的适应性&lt;/td&gt;
&lt;td&gt;在联网/断网, 大小屏幕, 没有鼠标的情况下都可以顺畅操作，跨平台&lt;/td&gt;
&lt;td&gt;一般&lt;/td&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;成长性&lt;/td&gt;
&lt;td&gt;记住用户的选择, 适应用户的特点，越用越方便&lt;/td&gt;
&lt;td&gt;有题目推荐系统，但有时会推荐已做过的题目&lt;/td&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;用户有控制权&lt;/td&gt;
&lt;td&gt;系统状态有反馈，等待时间合适。关键操作有确认提示，有明确的错误信息。&lt;/td&gt;
&lt;td&gt;用户数据非实时，按一定的周期更新一次&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;总计&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;87.78%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;二-评估分析&#34;&gt;二、评估分析&lt;/h3&gt;
&lt;h5 id=&#34;1使用此服务的所有功能估计这个软件网站服务做到这个程度大约需要多少时间团队人数6人左右计算机大学毕业生并有专业ui支持&#34;&gt;&lt;em&gt;1.使用此服务的所有功能，估计这个软件/网站/服务做到这个程度大约需要多少时间(团队人数6人左右，计算机大学毕业生，并有专业UI支持)&lt;/em&gt;&lt;/h5&gt;
&lt;p&gt;需要实现的功能:评测机、题面界面及题库数据库、用户系统与博客、比赛、讨论区等很多功能，预估耗时为3.5个月，半个月搭建各种语言的评测机，设计题库的数据库，同时前端写好题面的界面；半个月完善题库数据库，加入题目检索、题目标签的功能；一个半月全力进行用户系统、提交记录的开发，同时在系统整合时展开大规模测试；半个月前端进行讨论、题解界面的开发，后端开发比赛等功能；最后半个月模块整合，并针对评测机进行性能优化。&lt;/p&gt;
&lt;p&gt;当然如果使用开源的&lt;code&gt;OJ&lt;/code&gt;系统或许会更轻松？&lt;/p&gt;
&lt;h5 id=&#34;2分析这个软件目前的优劣和类似软件相比这个产品的质量在同类产品中估计名列第几&#34;&gt;&lt;em&gt;2.分析这个软件目前的优劣(和类似软件相比)，这个产品的质量在同类产品中估计名列第几？&lt;/em&gt;&lt;/h5&gt;
&lt;p&gt;优势：基于大量(&lt;code&gt;Remote Judge&lt;/code&gt;)题库的快速、便捷的在线评测功能，以及包括题解、讨论帖子、博客在内的相对完备的社区功能 劣势：网站做的比较粗，有许多细节没有完善；与其他面向竞赛的&lt;code&gt;OJ&lt;/code&gt;相比，洛谷应该有前三吧，洛谷持续增加的题库与例赛以及社区为这个网站维系着生命力，其他一些老牌的&lt;code&gt;OJ&lt;/code&gt;有些因为缺乏管理倒闭或者很少有人记得了&lt;/p&gt;
&lt;h5 id=&#34;3从各方面的问题推理出这个软件团队在软件工程方面可以提高的一个重要方面&#34;&gt;&lt;em&gt;3.从各方面的问题，推理出这个软件团队在软件工程方面可以提高的一个重要方面&lt;/em&gt;&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;界面好好捯饬一下，可以做得更美观，洛谷的前端虽说是&lt;code&gt;vue&lt;/code&gt;写的，但感觉静态的页面还是比较多吧&lt;/li&gt;
&lt;li&gt;作为&lt;code&gt;PM&lt;/code&gt;考虑扩大目标用户，网站给我的感觉还是主要为&lt;code&gt;OIer&lt;/code&gt;服务，可以考虑把网站规模进一步做大，吸纳&lt;code&gt;ICPC/PAT/lanqiao&lt;/code&gt;等参赛者&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;三-建议与规划&#34;&gt;三、建议与规划&lt;/h3&gt;
&lt;h4 id=&#34;1市场概况&#34;&gt;1.市场概况&lt;/h4&gt;
&lt;p&gt;市场面向参与各类信息学竞赛的青少年，据洛谷官方，在&lt;code&gt;2019&lt;/code&gt;年已有&lt;code&gt;30&lt;/code&gt;万注册用户，累计&lt;code&gt;3000&lt;/code&gt;万次评测。当然对算法或&lt;code&gt;ACM&lt;/code&gt;感兴趣的人群和想要入门&lt;code&gt;OI&lt;/code&gt;的人群也可看作洛谷庞大的潜在用户&lt;/p&gt;
&lt;h4 id=&#34;2市场现状&#34;&gt;2.市场现状&lt;/h4&gt;
&lt;p&gt;目前市场上的竞赛&lt;code&gt;OJ&lt;/code&gt;: &lt;a href=&#34;https://vjudge.net/&#34;&gt;Vjudge&lt;/a&gt;, &lt;a href=&#34;https://codeforces.com/&#34;&gt;CodeForces&lt;/a&gt; , &lt;a href=&#34;https://ac.nowcoder.com/acm/contest/vip-index&#34;&gt;牛客&lt;/a&gt;, &lt;a href=&#34;https://zoj.pintia.cn/home/news&#34;&gt;ZOJ&lt;/a&gt;, &lt;a href=&#34;http://poj.org/&#34;&gt;POJ&lt;/a&gt;, &lt;a href=&#34;http://acm.hdu.edu.cn/&#34;&gt;HDOJ&lt;/a&gt;, &lt;a href=&#34;https://loj.ac/&#34;&gt;LibreOJ&lt;/a&gt;与各大高校校内的&lt;code&gt;OJ&lt;/code&gt;，上述产品定位均为&lt;code&gt;IO/ACM&lt;/code&gt;题库，这些&lt;code&gt;OJ&lt;/code&gt;也很好用，但社交性相对较弱，不像洛谷这般吸引新用户，因此远没有洛谷这样火，图源:百度指数&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609145849.png&#34; style=&#34;width:90%;&#34;&gt;
&lt;/center&gt;
&lt;p&gt;&lt;code&gt;OJ&lt;/code&gt;中由高校开设的非盈利&lt;code&gt;OJ&lt;/code&gt;居多，而&lt;a href=&#34;https://ac.nowcoder.com/acm/contest/vip-index&#34;&gt;牛客竞赛&lt;/a&gt;的定位最接近洛谷，后者面向&lt;code&gt;CSP-J/CSP-S/NOI/ACM&lt;/code&gt;竞赛的参与者提供题库与培训，可以看作洛谷的商业化竞品。&lt;/p&gt;
&lt;h4 id=&#34;3产品生态&#34;&gt;3.产品生态&lt;/h4&gt;
&lt;p&gt;这个产品的&lt;strong&gt;核心用户群是&lt;/strong&gt;正在参与信息学竞赛的高中生，包括其在内可能有以下几种典型用户:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;条目&lt;/th&gt;
&lt;th&gt;用户A&lt;/th&gt;
&lt;th&gt;用户B&lt;/th&gt;
&lt;th&gt;用户C&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;名字&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;宁友千&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;张甫剑&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;赵子飞&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;基本信息&lt;/td&gt;
&lt;td&gt;高中在读，17岁&lt;/td&gt;
&lt;td&gt;35岁，校内负责组织&lt;code&gt;OI&lt;/code&gt;训练的老师&lt;/td&gt;
&lt;td&gt;24岁，是学生&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;使用背景&lt;/td&gt;
&lt;td&gt;为了备战信息学竞赛而进行编程刷题&lt;/td&gt;
&lt;td&gt;为了给同学们找编程题目作为作业/考核&lt;/td&gt;
&lt;td&gt;对算法感兴趣，同时想提升编程能力&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;偏好&lt;/td&gt;
&lt;td&gt;可以有各种类型的题目做&lt;/td&gt;
&lt;td&gt;题目难度适中，能体现知识点&lt;/td&gt;
&lt;td&gt;遇到困难可以学习题解&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;基本需求&lt;/td&gt;
&lt;td&gt;使用题库系统进行做题训练&lt;/td&gt;
&lt;td&gt;通过筛选功能快速找题&lt;/td&gt;
&lt;td&gt;在学习某一算法知识后在洛谷上找一些相关题目&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;潜在需求&lt;/td&gt;
&lt;td&gt;参与洛谷比赛锻炼实力，购买洛谷相关网课&lt;/td&gt;
&lt;td&gt;购买洛谷的高级团队功能，自主命题并对学生进行监督&lt;/td&gt;
&lt;td&gt;因为要参与蓝桥杯等大学生程设竞赛，开始寻找相关题单针对性训练&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;其中用户&lt;code&gt;B&lt;/code&gt;在使用洛谷后如果觉得还不错，很可能驱动其教学班中的用户&lt;code&gt;A&lt;/code&gt;也加入洛谷，反之亦然。某用户&lt;code&gt;C&lt;/code&gt;在使用洛谷后也有可能将其安利给友人，因为洛谷社区系统还蛮不错的，大家可以互关，一齐刷一个题单进行讨论&lt;/p&gt;
&lt;p&gt;洛谷除了主站之外还有洛谷网校和洛谷有题这两个子站点，前者提供了洛谷主站一些比赛的讲解(这是一个新的产品生态点)与集训营课程以供购买，后者是一些&lt;code&gt;NOIP/NOI&lt;/code&gt;的非编程题题库，整体上三个站点内容比较相互独立&lt;/p&gt;
&lt;h4 id=&#34;4产品规划&#34;&gt;4.产品规划&lt;/h4&gt;
&lt;p&gt;我想开发两个简单的新功能，一个是完善洛谷的&amp;quot;在线IDE&amp;quot;，从洛谷的官方&lt;a href=&#34;https://www.luogu.com.cn/discuss/show/241461&#34;&gt;引导贴&lt;/a&gt;可见在线IDE也是官方推荐的编码方式之一&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609150026.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;但这个IDE用起来比较吃力，没有任何形式的补全，部分语言如&lt;code&gt;Python&lt;/code&gt;连高亮也没有(牛客竞赛这方面就做的比较成熟)，另一个要做的功能是类似&lt;a href=&#34;&#34;&gt;OI Wiki&lt;/a&gt;的算法知识库。这两个功能是为了进一步降低洛谷使用的门槛，让洛谷成为更好用的工具，让更多没有硬件条件或是缺乏指导的想参与&lt;code&gt;OI&lt;/code&gt;的人群也能加入洛谷，同时算法知识库可以只提供基础算法，用户体验感觉良好则可以付费解锁高级内容或引流到洛谷网校&lt;/p&gt;
&lt;p&gt;人员分配方面,我将6人按&lt;code&gt;Backend/Frontend/Test&lt;/code&gt;分为&lt;code&gt;2-2-2&lt;/code&gt;&lt;/p&gt;
&lt;center style = &#34;width:80%;margin: auto;&#34;&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;时间&lt;/th&gt;
&lt;th&gt;规划&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;week 1-2&lt;/td&gt;
&lt;td&gt;修复现有bug，在洛谷社区就新功能发表意见征集帖&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 3&lt;/td&gt;
&lt;td&gt;wiki，IDE界面设计，生成新功能整体的设计文档&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 4&lt;/td&gt;
&lt;td&gt;在线IDE完善各种语言的高亮，后端开始实现&lt;code&gt;c/c++&lt;/code&gt;的关键字/库函数的联想&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 5&lt;/td&gt;
&lt;td&gt;在线IDE添加&lt;code&gt;c/c++&lt;/code&gt;关键字补全，后端模仿实现&lt;code&gt;JB&lt;/code&gt;系IDE的特殊符号(&lt;code&gt;{}()&amp;quot;&amp;quot;&#39;&#39;&lt;/code&gt;)补全机制&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 6&lt;/td&gt;
&lt;td&gt;对部分关键字如&lt;code&gt;for/foreach&lt;/code&gt;添加自动生成模板的功能，前端整合现阶段所有功能，展开集成测试&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 7&lt;/td&gt;
&lt;td&gt;发布0.1(&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;α&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\alpha&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.0037em;&#34;&gt;α&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;)阶段的IDE，展开站内用户测试，收集反馈意见，决定是否开发其他语言的补全(洛谷主要是&lt;code&gt;c/c++&lt;/code&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 8&lt;/td&gt;
&lt;td&gt;为IDE加入代码风格与主题设置&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 9&lt;/td&gt;
&lt;td&gt;为IDE加入&amp;quot;当前题目&amp;quot;的功能，后端协同数据库使得能在IDE界面拉取题目信息，像力扣一样单页面内就可以方便查看题面。网站在用户修改代码后及时保存到数据库，方便用户下次继续编写，集成测试&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 10&lt;/td&gt;
&lt;td&gt;发布IDE体验版(&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;β&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\beta&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.8888799999999999em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.05278em;&#34;&gt;β&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;)，收集反馈，并发布&lt;code&gt;wiki&lt;/code&gt;意见征集帖，优先做呼声最高的内容&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 11&lt;/td&gt;
&lt;td&gt;完成&lt;code&gt;wiki&lt;/code&gt;的文章界面，后端开始&lt;code&gt;wiki&lt;/code&gt;数据库搭建，测试继续测试发布中的IDE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 12&lt;/td&gt;
&lt;td&gt;前端完成搜索、文章列表、面包屑导航的&lt;code&gt;UI&lt;/code&gt;，后端完成文章的增删查改逻辑&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 13&lt;/td&gt;
&lt;td&gt;前后端整合，集成测试，周末开启&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;α&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\alpha&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.0037em;&#34;&gt;α&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;阶段的用户测试&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 14&lt;/td&gt;
&lt;td&gt;收集反馈，在原题目界面的题目标签增加一个&amp;quot;查看相关知识点&amp;quot;的链接，&lt;code&gt;wiki&lt;/code&gt;加入知识图谱，人员调整为&lt;code&gt;2-1-3&lt;/code&gt;，对现有所有新功能再次测试&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 15&lt;/td&gt;
&lt;td&gt;&lt;code&gt;wiki&lt;/code&gt;文章加入相关例题列表，加入主站的评论功能，考虑开启用户编辑以尽快完善&lt;code&gt;wiki&lt;/code&gt;内容&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 16&lt;/td&gt;
&lt;td&gt;正式上线新功能，进行站内站外的推广&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/center&gt;
&lt;h3 id=&#34;leetcode&#34;&gt;LeetCode&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;&amp;quot;见证每 1 bit 成长&amp;quot;&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;力扣&lt;code&gt;2011&lt;/code&gt;年起源于美利坚，&lt;code&gt;2018.2&lt;/code&gt;推出中国版，力扣*&amp;quot;是一个专注于程序员技术成长和企业技术人才服务的品牌, 致力于解决程序员技术评估、培训、职业匹配的痛点，逐步引领互联网技术求职和招聘迈向专业化&amp;quot;*。可以看出力扣志在提高用户的程序员职业技能水平，基于此开发了几大核心功能:&lt;code&gt;OJ&lt;/code&gt;、&lt;code&gt;LeetBook&lt;/code&gt;(教程)、社区和模拟面试&lt;/p&gt;
&lt;p&gt;用过&lt;code&gt;LeetCode&lt;/code&gt;后才发现它和竞赛&lt;code&gt;OJ&lt;/code&gt;有很大不同，首先力扣不使用算法竞赛题，而是&lt;code&gt;1000+&lt;/code&gt;的原创题目与大厂面试题(据官方)，其次力扣并不像洛谷一样紧紧围绕题目评测展开功能，而是注重从多方面提高用户水平&lt;/p&gt;
&lt;h3 id=&#34;一-使用及体验-2&#34;&gt;一、使用及体验&lt;/h3&gt;
&lt;h4 id=&#34;1-leetcode-cn&#34;&gt;1. LeetCode-cn&lt;/h4&gt;
&lt;p&gt;我先进入中国力扣的&lt;a href=&#34;https://leetcode-cn.com/&#34;&gt;首页&lt;/a&gt;看一下，好家伙，首页条目这么多就离谱，我该先看哪个..可以看到主页是大量推荐的讨论以及名企面试题，右方侧栏也是大量推荐的题解与帖子..但力扣的新版&lt;code&gt;UI&lt;/code&gt;很不错哦，不同模块间保持了一致的扁平简色风格，过渡效果也做得很平滑&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609150211.png&#34; style=&#34;width:90%;&#34;&gt;
&lt;/center&gt;
&lt;p&gt;这里是力扣的个人界面，可以清晰看到个人的做题进度和动态，其中还有一个&lt;code&gt;git&lt;/code&gt;风格的每日提交统计。这个每月勋章嘛，实际上是需要每天完成&amp;quot;每日一题&amp;quot;当月全勤才能拿到的，可以看作力扣为用户提供的自我驱动的一个指标吧&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609150234.png&#34; style=&#34;width:90%;&#34;&gt;
&lt;/center&gt;
&lt;p&gt;力扣的的题库是从美国版翻译来的，总题量为&lt;code&gt;2,035&lt;/code&gt;，客观上题目难度肯定没有竞赛题高，大部分题目面向面试，对竞赛中的高级算法涉及较少&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609150255.png&#34; style=&#34;width:90%;&#34;&gt;
&lt;/center&gt;
&lt;p&gt;点开一道&lt;a href=&#34;https://leetcode-cn.com/problems/candy/&#34;&gt;题&lt;/a&gt;，可以看到力扣题目界面相当独特，页面分为两栏，左侧是题面，右侧则是一个在线的代码编辑器，当然可以自由调整二者的比例或仅显示一栏。代码编辑器支持样式设置与线上代码保存，而且可以使用&amp;quot;执行代码&amp;quot;快速地测试程序，对于想要长期想在网页中编程的用户还是相当贴心的。同时可以注意到力扣代码提交的格式不同，在洛谷等算法&lt;code&gt;OJ&lt;/code&gt;中用户要自己处理程序的&lt;code&gt;I/O&lt;/code&gt;，而在力扣大多数用户以填写函数(方法)的方式完成核心算法，而输入输出的处理与数据结构的定义由评测脚本负责，这是力扣的便捷性所在，用户只要关注题目相关算法。力扣为&lt;code&gt;2k+&lt;/code&gt;题目，每道题&lt;code&gt;10+&lt;/code&gt;的语言都定义好了接口，这样也比较接近面试题的情景。&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609150315.png&#34; style=&#34;width:90%;&#34;&gt;
&lt;/center&gt;
&lt;p&gt;力扣的题目界面就是一个很完备的单页面应用，刷题时通过&amp;quot;题目列表&amp;quot;可以快速切题，而且题解/评论都是内嵌在网页中的，相比于洛谷，网页整体是响应式的，不需要来回切换不同的页面。每道题评论/题解都很多,大部分有官方题解，题解支持&lt;code&gt;latex&lt;/code&gt;和力扣扩展的&lt;code&gt;md&lt;/code&gt;语法，但题解没有审核，所以质量良莠不齐，(而且我这里是在用&lt;code&gt;c&lt;/code&gt;写代码欸，为什么不自动帮我过滤出所有&lt;code&gt;c&lt;/code&gt;编写的题解呢？我看其他语言的作用大吗)。我认为力扣注重的是用户通过做题&lt;strong&gt;学会&lt;/strong&gt;相关算法应对面试，因此为了照顾广大用户群体不过分追求题解的硬核性，而是培养一个自由交流的庞大学习社区，这一点无可厚非。提交记录方面，对于非&lt;code&gt;AC&lt;/code&gt;提交，可以直接在线看到&lt;strong&gt;一条&lt;/strong&gt;相应的测试用例，因为力扣的测试用例格式并不复杂。&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609150340.png&#34; style=&#34;width:90%;&#34;&gt;
&lt;/center&gt;
&lt;p&gt;力扣还有两个核心模块:&lt;a href=&#34;https://leetcode-cn.com/leetbook/&#34;&gt;学习&lt;/a&gt;(下左)与&lt;a href=&#34;https://leetcode-cn.com/circle/&#34;&gt;讨论&lt;/a&gt;(下右)，其中学习模块是一系列介绍算法的电子书，其中内嵌了一些代码题目，粗略试读了一部分后感觉此模块面向的是零基础入门的编程或语言新手，文章质量不见得比知乎上的好。讨论区大多是面经内推和组赛信息，这里我没有深入使用&lt;/p&gt;
&lt;div style=&#34;display:flex&#34;&gt;
    &lt;div style=&#34;width:48%;margin-right:1%;margin-left:1%;&#34;&gt;
        &lt;img src =&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609150359.png&#34; style=&#34;width:100%&#34;&gt;
    &lt;/div&gt;
    &lt;div  style=&#34;width:48%;margin-right:1%;margin-left:1%;&#34;&gt;
        &lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609150421.png&#34; style=&#34;width:100%&#34;&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;h4 id=&#34;2-bugs&#34;&gt;2. Bugs&lt;/h4&gt;
&lt;h5 id=&#34;bug-d&#34;&gt;bug D&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;bug复现: (&lt;strong&gt;必然发生&lt;/strong&gt;)&lt;/p&gt;
&lt;p&gt;力扣-&lt;a href=&#34;https://leetcode-cn.com/profile/articles/&#34;&gt;我的题解&lt;/a&gt; &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 选择一篇写好的题解，点击&amp;quot;编辑&amp;quot;字样 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 题解详情页面点击&amp;quot;编辑&amp;quot; &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 点击“删除”按钮 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 回到题解列表&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;具体描述:&lt;/p&gt;
&lt;p&gt;题解仍在题解列表中，但再次点击&amp;quot;编辑&amp;quot;字样无法找到题解，会回到题目主界面。而且这里还有个交互逻辑的问题，1.我在题解列表不能进行删除 2.我在题解列表点击&amp;quot;编辑&amp;quot;，在跳转的页面中没有进入编辑，需要再在题解详情页面点击&amp;quot;编辑&amp;quot;&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609150440.png&#34; style=&#34;width:85%;&#34;&gt;
&lt;/center&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;bug分析:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;严重性:👾👾, 虽然说不影响使用，但无法找回题解的情况下列表里再留着题解记录也没有意义吧&lt;/li&gt;
&lt;li&gt;可能成因: 可能就是没有删除用户历史题解列表里的记录，或者本意就是保存所有题解记录&lt;/li&gt;
&lt;li&gt;改进建议: 已删除题解标注出来，同时不能跳转到详情&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;bug-e&#34;&gt;bug E&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;bug复现: (&lt;strong&gt;必然发生&lt;/strong&gt;)&lt;/p&gt;
&lt;p&gt;点开上文的这道&lt;a href=&#34;https://leetcode-cn.com/problems/candy/&#34;&gt;题&lt;/a&gt; &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 点击&amp;quot;题解&amp;quot;选项卡点 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 击右上角个人头像 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;  &amp;quot;切换到旧版本&amp;quot;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;具体描述:&lt;/p&gt;
&lt;p&gt;题解都消失了&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609150531.png&#34; style=&#34;width:85%;&#34;&gt;
&lt;/center&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;bug分析:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;严重性:👾👾👾, 原本确实是有题解的，切换到新版本界面可恢复&lt;/li&gt;
&lt;li&gt;可能成因: 我注意到在旧版本点击讨论/题解会直接重定向到新版本的界面中，同时复现过程中如果切换的是&amp;quot;讨论&amp;quot;选项卡，则会跳转到旧界面的题目描述界面，因此虽然无法使用旧版本的讨论/题解，但我认为力扣已经移除了旧界面中的这两个模块。可能原因是相应的界面重构了，旧界面无法再加载新的题解。&lt;/li&gt;
&lt;li&gt;改进建议: 在这种情况下，禁止切换到旧界面或者切换到旧界面的题目描述区域&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;bug-f真bug&#34;&gt;bug F(真·bug)&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;bug复现: (&lt;strong&gt;必然发生&lt;/strong&gt;)&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;提交一次&lt;a href=&#34;https://leetcode-cn.com/problems/candy/&#34;&gt;Prob#135分发糖果&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;随便点开一道&lt;a href=&#34;https://leetcode-cn.com/problems/two-sum/&#34;&gt;题&lt;/a&gt; &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 点击&amp;quot;题目列表&amp;quot;   &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 切换至&amp;quot;🔥 LeetCode 热题 HOT 100&amp;quot; &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;  关闭当前页面&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;右上角头像 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; &amp;quot;做题分析&amp;quot;  &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 跳转到&lt;a href=&#34;https://leetcode-cn.com/problems/candy/&#34;&gt;Prob#135分发糖果&lt;/a&gt;的提交详情 &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; 点击最下侧的“返回题目”&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
	&lt;center&gt;
&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609150646.png&#34; style=&#34;width:85%;&#34;&gt;
&lt;/center&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;具体描述:&lt;/p&gt;
&lt;p&gt;(人类早期驯服野生小bug的珍贵录像)&lt;/p&gt;
&lt;p&gt;可以看到题单编号成了错误图标，且不能切换题目了，打开题目列表，题目列表也没了&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609150706.png&#34; style=&#34;width:85%;&#34;&gt;
&lt;/center&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609150724.png&#34; style=&#34;width:85%;&#34;&gt;
&lt;/center&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;bug分析:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;严重性:👾👾👾, 用户暂时使用不了题单，但切换题单或者刷新当前页面可恢复&lt;/li&gt;
&lt;li&gt;可能成因: 这是因为分发糖果这道题并不是我们当前题单内的题，但力扣仍然试图在提单内寻找这道题目导致异常情况，具体原因可能是提交记录回到题目的入口比较隐蔽，没有充分测试&lt;/li&gt;
&lt;li&gt;改进建议: 明确跳转题目不在当前题单时的行为逻辑，可以将跳转的题目加入到当前题单中，或将当前题单切换成包含所有题目的总题单，而不是不作异常处理破坏用户体验&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;同时力扣的讨论区有&amp;quot;意见反馈&amp;quot;专区，我按照官方建议的格式给出了bug F的反馈，但仍未得到及时回复:&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609150757.png&#34; style=&#34;width:90%;&#34;&gt;
&lt;/center&gt;
&lt;h4 id=&#34;3-leetcode-on-vsc&#34;&gt;3. LeetCode On VSC&lt;/h4&gt;
&lt;p&gt;同时我注意到&lt;code&gt;LeetCode&lt;/code&gt;还有&lt;code&gt;IDEA&lt;/code&gt;以及&lt;code&gt;Visual Studio Code&lt;/code&gt;的相关插件，下面我是我对&lt;code&gt;vsc&lt;/code&gt;版力扣插件的试用流程:&lt;/p&gt;
&lt;p&gt;插件的安装比较简单，首先配置好&lt;code&gt;10.0&lt;/code&gt;版本以上的&lt;code&gt;Node.js(npm)&lt;/code&gt;，并把&lt;code&gt;Node&lt;/code&gt;加入&lt;code&gt;PATH&lt;/code&gt;变量，因为这个插件的核心代码是&lt;code&gt;JavaScript&lt;/code&gt;写的，通过&lt;code&gt;js&lt;/code&gt;抓取远端网站的题解、题目进行本地刷题。同时通过&lt;code&gt;npm install -g skygragon/leetcode-cli&lt;/code&gt;安装力扣命令行，随后在&lt;code&gt;vsc&lt;/code&gt;的插件市场安装&lt;code&gt;LeetCode 0.17.0&lt;/code&gt;，可以发现&lt;code&gt;vsc&lt;/code&gt;的侧边栏多了一个力扣的选项卡，第一次切换进去后需要首先进行登录，此插件大部分交互使用&lt;code&gt;vsc&lt;/code&gt;的全局命令行(&lt;code&gt;Ctrl&lt;/code&gt; + &lt;code&gt;shift&lt;/code&gt; + &lt;code&gt;P&lt;/code&gt;)进行&lt;/p&gt;
&lt;p&gt;登录后可以查看题目列表，点击题名便抓取到了题面，题面以&lt;code&gt;Markdown Preview&lt;/code&gt;的形式展示(可能要安装&lt;code&gt;md&lt;/code&gt;相关插件)，设置好力扣工作区后就可以开始刷题了！&lt;/p&gt;
&lt;p&gt;可以看到自动生成的源码文件自动增加了提交与测试的按钮，同时右键也有快捷键，但这个&lt;code&gt;Show Top Voted Solution&lt;/code&gt;获取的是美版的题解..题面中的&lt;code&gt;Discussion|Solution&lt;/code&gt;实际也只是超链接，需要在浏览器中打开，还要吐槽的是偶尔发生的连接失败问题，就不展开了&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609150831.png&#34; style=&#34;width:90%;&#34;&gt;
&lt;/center&gt;
&lt;p&gt;总体来说，插件版力扣体验还是比网页版好的，不用管那么多满天飞的其他信息，可以专注于题目本身。更重要的是可以使用自己熟悉的&lt;code&gt;IDE&lt;/code&gt;并且使用代码补全功能了!网页版里代码版权好像是付费功能，&lt;strong&gt;好耶&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;试用题目测试，反馈结果也是&lt;code&gt;md&lt;/code&gt;,很简洁&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609150851.png&#34; style=&#34;width:90%;&#34;&gt;
&lt;/center&gt;
&lt;p&gt;提交同理&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609150907.png&#34; style=&#34;width:90%;&#34;&gt;
&lt;/center&gt;
&lt;h4 id=&#34;采访环节-2&#34;&gt;采访环节-2&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;采访对象&lt;/strong&gt;: C9H13O3N&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;被访者介绍&lt;/strong&gt;: 化竞人，CSGO高手，工程小专家，曾经接触使用过各种语言、框架，玩过&lt;code&gt;opencv/gl&lt;/code&gt;，在服务器上搭过&lt;code&gt;mybatis&lt;/code&gt;，也做过微信小程序和&lt;code&gt;APP&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;**采访动机/需求介绍:**因为我知道他一直在坚持在力扣上刷题呀，起码每日一题一直有在keep，也算力扣资深用户了&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;**实际使用栏目:**力扣-每日一题，&lt;code&gt;vsc&lt;/code&gt;版力扣&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;zixfy: Hola, C9H13O3N,请问你使用力扣时最常用的功能是什么呢？&lt;/p&gt;
&lt;p&gt;C9H13O3N: 其他的没怎么用过，主要就是题库，具体而言就是每日一题吧&lt;/p&gt;
&lt;p&gt;zixfy: 你是为了什么开始刷题呢?&lt;/p&gt;
&lt;p&gt;C9H13O3N: 主要还是提升自己的算法能力，力扣有不少基础算法题，可以起到比较好的复习作用&lt;/p&gt;
&lt;p&gt;zixfy: 那你为何会选择力扣呢，有使用过其他&lt;code&gt;OJ&lt;/code&gt;吗？&lt;/p&gt;
&lt;p&gt;C9H13O3N: 其他&lt;code&gt;OJ&lt;/code&gt;的话主要就是校内&lt;code&gt;OJ&lt;/code&gt;吧，选择力扣还是主要因为他的名气大吧，我的老师也有安利我多在上面刷些题目&lt;/p&gt;
&lt;p&gt;zixfy: 我注意到力扣的一大特点是对在线编码的支持，你是在网页编码还是在本地编码的呢?&lt;/p&gt;
&lt;p&gt;C9H13O3N: 简单题的话就直接在浏览器里写了，复杂一点的就用自己的&lt;code&gt;IDE&lt;/code&gt;写，因为没有开会员时是无法使用力扣的代码补全与&lt;code&gt;DEBUGGER&lt;/code&gt;的，写起来比较折磨&lt;/p&gt;
&lt;p&gt;zixfy: 那这样你觉得一年氪三百大洋买力扣会员值得吗，会员还有名企题库诶&lt;/p&gt;
&lt;p&gt;C9H13O3N: 力扣会员还是比较鸡肋吧，现在我现在也不是不能写，而且题库也充足啊，等到以后需要专门刷企业面试题再考虑吧&lt;/p&gt;
&lt;p&gt;zixfy: 我注意到有一个&lt;code&gt;vsc&lt;/code&gt;版的力扣插件，使用这个插件可以本地刷题，还能有&lt;code&gt;vsc&lt;/code&gt;的代码补全，要不要康康?&lt;/p&gt;
&lt;p&gt;C9H13O3N: 彳亍(试用中)&lt;/p&gt;
&lt;p&gt;C9H13O3N: 原来可以直接爬取题目啊，不错。哦哦，本地文件也有补全了，不过你这个&lt;code&gt;vsc&lt;/code&gt;的代码补全完全比不上&lt;code&gt;JB&lt;/code&gt;系的&lt;code&gt;IDE&lt;/code&gt;啊(...)。哦，文件内可以直接提交与测试，还有题单和搜索功能，确实比网页版体验好一些&lt;/p&gt;
&lt;p&gt;zixfy: ..对，它可以让你在刷题时开启专注模式&lt;/p&gt;
&lt;p&gt;zixfy: 那么你会给力扣整体打多少分呢(10分制)&lt;/p&gt;
&lt;p&gt;C9H13O3N: 8分吧？扣分点是是总是有些内购推广，而且有些题和功能只能付费后解锁&lt;/p&gt;
&lt;/blockquote&gt;
&lt;center&gt;
	&lt;img src= &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609150931.png&#34; style = &#34;width:60%&#34;&gt;     
&lt;/center&gt;
&lt;h4 id=&#34;4总评&#34;&gt;4.总评&lt;/h4&gt;
&lt;p&gt;总体而言，力扣体量大，发展潜力大，但仍然需要进一步扩充题库(数据库/&lt;code&gt;shell&lt;/code&gt;方面题较少)，同时把&amp;quot;学习&amp;quot;模块做好做大，因此我认为是&lt;strong&gt;d+/e-) 好，非常不错&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;采用&lt;a href=&#34;https://www.cnblogs.com/xinz/p/3308608.html&#34;&gt;邹欣老师给出的表格&lt;/a&gt;，我具体的量化评价如下:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;类别&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;描述&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;评价&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;评分([-3, 10]）&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;核心功能&lt;/td&gt;
&lt;td&gt;分析三个核心功能，功能设计和质量&lt;/td&gt;
&lt;td&gt;&lt;code&gt;OJ&lt;/code&gt;/学习/讨论，后两者缺乏突出特点&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;细节&lt;/td&gt;
&lt;td&gt;有什么为用户考虑的细节?&lt;/td&gt;
&lt;td&gt;题单、笔记本、做题分析，方便用户制定学习计划&lt;/td&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;用户体验&lt;/td&gt;
&lt;td&gt;当用户完成功能时，不干扰用户 。&lt;/td&gt;
&lt;td&gt;信息泛滥，顶部工具栏晃眼，刷题时常见内购广告和比赛推广&lt;/td&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;辅助功能&lt;/td&gt;
&lt;td&gt;一些辅助功能如皮肤等&lt;/td&gt;
&lt;td&gt;模拟面试、代码补全、企业题库，但需要付费获得体验&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;差异化功能&lt;/td&gt;
&lt;td&gt;这个软件独特的功能. 它对用户的吸引力?&lt;/td&gt;
&lt;td&gt;原创面试题库，在线编写代码的解决方案&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;软件的效能&lt;/td&gt;
&lt;td&gt;占用内存, 启动速度, 内存泄漏情况&lt;/td&gt;
&lt;td&gt;代码提交/测试耗时为秒级，且拒绝频繁提交&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;软件的适应性&lt;/td&gt;
&lt;td&gt;在联网/断网, 大小屏幕, 没有鼠标的情况下都可以顺畅操作，跨平台&lt;/td&gt;
&lt;td&gt;支持相关&lt;code&gt;IDE&lt;/code&gt;本地插件，有相关&lt;code&gt;APP&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;成长性&lt;/td&gt;
&lt;td&gt;记住用户的选择, 适应用户的特点，越用越方便&lt;/td&gt;
&lt;td&gt;在线代码编辑器支持长期使用&lt;/td&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;用户有控制权&lt;/td&gt;
&lt;td&gt;系统状态有反馈，等待时间合适。关键操作有确认提示，有明确的错误信息。&lt;/td&gt;
&lt;td&gt;系统整体完备，但不一定有明确的错误信息&lt;/td&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;总计&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;82.22%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;二-评估分析-2&#34;&gt;二、评估分析&lt;/h3&gt;
&lt;h5 id=&#34;1使用此服务的所有功能估计这个软件网站服务做到这个程度大约需要多少时间团队人数6人左右计算机大学毕业生并有专业ui支持-2&#34;&gt;&lt;em&gt;1.使用此服务的所有功能，估计这个软件/网站/服务做到这个程度大约需要多少时间(团队人数6人左右，计算机大学毕业生，并有专业UI支持)&lt;/em&gt;&lt;/h5&gt;
&lt;p&gt;力扣功能还蛮多，不考虑力扣&lt;code&gt;APP&lt;/code&gt;与相关插件的话，对于力扣主站的开发我认为需要6个月以上(非996)。一个半月完成评测机、题库系统与在线代码编辑器，一个半月完成用户系统，包括收藏夹、笔记本、进度管理、提交记录、做题分析、题解等等等(那就两个月吧)，剩下三个月逐个完成比赛、讨论、学习模块并进行集成测试，这样大概还是只能完成力扣的基本功能&lt;/p&gt;
&lt;h5 id=&#34;2分析这个软件目前的优劣和类似软件相比这个产品的质量在同类产品中估计名列第几-2&#34;&gt;&lt;em&gt;2.分析这个软件目前的优劣(和类似软件相比)，这个产品的质量在同类产品中估计名列第几？&lt;/em&gt;&lt;/h5&gt;
&lt;p&gt;优势：每道题&lt;code&gt;10+&lt;/code&gt;的语言都定义好了接口，方便用户专注于核心算法，用户基数大，已经形成了比较大型的学习交流社区，提供相关的入门教程，界面流畅好看； 劣势：就面向面试而言，缺乏非编程题目，非完全免费可能会劝退部分用户。但是事实上力扣已经可以称之为国内最大的&lt;code&gt;IT&lt;/code&gt;技术职业化提升与学习平台，在线面试、企业题库我也感觉比较惊艳，因此这个产品的质量在同类产品中估计名列第一&lt;/p&gt;
&lt;h5 id=&#34;3从各方面的问题推理出这个软件团队在软件工程方面可以提高的一个重要方面-2&#34;&gt;&lt;em&gt;3.从各方面的问题，推理出这个软件团队在软件工程方面可以提高的一个重要方面&lt;/em&gt;&lt;/h5&gt;
&lt;p&gt;我认为力扣最大的问题是没有体现出成长性，我在使用过程中没有注意到力扣有题目推荐的功能，以及缺乏对专业技能的评估系统，历史题目只就用来查看下进度，如果力扣结合用户所有做过的题，分析出用户易错点或短板，也许可以能给用户比较有意义的引导，也更契合力扣&amp;quot;助力程序员终身成长&amp;quot;的价值观。其次可以充实一下可怜的&lt;code&gt;shell/database&lt;/code&gt;题库，提高核心功能的质量&lt;/p&gt;
&lt;h3 id=&#34;三-建议与规划-2&#34;&gt;三、建议与规划&lt;/h3&gt;
&lt;h4 id=&#34;1市场概况-2&#34;&gt;1.市场概况&lt;/h4&gt;
&lt;p&gt;市场面向所有想要提高专业水平的待业或在职的程序员，力扣的用户主要来自北上广等程序员扎堆的地域(百度指数)，力扣具体注册用户难以考证，官方表明已经累积了约&lt;code&gt;1&lt;/code&gt;亿次代码提交，故可估计力扣的用户规模达到了&lt;strong&gt;百万&lt;/strong&gt;级别，远超于洛谷。力扣的潜在用户是跨专业，或想要快速入门企业面试题或一门编程语言的人群&lt;/p&gt;
&lt;h4 id=&#34;2市场现状-2&#34;&gt;2.市场现状&lt;/h4&gt;
&lt;p&gt;目前市场上面向&lt;code&gt;Offer&lt;/code&gt;的广义&lt;code&gt;OJ&lt;/code&gt;还有: &lt;a href=&#34;https://www.nowcoder.com/&#34;&gt;nowcoder(牛客网)&lt;/a&gt;, &lt;a href=&#34;https://www.lintcode.com/&#34;&gt;LintCode&lt;/a&gt;, &lt;a href=&#34;http://hihocoder.com/&#34;&gt;hihocoder&lt;/a&gt;, &lt;a href=&#34;https://www.hackerrank.com/&#34;&gt;hackerrank&lt;/a&gt;, &lt;a href=&#34;https://www.codewars.com/&#34;&gt;codewars&lt;/a&gt;等。其中&lt;code&gt;LintCode&lt;/code&gt;整体网站功能设计与力扣雷同;&lt;code&gt;hihocoder&lt;/code&gt;是一个专注于高水平的程序设计比赛与题目的网站,&lt;code&gt;hackerrank&lt;/code&gt;定位比较清晰，网站题库基于业界实用的各种前后端的语言，并为用户提供专业的评估与高频的比赛；&lt;code&gt;codewars&lt;/code&gt;支持数十种语言，同样更加接近实际开发所用的技术栈，牛客网产品定位和力扣相近，但牛客网的功能更多更杂(适用于大学生学习、备考、求职，涉及领域也不止&lt;code&gt;IT&lt;/code&gt;)，社区也相对花哨一点&lt;/p&gt;
&lt;p&gt;而且就热度而言，国内这样的&lt;code&gt;OJ&lt;/code&gt;比较有名的也只有力扣和牛客网&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609151011.png&#34; style=&#34;width:90%;&#34;&gt;
&lt;/center&gt;
&lt;p&gt;牛客网提供笔试题、面试编程题、高校期末考试题，甚至还可以在里面做一套&lt;code&gt;961&lt;/code&gt;？就刷算法题而言，牛客网的体验没有力扣好，做的比较粗糙。牛客同时还有简历投递、技术栈学习等一堆杂乱的功能，可以看出牛客和力扣存在一定的竞争关系，但牛客面向信息类技能(包括通用技能)的方方面面，而力扣的用户还是以刷题为直接目的的为主，二者也可以共生，比如某程序员在成长阶段可能用力扣更多，但在四处投简历时会到牛客网寻求更详细的求职信息&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609151029.png&#34; style=&#34;width:90%;&#34;&gt;
&lt;/center&gt;
&lt;h4 id=&#34;3产品生态-2&#34;&gt;3.产品生态&lt;/h4&gt;
&lt;p&gt;力扣的&lt;strong&gt;核心用户群是&lt;/strong&gt;正在准备互联网企业校招以及社招的各阶段人群，包括其在内可能有以下几种典型用户:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;条目&lt;/th&gt;
&lt;th&gt;用户A&lt;/th&gt;
&lt;th&gt;用户B&lt;/th&gt;
&lt;th&gt;用户C&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;名字&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;刘啾九&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;王马龙&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;许可多&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;基本信息&lt;/td&gt;
&lt;td&gt;25岁，在比特跳动公司上班&lt;/td&gt;
&lt;td&gt;23岁，应届生，准备校招中&lt;/td&gt;
&lt;td&gt;24岁，学数学的，想转行做数据分析师&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;使用背景&lt;/td&gt;
&lt;td&gt;做了好久的测试，想跳槽成后端数据库开发&lt;/td&gt;
&lt;td&gt;投递的比特跳动公司对算法要求高&lt;/td&gt;
&lt;td&gt;想在短时间内掌握&lt;code&gt;python/c++&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;偏好&lt;/td&gt;
&lt;td&gt;学习工作可用的编程技巧&lt;/td&gt;
&lt;td&gt;喜欢更贴近真实面试的场景&lt;/td&gt;
&lt;td&gt;有及时的帮助与反馈&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;基本需求&lt;/td&gt;
&lt;td&gt;针对&lt;code&gt;mysql&lt;/code&gt;等数据库题目练习&lt;/td&gt;
&lt;td&gt;按知识点展开刷题计划&lt;/td&gt;
&lt;td&gt;通过学习模块快速夯实基础知识&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;潜在需求&lt;/td&gt;
&lt;td&gt;深入参与社区，发掘最适合自己的企业&lt;/td&gt;
&lt;td&gt;开通力扣会员享受比特跳动的企业题库&lt;/td&gt;
&lt;td&gt;不会配&lt;code&gt;IDE&lt;/code&gt;,开通会员享受力扣的在线&lt;code&gt;IDE&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;力扣致力全程服务程序员的成长，那么最好情况下就是用户在角色&lt;code&gt;C&lt;/code&gt; &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; &lt;code&gt;B&lt;/code&gt; &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇒&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Rightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇒&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; &lt;code&gt;A&lt;/code&gt; &lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo&gt;⇔&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\Leftrightarrow&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.36687em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;⇔&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; &lt;code&gt;A&lt;/code&gt;的转变过程中都能作为力扣的忠实用户，当然这需要力扣进一步自然地将刷题/学习/求职三个功能衔接起来。&lt;code&gt;C&lt;/code&gt;类用户可能对算法、编程完全不熟悉，TA可能往往是被有经验的&lt;code&gt;A/B&lt;/code&gt;类用户安利过来的&lt;/p&gt;
&lt;p&gt;力扣有对应的&lt;code&gt;APP&lt;/code&gt;，基本上除了代码提交其他功能都搬过去了，但其实没必要，移动端的力扣可以专注于学习与社区这两个内容，着力优化移动端用户的浏览体验，并且在用户有做题需求时引导其使用网页版力扣&lt;/p&gt;
&lt;center&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609151104.png&#34; style=&#34;width:75%;&#34;&gt;
&lt;/center&gt;
&lt;h4 id=&#34;4产品规划-2&#34;&gt;4.产品规划&lt;/h4&gt;
&lt;p&gt;其实力扣定位相当清晰了，刷题找工作方面很完善，再添加新功能反而有些冗余。不过我注意到力扣介绍称*&amp;quot;为用户提供了多种多样的开发工具，适用于真实的日常技术开发和学习场景，其中，Playground （*另一个比较完整的在线IDE）无需设置环境...&amp;quot;*，但实际上力扣对业界技术栈与所用框架涉及甚少，&lt;code&gt;Playground &lt;/code&gt;仅有一个&lt;code&gt;React&lt;/code&gt;前端开发框架(只有这个比较接近开发环境)的环境，可以进一步开发。&lt;/p&gt;
&lt;center&gt;
	&lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609151145.png&#34; style=&#34;width:90%;&#34;&gt;
&lt;/center&gt;
&lt;p&gt;以添加数据库框架&lt;code&gt;MyBatis&lt;/code&gt;(当然也可以是其他前后端库或者机器学习框架)为例:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;N&lt;/code&gt;(Need，需求)：部分求职者想做后端工程师，而投递的公司使用&lt;code&gt;MyBatis&lt;/code&gt;，TA想熟悉相关基础，做个小DEMO啥的方便工作中使用&lt;/p&gt;
&lt;p&gt;&lt;code&gt;A&lt;/code&gt;(Approach，做法)：在学习模块加入相关技术栈教程，&lt;code&gt;Playground &lt;/code&gt;新开发&lt;code&gt;MyBatis&lt;/code&gt;的在线编程环境，同时题库可以新增一类综合编程题，让用户在&lt;code&gt;Playground &lt;/code&gt;上使用框架完成一个小项目，当然对于前端这种不好进行量化评测的我还没想好怎么做&lt;/p&gt;
&lt;p&gt;&lt;code&gt;B&lt;/code&gt;(Benefit，好处)：同时提高用户的算法能力和工程能力，从容面对面试&lt;/p&gt;
&lt;p&gt;&lt;code&gt;C&lt;/code&gt;(Competitors，竞争)：上文提到的竞品缺乏这种功能，可以考虑重点发展成为差异化功能&lt;/p&gt;
&lt;p&gt;&lt;code&gt;D&lt;/code&gt;(Delivery，推广)：在站内与相应具体技术的社区进行推广&lt;/p&gt;
&lt;p&gt;人力方面, 按&lt;code&gt;Backend/Frontend/Test&lt;/code&gt;分为&lt;code&gt;2-2-2&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;(胡言警告)&lt;/p&gt;
&lt;center style = &#34;width:80%;margin: auto;&#34;&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;日期&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;week 1&lt;/td&gt;
&lt;td&gt;在讨论区就新功能发表意见征集帖，&lt;code&gt;PM&lt;/code&gt;作需求调整&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 2-4&lt;/td&gt;
&lt;td&gt;开始学习模块的文章编辑，生成新&lt;code&gt;Playground &lt;/code&gt;与综合编程题的设计文档&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 5-8&lt;/td&gt;
&lt;td&gt;后端搭建&lt;code&gt;MyBatis/Java/JDBC&lt;/code&gt;的开发环境，同时前端复用已有的&lt;code&gt;Playground &lt;/code&gt;的&lt;code&gt;UI&lt;/code&gt;,开始编写新&lt;code&gt;Playground &lt;/code&gt;的多文件IDE界面&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 9&lt;/td&gt;
&lt;td&gt;前后端对接，进行大量集成测试&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 10&lt;/td&gt;
&lt;td&gt;发布&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;α&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\alpha&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.0037em;&#34;&gt;α&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;阶段的&lt;code&gt;Playground &lt;/code&gt; DEMO，视反馈意见作出调整&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 11-12&lt;/td&gt;
&lt;td&gt;增加新的题库区，前端进行综合编程题样题界面的开发，用户会在综合编程题收到一份详尽的指导书(), 后端在开发环境中建立题目所需的数据库，部署评测脚本，验证用户用&lt;code&gt;MyBatis&lt;/code&gt;写的数据库应用程序是否能正确操作数据库&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 13-14&lt;/td&gt;
&lt;td&gt;考虑到用户是多文件开发，同时为了更加贴近开发环境，在力扣部署一个&lt;code&gt;git&lt;/code&gt;服务器，给用户使用&lt;code&gt;git&lt;/code&gt;提交的选项，使用&lt;code&gt;CI&lt;/code&gt;功能进行评测&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 15&lt;/td&gt;
&lt;td&gt;整合新功能，开展一轮回归测试与集成测试&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;week 16&lt;/td&gt;
&lt;td&gt;完成&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;β&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;\beta&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.8888799999999999em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathdefault&#34; style=&#34;margin-right:0.05278em;&#34;&gt;β&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;版本的发布，开启用户内测，增加更多的综合编程题&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/center&gt;">【老物】2021软工作业：OJ软件案例分析</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/lao-wu-mo-lian-jie-dui-bian-cheng-zhong/"" data-c="
          &lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;项目&lt;/strong&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;内容&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;这个作业属于哪个课程&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;a href=&#34;https://edu.cnblogs.com/campus/buaa/BUAA_SE_2021_LR/&#34;&gt;2021春季计算机学院软件工程(罗杰 任健)&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;这个作业的要求在哪里&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;a href=&#34;https://edu.cnblogs.com/campus/buaa/BUAA_SE_2021_LR/homework/11889&#34;&gt;结对项目-第二阶段&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;我们在这个课程的目标是&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;和团队开发真正的软件，一起提升开发与合作的能力&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;这个作业在哪个具体方面帮助我们实现目标&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;通过结对编程学习协作设计与编码、代码复审、CI使用等&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h5 id=&#34;成员介绍&#34;&gt;成员介绍&lt;/h5&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;项目&lt;/th&gt;
&lt;th&gt;内容&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;结对项目第二阶段的&lt;code&gt;Gitlab&lt;/code&gt;仓库地址&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://gitlab.buaaoo.top/2021_alige_homeworks/pair_works/2021_zhengyang_zhu-zixuan_zhao_pair_work&#34;&gt;Pair Programming&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;二人的学号后四位&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;博客地址&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://www.cnblogs.com/ha-na-se/&#34;&gt;MadokaHomura(朱正阳)&lt;/a&gt;,  &lt;a href=&#34;https://www.cnblogs.com/zixfy/&#34;&gt;zixfy(赵子轩)&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h5 id=&#34;前情回顾&#34;&gt;前情回顾&lt;/h5&gt;
&lt;p&gt;&lt;a href=&#34;https://www.cnblogs.com/zixfy/p/14578813.html&#34;&gt;初见，结对编程！(上)&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;一-结对体验&#34;&gt;一、结对体验&lt;/h3&gt;
&lt;h4 id=&#34;1from-zzy&#34;&gt;1.From &lt;a href=&#34;https://www.cnblogs.com/ha-na-se/&#34;&gt;zzy&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;本次任务我主要负责&lt;code&gt;test&lt;/code&gt;部分。随着指导书的需求增多以及异常情况的复杂，任务的难度也有很大的提升。我认为此次任务的难度主要集中在文件系统中对软/硬链接的理解，以及软/硬链接在不同指令下的表现。&lt;/p&gt;
&lt;p&gt;由于此次作业难度的增大，我和zzx之间的讨论激烈程度也增加了。我认为这相较于上次我的单方面听从指挥有较大的进步。尽管大多数时候我的想法或观点经过讨论之后是有些问题的，但我认为能够提出问题，增进交流，也是一种进步。&lt;/p&gt;
&lt;p&gt;虽然这次我没有当&lt;code&gt;driver&lt;/code&gt;，但我也没能完成&lt;code&gt;Navigator&lt;/code&gt;的职责，主要设计仍然是由zzx完成的，我只是在此基础上提出了一点建议。类与方法的具体实现我也没有参与其中。&lt;code&gt;test&lt;/code&gt;方面做到也不够好，由于&lt;code&gt;oo&lt;/code&gt;期间就没有认真做单元测试，我这次做测试完全是摸着上次作业的测试走路，刚开始测试效率很低。在zzx完善了测试工具类之后，测试效率才提高（甚至有时候我还写出一些错误的测试误报bug浪费时间，着实是帮倒忙）&lt;/p&gt;
&lt;p&gt;总的来说，这次结对算是一种全新体验，虽然思路、理解、设计方面较上次有更多的参与，但是我实际编码和测试做的都不尽人意，希望下一次能够有所突破吧。&lt;/p&gt;
&lt;h4 id=&#34;2from-zzx&#34;&gt;2.From &lt;a href=&#34;https://www.cnblogs.com/zixfy/&#34;&gt;zzx&lt;/a&gt;&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;我对自己在这阶段的表现不满意 因为&lt;strong&gt;近两周&lt;/strong&gt;课业繁重其实并没有全身心投入结对编程，为了能尽早完成编码任务没能和上阶段一样就每一部分的具体编码细节与zzy进行深入讨论。我想说下个阶段需要充分利用每一分钟了😅&lt;/li&gt;
&lt;li&gt;这次新加入的&lt;code&gt;ln [-s]&lt;/code&gt;对第一阶段的程序架构产生了冲击，原有设计无法顺利增量开发，代码量的陡增(1,611)与不少冗余的产生让我有了很重的危机感；今天我仔细地想了一下，第一阶段的一些设计暴露出了许多问题，我此刻的想法如下:
&lt;ul&gt;
&lt;li&gt;每个文件/目录(逻辑上的文件)都存储本身的绝对路径是个很&lt;strong&gt;蠢&lt;/strong&gt;的设计，每条指令至多输出一条(非指令参数中的)绝对路径，更优解应该是需要输出时倒序拼接成绝对路径，进一步优化就是加入绝对路径的&lt;code&gt;cache&lt;/code&gt;，逻辑文件被移动才可能更改绝对路径。存储绝对路径也让我在&lt;code&gt;mv/cp&lt;/code&gt;里感到很麻烦，需要递归设置文件的新路径，逻辑文件应该只保存&lt;code&gt;name/size/count/father&lt;/code&gt;，其他的基本信息由&lt;code&gt;INode&lt;/code&gt;管理&lt;/li&gt;
&lt;li&gt;其次，程序在进行逻辑文件构造时要求传入父目录这个参数，我认为这也是存储绝对路径带来的衍生问题，没有父目录便确定不了绝对路径，但设置父子文件关系的功能应该下放到&lt;code&gt;Directory&lt;/code&gt;去管理，这个地方产生了很违和的冗余&lt;/li&gt;
&lt;li&gt;第三点,对于特殊目录&lt;code&gt;./..&lt;/code&gt;的处理，上阶段后我们将这两个目录放进了目录的子文件&lt;code&gt;Map&lt;/code&gt;中，但这样直接混淆了特殊目录与真实的子文件，导致&lt;code&gt;mv/cp&lt;/code&gt;在涉及特殊目录做了不少特判，但实际上只可能对特殊目录进行查询与获取，是不可能增删的，所以应该在目录类&lt;code&gt;Directory&lt;/code&gt;的&lt;code&gt;get()/contains()&lt;/code&gt;方法里进行特判即可&lt;/li&gt;
&lt;li&gt;第四点，我确信指导书的思想是“硬链接就是一个文件内容的另一个逻辑文件名”，所以我还是认为不应该区分&lt;code&gt;RegularFile&lt;/code&gt;与&lt;code&gt;HardLink&lt;/code&gt;，但是我们这阶段新增的&lt;code&gt;INode&lt;/code&gt;有问题,&lt;code&gt;INode&lt;/code&gt;与文件内容绑定，但只有&lt;code&gt;HardLink&lt;/code&gt;有实际的文件内容，因此有必要提取出一个&lt;code&gt;FileContent&lt;/code&gt;类进行文件内容管理，多个&lt;code&gt;HardLink&lt;/code&gt;之间共享的是同二个&lt;code&gt;INode &amp;amp; FileContent&lt;/code&gt;&lt;br&gt;
重构计划：&lt;br&gt;
&lt;img src=&#34;https://codimd.s3.shivering-isles.com/demo/uploads/upload_6c557e4743ac9db3c76c07214a7d3d19.png&#34; alt=&#34;（此图已挂）&#34; loading=&#34;lazy&#34;&gt;&lt;/li&gt;
&lt;li&gt;第五点，将所有修饰符改为&lt;code&gt;public&lt;/code&gt;,删去无必要的异常类(现在程序有些滥用异常),删去陈冗的&lt;code&gt;get()/set()&lt;/code&gt;以及套娃的方法控制码量&lt;/li&gt;
&lt;li&gt;当然这不会是整体的重构，只是对底层的实体类&lt;strong&gt;层次关系&lt;/strong&gt;与数据结构的重构，我们会尽量保证对接口类的逻辑不产生影响，我认为本阶段程序的缺陷主要是我上阶段盲目的设计和草率的编码风格导致的。当重构不可避免时，就尽早开始吧，拖到后期只能更棘手，今晚强测后我将确认程序在整体行为逻辑上还有那些偏差，然后就开始重构吧🏃​&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;3结对编程方式&#34;&gt;3.结对编程方式&lt;/h4&gt;
&lt;p&gt;本次结对编程采用了&lt;code&gt;JetBrains&lt;/code&gt;系&lt;code&gt;IDE&lt;/code&gt;自&lt;code&gt;v2020.2.x &lt;/code&gt;起支持的&lt;a href=&#34;https://blog.jetbrains.com/zh-hans/blog/2020/10/14/code-with-me/&#34;&gt;Code With Me&lt;/a&gt;插件，相比&lt;code&gt;git&lt;/code&gt;协作实时性更强，&lt;s&gt;效果拔群&lt;/s&gt;总体使用的体验还是不错的，但也存在一些问题：网络连接不稳定时会出现诸如不给提示、复制粘贴失败、代码写不上等现象。本次的代码全部是以zzx为host完成的。下附工作截图&lt;/p&gt;
&lt;center&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609144438.png&#34; width=&#34;80%&#34;&gt;
&lt;/center&gt;
&lt;h3 id=&#34;二-设计与实现&#34;&gt;二、设计与实现&lt;/h3&gt;
&lt;h4 id=&#34;1思路&#34;&gt;1.思路&lt;/h4&gt;
&lt;h5 id=&#34;a-用户系统&#34;&gt;a. 用户系统&lt;/h5&gt;
&lt;p&gt;首先是新增的用户系统类与原文件系统类之间的交互方式，本阶段我们使用了单例模式。同时考虑到&lt;code&gt;AppRunner&lt;/code&gt;中是先实例化文件系统后实例化用户系统的，因此文件系统构造后无法获得&lt;code&gt;root User&lt;/code&gt;的引用，因此用户系统构造后需要通知其设置&lt;code&gt;root&lt;/code&gt;用户&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java=&#34;&gt;public class FileSystemPluginManager {
    private static MyFileSystem fs;
    private static MyUserSystem us;
    public static void setUpFileSystem(MyFileSystem fs) {
        FileSystemPluginManager.fs = fs;
    }
    public static void setUpUserSystem(MyUserSystem us) {
        FileSystemPluginManager.us = us;
        fs.notifyUserSystemSetup();
    }
    public static void notifyUserExited() {
        fs.notifyUserExited();
    }
    ...
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;用户系统相对独立而且易实现，其大致数据结构为: &lt;code&gt;UserSystem&lt;/code&gt; 管理全局用户表(&lt;code&gt;Hashmap&lt;/code&gt;)与用户组表(&lt;code&gt;Hashmap&lt;/code&gt;)；&lt;code&gt;UserGroup&lt;/code&gt;管理组内用户表(&lt;code&gt;Hashmap&lt;/code&gt;)，记录作为其主组的用户数；&lt;code&gt;User&lt;/code&gt;管理其所属的用户组表(&lt;code&gt;Hashmap&lt;/code&gt;)；特别地，名字均不为&lt;code&gt;root&lt;/code&gt;&lt;/p&gt;
&lt;center &gt;
    &lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609144509.png&#34; width = &#34;80%&#34;&gt;
&lt;/center&gt;
&lt;h5 id=&#34;b一切皆文件&#34;&gt;b.一切皆文件&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;Linux&lt;/code&gt;中文件系统的一大核心思想是一切皆文件，文件/目录都拥有一个索引节点(&lt;code&gt;iNode&lt;/code&gt;)，其中文件&lt;code&gt;iNode&lt;/code&gt;存储文件内容，而文件夹存储的是子文件列表。地别地，硬链接文件与一个普通文件共享一个&lt;code&gt;iNode&lt;/code&gt;，亦或普通文件就是一个硬链接文件，而本阶段中的软链接文件可以理解为一个存储了用于重定向的路径的文件，因此我们提取出一个&lt;code&gt;INode&lt;/code&gt;类用于存储&lt;code&gt;creator, modifyTime, fileContent&lt;/code&gt;等实际的文件信息，而&lt;code&gt;FileLike&lt;/code&gt;类存储&lt;code&gt;AbosulatePath, size, name&lt;/code&gt;等逻辑上的文件信息。&lt;/p&gt;
&lt;p&gt;文件系统中的实体关系图如下，其中&lt;code&gt;FileLink&lt;/code&gt;是区别于目录的链接型文件,包括软链接文件(&lt;code&gt;SoftLink&lt;/code&gt;)与硬链接文件/文件(&lt;code&gt;File&lt;/code&gt;)，注意到&lt;code&gt;Directory/SoftLink&lt;/code&gt;所引用的&lt;code&gt;INode&lt;/code&gt;实例并没用存储子目录列表/重定向路径，而是在本类中存储这些属性，从现实中到面向对象的转换中，这里产生了一定的冗余&lt;/p&gt;
&lt;center&gt;
    &lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609144532.png&#34; width=&#34;50%&#34;&gt;
&lt;/center&gt;
&lt;p&gt;关于软链接的重定向，由于上阶段中索引文件/目录分为两种方法，一种是获得最后一级文件/目录，一种是获取其父目录(考虑到&lt;code&gt;mkdir/touch&lt;/code&gt;时其可能不存在的情况)，而加入软链接后，比如&lt;code&gt;touch&lt;/code&gt;指令中如果最后一级文件/目录是软链接，需要继续重定向，编写起来很冗余，因此整合了索引文件/目录的两种方法，保证在完全重定向的情况下保证最后一级文件/目录不是软链接，并且对于&lt;code&gt;/&lt;/code&gt;结尾的路径，在以获取文件的意向进行索引或最后一级文件/目录确实是文件类型时直接抛出路径非法的异常&lt;/p&gt;
&lt;p&gt;关于硬链接对&lt;code&gt;INode&lt;/code&gt;的共享，硬链接文件与&lt;code&gt;INode&lt;/code&gt;的链接关系在创建普通文件时隐式或通过&lt;code&gt;ln&lt;/code&gt;显式创建。当&lt;code&gt;INode&lt;/code&gt;文件大小修改时通知所有&lt;code&gt;linked&lt;/code&gt;的硬链接文件进行自底向上的更新，但&lt;code&gt;rm [-r]&lt;/code&gt;时理应递归解除所有硬链接文件和&lt;code&gt;INode&lt;/code&gt;的链接关系，但可以这样懒更新进行优化：当文件系统中某一文件/目录被删除，其父目录被设置成&lt;code&gt;null&lt;/code&gt;，硬链接文件自底向上更新大小时若遇到&lt;code&gt;null&lt;/code&gt;，说明文件已被删除，此时再接触硬链接文件和&lt;code&gt;INode&lt;/code&gt;的链接关系&lt;/p&gt;
&lt;h4 id=&#34;2测试&#34;&gt;2.测试&lt;/h4&gt;
&lt;h5 id=&#34;a-第一阶段debug&#34;&gt;a. 第一阶段DEBUG&lt;/h5&gt;
&lt;p&gt;代码覆盖率测试固然可以十分全面地调试程序在各种可能的情况下的行为，但对于自己应该写但却没有写的代码却是无能为力的。而且做到代码测试全覆盖也无法保证程序的最终质量，我们在第一阶段中产生的&lt;code&gt;Bug&lt;/code&gt;都是源于对极端/特殊数据的测试遗漏，这也启发我们在完成代码主体的覆盖率测试后应当更加注重程序对极端情况的处理，保障程序的鲁棒性与健壮性&lt;/p&gt;
&lt;h5 id=&#34;b-本阶段测试&#34;&gt;b. 本阶段测试&lt;/h5&gt;
&lt;p&gt;在第一阶段过后，我们发现测试过程中有两个降低编写测试代码效率的问题:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;i) 对于期望异常抛出的测试&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在上阶段中异常捕获测试使用的是&lt;code&gt;@Test&lt;/code&gt;注解与以下方法&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java=&#34;&gt;Exception expected = null;
try {
    doSomeThing();
} catch (Exception e) {
    expected = e;
}
Assert.assertTrue(expected instanceof MyException);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;为了提升代码可读性与简化编码，我们将上述方法利用泛型封装成异常测试类&lt;code&gt;ExceptionTestAble&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Test
public void deleteGroup() throws UserSystemException {
    us.addUser(&amp;quot;test&amp;quot;);
    new ExceptionTestAble(MyUserSystemException.class) {
        @Override
        public void run() throws Exception {
            us.deleteGroup(&amp;quot;test&amp;quot;);
        }
    }
};
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;ii) 黑盒测试&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在进行各模块的单元测试后进行程序整体功能的测试，但如果在单元测试函数中根据指令直接去调用&lt;code&gt;FileSystem/UserSystem&lt;/code&gt;的函数，指令数较多时降低了测试代码的可读性，并且写起来麻烦&lt;/p&gt;
&lt;p&gt;在尝试重定向&lt;code&gt;I/O&lt;/code&gt;直接调用&lt;code&gt;AppRunner&lt;/code&gt;进行输入输出捕获时发现在多个&lt;code&gt;@Test&lt;/code&gt;方法中调用&lt;code&gt;AppRunner&lt;/code&gt;时貌似由于其获取输入使用的是&lt;code&gt;Scanner&lt;/code&gt;而产生了线程问题，遂弃之。我们封装了一个对拍机类用于&lt;code&gt;FileSystem/UserSystem&lt;/code&gt;的构造，输入指令序列的解析与期望输出比对，可以使测试用例编写者只关注构造测试样例的数据本身&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;@Test
public void test78() {
    FileSystemTester.quickTest(
            Arrays.asList(&amp;quot;mkdir /buaase&amp;quot;,
                    &amp;quot;cd buaase&amp;quot;,
                    &amp;quot;mkdir -p /buaase/dir1/dir2&amp;quot;,
                    &amp;quot;ls dir1&amp;quot;,
                    &amp;quot;touch /buaase/file.txt&amp;quot;,
                    &amp;quot;info /buaase&amp;quot;),
            Arrays.asList(&amp;quot;Make directory /buaase&amp;quot;,
                    &amp;quot;/buaase&amp;quot;,
                    &amp;quot;Make directory /buaase/dir1/dir2&amp;quot;,
                    &amp;quot;dir2&amp;quot;,
                    &amp;quot;root root 1 5 0 2 /buaase&amp;quot;)
    );
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;由于指导书&lt;code&gt;issue&lt;/code&gt;部分存在很多边界情况和思维盲区，我们吸取上次强测的教训，对&lt;code&gt;issue&lt;/code&gt;中涉及到的情况也都进行了测试。&lt;/p&gt;
&lt;p&gt;最后一次提交的测试报告如下图所示&lt;/p&gt;
&lt;center&gt;
    &lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609144603.png&#34; width=&#34;75%&#34;&gt;
&lt;/center&gt;
&lt;h3 id=&#34;三-工作量&#34;&gt;三、工作量&lt;/h3&gt;
&lt;h4 id=&#34;1psp表格&#34;&gt;1.PSP表格&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;PSP2.1&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Personal Software Process Stages&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;预估耗时（分钟）&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;实际耗时（分钟）&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Planning&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;计划&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;u&gt;5&lt;/u&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;u&gt;5&lt;/u&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Estimate&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 估计这个任务需要多少时间&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;5&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Development&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;开发&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;u&gt;1660&lt;/u&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;u&gt;1880&lt;/u&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Analysis&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 需求分析 (包括学习新技术)&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;180&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;155&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Design Spec&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 生成设计文档&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;30&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Design Review&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 设计复审 (和同事审核设计文档)&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;60&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;120&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Coding Standard&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 代码规范 (为目前的开发制定合适的规范)&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;10&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Design&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 具体设计&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;240&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;300&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Coding&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 具体编码&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;420&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;480&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Code Review&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 代码复审&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;120&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;120&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Test&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 测试（自我测试，修改代码，提交修改）&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;600&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;660&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Reporting&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;报告&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;u&gt;120&lt;/u&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;u&gt;100&lt;/u&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Test Report&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 测试报告&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;30&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;30&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Size Measurement&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 计算工作量&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;10&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Postmortem &amp;amp; Process Improvement Plan&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 事后总结, 并提出过程改进计划&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;80&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;65&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;合计&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;u&gt;1785&lt;/u&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;u&gt;1950&lt;/u&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;2码量&#34;&gt;2.码量&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Java&lt;/th&gt;
&lt;th&gt;总行数&lt;/th&gt;
&lt;th&gt;代码行数&lt;/th&gt;
&lt;th&gt;注释行数&lt;/th&gt;
&lt;th&gt;空行数&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Src&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;2,046&lt;/td&gt;
&lt;td&gt;1,611&lt;/td&gt;
&lt;td&gt;167&lt;/td&gt;
&lt;td&gt;268&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Test&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;2,052&lt;/td&gt;
&lt;td&gt;1,770&lt;/td&gt;
&lt;td&gt;47&lt;/td&gt;
&lt;td&gt;235&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Total&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;u&gt; 4,098 &lt;/u&gt;&lt;/td&gt;
&lt;td&gt;3,381&lt;/td&gt;
&lt;td&gt;214&lt;/td&gt;
&lt;td&gt;503&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;(update at 4.3)&lt;/strong&gt;&lt;/p&gt;
&lt;center&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609144624.png&#34; width = &#34;50%&#34;&gt;
&lt;/center&gt;
&lt;p&gt;已重构， 主要针对的是解决上文中提到的各模块功能划分不明确，底层实体关系混乱而导致的冗余与高耦合的问题，重新划分为&lt;strong&gt;Directory&lt;/strong&gt;（目录）、&lt;strong&gt;INode&lt;/strong&gt;（索引节点）、&lt;strong&gt;FileContent&lt;/strong&gt;（文件内容）、&lt;strong&gt;FileLink&lt;/strong&gt;（链接文件）、&lt;strong&gt;SoftLink&lt;/strong&gt;（软链接文件）、&lt;strong&gt;HardLink&lt;/strong&gt;（硬链接文件/文件）、&lt;strong&gt;FileLike&lt;/strong&gt;（逻辑文件）&lt;/p&gt;
&lt;h5 id=&#34;1filelike逻辑文件&#34;&gt;1.FileLike（逻辑文件）&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;负责实现&lt;code&gt;Directory/FileLink&lt;/code&gt;的共性方法，主要有三:&lt;code&gt;getAbsPath(FileSystem)&lt;/code&gt;以通过文件系统获取逻辑文件的绝对路径,&lt;code&gt;updateSize(int)/updateWhenMove(int)&lt;/code&gt;用于自底向上更新大小/递归修改更新时间，&lt;code&gt;moveToDir(...)&lt;/code&gt;实现将逻辑文件转移到另一文件夹的功能，我们分析出&lt;code&gt;cp/mv&lt;/code&gt;的&lt;code&gt;14&lt;/code&gt;中情况在&lt;code&gt;MyFileSystem&lt;/code&gt;确定新文件名与新父目录后只需考虑是否覆盖与指令类型的&lt;code&gt;4&lt;/code&gt;种情况&lt;/li&gt;
&lt;li&gt;声明&lt;code&gt;copy()&lt;/code&gt;的抽象方法实现复制的多态&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;2filelink链接文件&#34;&gt;2.&lt;strong&gt;FileLink（链接文件）&lt;/strong&gt;&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;空壳抽象类，用于区分狭义的文件与目录&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;3inode索引节点&#34;&gt;3.&lt;strong&gt;INode&lt;/strong&gt;（索引节点）&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;存储硬链接文件用于共享的属性&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;4filecontent文件内容&#34;&gt;4.&lt;strong&gt;FileContent&lt;/strong&gt;（文件内容）&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;管理链接到的硬链接文件，在文件内容修改时同步各硬链接的文件大小&lt;/li&gt;
&lt;li&gt;在硬链接自底向上更新大小访问到为&lt;code&gt;null&lt;/code&gt;的父目录时，说明已被删，解除相应链接&lt;/li&gt;
&lt;li&gt;管理文件内容的&lt;code&gt;write/append&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;5softlink软链接文件&#34;&gt;5.&lt;strong&gt;SoftLink&lt;/strong&gt;（软链接文件）&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;主要方法只有进行重定向&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;6hardlink硬链接文件文件&#34;&gt;6.&lt;strong&gt;HardLink&lt;/strong&gt;（硬链接文件/文件）&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;通过&lt;code&gt;ln&lt;/code&gt;建立起硬链接的两个逻辑文件共享同二个&lt;code&gt;FileContent&lt;/code&gt;与&lt;code&gt;INode&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;7directory目录&#34;&gt;7.&lt;strong&gt;Directory&lt;/strong&gt;（目录）&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;核心类，因为&lt;code&gt;FileSystem&lt;/code&gt;所需的核心方法都在本类中以静态方法实现&lt;/li&gt;
&lt;li&gt;管理直接的子文件/目录，进行相应的增删查，在增删方法进行父子关系的建立与解除，在查方法进行&lt;code&gt;./..&lt;/code&gt;的特判&lt;/li&gt;
&lt;li&gt;在子文件/目录管理方法的基础上封装具有语义的方法：如添加子文件夹&lt;code&gt;addChildDir()&lt;/code&gt;，创建硬链接文件或进行修改的方法&lt;code&gt;ensureChildFile&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;核心方法&lt;code&gt;detectFileLike()&lt;/code&gt;,通过路径索引返回一个数据结构&lt;code&gt;FileDetecter&lt;/code&gt;,其中&lt;code&gt;FileDetecter&lt;/code&gt;包括倒数第二级逻辑文件、倒数第一级逻辑文件、倒数第一级逻辑文件名&lt;/li&gt;
&lt;li&gt;在&lt;code&gt;detectFileLike()&lt;/code&gt;的基础上为文件系统封装具有指令语义的方法，如&lt;code&gt;getFileLike()/addChildDirRecursively()/getDirectory()&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;8-myfilesystem&#34;&gt;8. MyFileSystem&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;接口类，完成指令语义级别的逻辑判断，调用底层&lt;code&gt;Directory&lt;/code&gt;类的方法进行操作&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;重构后冗余的绝对路径与构造方法依赖父目录删去，各模块功能相对更清晰了，码量只减少了近&lt;code&gt;200&lt;/code&gt;行，因为只是对底层类进行了重构， &lt;code&gt;MyFileSystem&lt;/code&gt;与其他工具类基本不受影响，我们程序下一步优化的方向是针对&lt;code&gt;MyFileSystem&lt;/code&gt;与&lt;code&gt;Directory&lt;/code&gt;类进行优化，&lt;code&gt;MyFileSystem&lt;/code&gt;同时进行异常的解析与指令语义的执行，有些臃肿。本阶段新增的&lt;code&gt;5&lt;/code&gt;条指令占据了近&lt;code&gt;250&lt;/code&gt;行，本阶段实现时已经整合了&lt;code&gt;mv/cp&lt;/code&gt;指令，同时考虑到&lt;code&gt;ln/ln -s&lt;/code&gt;行为逻辑相近，可以进行整合&lt;/p&gt;
">【老物】磨练，结对编程!（中）</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/lao-wu-chu-jian-jie-dui-bian-cheng-shang/"" data-c="
          &lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;项目&lt;/strong&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;内容&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;这个作业属于哪个课程&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;a href=&#34;https://edu.cnblogs.com/campus/buaa/BUAA_SE_2021_LR/&#34;&gt;2021春季计算机学院软件工程(罗杰 任健)&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;这个作业的要求在哪里&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;a href=&#34;https://shimo.im/docs/QDdKhC3thk6jcRYp/read&#34;&gt;结对项目-第一阶段&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;我们在这个课程的目标是&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;和团队开发真正的软件，一起提升开发与合作的能力&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;这个作业在哪个具体方面帮助我们实现目标&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;通过结对编程学习协作设计与编码、代码复审、CI使用等&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h5 id=&#34;成员介绍&#34;&gt;成员介绍&lt;/h5&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;项目&lt;/th&gt;
&lt;th&gt;内容&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;结对项目第一阶段的&lt;code&gt;Gitlab&lt;/code&gt;仓库地址&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://gitlab.buaaoo.top/2021_alige_homeworks/pair_works/2021_zhengyang_zhu-zixuan_zhao_pair_work&#34;&gt;Pair Programming&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;二人的学号后四位&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;博客地址&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://www.cnblogs.com/ha-na-se/&#34;&gt;MadokaHomura(朱正阳)&lt;/a&gt;,  &lt;a href=&#34;https://www.cnblogs.com/zixfy/&#34;&gt;zixfy(赵子轩)&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;一-关于解题&#34;&gt;一、关于解题&lt;/h3&gt;
&lt;hr&gt;
&lt;h4 id=&#34;1-设计与编码&#34;&gt;1. 设计与编码&lt;/h4&gt;
&lt;h5 id=&#34;a-事前设计&#34;&gt;a. 事前设计&lt;/h5&gt;
&lt;p&gt;本次作业最终需要实现一个基于内存的文件系统，它允许用户通过各类输入指令来进行文件的增删查改等交互，数据结构是树型结构。&lt;/p&gt;
&lt;p&gt;在逻辑上某一条指令的处理流程图如下:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-mermaid&#34;&gt;graph LR
input[指令输入]--&amp;gt;parse[解析地址]
parse.-&amp;gt;pathE&amp;gt;路径格式错误]
parse--&amp;gt;instrType{指令类型}
instrType--增--&amp;gt;instrAdd[获取路径倒数第二级目录]
instrType--查删改--&amp;gt;instrOther[获取路径最后一级目录/文件]
instrType--递归创建--&amp;gt;instrMkdirp[递归创建目录]
instrAdd.-&amp;gt;getFileE&amp;gt;目录/文件不存在]
instrOther.-&amp;gt;getFileE&amp;gt;目录/文件不存在]
instrMkdirp.-&amp;gt;typeE&amp;gt;目录/文件类型冲突]

instrAdd.-&amp;gt;typeE&amp;gt;目录/文件类型冲突]

instrOther.-&amp;gt;typeE&amp;gt;目录/文件类型冲突]
instrAdd--&amp;gt;addOp[增加子目录/文件]
addOp.-&amp;gt;existE&amp;gt;子目录已存在]
instrOther--查改--&amp;gt;modifyOp[操作文件/目录]
modifyOp.-&amp;gt;contentE&amp;gt;文件内容格式错误]
instrOther--删--&amp;gt;delOp[父目录删除此目录/文件]
delOp.-&amp;gt;delPerE&amp;gt;删除工作目录或其上级目录]
style pathE fill:red,fill-opacity:0.1
style contentE fill:red,fill-opacity:0.1

style getFileE fill:red,fill-opacity:0.1
style typeE fill:red,fill-opacity:0.1
style existE fill:red,fill-opacity:0.1
style delPerE fill:red,fill-opacity:0.1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;因此我们将程序所需实现的功能/模块列出&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;PathManager&lt;/strong&gt;: 一个解析路径的迭代器&lt;br&gt;
a.  通过路径构造，并在构造时判断路径类型(绝对路径、相对路径)&lt;br&gt;
b.  将路径分级（分段），作为迭代器返回下一级解析出的单级地址&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;FileLike&lt;/strong&gt;: 文件类/目录类的父类，下简称&lt;em&gt;类文件&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;a. 保存类文件的基本信息, 名字，绝对路径，创建/修改时间，父目录，大小&lt;br&gt;
b. 自底向上更新文件/目录大小&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Directory&lt;/strong&gt;: 目录类，管理子文件/目录&lt;br&gt;
a. 对子文件/目录进行增、删、查&lt;br&gt;
b. 向文件系统提供根据路径索引文件/目录的静态方法&lt;br&gt;
c. 向文件系统提供根据路径索引对应文件/目录的父目录的静态方法&lt;br&gt;
d. 向文件系统提供根据路径递归创建目录的静态方法&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;File&lt;/strong&gt;: 文件类，管理文件存储内容&lt;br&gt;
a. 追加/覆写文件内容&lt;br&gt;
b. 对文件内容进行转义以输出&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;MyFileSystem&lt;/strong&gt;: 文件系统类，通过调用底层类按指令语义进行操作或抛出异常&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;我们随手画的草稿如下:&lt;/p&gt;
&lt;center&gt;
    &lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609143717.png&#34;&gt;
&lt;/center&gt;
&lt;/center&gt;
&lt;p&gt;最终经过缝缝补补改改删删后完成时的&lt;code&gt;UML&lt;/code&gt;类图&lt;/p&gt;
&lt;center&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609143735.png&#34; &gt;
&lt;/center&gt;
&lt;p&gt;而且一条指令的执行过程中可能在流程图中任一执行阶段触发异常，因此我们使用&lt;code&gt;Java&lt;/code&gt;的异常处理机制来处理错误输入，我们所定义的各种异常类如下&lt;/p&gt;
&lt;center&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609143754.png&#34; /&gt;
&lt;/center&gt;
&lt;p&gt;由于本次作业不区分不同异常输入对应的输出信息格式，因此只要在&lt;strong&gt;MyFileSystem&lt;/strong&gt;中的方法调用过程中&lt;code&gt;catch&lt;/code&gt;到相应异常就直接输出&lt;code&gt;Path x is invaild&lt;/code&gt;的错误信息，如果后续需要分辨不同的异常情况，我们只需修改嵌套的&lt;code&gt;try-catch-throw&lt;/code&gt;的逻辑即可&lt;/p&gt;
&lt;h5 id=&#34;b-具体细节&#34;&gt;b. 具体细节&lt;/h5&gt;
&lt;p&gt;对于&lt;code&gt;PathManager&lt;/code&gt;迭代器的实现，选择了使用自动机，因为路径的格式定义比较简单，所以用自动机编写不难，而且可以清楚地考虑到各种特殊情况。并且迭代器分级解析地址时同时进行了格式检查，所以相比于&lt;code&gt;check + split&lt;/code&gt;不需要额外存储空间&lt;/p&gt;
&lt;p&gt;对于*&amp;quot;根据路径索引对应文件/目录的父目录”*, 考虑到我们规定&lt;code&gt;PathManager&lt;/code&gt;解析完时&lt;code&gt;next()&lt;/code&gt;返回特殊值&lt;code&gt;null&lt;/code&gt;，因此只要将目录分成根目录、单级目录、两级以上的目录(&lt;code&gt;/&lt;/code&gt;, &lt;code&gt;/a&lt;/code&gt;, &lt;code&gt;/a/b&lt;/code&gt; or &lt;code&gt;a/b/c/......&lt;/code&gt;)三种情况分别处理就行了，同时在获取父目录结束时解析出最后一级地址（文件名），&lt;code&gt;Java&lt;/code&gt;不能返回多值，因此封装了一个数据结构保证只扫一遍地址就okay&lt;/p&gt;
&lt;p&gt;对于文件内容的转义，我们的实现是在文件类&lt;code&gt;File&lt;/code&gt;中只维护转义后的文件内容,在&lt;code&gt;fappend&lt;/code&gt;指令中对连接处可能新产生的&lt;code&gt;&amp;quot;@n&amp;quot;&lt;/code&gt;作特判&lt;/p&gt;
&lt;h5 id=&#34;c-测试与提交&#34;&gt;c. 测试与提交&lt;/h5&gt;
&lt;p&gt;&lt;a href=&#34;https://gitlab.buaaoo.top/2021_alige_public/pair_work/homework_1_guidebook/issues/12&#34;&gt;mytql&lt;/a&gt;, 根据他的&lt;a href=&#34;(https://gitlab.buaaoo.top/2021_alige_public/pair_work/homework_1_guidebook/issues/12)&#34;&gt;方法&lt;/a&gt;我们在&lt;code&gt;CI / CD&lt;/code&gt;运行环境中配置好了&lt;code&gt;maven&lt;/code&gt;，并使用&lt;code&gt;jacoco-maven-plugin&lt;/code&gt;生成测试结果报告(一个网页和一个表格)，最后一次提交得到的测试报告如下图&lt;/p&gt;
&lt;center&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609143819.png&#34; width = &#34;75%&#34;&gt;&lt;/center&gt;
&lt;p&gt;&lt;code&gt;cobetura&lt;/code&gt;与&lt;code&gt;jacoco&lt;/code&gt;都能得到这种页面，但在查看分支覆盖率时貌似都只能查看某一分支的遗漏分支数量，并不能了解在条件表达式在何种布尔表达式下是没有被测试过的,希望能有&lt;code&gt;dalao&lt;/code&gt;指点(&lt;/p&gt;
&lt;center&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609143840.png&#34; width = &#34;75%&#34;&gt;&lt;/center&gt;
&lt;p&gt;为了代码覆盖率达标，当然要对各模块中的异常的抛出也进行测试啦，我们使用&lt;code&gt;Junit&lt;/code&gt;中的函数标注&lt;code&gt;@Test(expected = myException.class)&lt;/code&gt;进行抛出异常的断言，以及在测试函数中自己手动进行&lt;code&gt;try-catch&lt;/code&gt;测试异常是否如预期抛出&lt;/p&gt;
&lt;h3 id=&#34;二-关于结对&#34;&gt;二、关于结对&lt;/h3&gt;
&lt;hr&gt;
&lt;h4 id=&#34;1结对形式&#34;&gt;1.结对形式&lt;/h4&gt;
&lt;p&gt;现场结对编程的照片:&lt;/p&gt;
&lt;center&gt;
    &lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609143857.png&#34;  width=&#34;80%&#34;&gt;
&lt;/center&gt;
&lt;center&gt;&lt;font style=&#34;color:grey;font-weight:lighter;font-style:italic;&#34;&gt;专注中...&lt;/font&gt;&lt;/center&gt;
&lt;center&gt;
    &lt;img src = &#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609143921.png&#34; width=&#34;80%&#34;&gt;
&lt;/center&gt;
&lt;center&gt;&lt;font style=&#34;color:grey;font-weight:lighter;font-style:italic;&#34;&gt;(摄于2021年3月23日)&lt;/font&gt;&lt;/center&gt;
&lt;h4 id=&#34;2结对流水账&#34;&gt;2.结对流水账&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;3/22&lt;/em&gt;: 摸石过河
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;15:05 - 15:30&lt;/em&gt;: 设计与思路交流&lt;/li&gt;
&lt;li&gt;&lt;em&gt;15:30 - 17:30&lt;/em&gt;: 编码&lt;/li&gt;
&lt;li&gt;&lt;em&gt;18:21 - 20:20&lt;/em&gt;: 编码&lt;/li&gt;
&lt;li&gt;&lt;em&gt;20:40 - 22:30&lt;/em&gt;: 编码&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;em&gt;3/23&lt;/em&gt;: 拨云见日
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;15:55 - 18:25&lt;/em&gt;: 编码&lt;/li&gt;
&lt;li&gt;&lt;em&gt;18:30 - 20:30&lt;/em&gt;: 编码&lt;/li&gt;
&lt;li&gt;&lt;em&gt;20:51 - 21:20&lt;/em&gt;: 总代码复审&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;em&gt;3/24&lt;/em&gt;: 再复审
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;14:31 - 16:20&lt;/em&gt;: 代码复审 评测 报告&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在本阶段二人决定角色定位将更有倾向性，但是二人进行了充分的交流，并在一些时间段交换工作，所以都对代码知根知底，两人不同角色的工作比例大概都是七三开。本次&lt;a href=&#34;https://www.cnblogs.com/ha-na-se/&#34;&gt;朱正阳&lt;/a&gt;担任&lt;code&gt;Driver&lt;/code&gt;，主要职责是具体源代码实现，&lt;a href=&#34;https://www.cnblogs.com/zixfy/&#34;&gt;赵子轩&lt;/a&gt;担任&lt;code&gt;Navigator&lt;/code&gt;，主要职责是测试与把握整体设计&lt;/p&gt;
&lt;h4 id=&#34;3结对感受&#34;&gt;3.结对感受&lt;/h4&gt;
&lt;h5 id=&#34;a-朱正阳&#34;&gt;(a) &lt;a href=&#34;https://www.cnblogs.com/ha-na-se/&#34;&gt;朱正阳&lt;/a&gt;&lt;/h5&gt;
&lt;p&gt;在第一次结对编程中，我主要担当的是驾驶员（&lt;code&gt;Driver&lt;/code&gt;）的角色，通过这次结对编程，我主要从以下两方面发表自己的感想&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;关于结对编程&lt;/p&gt;
&lt;p&gt;最开始结对的时候效率并不高，我认为原因主要有以下三点&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;两个人在某些细节上想法有所不同&lt;/li&gt;
&lt;li&gt;交流上存在一定障碍，有时双方都无法及时get到对方的点&lt;/li&gt;
&lt;li&gt;我没有提前做好准备，许多东西我还需要进一步消化理解&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;随着结对不断进行，双方交流效率也提高了，任务效率也逐渐高了起来。&lt;/p&gt;
&lt;p&gt;结对编程也是一个很好的向他人请教的机会，能够近距离看到队友是如何编程的，对于这个问题他又是怎么想的，确实能够收获很多。&lt;/p&gt;
&lt;p&gt;结对编程还是一个强迫与他人进行思想上的交流以及传递自己想法与观点的过程。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;关于开发流程&lt;/p&gt;
&lt;p&gt;在此前的编程中，我很少将大部分精力放在设计以及测试上。通过这次结对，我学习到了很多关于单元测试的知识，也真正认识到了设计以及测试的重要性。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;关于队友&lt;/p&gt;
&lt;p&gt;有一个非常靠谱的队友确实可以大幅提高编程的效率以及质量。队友的编程习惯比较好，对于程序的架构也把握的很好；在我编程的过程中不断的指导我，耐心纠正我的很多不良的编程习惯以及冗余；做事比较认真负责。通过这三天的结对编程，我也从他那里学习到了很多东西，这是我一个人编程所做不到的。我很感激能有一个这样的队友。因此后续也会一起努力，一起进步&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;接下来应该还会有第二次第三次结对编程的任务，希望能在之后的任务中继续向队友学习，更加放开交流，努力完成任务，提升自己。&lt;/p&gt;
&lt;h5 id=&#34;b-zzx&#34;&gt;(b) &lt;a href=&#34;https://www.cnblogs.com/zixfy/&#34;&gt;zzx&lt;/a&gt;&lt;/h5&gt;
&lt;p&gt;在第一次结对编程中，我主要担当的是&lt;code&gt;Navigator&lt;/code&gt;，我的体会与反思：&lt;/p&gt;
&lt;p&gt;纸上得来终觉浅，在亲历&lt;code&gt;Pair&lt;/code&gt;之后，我认为&lt;code&gt;Pair&lt;/code&gt;最大的好处是提升代码的质量，毕竟在二人协作时读懂代码是交流的先决，总是会不自觉地想去保证代码的可维护性。我认为好的结对编程需要以下长期的要素: 信任、执行力以及&lt;a href=&#34;&#34;&gt;可见的详尽计划&lt;/a&gt;。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;关于信任，我想这就是教材里说的道德水平吧，但这更应该是每一个程序员的基本素养。单枪匹马在以后工作中更是不可能，所以无论是采取何种的合作形式都应该对搭档给予信任，这是“平等地位”的先决，本次我与zzy全程都在相互支持，并及时进行沟通&lt;/li&gt;
&lt;li&gt;关于执行力，这是&lt;code&gt;Pair&lt;/code&gt;效率的保证，好在zzy与我都是做事比较投入的那种人，结对现场基本没有摸鱼机会(。但实际上也因此没有保证每小时都有休息时间，以后一定会协调好时间的&lt;/li&gt;
&lt;li&gt;关于计划，这是我们本次有所忽略的，我作为&lt;code&gt;Navigator&lt;/code&gt;没有给出细致到小时级别、功能级别的编码计划，这一方面使得编码变成了步步为营，另一方面也导致有时二人并没有是为了同一个小目标而工作，从而降低了工作效率。我决定后续一定要在动手前先制定好工作计划，磨刀不误砍柴工&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;我在本次&lt;code&gt;Pair&lt;/code&gt;中发现自己的不足如下:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;上文3.&lt;/li&gt;
&lt;li&gt;我向来是不擅长与他人深入交流的baka，因此&lt;code&gt;Pair&lt;/code&gt;实际上是对我的一次考验，而且我在经常性的交流中更难专注想事情&lt;/li&gt;
&lt;li&gt;我太菜了，作为编程苦手，想到要6天内完成&lt;code&gt;OO&lt;/code&gt;的“第五单元”就顿感亚历山大。在担任&lt;code&gt;Navigator&lt;/code&gt;时不能保证总是给zzy正确有效的指引，对于整体架构，在实现时自己却还在改来改去。在自己写的一些方法里还&lt;code&gt;Bug&lt;/code&gt;频出&lt;/li&gt;
&lt;li&gt;本次&lt;code&gt;Pair&lt;/code&gt;之前我对Junit一知半解，但为了能跟上整体代码的进度，所写的单元测试代码便相当的臭长&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;总之第一阶段的&lt;code&gt;Pair&lt;/code&gt;让我明白了团队计划与编码能力的重要性，希望后续能努力做得更好&lt;/p&gt;
&lt;h3 id=&#34;三-工作量&#34;&gt;三、工作量&lt;/h3&gt;
&lt;h4 id=&#34;1psp表格&#34;&gt;1.PSP表格&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;PSP2.1&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Personal Software Process Stages&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;预估耗时（分钟）&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;实际耗时（分钟）&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Planning&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;计划&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Estimate&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 估计这个任务需要多少时间&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;5&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Development&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;开发&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;&lt;u&gt;515&lt;/u&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;&lt;u&gt;1025&lt;/u&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Analysis&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 需求分析 (包括学习新技术)&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;30&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;25&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Design Spec&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 生成设计文档&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;30&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;30&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Design Review&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 设计复审 (和同事审核设计文档)&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;15&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Coding Standard&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 代码规范 (为目前的开发制定合适的规范)&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;20&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;30&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Design&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 具体设计&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;30&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;30&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Coding&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 具体编码&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;180&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;480&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Code Review&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 代码复审&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;30&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;60&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Test&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 测试（自我测试，修改代码，提交修改）&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;180&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;360&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Reporting&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;报告&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;&lt;u&gt;70&lt;/u&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;&lt;u&gt;140&lt;/u&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Test Report&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 测试报告&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;30&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;60&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Size Measurement&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 计算工作量&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;10&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;20&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· Postmortem &amp;amp; Process Improvement Plan&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;· 事后总结, 并提出过程改进计划&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;30&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;60&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;合计&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;&lt;u&gt;585&lt;/u&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;&lt;u&gt;1170&lt;/u&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;2码量&#34;&gt;2.码量&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Java&lt;/th&gt;
&lt;th&gt;总行数&lt;/th&gt;
&lt;th&gt;代码行数&lt;/th&gt;
&lt;th&gt;注释行数&lt;/th&gt;
&lt;th&gt;空行数&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Src&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;918&lt;/td&gt;
&lt;td&gt;629&lt;/td&gt;
&lt;td&gt;180&lt;/td&gt;
&lt;td&gt;109&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Test&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;745&lt;/td&gt;
&lt;td&gt;622&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;123&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Total&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;1663&lt;/td&gt;
&lt;td&gt;1251&lt;/td&gt;
&lt;td&gt;180&lt;/td&gt;
&lt;td&gt;232&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
">【老物】初见，结对编程！(上)</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/lao-wu-2021-ruan-gong-ge-ren-yue-du-zuo-ye-2/"" data-c="
          &lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;项目&lt;/strong&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;strong&gt;内容&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;这个作业属于哪个课程&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;a href=&#34;https://edu.cnblogs.com/campus/buaa/BUAA_SE_2021_LR/&#34;&gt;2021春季计算机学院软件工程(罗杰 任健)&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;这个作业的要求在哪里&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;a href=&#34;https://edu.cnblogs.com/campus/buaa/BUAA_SE_2021_LR/homework/11828&#34;&gt;个人阅读作业#2&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;我在这个课程的目标是&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;和我的团队开发一个真正的软件，一起提升开发与合作的能力&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;这个作业在哪个具体方面帮助我实现目标&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;阅读教材提炼所思所惑；初探&lt;code&gt;Git / CI / CD&lt;/code&gt;相关工具&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;一-阅读提问&#34;&gt;一、阅读提问&lt;/h3&gt;
&lt;hr&gt;
&lt;h4 id=&#34;问a结对编程总能做到1-1-2-吗&#34;&gt;问A：结对编程总能做到1 + 1 &amp;gt; 2 吗？&lt;/h4&gt;
&lt;p&gt;教材中第四章出现了结对编程(&lt;code&gt;Pair programming&lt;/code&gt;)，这是一种变态的代码复审，有别于传统的&lt;code&gt;Code Review&lt;/code&gt;。书中强调&amp;quot;复审的目的在于纠错改进与教育更多的开发人员&amp;quot;，随后在4.5.3节说到Pair中两人对程序深入了解，复审效果好。但代码复审包括具体代码、效能、设计规范等多方面，Pair中有时间像Code Review一样周全的考虑吗？在传授经验这个方面，Pair中比较多的也是口头交流吧，那么有些经验不就只停留在两人之间了吗？当开发想到一个新idea，为什么不形成书面形式在Code Review中“让更多的成员熟悉项目各部分的代码”？为什么想着不间断地复审而不去花时间提高团队Code Review的&lt;strong&gt;效率&lt;/strong&gt;？&lt;/p&gt;
&lt;p&gt;在团队中，开发者是人而不是工具，合体之后就一定能1 + 1 &amp;gt; 2吗？书中提到:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;极限编程对工程师提出了更高的要求。这种要求不关乎技术水平，也不关乎学历水平或工作经验。这张要求是对一个人的心智、道德修养的更高要求。结对编程中，编码不再是私人的工作，而是一种公开的“表演”。	 &lt;em&gt;(4.5.3节-不间断地复审)&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Pair对技术力也有要求，不熟悉技术的两人进行Pair只能是一齐学习。文中将Pair的渐进的成长过程比作双人舞的各个阶段，但实际中Pair是否会因为对人的要求太高而停滞在某一阶段，Pair的普适性何如？&lt;/p&gt;
&lt;p&gt;4.6节也谈到了合作之道，说到底结对编程还是交流的艺术，能否高效快速解决问题还是得靠实践出真知吧。&lt;/p&gt;
&lt;h4 id=&#34;问b代码测试中覆盖率要达到100吗&#34;&gt;问B：代码测试中覆盖率要达到100%吗？&lt;/h4&gt;
&lt;p&gt;教材在&lt;em&gt;2.1.2节-好的单元测试的标准&lt;/em&gt;中有提到:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;单元测试应覆盖所测单元的所有代码路径，包括错误处理路径。为了保证代码覆盖率，单元测试必须测试公开的私有的函数/方法&lt;/p&gt;
&lt;p&gt;...&lt;/p&gt;
&lt;p&gt;要注意：100%的代码覆盖率并不等同于100%的正确性&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;那我想反过来问：实际中代码覆盖率一定要达到100%吗？从投入产出比的角度考虑，覆盖率达到100%势必要更多地考虑琐碎的问题，覆盖率不错的情况下边际收益岂不是下降了？或者说，实际测试中是不是应该搞双标，仅对更核心的模块代码作更全面的测试覆盖来保证工作效率？更重要的是，100%的代码覆盖率并不说明代码正确，我认为覆盖率是一个基本指标，而不是目标。全覆盖的测试不一定考虑全了外部的问题，比如特殊的输入值，&lt;code&gt;I\O&lt;/code&gt;中的&lt;code&gt;File Not Found&lt;/code&gt;，这些都是难以发现的隐患，所以测试用例是不是应该从场景出发，更多地考虑程序功能与逻辑上的完备性呢？&lt;/p&gt;
&lt;h4 id=&#34;问c敏捷开发&#34;&gt;问C：敏捷开发？&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;冲刺到一半的时候，产品负责人突然要马上做重要的改动！或者某个大佬要看某个不在计划中的功能的演示，怎么办？种种情况非常考验Scurm Master&lt;/p&gt;
&lt;p&gt;...&lt;/p&gt;
&lt;p&gt;也要等到冲刺完了再说啊！	&lt;em&gt;(6.2节-敏捷流程的问题和解法)&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;根据敏捷的价值观，对于执行原定计划更倾向于响应变化，并与客户合作。所以在冲刺中产生新的需求不应是常态嘛。真有重要变化时，为什么不在Scrum Meeting中一齐讨论此改动的重要性和急迫性再考虑进不进行工作上的调整？既然每次新的需求产生时都可能波及到系统中多个模块，或者是现在完全没有考虑的优化方向，那么有时重构不可避免，拖到Sprint结束会不会导致问题积压，错过重构的黄金时间，Sprint中的安排不可改变吗？&lt;/p&gt;
&lt;p&gt;敏捷中的产品Backlog到底是什么样的呢？它的主要表现形式为用户故事。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;用户故事是描述对用户有价值的功能，一个好的用户故事应该包括角色、功能和商业价值三个要素。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;角色：到底是谁要使用这个功能，这个功能是为谁而设计的？&lt;/li&gt;
&lt;li&gt;功能：这个功能是怎样的，要达到什么程度？&lt;/li&gt;
&lt;li&gt;商业价值：为什么要这个功能，这个功能最后能带来什么有益的商业价值，对用户来说有什么意义？&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p&gt;敏捷还强调个人和交流，这在小团队很奏效，团队规模大了以后难以保证高效的交流。而且相比传统的软件开发模式不重视正式的文档，这在团队工作交接的时候会不会有困难，敏捷开发中怎么将一个项目做大做长远？&lt;/p&gt;
&lt;h4 id=&#34;问d写不出好代码的pm是好pm吗&#34;&gt;问D：写不出好代码的PM是好PM吗？&lt;/h4&gt;
&lt;p&gt;书中9.4节关于一个&lt;code&gt;PM&lt;/code&gt;(&lt;code&gt;Program Manager&lt;/code&gt;)的自我修养:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;专业能力：PM通常也能写代码，能玩转Excel, PPT, Visio, 甘特图，有文字功力...&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;既然PM要做其他的那么多事情，那么对TA的代码能力有要求吗，要求多好呢？我认为PM应该做到的是对开发使用的技术路线与架构有个基本的认识，才能更合理地评估某一功能开发的难度，这样可以避免异想天开的设计，也更方便与开发者交流。在这个&lt;a href=&#34;https://www.zhihu.com/question/20165440/answer/14188711&#34;&gt;回答&lt;/a&gt;中微软的答主也说到:&lt;em&gt;&amp;quot;虽然理论上程序经理并不必然是程序大拿，但我见过的很多微软的程序经理都是开发转过来的，技术实力并不比同组的开发弱。...很少能看到诸如艺术类专业出身的人做程序经理的情况。&amp;quot;&lt;/em&gt;&lt;/p&gt;
&lt;h4 id=&#34;问e创新不必是领域内专家关键不必是技术&#34;&gt;问E：创新不必是领域内专家，关键不必是技术？&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;迷思之六：技术的创新是关键&lt;/p&gt;
&lt;p&gt;我们在这里看到，除了技术的创新，还有很多方面的创新：商业模式的创新，用户体验的创新，生态系统的创新。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这些迷思基本是以商业价值在衡量创新，如果很多企业都只安于跟上主流技术，一味追求这些模式创新，怎么解决相关市场的同质化问题，有热度一窝蜂来，没热度一窝蜂去？如果都想做后来者，那谁还愿意承担风险当实干者，这对社会的长远发展是好是坏？埃隆·马斯克为什么能成功？&lt;/p&gt;
&lt;h3 id=&#34;二-调研源代码版本管理软件&#34;&gt;二、调研源代码版本管理软件&lt;/h3&gt;
&lt;hr&gt;
&lt;h4 id=&#34;1基于git的项目管理工具&#34;&gt;1.基于Git的项目管理工具&lt;/h4&gt;
&lt;h5 id=&#34;a-github&#34;&gt;a) GitHub&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;Github&lt;/code&gt;是现今世界上最大的&lt;a href=&#34;https://github.com/&#34;&gt;同性交友网站&lt;/a&gt;，兼最火的开放源代码与代码托管社区。被微软收购后，&lt;code&gt;Github&lt;/code&gt;&lt;strong&gt;已经&lt;/strong&gt;在去年免费开放了私有库所有功能来对标&lt;code&gt;Gitlab&lt;/code&gt;，好耶。&lt;code&gt;Github&lt;/code&gt;作为开山者先入为主，用户基数大，社区建设也是最久的，所以要做开源项目的话，它一定是首选啦。后面的代码托管平台基本都有具有&lt;code&gt;Github&lt;/code&gt;的基本功能:&lt;code&gt;Fork \ Pull Request \ Follow \ issue&lt;/code&gt;之类的。&lt;/p&gt;
&lt;h5 id=&#34;b-gitlab&#34;&gt;b) Gitlab&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;GitLab &lt;/code&gt;是一个基于&lt;code&gt;Git&lt;/code&gt;的&lt;a href=&#34;https://about.gitlab.com/&#34;&gt;仓库管理系统的开源项目&lt;/a&gt;，并在此基础上搭建&lt;code&gt;web&lt;/code&gt;服务。&lt;code&gt;GitLab CI/CD&lt;/code&gt; 是 &lt;code&gt;GitLab&lt;/code&gt; 内置的一款工具，易于实现持续集成，持续交付，持续部署的&lt;code&gt;pipeline&lt;/code&gt;。&lt;code&gt;GitLab &lt;/code&gt;支持开发团队对其所辖仓库拥有更多的控制，所以从代码的私有性上来看，&lt;code&gt;GitLab &lt;/code&gt;是一个更好的选择。&lt;/p&gt;
&lt;h5 id=&#34;c-gitee&#34;&gt;c) Gitee&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;Gitee&lt;/code&gt;(码云)是国内规模最大的&lt;a href=&#34;https://gitee.com/&#34;&gt;代码托管平台&lt;/a&gt;哦。相比于其他平台，&lt;code&gt;Gitee&lt;/code&gt;访问速度更快更稳定，不会因为某些神秘的原因登不上去。&lt;code&gt;Gitee&lt;/code&gt;在开源仓库方面差不多是在模仿&lt;code&gt;Github&lt;/code&gt;，功能齐全。但感觉&lt;code&gt;Gitee&lt;/code&gt;比较注重本地化与社区，其目标用户主要是企业或团队，相应的有小队和任务的功能。持续集成方面也有推出正在内测中的&lt;code&gt;Gitee Go&lt;/code&gt;&lt;/p&gt;
&lt;h5 id=&#34;d-bitbucket&#34;&gt;d) Bitbucket&lt;/h5&gt;
&lt;p&gt;&lt;code&gt;BitBucket &lt;/code&gt;是 &lt;code&gt;2008 &lt;/code&gt;年创建的&lt;a href=&#34;https://bitbucket.org/product/&#34;&gt;源代码托管网站&lt;/a&gt;，采用 &lt;code&gt;Mercurial &lt;/code&gt;和 &lt;code&gt;Git&lt;/code&gt;作为分布式版本控制系统，同时提供免费账户和商业计划。主要面向慈善企业和企业用户/其主要市场是大型企业。&lt;/p&gt;
&lt;h4 id=&#34;2总览&#34;&gt;2.总览&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;工具名&lt;/th&gt;
&lt;th&gt;创建时间&lt;/th&gt;
&lt;th&gt;使用人数&lt;/th&gt;
&lt;th&gt;项目数&lt;/th&gt;
&lt;th&gt;私有仓库&lt;/th&gt;
&lt;th&gt;适用范围&lt;/th&gt;
&lt;th&gt;CI / CD&lt;/th&gt;
&lt;th&gt;用户界面&lt;/th&gt;
&lt;th&gt;备注&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Github&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;2008&lt;/td&gt;
&lt;td&gt;3100w&lt;/td&gt;
&lt;td&gt;10000w&lt;/td&gt;
&lt;td&gt;免费，无合作人数上限&lt;/td&gt;
&lt;td&gt;全球性开源&lt;/td&gt;
&lt;td&gt;支持&lt;/td&gt;
&lt;td&gt;简明干净，用着最习惯&lt;/td&gt;
&lt;td&gt;最大的开源代码平台&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Gitlab&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;2011&lt;/td&gt;
&lt;td&gt;3000w&lt;/td&gt;
&lt;td&gt;54w&lt;/td&gt;
&lt;td&gt;同上&lt;/td&gt;
&lt;td&gt;企业、学校等内网Git私服&lt;/td&gt;
&lt;td&gt;支持&lt;/td&gt;
&lt;td&gt;功能划分清晰&lt;/td&gt;
&lt;td&gt;自托管的 Git 项目仓库&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Gitee(国内)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;2013&lt;/td&gt;
&lt;td&gt;600w&lt;/td&gt;
&lt;td&gt;1500w&lt;/td&gt;
&lt;td&gt;免费，最多5人合作&lt;/td&gt;
&lt;td&gt;全球性开源&lt;/td&gt;
&lt;td&gt;开发中&lt;/td&gt;
&lt;td&gt;相对比较乱&lt;/td&gt;
&lt;td&gt;针对国内用户的代码托管方案&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Bitbucket&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;2008&lt;/td&gt;
&lt;td&gt;500w&lt;/td&gt;
&lt;td&gt;???&lt;/td&gt;
&lt;td&gt;同上&lt;/td&gt;
&lt;td&gt;企业/团队Git私服&lt;/td&gt;
&lt;td&gt;支持&lt;/td&gt;
&lt;td&gt;很干净，喜欢&lt;/td&gt;
&lt;td&gt;为专业团队而生，&lt;em&gt;&amp;quot;code, manage, collaborate&amp;quot;&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;三-调研持续集成部署工具&#34;&gt;三、调研持续集成/部署工具&lt;/h3&gt;
&lt;hr&gt;
&lt;h4 id=&#34;1-gitlab&#34;&gt;1. GitLab&lt;/h4&gt;
&lt;p&gt;以&lt;code&gt;oo2020_pre3_task3&lt;/code&gt;为例，&lt;a href=&#34;https://gitlab.buaaoo.top/zixfy/ci_demo_3/-/jobs&#34;&gt;仓库在这里&lt;/a&gt;，用的是样例中的&lt;code&gt;.gitlab-ci.yml&lt;/code&gt;哦，去掉&lt;code&gt;only: tags&lt;/code&gt;，不然只有有tag的commit才能触发&lt;code&gt;pipeline&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Gitlab&lt;/code&gt;的&lt;code&gt;CI / CD&lt;/code&gt;控制台，第一个&lt;code&gt;stage&lt;/code&gt;:&lt;/p&gt;
&lt;center&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609143042.png&#34;  &gt;&lt;/center&gt;
&lt;p&gt;第二个&lt;code&gt;stage&lt;/code&gt;:&lt;/p&gt;
&lt;center&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609143107.png&#34;  &gt;&lt;/center&gt;
&lt;p&gt;为了获得代码的测试覆盖率使用了&lt;code&gt;maven&lt;/code&gt;插件:&lt;code&gt;jacoco-maven-plugin&lt;/code&gt;，配置在&lt;code&gt;mvn test&lt;/code&gt;执行时自动执行&lt;code&gt;mvn jacoco:report&lt;/code&gt;。用&lt;a href=&#34;https://stackoverflow.com/questions/48032798/code-coverage-report-using-gitlab-ci-yml-file&#34;&gt;Stackoverflow&lt;/a&gt;上面的方法，从生成的&lt;code&gt;csv&lt;/code&gt;中提取出总代码覆盖率，设置&lt;code&gt;coverage&lt;/code&gt;正则表达式&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yml&#34;&gt;mvn_test:
  stage: test
  dependencies:
    - mvn_build
  script:
    - echo &amp;quot;------Run JUnit4------&amp;quot;
    - mvn clean test
    - awk -F&amp;quot;,&amp;quot; &#39;{ instructions += $4 + $5; covered += $5 } END { print covered, &amp;quot;/&amp;quot;, instructions, &amp;quot;instructions covered&amp;quot;; print 100*covered/instructions, &amp;quot;% covered&amp;quot; }&#39; target/site/jacoco/jacoco.csv
  coverage: &#39;/\d+.\d+ \% covered/&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;再在&lt;code&gt;Gitlab -&amp;gt; project -&amp;gt; Setting -&amp;gt; CI / CD -&amp;gt; General pipelines settings &lt;/code&gt;找到&lt;code&gt;badge&lt;/code&gt;的&lt;code&gt;.md&lt;/code&gt;，就可动态显示&lt;code&gt;coverage&lt;/code&gt;了，好耶。&lt;/p&gt;
&lt;center&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609143156.png&#34;  &gt;&lt;/center&gt;
&lt;h4 id=&#34;2-github-actions&#34;&gt;2. Github Actions&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;Github&lt;/code&gt;上使用&lt;a href=&#34;https://github.com/iff0/SETestRepo/actions&#34;&gt;这个仓库&lt;/a&gt;, 配置&lt;code&gt;yaml&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;name: my CI test
on: push
jobs:
  job_build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        java-version: 1.8
    - name: check
      run: |
        java -version
        javac -version
        mvn -v
    - name: build
      run: |
        mvn compile
...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;Github Action&lt;/code&gt;里一个&lt;code&gt;.yml&lt;/code&gt;对应一个顶级元素&lt;code&gt;workflow&lt;/code&gt;，它和&lt;code&gt;Gitlab&lt;/code&gt;里的&lt;code&gt;pipeline&lt;/code&gt;差不多哦&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609143222.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;workflow&lt;/code&gt;包含多个&lt;code&gt;job&lt;/code&gt;，即不同阶段，用&lt;code&gt;need&lt;/code&gt;字段确定执行次序。&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609143321.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;每个&lt;code&gt;jobs&lt;/code&gt;还分为多个&lt;code&gt;step&lt;/code&gt;，&lt;code&gt;step&lt;/code&gt;里才是执行的脚本。这一点很好，在控制台可以看到不同&lt;code&gt;step&lt;/code&gt;的输出信息&lt;/p&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609143337.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;p&gt;当然&lt;code&gt;Github Action&lt;/code&gt;有不少开源的&lt;code&gt;Action&lt;/code&gt;，直接在&lt;code&gt;step&lt;/code&gt;里用&lt;code&gt;uses&lt;/code&gt;指明&lt;code&gt;Action&lt;/code&gt;的仓库名就能直接用了，上文的&lt;code&gt;.yml&lt;/code&gt;就用&lt;code&gt;Action&lt;/code&gt;安装了&lt;code&gt;Java&lt;/code&gt;环境&lt;/p&gt;
&lt;h4 id=&#34;3-gitlab-vs-github-actions&#34;&gt;3. Gitlab vs. Github Actions&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;CI / CD&lt;/code&gt;主要的工作是自动化单元测试、在&lt;code&gt;QA&lt;/code&gt;的类生产环境中自动化集成测试，okay就自动部署到生产环境，这对于敏捷开发而言很舒服。对于下一个可交付的版本，不用再去浪费时间人工操作了。在提高开发效率的同时，大家也都能在仓库中了解当前版本的问题。&lt;/p&gt;
&lt;p&gt;上面两个工具只是稍微尝试了一下，总的说来&lt;code&gt;Github Actions&lt;/code&gt;用的是远程的服务器，跑起来更快；&lt;code&gt;Github Actions&lt;/code&gt;具有&lt;code&gt;Github&lt;/code&gt;开源的主要特征，有不少&lt;code&gt;Action&lt;/code&gt;可供调用，但用起来总不够灵活，&lt;code&gt;Gitlab&lt;/code&gt;的脚本结构更清晰，编写起来容易；&lt;code&gt;Gitlab CI / CD&lt;/code&gt;功能更全面，有里程碑设置，代码评审和合并请求啥的...&lt;/p&gt;
">【老物】2021软工-个人阅读作业#2</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/lao-wu-buaa_oo_2020_unit4/"" data-c="
          &lt;h3 id=&#34;一-uml解析器设计&#34;&gt;一、UML解析器设计&lt;/h3&gt;
&lt;p&gt;​	先看下题目：第四单元实现一个基于&lt;code&gt;JDK 8&lt;/code&gt;带有效性检查的&lt;code&gt;UML(Unified Modeling Language)&lt;/code&gt;类图，顺序图，状态图分析器 &lt;code&gt;MyUmlInteraction&lt;/code&gt;，实际上我们要建立一个有向图模型，&lt;code&gt;UML&lt;/code&gt;中的对象（元素）可能与同级元素连接，也可与低级元素相连形成层次关系&lt;/p&gt;
&lt;p&gt;​	**输入：**上述三&lt;code&gt;UML&lt;/code&gt;图的边集（非实体元素）与点集，上下层级元素通过&lt;code&gt;_parent&lt;/code&gt;隐式邻接。值得注意的是，不同于前两个单元，我们终于回归了离线算法&lt;code&gt;OFFLINE&lt;/code&gt;，&lt;code&gt;I/O&lt;/code&gt;通过一行&lt;code&gt;END_OF_MODEL&lt;/code&gt;分隔，处理难度减小了&lt;/p&gt;
&lt;p&gt;​	**输出：**针对给出的&lt;code&gt;_name&lt;/code&gt;索引到相应的&lt;code&gt;UML&lt;/code&gt;元素查询相关对应图中信息，复杂的&lt;code&gt;problem&lt;/code&gt;是&lt;code&gt;hw15&lt;/code&gt;中对&lt;em&gt;循环继承&lt;/em&gt;的判断，其他的都能不使用高级算法解决掉&lt;/p&gt;
&lt;p&gt;​	下图是我对本单元作业设计的类图，因为三次作业都是这个架构，下文只按解析器构造流程顺序分析。btw感谢&lt;a href=&#34;https://course.buaaoo.top/assignment/179/discussion/692&#34;&gt;肖同学的排雷帖&lt;/a&gt;，可见我对&lt;code&gt;UML&lt;/code&gt;的理解不够深入，&lt;code&gt;UMLAttribute&lt;/code&gt;可以出现在顺序图中，不应该简单归入类图元素的子类，不过我这样还是能活过本单元的&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609142459.png&#34; style=&#34;zoom:67%;&#34; /&gt;&lt;/p&gt;
&lt;h4 id=&#34;信息转换适配器模式&#34;&gt;信息转换——适配器模式&lt;/h4&gt;
&lt;p&gt;​	我构建了抽象类&lt;code&gt;MyEle&lt;/code&gt;，以及三个子抽象类对应三种&lt;code&gt;UML&lt;/code&gt;图中的元素，因为接口给出的结点（对应实体的元素）没有邻接结点的信息，我有必要自定义类来保存这些信息。能将这种*“一些&amp;quot;现存的对象&amp;quot;放到新的环境中，而新环境要求的接口是现对象不能满足的”*问题解决的是适配器模式&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class MyAdapt {
    //适配器用于转换的类
    public static MyEle as(UmlElement e) {
        switch (e.getElementType()) {
            case UML_CLASS: {
                return new MyClass((UmlClass) e);
            }
            case UML_ASSOCIATION: {
                return new MyAssc((UmlAssociation) e);
            }...
//
public abstract class MyEle {
    //My*类对UmlElement对象有一个依赖，MyEle实现基本信息接口，其他由子类分别考量
    private UmlElement ele;
    public MyEle(UmlElement e) {
        this.ele = e;
    }...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;​	在&lt;code&gt;UmlInteraction&lt;/code&gt;构造函数中，我首先将传入的&lt;code&gt;UmlElement&lt;/code&gt;通过&lt;code&gt;MyAdapt&lt;/code&gt;“转换”成&lt;code&gt;My*&lt;/code&gt;对象，后者可以从前者中只存储我们关心的信息，一些可以忽略的元素&lt;code&gt;UmlEvent&lt;/code&gt; / &lt;code&gt;UmlEndPoint&lt;/code&gt;等直接在这里过滤掉&lt;/p&gt;
&lt;h4 id=&#34;建图&#34;&gt;建图&lt;/h4&gt;
&lt;p&gt;​	有了这些准备工作开始建图，以类图为例（另两类图如法炮制），通过&lt;code&gt;.mdj&lt;/code&gt;解析，边集通过&lt;code&gt;_parent&lt;/code&gt; / &lt;code&gt;_reference&lt;/code&gt; / &lt;code&gt;UML&lt;/code&gt;元素表示，提取后完成建图。我对作业中涉及的所有的&lt;code&gt;UmlElement&lt;/code&gt;，包括边集&lt;code&gt;UMLAssociation&lt;/code&gt; / &lt;code&gt;UMLGeneralization&lt;/code&gt;等都适配自己的类，当然这可有可无，我这样做是为了遍历一遍&lt;code&gt;MyEle&lt;/code&gt;对象就完成建图，看起来清晰一点。类图中的顶级元素是类与接口，都管理着方法与属性，&lt;code&gt;StarUML&lt;/code&gt;中可以对二者进行很多相同操作，有必要为二者创建父类**&lt;code&gt;ClassLike&lt;/code&gt;（类实体）**来复用代码&lt;/p&gt;
&lt;p&gt;​	根据输入模式，我们在解析器中需要管理按**&lt;code&gt;_name&lt;/code&gt;**索引的&lt;code&gt;Class&lt;/code&gt; / &lt;code&gt;StateMachine&lt;/code&gt; / &lt;code&gt;Interaction&lt;/code&gt;等集合，并且索引查询中要进行有效与重复检查。我为了复用代码采用了泛型容器，分别用&lt;code&gt;Hashmap&lt;/code&gt; / &lt;code&gt;Hashset&lt;/code&gt;实现有效&lt;code&gt;_name&lt;/code&gt;查找表与重复&lt;code&gt;_name&lt;/code&gt;池&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public class MySet&amp;lt;T&amp;gt; {
    private HashMap&amp;lt;String, T&amp;gt; na2ele = new HashMap&amp;lt;&amp;gt;();
    private HashSet&amp;lt;String&amp;gt; dupName = new HashSet&amp;lt;&amp;gt;();
    public void add(T t) {
        if (t instanceof MyEle) 
            if (na2ele.containsKey(t.getName())) dupName.add(t.getName());
            else na2ele.put(t.getName(), t);
    }
    public boolean contains(String s) { return na2ele.containsKey(s); }
    public boolean isDup(String s) { return dupName.contains(s); }
    ...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;​	根据输入，查询请求关心*&lt;code&gt;ClassLike&lt;/code&gt;自身的层次或直接关联关系&lt;em&gt;或&lt;/em&gt;&lt;code&gt;ClassLike&lt;/code&gt;间接继承/实现的关系*，后者如*“类的顶级父类 / 实现的全部接口”*需要&lt;code&gt;ClassLike&lt;/code&gt;继承链上的信息。没有循环继承时继承链为树形结构，由此，我在&lt;code&gt;MyClassLike&lt;/code&gt;定义&lt;code&gt;addFather&lt;/code&gt; / &lt;code&gt;getFather&lt;/code&gt; / &lt;code&gt;update&lt;/code&gt;继承相关抽象方法。&lt;code&gt;update&lt;/code&gt;将&lt;code&gt;extends&lt;/code&gt;或&lt;code&gt;implements&lt;/code&gt;的&lt;code&gt;ClassLike&lt;/code&gt;进行&lt;code&gt;update&lt;/code&gt;后再合并信息，置为更新过的状态，是递归式搜索&lt;/p&gt;
&lt;p&gt;​	输出方面，通过与同学交流可以记忆化搜索（查询时更新），但是这是个&lt;code&gt;OFFLINE&lt;/code&gt;问题，同时考虑到题目的数据规模&lt;code&gt;1e2.6&lt;/code&gt;，小，在完成建图之后直接对所有类&lt;code&gt;update&lt;/code&gt;，全部元素更新后再进行查询也没问题，这样不用每个查询方法都先&lt;code&gt;update&lt;/code&gt;一下了&lt;/p&gt;
&lt;h4 id=&#34;precheck&#34;&gt;PreCheck&lt;/h4&gt;
&lt;p&gt;​	&lt;code&gt;hw15&lt;/code&gt;要求进行有效性检查，上文中查询前&lt;code&gt;update&lt;/code&gt;显然要放到&lt;code&gt;R002&lt;/code&gt; / &lt;code&gt;R003&lt;/code&gt;之间，有效性以&lt;code&gt;_id&lt;/code&gt; / &lt;code&gt;_name&lt;/code&gt;重复，&lt;code&gt;_visibility&lt;/code&gt;等检查为主，很简单；&lt;code&gt;R002&lt;/code&gt;检测循环继承，输出继承环路上所有元素，当然不用求出环路，只要求出所有环路上的元素。&lt;code&gt;MyEle&lt;/code&gt;处在继承环路上 &lt;em&gt;&lt;strong&gt;iff&lt;/strong&gt;&lt;/em&gt; 其处于某阶数大于&lt;code&gt;1&lt;/code&gt;的强连通分量上或本身存在自环或一次以自身为源点的搜索经过本身&lt;code&gt;1&lt;/code&gt;次以上，故可使用&lt;code&gt;Tarjan&lt;/code&gt;或&lt;code&gt;BFS&lt;/code&gt;来检查&lt;/p&gt;
&lt;h3 id=&#34;二-oop心路历程&#34;&gt;二、OOP心路历程&lt;/h3&gt;
&lt;p&gt;​	谈到架构设计及OO方法理解的演进，我认为自己本学期确实有长进，起码前两个&lt;code&gt;Unit&lt;/code&gt;次次重构，但后两个&lt;code&gt;Unit&lt;/code&gt;都是先好好分析设计结构再写的，而且都不很复杂，所以都没有重构&lt;/p&gt;
&lt;p&gt;​	&lt;code&gt;Unit1&lt;/code&gt;为层次化设计，&lt;code&gt;hw1&lt;/code&gt; / &lt;code&gt;hw2&lt;/code&gt;是纯纯的面向过程，&lt;code&gt;hw3&lt;/code&gt;中利用工厂模式根据实际中的实体为表达式中的对象建立了具有继承层次关系的类，通过将求导以及化简操作作为抽象方法，使得因子，表达式啥的都能按照自己的求导法则各自计算导数、化简，输出通过覆写&lt;code&gt;toString()&lt;/code&gt;，这是我首次在作业中体会到面向对象中多态的优势。&lt;/p&gt;
&lt;p&gt;​	&lt;code&gt;Unit2&lt;/code&gt;为多线程设计，代码结构很简单，采用简单的生产-消费者模式都行，主要还是通过&lt;code&gt;Java&lt;/code&gt;库及保留字实现&lt;code&gt;Java&lt;/code&gt;线程的同步与互斥，这块一直理不太清又很难调试，所以又重构了好多次，可以说我也是初次接触在线算法问题，电梯调度的优劣是跟数据相关的，其实有点玄学，在这里我初步了解了&lt;code&gt;Java&lt;/code&gt;的异常机制，这是保证鲁棒性的方法之一，&lt;code&gt;Java&lt;/code&gt;中还有封装好的&lt;code&gt;ReentrantLock&lt;/code&gt;可重入锁等锁，我也做了了解&lt;/p&gt;
&lt;p&gt;​	&lt;code&gt;Unit3&lt;/code&gt;为规格设计，需要根据&lt;code&gt;JML&lt;/code&gt;封装官方包中的接口，首先得说&lt;code&gt;JML&lt;/code&gt;表意很准确，不用像指导书般反复研究，这个&lt;code&gt;Unit&lt;/code&gt;大家实现的接口功能都是一样，但方法与效果不尽相同，面向对象中就是通过这样的封装实现代码的模块化，调用者很难为封装好的方法优化，作为实现者有义务实现高效的封装。面向过程和面向对象肯定不是对立的，我们实现的代码对外是屏蔽掉的，所以在作业中我在底层函数用了很多面向过程风格的代码&lt;/p&gt;
&lt;p&gt;​	&lt;code&gt;Unit4&lt;/code&gt;为模型化设计，我们接触的&lt;code&gt;UML&lt;/code&gt;脱离了&lt;code&gt;Java&lt;/code&gt;，描述的是对象、属性、状态等，更加接近面向对象的本质，作业方面空间很大，由于&lt;code&gt;hw13&lt;/code&gt;就理好了层次，后续轻松拓展，还第一次使用了泛型容器，节约了很多代码量，充分封装各个层次的操作以模块化&lt;/p&gt;
&lt;h3 id=&#34;三-测试理解与实践&#34;&gt;三、测试理解与实践&lt;/h3&gt;
&lt;p&gt;​	当然我印象最深刻的是多线程程序测试，程序运行结果与环境相关，在测试出现问题后很难通过程序本身找到病因，我使用&lt;code&gt;JProfiler&lt;/code&gt; + &lt;code&gt;println()&lt;/code&gt;才能逐步确定程序卡在了哪里&lt;/p&gt;
&lt;p&gt;​	测试分两方面，一是验证程序的基本功能，二是对极限数据或异常输入测试，前者通过随机生成样例数据或&lt;code&gt;JUnit&lt;/code&gt;单元测试法或对拍实现，后者如电梯换乘调度测试，特殊表达式求导，给定数据规模下复杂度最高的数据。我认为注重后者或许对我们更有价值，反正我的&lt;code&gt;Bug&lt;/code&gt;都出在极限情况...还有一种测试就是对优化过的代码进行测试，一定得用修改前版本对拍一下，属实对这一点有&lt;code&gt;ptsd&lt;/code&gt;了&lt;/p&gt;
&lt;p&gt;​	&lt;code&gt;JUnit&lt;/code&gt;对我而言很好用，&lt;code&gt;@Before&lt;/code&gt; / &lt;code&gt;@Test&lt;/code&gt; / &lt;code&gt;@After&lt;/code&gt;完整构建了数据生成、断言测试、错误分析的测试流程，还在同一项目下就能用，舒服啊&lt;/p&gt;
&lt;h3 id=&#34;四-收获总结&#34;&gt;四、收获总结&lt;/h3&gt;
&lt;p&gt;​	首先我在本学期通过&lt;code&gt;Java&lt;/code&gt;认识到面向对象的印象深刻的特征：封装与多态&lt;/p&gt;
&lt;p&gt;​	封装定义为&lt;em&gt;隐藏对象的属性和实现细节，仅对外公开接口&lt;/em&gt;，我最开始对每个属性几乎都写了&lt;code&gt;get&lt;/code&gt; / &lt;code&gt;set&lt;/code&gt;，但这样属性的隐藏原则就没意义了，我理解的封装是没有需求就不开放属性的查询或方法的调用，所以属于对象“份内事”的方法也尽量用&lt;code&gt;private&lt;/code&gt;修饰。封装的优势显然，首先封装隐藏了属性，保证了程序的数据安全，封装方法，可以使程序设计更加模块化，比如&lt;code&gt;Unit4&lt;/code&gt;中可将三种图的查询分派给三种管理类，这样也能降低类的平均复杂度，还有一点是封装的代码拓展性强，需要改变程序功能时，调用者往往不用改写，只需对封装的对象中的数据结构与方法进行修改，这也是课程迭代开发模式下的要求。当然，既然有这个信息隐藏原则，调用者就很难根据实际问题对封装对象作出调整，导致封装对象已经很难有优化的空间，所以使用封装时，调用者得对对象有一个大体的了解，比如在&lt;code&gt;Unit3&lt;/code&gt;中我因为对&lt;code&gt;Hashmap&lt;/code&gt;的底层实现不了解，初始容量过大引发了隐患；实现者则需合理利用时空资源保证程序的整体良性&lt;/p&gt;
&lt;p&gt;​	多态，我理解的是同一类型对象引用在运行时可以使用不同的方法以实现“多种形态”，一种形式是子类&lt;code&gt;Override&lt;/code&gt;方法后使用父类类型引用，还可以是由不同类实现的接口。通过多态在&lt;code&gt;Unit1&lt;/code&gt;实现表达式中不同因子的求导，在&lt;code&gt;Unit4&lt;/code&gt;中可以让数据结构不同的&lt;code&gt;Class&lt;/code&gt; / &lt;code&gt;Interface&lt;/code&gt;（单/多继承）共享一份&lt;code&gt;Tarjan&lt;/code&gt;代码，多态巧妙在我们无需去&lt;code&gt;if-else&lt;/code&gt;所引用的对象实际是什么类型，调用的方法采用对应继承链上最近的版本，所以多态中想要扩展新子类很简单，只需要符合引用者的行为逻辑，引用新子类的对象则无需修改代码&lt;/p&gt;
&lt;p&gt;​	当然一些别的特征也很酷，我们可以通过继承复用父类的代码，也可以通过泛型类来复用代码，并且实现类似多态的效果，不过泛型类在构造传入类型时，其所管理的类型就确定了，所以我觉得泛型倒有一点&lt;code&gt;c/c++&lt;/code&gt;中&lt;code&gt;#define&lt;/code&gt;的意思&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;​	不难看出，上面这些特征，无论是类也好，接口也好，其共性是对对象行为范式的一种抽象，&lt;code&gt;OO&lt;/code&gt;语言不同于&lt;code&gt;PO&lt;/code&gt;语言的一点就是它给了一套这种抽象的机制，所以面向对象编程更贴近实际，我们代码的结构往往对应实际中的逻辑关系，可能这也是&lt;code&gt;Java&lt;/code&gt;的优势，虽然不精炼，但很直观易懂&lt;/p&gt;
&lt;p&gt;​	在理论网课 / 实验课中，我也学到了&lt;code&gt;OO&lt;/code&gt;设计模式与原则，&lt;code&gt;OO&lt;/code&gt;的可维护性强，很适合于迭代开发与复杂系统的整体设计，学习&lt;code&gt;OO&lt;/code&gt;编程思想，更深入地理解&lt;code&gt;Python&lt;/code&gt; / &lt;code&gt;C++&lt;/code&gt;等的&lt;code&gt;OO&lt;/code&gt;机制了&lt;/p&gt;
&lt;h3 id=&#34;五-我的改进意见&#34;&gt;五、我的改进意见&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;看到这么多同学吐槽实验课我就放心了，我认为实验课有必要给同学们一定的反馈，具体的形式可以是编程性实验之后可以在平台上像作业一样了解测试情况并且进行&lt;code&gt;Bug&lt;/code&gt;修复&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;感觉后两&lt;code&gt;Unit&lt;/code&gt;对可维护性要求降低了，&lt;code&gt;Unit1&lt;/code&gt;中嵌套的出现打破了原本简单的表达式到因子的层次关系，&lt;code&gt;Unit2&lt;/code&gt;中多部电梯的出现改变了控制类的数据结构，也改变了线程同步的条件，而&lt;code&gt;Unit3 / 4&lt;/code&gt;在迭代开发中基本是跟随指导书在上一次作业中多写些方法增加功能就okay了，反正就是对原先的作业架构的冲击力不够大，应该提高难度，btw程序高效性也很重要，希望后两个&lt;code&gt;Unit&lt;/code&gt;能开启性能分&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Unit3&lt;/code&gt;可以放到前面，体现出类规格，层次间的规格&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;互测本意应该是驱动大家学习其他同学代码中的设计策略吧，建议发动&lt;code&gt;Hack&lt;/code&gt;的时候得提交自己发现的&lt;code&gt;Bug&lt;/code&gt;的位置，防止互测变成纯黑箱互测&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;六-网课学习体会&#34;&gt;六、网课学习体会&lt;/h3&gt;
&lt;p&gt;​	条件艰苦的线上网课，颇怀念线下的课堂氛围和peer pressure呢&lt;/p&gt;
&lt;p&gt;​	感谢仍离同学们最近的老师与助教们~&lt;/p&gt;
">【老物】BUAA_OO_2020_UNIT4</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/buaa_oo_-di-san-dan-yuan/"" data-c="
          &lt;h3 id=&#34;一-jml初探&#34;&gt;一、JML初探&lt;/h3&gt;
&lt;p&gt;​	&lt;code&gt;JML(Java Modeling Language)&lt;/code&gt;作为一种形式化语言，可以约束&lt;code&gt;Java&lt;/code&gt;代码中类和方法的状态和行为形成规格，通过将一系列具体代码实现抽象成明确的行为接口，可以形成一种契约式编程模式，&lt;code&gt;JML&lt;/code&gt;设计者无需考虑实际的数据结构与算法，可以聚焦于程序的整体逻辑，&lt;code&gt;JML&lt;/code&gt;形式化语言的无二义性能让实现者准确理解接口功能，根据问题需要选择合适的实现方式，同时&lt;code&gt;JML&lt;/code&gt;可以帮助实现者开展代码测试与形式化验证，当然这时就要分析出模型语言映射到具体代码的抽象函数了。&lt;/p&gt;
&lt;h4 id=&#34;jml表达式&#34;&gt;JML表达式&lt;/h4&gt;
&lt;p&gt;​	&lt;code&gt;JML&lt;/code&gt;可以内嵌在&lt;code&gt;.java&lt;/code&gt;内，很方便，以**&lt;code&gt;// @&lt;/code&gt;&lt;strong&gt;行注释或&lt;/strong&gt;&lt;code&gt;/* @ ... @ */&lt;/code&gt;**块注释，&lt;code&gt;JML&lt;/code&gt;表达式支持&lt;code&gt;Java&lt;/code&gt;表达式作为基础。针对更复杂的逻辑引入了量词表达式，&lt;code&gt;\forall&lt;/code&gt;关键字类似数学中的&lt;code&gt;∀&lt;/code&gt;，用法为&lt;code&gt;\forall v; P(v); Q(v)&lt;/code&gt;，等价于&lt;code&gt;∀v(P(v) → Q(v))&lt;/code&gt;；&lt;code&gt;\exists&lt;/code&gt;关键字类似数学中的&lt;code&gt;∃&lt;/code&gt;，用法为&lt;code&gt;\exists v; P(v); Q(v)&lt;/code&gt;，等价于&lt;code&gt;∃v(P(v) ^ Q(v))&lt;/code&gt;；这是在本单元比较常用的，当然还有&lt;code&gt;\max, \sum, \min&lt;/code&gt;等实用的关键字。&lt;/p&gt;
&lt;p&gt;​	还可以使用特殊操作符&lt;code&gt;==&amp;gt; &amp;lt;==&amp;gt;&lt;/code&gt;表示蕴含与等价关系，使用这种操作符可以增强&lt;code&gt;JML&lt;/code&gt;的可读性，同时还有&lt;code&gt;\nothing, \everything&lt;/code&gt;表示当前作用域下的空集全集&lt;/p&gt;
&lt;h4 id=&#34;方法规格&#34;&gt;方法规格&lt;/h4&gt;
&lt;p&gt;​	本单元我们聚焦于&lt;code&gt;JML&lt;/code&gt;中的方法规格，方法规格针对类中各种方法（构造、修改、查询、生成）的返回值与行为进行约束，方法规格的三大关键是前置条件、后置条件、副作用范围。&lt;/p&gt;
&lt;p&gt;​	前置条件通过对参数施加约束，从而区分不同的处理操作，大体可分为&lt;code&gt;normal_behavior&lt;/code&gt;，&lt;code&gt;expcetional_behavior&lt;/code&gt;，各有各的前置条件，从而通过&lt;code&gt;JML&lt;/code&gt;可以直观看出何时需要对异常输入处理，何时是正常输入，当然二者的条件不能有交集。若输入均不满足前置条件，我们在实现中是没有理由进行处理的，因此方法的调用者为了保证结果的可控必须了解前置条件。对于前置条件，使用&lt;code&gt;requires P;&lt;/code&gt;要求输入满足命题&lt;code&gt;P&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;​	后置条件对方法调用之后的对象状态与返回值约束，规定方法行为，使用关键字&lt;code&gt;ensures&lt;/code&gt;规定后置条件，对于查询&lt;code&gt;(query)&lt;/code&gt;方法，特别是只关心返回值不改变数据的方法，可以在访问修饰符后加上&lt;code&gt;/*@pure@*/ &lt;/code&gt;标记，对于返回值&lt;code&gt;(\result)&lt;/code&gt;的表示，一般使用&lt;code&gt;ensures P(\result);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;​	当然可能在查询中可能也会修改对象，比如惰式更新，修改方法&lt;code&gt;(modify)&lt;/code&gt;也要修改对象，为了表示出修改与其范围，我们需要调用前的状态，&lt;code&gt;ensures P&lt;/code&gt;针对的是调用后状态，&lt;code&gt;\old(obj)&lt;/code&gt;关键字就可以看作对象/基本类型在方法调用前的快照。比如对于涉及容器的数据管理类，经常使用增删&lt;code&gt;Add, Remove&lt;/code&gt;方法，&lt;code&gt;\old&lt;/code&gt;就派上用场了，可以使用&lt;code&gt;P(\old(obj)) ==&amp;gt; Q(obj)&lt;/code&gt;描述新的对象状态，当然这对对象的新状态是一种弱约束，比如不能保证&lt;code&gt;Add&lt;/code&gt;后不会加入不期望的元素，可以在另一方向再加一个条件&lt;code&gt;(constains(obj) &amp;amp;&amp;amp; !isforadd(obj)) ==&amp;gt; \old(constains(obj))&lt;/code&gt;进行最小化，可见利用&lt;code&gt;requires, ensures&lt;/code&gt;已经可以基本描述方法了&lt;/p&gt;
&lt;p&gt;​	还有一个方面就是副作用范围&lt;code&gt;(side effect)&lt;/code&gt;了，我们可以列出本方法中可能修改的类中（静态）属性，对调用者而言，可以轻松get到是否会修改自己关心的敏感属性，通常使用&lt;code&gt;assignable(modifiable)&lt;/code&gt;来列出可能修改的属性表&lt;code&gt;assignable v1, v2, ...;&lt;/code&gt;，也可以使用&lt;code&gt;JML&lt;/code&gt;中的全集，空集&lt;/p&gt;
&lt;p&gt;​	上面提到的&lt;code&gt;expcetional_behavior&lt;/code&gt;是针对&lt;code&gt;Java&lt;/code&gt;的异常特性的，使用&lt;code&gt;signals&lt;/code&gt;关键字规范了异常的抛出时机与类型，用法为&lt;code&gt;signals (&amp;lt;Exception Class&amp;gt; e) P;&lt;/code&gt;，等价于当&lt;code&gt;P == true&lt;/code&gt;时&lt;code&gt;throw&lt;/code&gt;异常，本单元对程序鲁棒性的考量也在此体现&lt;/p&gt;
&lt;h4 id=&#34;类型规格&#34;&gt;类型规格&lt;/h4&gt;
&lt;p&gt;​	类型规格就是对类中属性数据的约束，类似&lt;code&gt;Java&lt;/code&gt;，&lt;code&gt;JML&lt;/code&gt;可在变量名前加修饰符，&lt;code&gt;non_null&lt;/code&gt;保证容器内无&lt;code&gt;null&lt;/code&gt;，遵从这个规约可有效避免访问空引用，也有&lt;code&gt;static, instance&lt;/code&gt;区分静态属性，当然&lt;code&gt;JML&lt;/code&gt;想访问类中&lt;code&gt;private&lt;/code&gt;属性时，相关属性可加&lt;code&gt;/*@spec_public@*/&lt;/code&gt;，但我们的实现大可不必完全按规格来，规格描述也不该关心具体实现中的数据（这一点是在实验课中体会到的），本单元&lt;code&gt;JML&lt;/code&gt;描述中容器都用数组表示，但我们只要符合规格的约束条件，可以选择更合适的数据结构。本单元代码中未涉及不变式&lt;code&gt;invariant&lt;/code&gt;、状态变化约束&lt;code&gt;constraint&lt;/code&gt;，这两个是比较强的约束条件，前者规定每次属性修改后的规约，后者表示属性修改相对于修改前状态的规约&lt;/p&gt;
&lt;p&gt;​	总之&lt;code&gt;JML&lt;/code&gt;对代码实现者很实用，本单元写代码时官方&lt;code&gt;JML&lt;/code&gt;已经给出了整体的结构与逻辑，&lt;code&gt;JML&lt;/code&gt;中还有不少很实用的用法，值得日后深入学习一哈&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;关键字&lt;/th&gt;
&lt;th&gt;作用&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;\not_assigned(x,y,...)&lt;/td&gt;
&lt;td&gt;变量是否在方法执行过程中未被赋值&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;\not_modified(x,y,...)&lt;/td&gt;
&lt;td&gt;变量在方法执行期间的取值是否未发生变化&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;\type(type)&lt;/td&gt;
&lt;td&gt;返回类型type对应的类型&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;\typeof(expr)&lt;/td&gt;
&lt;td&gt;返回expr对应的准确类型&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;\num_of&lt;/td&gt;
&lt;td&gt;返回变量中满足相应条件的元素个数&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;二-jml之工具链&#34;&gt;二、JML之工具链&lt;/h3&gt;
&lt;p&gt;​	&lt;code&gt;IDEA&lt;/code&gt;貌似没有插件式的&lt;code&gt;JML&lt;/code&gt;工具，还是挺可惜的，&lt;code&gt;JML&lt;/code&gt;官网有相关工具的介绍&lt;/p&gt;
&lt;h4 id=&#34;openjml&#34;&gt;OpenJML&lt;/h4&gt;
&lt;p&gt;​	&lt;code&gt;OpenJML&lt;/code&gt;可用于&lt;code&gt;JML&lt;/code&gt;的语法检查分析，下载解压到项目文件夹下运行&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;java -jar openjml.jar -exec Solvers-windows\z3-4.7.1.exe -esc com\oocourse\spec3\exceptions\*.java com\oocourse\spec3\main\*.java
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;​	发现提示&lt;code&gt;int&lt;/code&gt;与&lt;code&gt;#INT1&lt;/code&gt;不同啥的，是&lt;code&gt;JML&lt;/code&gt;中三目运算符的解析好像有点问题，把&lt;code&gt;Group&lt;/code&gt;接口中三目修改成&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;    /*@ ensures (\result == 0 &amp;amp;&amp;amp; (people.length == 0) || (people.length != 0) &amp;amp;&amp;amp; \result ==
      @          ((\sum int i; 0 &amp;lt;= i &amp;amp;&amp;amp; i &amp;lt; people.length; people[i].getAge()) / people.length));
      @*/
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;jmlunitng&#34;&gt;JMLUnitNG&lt;/h4&gt;
&lt;p&gt;​	&lt;code&gt;JMLUnitNG&lt;/code&gt;可基于&lt;code&gt;JML&lt;/code&gt;对代码实现自动生成测试代码并开展测试，使用&lt;code&gt;java -jar jmlunitng.jar 接口 源码&lt;/code&gt;生成了测试代码&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609141949.png&#34; alt=&#34;img&#34; style=&#34;zoom: 50%;&#34; /&gt;
&lt;p&gt;​	与同学交流貌似需要在&lt;code&gt;JDK 8&lt;/code&gt;环境下才能运行，在&lt;code&gt;IDEA&lt;/code&gt;中&lt;code&gt;Project Structrue -&amp;gt; Project Settings -&amp;gt; Project language level&lt;/code&gt;设置成&lt;code&gt;8&lt;/code&gt;，运行一下针对&lt;code&gt;Group&lt;/code&gt;接口的测试代码&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609142014.png&#34; alt=&#34;img&#34; style=&#34;zoom:50%;&#34; /&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609142044.png&#34; alt=&#34;img&#34; style=&#34;zoom:50%;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;​		可见&lt;code&gt;JMLUnitNG&lt;/code&gt;是针对极端数据的，说好也是验证了程序的基本功能，说坏数据覆盖面并不广，对本单元作业的帮助有限。&lt;/p&gt;
&lt;h4 id=&#34;其他&#34;&gt;其他&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;JMLEclipse&lt;/code&gt;：针对&lt;code&gt;Eclipse&lt;/code&gt;的&lt;code&gt;JML&lt;/code&gt;插件&lt;/li&gt;
&lt;li&gt;&lt;code&gt;JMLOK&lt;/code&gt;：介绍是说随机数据对&lt;code&gt;JML&lt;/code&gt;实现的测试&lt;/li&gt;
&lt;li&gt;&lt;code&gt;AspectJML tool, JML4c&lt;/code&gt;：运行时规格验证&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;三-架构与java性能提升&#34;&gt;三、架构与Java性能提升&lt;/h3&gt;
&lt;p&gt;​	本次作业要求是对社交关系网络的模拟，很显然是一种图论模型，&lt;code&gt;Person&lt;/code&gt;接口作结点，&lt;code&gt;Network&lt;/code&gt;作图，&lt;code&gt;Group&lt;/code&gt;作子图，&lt;code&gt;JML&lt;/code&gt;规格将层次描述的很清楚，强制&lt;code&gt;Person&lt;/code&gt;管理边集，层次按图的层次就好，在&lt;code&gt;hw9, 10&lt;/code&gt;我还专门引入了边类&lt;code&gt;MyFriend&lt;/code&gt;，主要考虑到可能迭代会出现&lt;code&gt;Person&lt;/code&gt;的子接口。而且针对&lt;code&gt;hw10&lt;/code&gt;的&lt;code&gt;isCircle&lt;/code&gt;还保留了&lt;code&gt;BFS&lt;/code&gt;和&lt;code&gt;Disjoint Sets&lt;/code&gt;两个版本的，主要考虑到最后可能会加入删边操作，并查集的删边操作至少也得是*&lt;code&gt;O(V + E)&lt;/code&gt;*了，然而都并没有,whatever,本单元这一点相当友好~~，笔者终于不用重构了~~&lt;/p&gt;
&lt;p&gt;​	选用数据结构方面，考虑到&lt;code&gt;id&lt;/code&gt;范围，类中容器全部选择以&lt;code&gt;id&lt;/code&gt;为键值的&lt;code&gt;Hashmap&amp;lt;&amp;gt;&lt;/code&gt;，当然用两个&lt;code&gt;Hashmap&amp;lt;&amp;gt;&lt;/code&gt;建立起结点输入&lt;code&gt;id&lt;/code&gt;到数组下标&lt;code&gt;index&lt;/code&gt;的可逆函数 + 静态数组也很不错，为了可维护性选了前者&lt;/p&gt;
&lt;p&gt;​	&lt;strong&gt;为什么要说&amp;quot;Java性能&amp;quot;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;​	&lt;code&gt;JML&lt;/code&gt;设计者只关心类可见的状态，并不关心具体实现的类内部状态，这也是同学们发挥的空间，但那种直接对着规格照葫芦画瓢的代码是很危险的，笔者仍然记得&lt;code&gt;hw10&lt;/code&gt;用互测规模数据都可以把&lt;code&gt;Group.getAgeVar&lt;/code&gt;朴素遍历卡到&lt;code&gt;1e9&lt;/code&gt;级复杂度(运行分钟级)，震惊了。反正适合实际问题的方法才是最好的！其次，&lt;code&gt;Java&lt;/code&gt;还有&lt;code&gt;c++&lt;/code&gt;这种面向对象语言，但凡涉及到字符串&lt;code&gt;String&lt;/code&gt;，容器&lt;code&gt;(container)&lt;/code&gt;之类的，抽象层次一高，就很难针对问题进行优化，导致执行效率低，反正很慢就是了，而且根据数据本单元&lt;code&gt;T&lt;/code&gt;的还不少，所以提高性能很关键，这一部分围绕几个图架构下的关键矛盾方法开扯&lt;/p&gt;
&lt;h4 id=&#34;连通块-iscircle-queryblocksum&#34;&gt;连通块-isCircle &amp;amp; queryBlockSum&lt;/h4&gt;
&lt;p&gt;​	前者查询是否为同一连通块内，后者查询连通块数，最优解为并查集&lt;code&gt;(Union-find Sets)&lt;/code&gt;，具体原理老生常谈了。&lt;code&gt;isCircle()&lt;/code&gt;两次&lt;code&gt;find&lt;/code&gt;操作，同时在图内维护连通块数&lt;code&gt;k&lt;/code&gt;，增加结点&lt;code&gt;addPerson&lt;/code&gt;时&lt;code&gt;k++&lt;/code&gt;，增加边&lt;code&gt;addRelation&lt;/code&gt;时进行&lt;code&gt;merge&lt;/code&gt;操作，若为不同连通块合并,&lt;code&gt;k--&lt;/code&gt;，在&lt;code&gt;i&lt;/code&gt;条指令下复杂度为*&lt;code&gt;O(E + i)&lt;/code&gt;*&lt;/p&gt;
&lt;p&gt;​	当然&lt;code&gt;hw10&lt;/code&gt;中的并查集有很大的隐患，递归形式的&lt;code&gt;find&lt;/code&gt;操作在退化成单链的图中递归层数为*&lt;code&gt;V&lt;/code&gt;*，笔者通过压力测试发现四千多层就爆栈了，&lt;code&gt;StackOverFlow&lt;/code&gt;由递归层数，&lt;code&gt;JVM&lt;/code&gt;设置的栈大小以及函数参数，局部变量大小决定，笔者决定稳他一手，将&lt;code&gt;find&lt;/code&gt;路径上的结点暂存一下，找到父节点后统一设置父节点，就不递归了&lt;/p&gt;
&lt;p&gt;​	像开头说的，并查集如果面对删边&lt;code&gt;deleteRelation&lt;/code&gt;很棘手，由于查并集路径压缩信息丢失，不能单纯的改父节点，我们需要遍历点集找到涉及的两个连通块的点集，再遍历一遍打上标记，删边，对于有标记的点展开&lt;code&gt;BFS&lt;/code&gt;重新记录下父节点,&lt;em&gt;&lt;code&gt;O(V) / O(V + E)&lt;/code&gt;&lt;/em&gt;，但如果&lt;code&gt;deleteRelation&lt;/code&gt;有条数限制，那又是另一种权衡了&lt;/p&gt;
&lt;h4 id=&#34;记忆化-group接口&#34;&gt;记忆化-Group接口&lt;/h4&gt;
&lt;p&gt;​	&lt;code&gt;Group&lt;/code&gt;用于查询子图信息，为了提高效率维护内部属性，反正一堆东西在&lt;code&gt;addPerson / delPerson&lt;/code&gt;时更新就好，平均值维护年龄和&lt;code&gt;suma&lt;/code&gt;，方差维护年龄平方和&lt;code&gt;suma^2&lt;/code&gt;，套公式&lt;code&gt;(suma^2 + mean^2 * size - 2 * size * suma) / size&lt;/code&gt;特别地，子图内的增加边&lt;code&gt;(ar)&lt;/code&gt;可以绕开&lt;code&gt;Group&lt;/code&gt;，所以&lt;code&gt;ar&lt;/code&gt;的时候得更新一下边的数据，没啥可操作的，但必须我们对变量的维护这个优化要符合&lt;code&gt;JML&lt;/code&gt;（比如&lt;code&gt;hw11&lt;/code&gt;再维护&lt;code&gt;int suma^2&lt;/code&gt;就溢出了，一定得保证正常情况合法结果），对拍走起&lt;/p&gt;
&lt;h4 id=&#34;点双连通分量-querystronglinked&#34;&gt;点双连通分量-queryStrongLinked&lt;/h4&gt;
&lt;p&gt;​	通读一下规格，查询两个结点是否在某个阶数大于&lt;code&gt;2&lt;/code&gt;的环路上，在讨论区大手子指点下可以解读为两个结点是否在某个阶数大于&lt;code&gt;2&lt;/code&gt;的点双连通分量上，学习了一下资料，点双连通分量竟然是&lt;code&gt;tarjan&lt;/code&gt;？笔者只用过神奇的塔尖求过有向图的强连通分量啊...然后其实把求有向图的强连通分量的&lt;code&gt;tarjan&lt;/code&gt;的&lt;code&gt;DFS&lt;/code&gt;树的出栈条件改一下就好了：递归遍历子节点后再出栈改成每个子节点递归后出栈。上张简单图（数字是&lt;code&gt;DFS&lt;/code&gt;顺序，箭头是&lt;code&gt;DFS&lt;/code&gt;大概的方向）&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609142117.png&#34; alt=&#34;img&#34; style=&#34;zoom:67%;&#34; /&gt;
&lt;p&gt;​	可以看到我们&lt;code&gt;2&lt;/code&gt;次回溯到&lt;code&gt;1&lt;/code&gt;，根据塔尖的递归更新，&lt;code&gt;2, 3 / 4，5&lt;/code&gt;的&lt;code&gt;low&lt;/code&gt;都会标记成&lt;code&gt;1&lt;/code&gt;正好对应两个分量，但在求强连通分量时要等到&lt;code&gt;1&lt;/code&gt;无子节点时再出栈；改改代码，每次回溯到根节点出栈就ok，当然注意不能出栈根节点，它可以处在多个分量中，并且注意特判阶数，&lt;em&gt;&lt;code&gt;O(V + E)&lt;/code&gt;&lt;/em&gt;&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609142137.png&#34; alt=&#34;img&#34; style=&#34;zoom:67%;&#34; /&gt;
&lt;h4 id=&#34;单源带权最短路-queryminpath&#34;&gt;单源带权最短路-queryMinPath&lt;/h4&gt;
&lt;p&gt;​	经典带权最短路，经典&lt;code&gt;Dijkstra&lt;/code&gt;，堆优化后*&lt;code&gt;O(Vlog(V))&lt;/code&gt;*&lt;/p&gt;
&lt;p&gt;​	&lt;code&gt;Java&lt;/code&gt;中想要搞一个小顶堆，&lt;code&gt;PriorityQueue / TreeSet&lt;/code&gt;就够用，两者分别基于静态数组与红黑树，当然注意不能修改堆比较器中涉及的类属性，这将破坏堆维护的性质并导致意料之外的&lt;code&gt;Bug&lt;/code&gt;，只能冗余加或先删除再添加，&lt;code&gt;PriorityQueue&lt;/code&gt;就不要先删再加了，毕竟只能按引用查找遍历到下标再删，&lt;em&gt;&lt;code&gt;O(n)&lt;/code&gt;&lt;/em&gt;，红黑树的增删都是*&lt;code&gt;O(log(n))&lt;/code&gt;*&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;public boolean remove(Object o);
private int indexOf(Object o);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;​	为啥笔者还是&lt;code&gt;TLE&lt;/code&gt;一个点，排查后原来是结点联结边集&lt;code&gt;Hashmap&amp;lt;&amp;gt;(initalSize)&lt;/code&gt;初始化容量太大了，&lt;code&gt;Hashmap&lt;/code&gt;迭代器遍历的核心函数为&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;final HashMap.Node&amp;lt;K, V&amp;gt; nextNode() {...
                if ((this.next = (this.current = e).next) == null &amp;amp;&amp;amp; (t = HashMap.this.table) != null)
                    while(this.index &amp;lt; t.length &amp;amp;&amp;amp; (this.next = t[this.index++]) == null);
...}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;​	可见要一次迭代器遍历要遍历哈希表到最后一个键值对，复杂度是容器的线性，所以说容量不能设太大，或者说这种无序型容器就不适合进行频繁的遍历操作，我们可以冗余存储一个顺序容器。当然对于&lt;code&gt;qmp, qsl&lt;/code&gt;这种频繁访边点权的操作，建立起结点输入&lt;code&gt;id&lt;/code&gt;到数组下标&lt;code&gt;index&lt;/code&gt;的可逆函数 + 静态数组进行离散化就很香了，再把那个图中的边集直接一给&lt;code&gt;MyNetwork&lt;/code&gt;管理，采用&lt;a href=&#34;https://zhuanlan.zhihu.com/p/37481701&#34;&gt;链式前向星&lt;/a&gt;，就纯数组，绕过低效的容器和对象，&lt;s&gt;甚至可以搬自己的&lt;code&gt;c&lt;/code&gt;代码了，起飞&lt;/s&gt;&lt;/p&gt;
&lt;h4 id=&#34;次序区间查询&#34;&gt;次序，区间查询&lt;/h4&gt;
&lt;p&gt;​	&lt;code&gt;queryAgeSum()&lt;/code&gt;单点更新，区间查询，教科书的&lt;a href=&#34;https://www.luogu.com.cn/problem/solution/P3374&#34;&gt;树状数组&lt;/a&gt;，&lt;code&gt;queryNameRank&lt;/code&gt;在查询次数远大于节点数时可以二分下界查找，本次作业应该不太实用&lt;/p&gt;
&lt;h3 id=&#34;四-bug们和修复&#34;&gt;四、Bug们和修复&lt;/h3&gt;
&lt;h4 id=&#34;junit单元测试&#34;&gt;JUnit单元测试&lt;/h4&gt;
&lt;p&gt;​	这是一个可以快捷开展针对特定方法测试的框架，很实用，因为本单元我们要抓住关键矛盾~~，测试复杂方法就好了~~，用&lt;code&gt;@Before&lt;/code&gt;标记可以在测试前初始化数据，用&lt;code&gt;@Test&lt;/code&gt;开展一次测试，一般测一个函数就好了，&lt;code&gt;Junit&lt;/code&gt;可以把不同测试的&lt;code&gt;stdout&lt;/code&gt;分开，关于测试方式，我们往往要优化代码，所以我们可以在测试类中模拟这些方法的朴素版，比如&lt;code&gt;Group&lt;/code&gt;的，然后随机构造数据，通过&lt;code&gt;Junit&lt;/code&gt;的断言&lt;code&gt;Assertion&lt;/code&gt;机制来验证一下优化版是否保证了正确性，当然可以调用&lt;code&gt;c&lt;/code&gt;来对拍，&lt;code&gt;Junit&lt;/code&gt;内嵌于&lt;code&gt;Java&lt;/code&gt;相当灵活，还可以用于抛出异常的测试和运行时间的分析，是非常有用的&lt;code&gt;Debug&lt;/code&gt;工具&lt;/p&gt;
&lt;h4 id=&#34;自测-公测-bugs&#34;&gt;自测 &amp;amp; 公测 Bugs&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;首先是之前说的优先队列内元素不随意修改，笔者竟然没注意到&lt;code&gt;Java&lt;/code&gt;只能传引用的特性；修复： 冗余加入的时候&lt;code&gt;clone()&lt;/code&gt;一下&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Group.getAgeVar&lt;/code&gt;没注意到&lt;code&gt;size == 0&lt;/code&gt;的情况，&lt;code&gt;divide by zero&lt;/code&gt;，&lt;code&gt;hw10&lt;/code&gt;强测翻皮水&lt;/li&gt;
&lt;li&gt;上文说了&lt;code&gt;qmp&lt;/code&gt;在设置哈希表容量过大时不要迭代器遍历，&lt;code&gt;TLE&lt;/code&gt;一个点&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;五-规格设计心得体会&#34;&gt;五、规格设计心得体会&lt;/h3&gt;
&lt;p&gt;​	&lt;code&gt;JML&lt;/code&gt;作为一种形式化语言，表意很准确，我觉得结合接口&lt;code&gt;API&lt;/code&gt;文档使用也就更直观了，本单元作业没有涉及不变式跟继承关系下的规格啥的。但其实主要让笔者体会到了规格设计中的契约式编程方法，设计者和实现者分离，我们在作业中扮演的实现者就是要在&lt;code&gt;JML&lt;/code&gt;规格之下考量可维护性，执行效率，可读性，采用最合适的。这是一种高效的开发模式，对我们在团队项目、工作中很有用处&lt;/p&gt;
">【老物】BUAA_OO_2020_UNIT3</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/buaa_oo_2020_unit2/"" data-c="
          &lt;h3 id=&#34;一-程序结构分析&#34;&gt;一、程序结构分析&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;第五次作业&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;UML &amp;amp; Mertrics&lt;/strong&gt;&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609134715.png&#34; style=&#34;zoom: 65%;&#34; /&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609134833.png&#34; style=&#34;zoom: 80%;&#34; /&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609134855.png&#34; style=&#34;zoom:80%;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;​	电梯的调度问题，实质上就是任务的请求与分配问题，笔者在第五次作业中采用简单的“生产者-消费者”模型，建立了&lt;code&gt;Din&lt;/code&gt;线程作为生产者解析输入并增加运载请求，建立&lt;code&gt;Elev&lt;/code&gt;线程进行输出，待处理数据由主控类&lt;code&gt;Ctrl&lt;/code&gt;维护，并作为电梯“调度器”，前两者的操作由线程安全的&lt;code&gt;Ctrl&lt;/code&gt;负责，后两次作业也延续这样的架构，事实是无需重构也应付得了本次迭代。但笔者请求队列与调度器一体化，且只有一级调度，导致主控类异常臃肿。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;第六次作业&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;UML &amp;amp; Mertrics&lt;/strong&gt;&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609134923.png&#34; style=&#34;zoom: 50%;&#34; /&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609134947.png&#34; style=&#34;zoom:80%;&#34; /&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609135031.png&#34; style=&#34;zoom:80%;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;​	仍是老三样，第六次作业中扩展功能比较容易实现，进行相关类的方法扩写，主要是实现多电梯线程，笔者&lt;code&gt;Ctrl&lt;/code&gt;类的处理不是很好，下一次重写了&lt;code&gt;Ctrl&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;第七次作业&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;UML &amp;amp; Mertrics&lt;/strong&gt;&lt;/p&gt;
  &lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609135114.png&#34; style=&#34;zoom: 67%;&#34; /&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609135157.png&#34; style=&#34;zoom:80%;&#34; /&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609135224.png&#34; style=&#34;zoom:80%;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;​	架构上没有大的改动，为实现换乘功能，笔者建立了&lt;code&gt;MyReq&lt;/code&gt;类存储&lt;code&gt;PersonRequst&lt;/code&gt;与乘客现处楼号，并&lt;s&gt;面向过程&lt;/s&gt;根据换乘地图为各型电梯建立了楼层映射机制&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;二-bug分析&#34;&gt;二、Bug分析&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;第五次作业中主要遇到的是多线程初见的线程调度bug，主要是笔者当时没有找到精准的&lt;code&gt;notify()&lt;/code&gt;条件，居然唤起了&lt;code&gt;RUNNALBE&lt;/code&gt;的线程，由于&lt;code&gt;Ctrl&lt;/code&gt;是共享的，导致输入被电梯线程阻塞，好在最终确定了进入&lt;code&gt;wait()&lt;/code&gt;的条件。&lt;/li&gt;
&lt;li&gt;第六次作业笔者体会到了线程安全问题在本单元的重要性，在处理电梯数目输入时，笔者竟然没用输入文档的&lt;code&gt;ElevatorInput.getElevatorNum()&lt;/code&gt;,而是用&lt;code&gt;(new Scanner(System.in)).nextInt()&lt;/code&gt;,&lt;code&gt;System.in&lt;/code&gt;被输入接口与&lt;code&gt;Scanner&lt;/code&gt;共享，导致输入缓冲区线程不安全，笔者这次属实拉了胯了，直接白给愉悦送走&lt;/li&gt;
&lt;li&gt;第七次作业又出现了恶性bug,当&lt;code&gt;C&lt;/code&gt;型电梯上的乘客想去楼&lt;code&gt;4&lt;/code&gt;时，笔者直接给他送到楼&lt;code&gt;3&lt;/code&gt;，但楼&lt;code&gt;3&lt;/code&gt;只有&lt;code&gt;C&lt;/code&gt;能去，&lt;code&gt;B&lt;/code&gt;接不到，这次强测也是差点翻车了，不过三次作业笔者的整体结构还是可以的，通过严格控制&lt;code&gt;synchronized&lt;/code&gt;语句块的分布与使用，三次作业除了这些bug也没有出现过死锁或是数据冒险啥的难以复现的bug&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;三-互测策略&#34;&gt;三、互测策略&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;第五次作业功能比较简单，只要保证简单的线程调度就只用考虑单电梯调度问题，可以输入30条从底楼到顶楼的数据测试他人是否完成了捎带&lt;/li&gt;
&lt;li&gt;第六次没进互测，不过笔者认为可以从电梯超载与输入指令数最大化这两方面进行hack&lt;/li&gt;
&lt;li&gt;第七次重点在于线程安全与换乘，可以输入仅1条需要换乘的指令，测试他人是否在换乘完成前相关电梯线程已退出，更可以围绕换乘问题，观察三类电梯楼号的定义域可以发现&lt;code&gt;1&lt;/code&gt;,&lt;code&gt;3&lt;/code&gt;,&lt;code&gt;15&lt;/code&gt;是最特殊的3个换乘点，也可以枚举所有请求后排除直达请求进行换乘的完备hack&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;四-对象创建模式&#34;&gt;四、对象创建模式&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;第五次作业只建立了输入线程&lt;code&gt;Din&lt;/code&gt;，电梯线程&lt;code&gt;Elev&lt;/code&gt;，看到一些朋友把调度器也整成线程我是没想到的，&lt;code&gt;Din&lt;/code&gt;负责向&lt;code&gt;Ctrl&lt;/code&gt;输入数据，并在输入及结束后唤醒所有&lt;code&gt;WAITING&lt;/code&gt;的&lt;code&gt;Elev&lt;/code&gt;，&lt;code&gt;Elev&lt;/code&gt;的结束条件是没有待调度请求并且&lt;code&gt;Din&lt;/code&gt;在结束后设置了无输入的全局变量。具体调度策略方面，选用&lt;code&gt;LOOK&lt;/code&gt;算法，但无论&lt;code&gt;SCAN&lt;/code&gt;还是&lt;code&gt;LOOK&lt;/code&gt;，都损失了一个方向上的请求信息，总感觉不太好。于是之后笔者就真香&lt;code&gt;GREEDY&lt;/code&gt;了，打造了纯贪心的电梯调度与电梯间调度策略&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;第六次作业改动不多，主要是改变了&lt;code&gt;Ctrl&lt;/code&gt;中的数据结构适配多部电梯，另外的重头戏就是电梯间调度，笔者在本次将单电梯改为贪心电梯，与同学交流中有的是用平均分配、随机分配来分派任务到各个电梯，但笔者还是采用了电梯间自由地贪心竞争策略。原因是，设想有两架&lt;code&gt;Elev&lt;/code&gt;，一台空载，一台载有乘客，从同一楼号出发，对于某一请求而言，载人&lt;code&gt;Elev&lt;/code&gt;因为电梯内请求而停靠或转向的平均概率更高，空载更有可能抢到请求。实际上载客越少越能直接相应电梯外请求，这有效减小某些电梯一直空转的几率，从而自动实现了优先级任务分配，提高了&lt;code&gt;Elev&lt;/code&gt;并行率，每次上一个人也可以&lt;code&gt;Thread.sleep(5)&lt;/code&gt;提高并行率。&lt;s&gt;还有就是这样不用写二级调度了&lt;/s&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;第七次作业，鉴于要实现换乘，有必要维护需要换乘乘客的当前楼号，于是笔者新建了&lt;code&gt;MyReq&lt;/code&gt;类改进&lt;code&gt;PersonRequst&lt;/code&gt;,对于上文&lt;code&gt;二、&lt;/code&gt;中&lt;code&gt;notify&lt;/code&gt;了运行线程的bug，笔者也找到了安全方便的方案&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-java&#34;&gt;for (int i = 0; i &amp;lt; elevNum; i++) {
            if (elevs.get(i).getState().equals(Thread.State.valueOf(&amp;quot;WAITING&amp;quot;))) {
                synchronized (elevs.get(i)) {
                    elevs.get(i).notifyAll();
                }
            }
        }//先判断是在wait()再notifyAll();
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;同时要注意线程安全的坑，笔者是保证所有&lt;code&gt;Elev&lt;/code&gt;最后一起&lt;code&gt;DEAD&lt;/code&gt;的，防止要换乘的电梯早退&lt;/p&gt;
&lt;p&gt;解决线程设计后，烦人的换乘问题来了，各型电梯的楼号定义域&lt;code&gt;A = [-3, 1] ∪ [15, 20]&lt;/code&gt;,&lt;code&gt;B = [-2, 15] - {3}&lt;/code&gt;，&lt;code&gt;C = [1, 8] * 2 - 1&lt;/code&gt;，找到换乘点&lt;code&gt;(A ∩ B) ∪ (A ∩ C) ∪ (B ∩ C) = (C - {3}) ∪ {-1, -2}&lt;/code&gt;,笔者并不想写二级调度，就建立了地址转换，考虑&lt;code&gt;Elev&lt;/code&gt;对&lt;code&gt;MyReq&lt;/code&gt;的解析，我们只要在电梯&lt;code&gt;A-C&lt;/code&gt;下完成&lt;code&gt;MyReq&lt;/code&gt;在电梯内和在电梯外的楼号转换就行,实际上完成前者就行，若电梯内&lt;code&gt;getToFloor()&lt;/code&gt;非法，就将目的地改为换乘路径最短的换乘点。电梯外的话，先假设上电梯，转换后若目标就是当前楼层，就保留原本目的地，否则直接上电梯。笔者真是懒死了，这类特定情境问题还是最好编程打表，别像笔者败在细节。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;五-心得体会&#34;&gt;五、心得体会&lt;/h3&gt;
&lt;p&gt;​		笔者本单元的作业效果并不理想，还是对于线程安全的理解不深，以及没有注重多线程程序设计中的细节问题导致bug，笔者还是对自己的调度器耿耿于怀，笔者理应实现队列，调度分离的，这样的调度器耦合度太高了。&lt;/p&gt;
">【老物】BUAA_OO_2020_UNIT2</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/lao-wu-buaa_oo_2020_unit1/"" data-c="
          &lt;center&gt;唐完了&lt;/center&gt;
&lt;!-- more --&gt;
&lt;h3 id=&#34;一-程序结构分析&#34;&gt;一、程序结构分析&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;第一次作业&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;UML &amp;amp; Mertrics&lt;/strong&gt;&lt;/p&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609132549.png&#34; alt=&#34;0&#34; style=&#34;zoom: 67%;&#34; /&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609133246.png&#34; alt=&#34;1&#34; style=&#34;zoom:120%;&#34; /&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609133306.png&#34; alt=&#34;2&#34; style=&#34;zoom:140%;&#34; /&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;​	由于数据处理简单，第一次作业中笔者发挥了面向过程的思想，将项转换成&lt;code&gt;Biginteger, Biginteger&lt;/code&gt;的字典逐项输出就行了，导致类复杂度、方法复杂度耦合度都很高，后面只能重写。笔者在后面作业意识到这种面向过程式程序不利于迭代开发。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;第二次作业&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;UML &amp;amp; Mertrics&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609133324.png&#34; alt=&#34;3&#34; style=&#34;zoom: 67%;&#34; /&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609133542.png&#34; alt=&#34;https://images.cnblogs.com/cnblogs_com/iff0/1674594/o_200319060009%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200319135957.png&#34; style=&#34;zoom:60%;&#34; /&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609134256.png&#34; alt=&#34;https://images.cnblogs.com/cnblogs_com/iff0/1674594/o_200319060142%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200319140130.png&#34; style=&#34;zoom: 80%;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;​	笔者在第二次作业中建立了项-表达式的层次，建立了合并类与输入处理类，但没有将因子也建立类，导致第三次作业无法处理嵌套再次重构，&lt;code&gt;Parse&lt;/code&gt;类与项&lt;code&gt;Term&lt;/code&gt;类较臃肿，因为笔者将四元组作为项的数据结构。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;第三次作业&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;UML &amp;amp; Mertrics&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609134318.png&#34; alt=&#34;22&#34; style=&#34;zoom:80%;&#34; /&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609134358.png&#34; style=&#34;zoom: 50%;&#34; /&gt;&lt;img src=&#34;https://raw.githubusercontent.com/zixfy/imageshack2023/main/img/20230609134430.png&#34; style=&#34;zoom:80%;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;​	笔者在第三次作业根据表达式-项-因子的层次建立类，&lt;code&gt;Term&lt;/code&gt;类与&lt;code&gt;Parse&lt;/code&gt;类仍然复杂，因为笔者在此次作业中，把输入输出处理聚集在&lt;code&gt;Parse&lt;/code&gt;，把化简方法分散到&lt;code&gt;Term&lt;/code&gt;，&lt;code&gt;Fact&lt;/code&gt;类中，导致耦合度较高。&lt;/p&gt;
&lt;h3 id=&#34;二-bug分析&#34;&gt;二、Bug分析&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;笔者两处Bug都在输出化简上
&lt;ul&gt;
&lt;li&gt;第二次作业中，笔者没有在正常数&lt;code&gt;Term&lt;/code&gt;前打印&lt;code&gt;&#39;+&#39;&lt;/code&gt;，因为&lt;code&gt;Term&lt;/code&gt;输出函数内&lt;code&gt;if-else&lt;/code&gt;太多了，也很难看，笔者随后想到打印&lt;code&gt;Term&lt;/code&gt;时正项一定打印&lt;code&gt;&#39;+&#39;&lt;/code&gt;，并优先输出常数的方法，对于表达式&lt;code&gt;Expr&lt;/code&gt;中多符号直接换成单符号，&lt;code&gt;&amp;quot;+1*&amp;quot;&lt;/code&gt;直接换成&lt;code&gt;&amp;quot;+&amp;quot;&lt;/code&gt;就完事了，然而，&lt;/li&gt;
&lt;li&gt;第三次作业中，笔者逻辑错误，对于&lt;code&gt;Term&lt;/code&gt;，先合并&lt;code&gt;Term&lt;/code&gt;中的因子&lt;code&gt;Fact&lt;/code&gt;，再把&lt;code&gt;Term&lt;/code&gt;中实例为复合因子&lt;code&gt;Complex&lt;/code&gt;且只含一个&lt;code&gt;Term&lt;/code&gt;的拆成&lt;code&gt;ArrayList&amp;lt;Fact&amp;gt;&lt;/code&gt;加入&lt;code&gt;Term&lt;/code&gt;中；显然这两次处理顺序反了，于是可能输出一个以上连续的常数因子&lt;code&gt;Constal&lt;/code&gt;（&lt;code&gt;+5*+1*....&lt;/code&gt;），超出了笔者的设想，化简方法于是造成了错误。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;三-互测策略&#34;&gt;三、互测策略&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;仔细看别人的代码，我从一些结构清晰的同学的代码收获很多，对于结构混乱没有注释的还是放弃阅读吧&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;一个一个运行其他人&lt;code&gt;Project&lt;/code&gt;太慢了，可以写程序输入一组数据然后让其他人程序同时运行得到多人的输出，提高效率&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;构造边界数据，可惜这次不能输入非法数据&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;四-对象创建模式&#34;&gt;四、对象创建模式&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;第一次作业是淳朴的面向过程思想，只有一个&lt;code&gt;Expr&lt;/code&gt;类，没有体现出层次化的设计模式，第一次作业，我学会了对象构造方法，把解析的数据传入&lt;code&gt;Expr&lt;/code&gt;，再调用&lt;code&gt;Expr&lt;/code&gt;中的&lt;code&gt;deriv()&lt;/code&gt;进行输出。&lt;/li&gt;
&lt;li&gt;第二次作业在输入处理上放弃了一个正则表达式到位的思想，改成了分层次处理，先把表达式分割成项，处理项，&lt;code&gt;Wrong Format&lt;/code&gt;的处理也分层处理，表达式只管是不是合法的表达式，项只管是不是合法的项，在第三次作业中沿用了这种方法，处理很顺利。为方便求导没有体现出因子的层次，导致第三次重构，合并仍然采用&lt;code&gt;Hashmap&amp;lt;&amp;gt;&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;第三次作业相比于第二次构建了因子类&lt;code&gt;Fact&lt;/code&gt;，我把表达式&lt;code&gt;Expr&lt;/code&gt;继承于复合因子&lt;code&gt;Complex&lt;/code&gt;，感觉还是有点奇怪的，但他们的数据结构是一样的，不同的是输出方式。输入还是分层处理，求导方面，笔者思维有限，不太理解深浅拷贝的效果，在求导时尽量深拷贝以防意想不到的错误。输出的关键是化简。笔者理应该构建化简类来解耦的，笔者通过递归式的化简-合并完成整个表达式的化简，当然有些地方没化简比如&lt;code&gt;sin(0)&lt;/code&gt;, &lt;code&gt;cos(0)&lt;/code&gt;笔者没有进行幂函数的合并，在笔者的结构中，最好在&lt;code&gt;Term&lt;/code&gt;下继承一个类来表示幂函数方便化简。&lt;/li&gt;
&lt;li&gt;三次作业中没有明确的设计模式，随遇而安，不利于构造清晰的程序结构。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;五-心得体会&#34;&gt;五、心得体会&lt;/h3&gt;
&lt;p&gt;​	经过第一单元的学习，我意识到面向对象思想的重要性，因为单纯的面向过程编程可维护性低，难以迭代式开发，导致我重写了2次；其次就是在写程序时必须要注意程序的鲁棒性，对异常输入有识别与处理机制；还有就是不要盲目开写，良好的构思可以效果拔群。&lt;/p&gt;
">【老物】BUAA_OO_2020_UNIT1</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/about/"" data-c="
          &lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;blockquote&gt;
&lt;p&gt;不要对我说红色不该遗忘，温度不迷茫，方向不倔强&lt;/p&gt;
&lt;/blockquote&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;p&gt;&lt;a href=&#34;https://zixfy.github.io/post/za-wu-dai-tian-keng-kai-keng/&#34;&gt;my TODO&lt;/a&gt;&lt;/p&gt;
">关于</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="http://zixfy.github.io/post/hello-gridea/"" data-c="
          &lt;p&gt;👏  欢迎使用 &lt;strong&gt;Gridea&lt;/strong&gt; ！&lt;br&gt;
✍️  &lt;strong&gt;Gridea&lt;/strong&gt; 一个静态博客写作客户端。你可以用它来记录你的生活、心情、知识、笔记、创意... ...&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/getgridea/gridea&#34;&gt;Github&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://gridea.dev/&#34;&gt;Gridea 主页&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://fehey.com/&#34;&gt;示例网站&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;特性&#34;&gt;特性👇&lt;/h2&gt;
&lt;p&gt;📝  你可以使用最酷的 &lt;strong&gt;Markdown&lt;/strong&gt; 语法，进行快速创作&lt;/p&gt;
&lt;p&gt;🌉  你可以给文章配上精美的封面图和在文章任意位置插入图片&lt;/p&gt;
&lt;p&gt;🏷️  你可以对文章进行标签分组&lt;/p&gt;
&lt;p&gt;📋  你可以自定义菜单，甚至可以创建外部链接菜单&lt;/p&gt;
&lt;p&gt;💻  你可以在 &lt;strong&gt;Windows&lt;/strong&gt;，&lt;strong&gt;MacOS&lt;/strong&gt; 或 &lt;strong&gt;Linux&lt;/strong&gt; 设备上使用此客户端&lt;/p&gt;
&lt;p&gt;🌎  你可以使用 &lt;strong&gt;𝖦𝗂𝗍𝗁𝗎𝖻 𝖯𝖺𝗀𝖾𝗌&lt;/strong&gt; 或 &lt;strong&gt;Coding Pages&lt;/strong&gt; 向世界展示，未来将支持更多平台&lt;/p&gt;
&lt;p&gt;💬  你可以进行简单的配置，接入 &lt;a href=&#34;https://github.com/gitalk/gitalk&#34;&gt;Gitalk&lt;/a&gt; 或 &lt;a href=&#34;https://github.com/SukkaW/DisqusJS&#34;&gt;DisqusJS&lt;/a&gt; 评论系统&lt;/p&gt;
&lt;p&gt;🇬🇧  你可以使用&lt;strong&gt;中文简体&lt;/strong&gt;或&lt;strong&gt;英语&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;🌁  你可以任意使用应用内默认主题或任意第三方主题，强大的主题自定义能力&lt;/p&gt;
&lt;p&gt;🖥  你可以自定义源文件夹，利用 OneDrive、百度网盘、iCloud、Dropbox 等进行多设备同步&lt;/p&gt;
&lt;p&gt;🌱 当然 &lt;strong&gt;Gridea&lt;/strong&gt; 还很年轻，有很多不足，但请相信，它会不停向前 🏃&lt;/p&gt;
&lt;p&gt;未来，它一定会成为你离不开的伙伴&lt;/p&gt;
&lt;p&gt;尽情发挥你的才华吧！&lt;/p&gt;
&lt;p&gt;😘 Enjoy~&lt;/p&gt;
">Hello World</a>
      </div>
      
    </div>
    <div class="page">
      <div id="page_ul"></div>
    </div>
  </div>
</div>
<script>
  !function () {
    let searchMask = document.querySelector('#search_mask');
    let result = document.querySelector('#result');
    let items = document.querySelectorAll('.item');
    let searchBox = document.querySelector('#search');
    let statCount = document.querySelector('#stat_count');
    let statTimes = document.querySelector('#stat_times');
    let pageUl = document.querySelector('#page_ul');
    let close = document.querySelector('#close');
    
    close.addEventListener('click', function() {
      searchMask.style = 'display: none;'
    })

    let finds = [];
    let contents = [];
    let pageSize = 10;
    items.forEach(item => {
      let a = item.querySelector('a');
      contents.push({
        title: a.innerText,
        details: a.dataset.c,
        link: a.href
      })
      item.remove();
    })

    function insertStr(soure, start, count) {
      let newStr = soure.substr(start, count);
      return soure.slice(0, start) + '<em>' + newStr + '</em>' + soure.slice(start + count);
    }

    pageUl.addEventListener('click', function(event) {
      let target = event.target;
      if (target.__proto__ === HTMLSpanElement.prototype) {
        appendResults(parseInt(target.dataset.i));
      }
    })

    function appendResults(index) {
      let htmlResult = '';
      let start = index || 0;
      let end = Math.min(start + pageSize, finds.length);
      for (let i = start; i < end; i++) {
        const current = finds[i];
        let html = current.title;
        let sum = 0;
        let positions = current.positions;
        positions.forEach(position => {
          html = insertStr(html, position.start + sum, position.count);
          sum += 9;
        })
        htmlResult += `<div class="item"><a class="result-title" href="${current.link}">${html}</a></div>`;
      }
      result.innerHTML = htmlResult;
      pageUl.innerHTML = '';
      let count = finds.length / pageSize;
      let lis = '';
      if (start !== 0) {
        lis += `<span class="fa fa-angle-left" data-i='${start - 1}'></span>`;
      }
      for (let i = 0; i < count; i++) {
        lis += `<span class='${i === start?'current':''}' data-i='${i}'>${i+1}</span>`;     
      }
      if (start+1 < count) {
        lis += `<span class="fa fa-angle-right" data-i='${start+1}'></span>`;  
      }
      pageUl.innerHTML = lis;
    }

    function search(delay) {
      let timer = null
      return function () {
        clearTimeout(timer)
        timer = setTimeout(() => {
          let start = Date.now();
          let segments = searchBox.value.split(' ').filter(c => c != '');
          if (segments.length <= 0) {
            return;
          }
          finds = [];
          let htmlResult = '';
          contents.forEach(content => {
            let title = content.title;
            let positions = [];
            let find = false;
            segments.forEach((segment) => {
              if (content.title.includes(segment)) {
                find = true;
                positions.push({
                  start: content.title.indexOf(segment),
                  count: segment.length
                })
              } else if (content.details.includes(segment)) {
                find = true;
              }
            });
            if (find) {
              finds.push({
                title: content.title,
                link: content.link,
                positions
              });
            }
          })
          appendResults(0);
          statCount.textContent = finds.length;
          statTimes.textContent = Date.now() - start;
        }, delay)
      }
    }
    searchBox.addEventListener('input', search(200));
  }()
</script>

<input hidden id="copy" />
<script>
  !function () {
    let times = document.querySelectorAll('.publish-time');
    for (let i = 0; i < times.length; i++) {
      let date = times[i].dataset.t;
      let time = Math.floor((new Date().getTime() - new Date(date).getTime()) / 1000);
      if (time < 60) {
        str = time + '秒之前';
      } else if (time < 3600) {
        str = Math.floor(time / 60) + '分钟之前';
      } else if (time >= 3600 && time < 86400) {
        str = Math.floor(time / 3600) + '小时之前';
      } else if (time >= 86400 && time < 259200) {
        str = Math.floor(time / 86400) + '天之前';
      } else {
        str = times[i].textContent;
      }
      times[i].textContent = str;
    }
  }();
</script>

<script>
  let language = '';
  if (language !== '') {
    let map = new Map();
    if (language === 'en') {
      map.set('search', 'Search');
      map.set('category', 'Categories');
      map.set('article', 'Articles');
      map.set('tag', 'Tags');
      map.set('top', 'Top');
      map.set('publish', 'published');
      map.set('minute', ' minutes');
      map.set('read-more', 'Read More');
      map.set('view', 'View');
      map.set('words', ' words');
      map.set('category-in', 'category in');
      map.set('preview', 'Meta');
      map.set('index', 'Toc');
      map.set('no-archives', "You haven't created yet");
      map.set('archives', " articles in total");
      map.set('cloud-tags', " tags in total");
      map.set('copyright', "Copyright: ");
      map.set('author', "Author: ");
      map.set('link', "Link: ");
      map.set('leave-message', "Leave a message");
      map.set('format', "Links Format");
      map.set('site-name', "Name: ");
      map.set('site-link', "Link: ");
      map.set('site-desc', "Desc: ");
      map.set('stat', " related results, taking ");
      map.set('stat-time', " ms");
      map.set('site-img', "Image: ");
    }

    if (map.size > 0) {
      let lanElems = document.querySelectorAll('.language');
      lanElems.forEach(elem => {
        let lan = elem.dataset.lan, text = map.get(lan);
        if (elem.__proto__ === HTMLInputElement.prototype) {
          elem.placeholder = text
        } else {
          if (elem.dataset.count) {
            text = elem.dataset.count + text;
          }
          elem.textContent = text;
        }
      })
    }
  }

  window.Clipboard = (function (window, document, navigator) {
    var textArea,
      copy;

    // 判断是不是ios端
    function isOS() {
      return navigator.userAgent.match(/ipad|iphone/i);
    }
    //创建文本元素
    function createTextArea(text) {
      textArea = document.createElement('textArea');
      textArea.value = text;
      textArea.style.width = 0;
      textArea.style.height = 0;
      textArea.clientHeight = 0;
      textArea.clientWidth = 0;
      document.body.appendChild(textArea);
    }
    //选择内容
    function selectText() {
      var range,
        selection;

      if (isOS()) {
        range = document.createRange();
        range.selectNodeContents(textArea);
        selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        textArea.setSelectionRange(0, 999999);
      } else {
        textArea.select();
      }
    }

    //复制到剪贴板
    function copyToClipboard() {
      try {
        document.execCommand("Copy")
      } catch (err) {
        alert("复制错误！请手动复制！")
      }
      document.body.removeChild(textArea);
    }

    copy = function (text) {
      createTextArea(text);
      selectText();
      copyToClipboard();
    };

    return {
      copy: copy
    };
  })(window, document, navigator);

  function copyCode(e) {
    if (e.srcElement.tagName === 'SPAN' && e.srcElement.classList.contains('copy-code')) {
      let code = e.currentTarget.querySelector('code');
      var text = code.innerText;
      if (e.srcElement.textContent === '复制成功') {
        return;
      }
      e.srcElement.textContent = '复制成功';
      (function (elem) {
        setTimeout(() => {
          if (elem.textContent === '复制成功') {
            elem.textContent = '复制代码'
          }
        }, 1000);
      })(e.srcElement)
      Clipboard.copy(text);
    }
  }

  let pres = document.querySelectorAll('pre');
  pres.forEach(pre => {
    let code = pre.querySelector('code');
    let copyElem = document.createElement('span');
    copyElem.classList.add('copy-code');
    copyElem.textContent = '复制代码';
    pre.appendChild(copyElem);
    pre.onclick = copyCode
  })

</script>
<script src="/media/js/motion.js"></script>


  <script
    src="https://cdn.jsdelivr.net/gh/cferdinandi/smooth-scroll/dist/smooth-scroll.polyfills.min.js"></script>
  <script>
    var scroll = new SmoothScroll('a[href*="#"]', {
      speed: 200
    });
  </script>



<script src="/media/js/mouse/love.js"></script>


  <script src="/media/js/cool.js"></script>



  <div class="snow-container"></div>
  <script color="0,205,205" pointer-events="auto" zIndex="-1" opacity='0.7' count="99" src="/media/js/bg/canvas-nest.js"></script>

</html>